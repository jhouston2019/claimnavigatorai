<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClaimNavigatorAI - Integration Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-900 mb-8">ClaimNavigatorAI - Integration Test</h1>
        
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Test AI Response Agent</h2>
            <p class="text-gray-600 mb-4">This page tests the integration between frontend and backend components.</p>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Test Mode</label>
                    <select id="testMode" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        <option value="reply">Standard Reply</option>
                        <option value="summary">Summary & Guidance</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Test Letter</label>
                    <textarea id="testLetter" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="Enter test insurer letter...">Dear Policyholder,

We have reviewed your claim and determined that the damage is not covered under your policy due to the exclusion clause in section 4.2. Your claim is hereby denied.

Sincerely,
Claims Department</textarea>
                </div>
                
                <button id="testBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md">
                    Test AI Response
                </button>
            </div>
        </div>
        
        <div id="testResults" class="bg-white rounded-lg shadow-lg p-6 hidden">
            <h3 class="text-lg font-semibold mb-4">Test Results</h3>
            <div id="resultsContent"></div>
        </div>
    </div>

    <script>
        const testBtn = document.getElementById('testBtn');
        const testResults = document.getElementById('testResults');
        const resultsContent = document.getElementById('resultsContent');
        const testMode = document.getElementById('testMode');
        const testLetter = document.getElementById('testLetter');

        testBtn.addEventListener('click', async () => {
            testBtn.disabled = true;
            testBtn.textContent = 'Testing...';
            
            try {
                const response = await fetch('/.netlify/functions/aiResponseAgent', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        mode: testMode.value,
                        claim: {
                            name: 'Test Policyholder',
                            policyNumber: 'TEST-123456',
                            claimNumber: 'CLM-789012',
                            dateOfLoss: '2024-01-15',
                            company: 'Test Insurance Co',
                            phone: '+1-555-0123',
                            email: 'test@example.com',
                            address: '123 Test St, Test City, TC 12345'
                        },
                        letter: testLetter.value
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    resultsContent.innerHTML = `
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-semibold text-green-600">✅ Test Successful</h4>
                                <p class="text-sm text-gray-600">Response received in ${Date.now() - testStartTime}ms</p>
                            </div>
                            <div>
                                <h5 class="font-medium">Analysis:</h5>
                                <p class="text-sm bg-gray-50 p-2 rounded">${data.analysis}</p>
                            </div>
                            <div>
                                <h5 class="font-medium">Issues Detected:</h5>
                                <ul class="text-sm list-disc list-inside">
                                    ${data.issues.map(issue => `<li>${issue}</li>`).join('')}
                                </ul>
                            </div>
                            <div>
                                <h5 class="font-medium">Suggestions:</h5>
                                <ul class="text-sm list-disc list-inside">
                                    ${data.suggestions.map(suggestion => `<li>${suggestion}</li>`).join('')}
                                </ul>
                            </div>
                            <div>
                                <h5 class="font-medium">Draft Letter:</h5>
                                <div class="text-sm bg-gray-50 p-2 rounded whitespace-pre-wrap">${data.draftLetter}</div>
                            </div>
                        </div>
                    `;
                } else {
                    resultsContent.innerHTML = `
                        <div class="text-red-600">
                            <h4 class="font-semibold">❌ Test Failed</h4>
                            <p>Error: ${data.error}</p>
                            <p class="text-sm">Details: ${data.details}</p>
                        </div>
                    `;
                }
                
                testResults.classList.remove('hidden');
                
            } catch (error) {
                resultsContent.innerHTML = `
                    <div class="text-red-600">
                        <h4 class="font-semibold">❌ Connection Error</h4>
                        <p>${error.message}</p>
                        <p class="text-sm">Make sure the Netlify function is deployed and accessible.</p>
                    </div>
                `;
                testResults.classList.remove('hidden');
            } finally {
                testBtn.disabled = false;
                testBtn.textContent = 'Test AI Response';
            }
        });

        const testStartTime = Date.now();
    </script>
</body>
</html>
