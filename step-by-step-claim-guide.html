<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Claim Management Center - ClaimNavigatorAI</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/app/assets/css/tool-visual-alignment.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="storage/claimStorage.js"></script>
  <script src="ai-expert-config.js"></script>
  <script src="/app/assets/js/tool-registry.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --navy-primary: #1e3a5f;
      --navy-dark: #0f1f3d;
      --navy-light: #2c5282;
      --gold-accent: #d4af37;
      --gold-light: #f0e5c5;
      --bg-page: #c4c6c8;
      --bg-white: #ffffff;
      --bg-cream: #fafaf8;
      --bg-card: #ffffff;
      --bg-card-hover: #f8f9fb;
      --border-light: #e8edf2;
      --border-medium: #d1dce6;
      --border-dark: #b8c5d3;
      --text-primary: #1a202c;
      --text-secondary: #4a5568;
      --text-muted: #718096;
      --text-white: #ffffff;
      --accent-blue: #3b82f6;
      --accent-green: #10b981;
      --accent-red: #ef4444;
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.08);
      --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
      --shadow-lg: 0 10px 30px rgba(0,0,0,0.12);
    }

    /* Global Navigation Header */
    .global-header,
    header.global-header,
    body .global-header,
    body > .global-header,
    body header.global-header {
      background: linear-gradient(135deg, #1e3a5f 0%, #0f1f3d 100%) !important;
      background-color: #1e3a5f !important;
      border-bottom: 3px solid rgba(255, 255, 255, 0.1) !important;
      position: sticky !important;
      top: 0 !important;
      z-index: 1000 !important;
    }

    .global-nav {
      max-width: 1400px !important;
      margin: 0 auto !important;
      display: flex !important;
      align-items: center !important;
      justify-content: space-between !important;
      padding: 0 32px !important;
      height: 60px !important;
      background: transparent !important;
    }

    .nav-brand {
      font-size: 18px !important;
      font-weight: 700 !important;
      color: white !important;
      text-decoration: none !important;
    }

    .nav-menu {
      display: flex !important;
      align-items: center !important;
      gap: 0 !important;
      list-style: none !important;
      margin: 0 !important;
      padding: 0 !important;
    }

    .nav-item {
      position: relative !important;
    }

    .nav-link {
      display: flex !important;
      align-items: center !important;
      padding: 20px 20px !important;
      color: rgba(255, 255, 255, 0.9) !important;
      text-decoration: none !important;
      font-size: 14px !important;
      font-weight: 500 !important;
      transition: all 0.2s ease !important;
      border-bottom: 3px solid transparent !important;
      white-space: nowrap !important;
    }

    .nav-link:hover {
      background: rgba(255, 255, 255, 0.1) !important;
      color: white !important;
    }

    .nav-link.active {
      background: rgba(255, 255, 255, 0.15) !important;
      color: #ffffff !important;
      border-bottom-color: #ffffff !important;
      font-weight: 600 !important;
    }

    .nav-link-primary {
      color: #ffffff !important;
      font-weight: 600 !important;
    }

    .nav-dropdown {
      position: relative;
    }

    .dropdown-toggle::after {
      content: '▼';
      font-size: 10px;
      margin-left: 6px;
      opacity: 0.7;
      transition: transform 0.2s ease;
      display: inline-block;
    }

    .nav-dropdown.open .dropdown-toggle::after {
      transform: rotate(180deg);
    }

    .dropdown-menu {
      position: absolute;
      top: 100%;
      left: 0;
      background: white;
      border: 1px solid var(--border-light);
      border-radius: 0 0 8px 8px;
      box-shadow: var(--shadow-md);
      min-width: 200px;
      display: none;
      z-index: 1001;
    }

    /* Show dropdown when .open class is present */
    .nav-dropdown.open .dropdown-menu {
      display: block;
    }

    .dropdown-item {
      display: block;
      padding: 12px 20px;
      color: var(--text-primary);
      text-decoration: none;
      font-size: 14px;
      transition: background 0.2s;
      border-bottom: 1px solid var(--border-light);
    }

    .dropdown-item:last-child {
      border-bottom: none;
      border-radius: 0 0 8px 8px;
    }

    .dropdown-item:hover {
      background: var(--bg-cream);
      color: var(--navy-primary);
    }

    .nav-subtext {
      display: block;
      font-size: 11px;
      color: rgba(255, 255, 255, 0.6);
      font-weight: 400;
      margin-top: 2px;
    }

    /* Mobile Navigation */
    @media (max-width: 968px) {
      .global-nav {
        padding: 0 16px;
        height: auto;
        flex-direction: column;
        align-items: flex-start;
        padding-bottom: 8px;
      }

      .nav-brand {
        padding: 12px 0;
      }

      .nav-menu {
        flex-direction: column;
        align-items: flex-start;
        width: 100%;
        gap: 0;
      }

      .nav-item {
        width: 100%;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
      }

      .nav-link {
        width: 100%;
        padding: 12px 0;
        flex-direction: column;
        align-items: flex-start;
        border-bottom: none;
      }

      .nav-link.active {
        border-bottom: none;
        border-left: 3px solid #ffffff;
        padding-left: 12px;
      }

      .nav-subtext {
        font-size: 10px;
      }

      .dropdown-menu {
        position: static;
        box-shadow: none;
        border: none;
        border-left: 3px solid var(--border-light);
        border-radius: 0;
        margin-left: 12px;
        background: rgba(255, 255, 255, 0.05);
        display: none;
      }

      .nav-dropdown.open .dropdown-menu {
        display: block;
      }

      .dropdown-item {
        color: rgba(255, 255, 255, 0.8);
        font-size: 13px;
        padding: 10px 16px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      }

      .dropdown-item:hover {
        background: rgba(255, 255, 255, 0.1);
        color: white;
      }
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: #e3e5eb;
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.6;
    }

    .container {
      max-width: 100%;
      margin: 0;
      padding: 0;
    }

    /* Page Header */
    .page-header {
      margin-bottom: 0;
      text-align: center;
      background: #1e3a5f;
      padding: 20px 40px;
      border-radius: 0;
      box-shadow: none;
      border-bottom: 2px solid #0f1f3d;
    }

    .page-title {
      font-size: 28px;
      font-weight: 700;
      color: #ffffff;
      letter-spacing: -0.02em;
      margin-bottom: 6px;
      line-height: 1.3;
    }

    .page-subtitle {
      font-size: 15px;
      color: #ffffff;
      max-width: 100%;
      margin: 0;
    }

    /* Claim Information Panel */
    .claim-info-panel {
      background: #1e3a5f;
      border: none;
      border-bottom: 1px solid #0f1f3d;
      border-radius: 0;
      padding: 10px 40px;
      margin-bottom: 0;
      box-shadow: none;
    }

    .claim-info-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      padding-bottom: 0;
      border-bottom: none;
    }

    .claim-info-title {
      font-size: 12px;
      font-weight: 700;
      color: #ffffff;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .btn-edit {
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
      color: #ffffff;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-edit:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.5);
      color: #ffffff;
    }

    .claim-info-grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 10px;
      margin-bottom: 6px;
    }

    .claim-info-item {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .info-label {
      font-size: 9px;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.7);
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }

    .info-value {
      font-size: 12px;
      font-weight: 600;
      color: #ffffff;
    }

    .info-value.urgent {
      color: #ffffff;
      font-weight: 700;
    }

    .info-value.status-active {
      color: #60a5fa;
    }

    .deadline-alert {
      background: rgba(96, 165, 250, 0.15);
      border: 1px solid rgba(96, 165, 250, 0.3);
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 11px;
      color: #93c5fd;
    }

    /* Where Are You Section */
    .where-are-you-section {
      background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
      border: 2px solid #3b82f6;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
    }

    .section-heading {
      font-size: 18px;
      font-weight: 700;
      color: var(--navy-dark);
      text-align: center;
      margin-bottom: 6px;
    }

    .section-description {
      font-size: 13px;
      color: var(--text-secondary);
      text-align: center;
      margin-bottom: 12px;
    }

    .quick-jump-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 8px;
    }

    .quick-jump-btn {
      background: white;
      border: 1px solid var(--border-light);
      border-radius: 6px;
      padding: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: left;
    }

    .quick-jump-btn:hover {
      border-color: var(--navy-primary);
      box-shadow: var(--shadow-sm);
      transform: translateY(-1px);
    }

    .jump-icon {
      font-size: 20px;
      flex-shrink: 0;
    }

    .jump-text {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-primary);
      line-height: 1.3;
    }

    .content-area {
      max-width: 1400px;
      margin: 0 auto;
      padding: 16px 32px;
    }

    /* Progress Indicator */
    .progress-indicator {
      position: fixed;
      top: 24px;
      right: 24px;
      background: var(--bg-white);
      border: 2px solid var(--border-medium);
      border-radius: 28px;
      padding: 12px 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      z-index: 1000;
      box-shadow: var(--shadow-md);
    }

    .progress-ring {
      width: 36px;
      height: 36px;
      position: relative;
    }

    .progress-ring svg {
      transform: rotate(-90deg);
    }

    .progress-ring-bg {
      fill: none;
      stroke: var(--border-light);
      stroke-width: 3;
    }

    .progress-ring-fill {
      fill: none;
      stroke: var(--navy-primary);
      stroke-width: 3;
      stroke-linecap: round;
      stroke-dasharray: 100;
      stroke-dashoffset: calc(100 - (100 * var(--progress, 0)) / 100);
      transition: stroke-dashoffset 0.6s ease-out;
    }

    .progress-text {
      display: flex;
      flex-direction: column;
    }

    .progress-percent {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .progress-stage {
      font-size: 12px;
      color: var(--text-muted);
    }

    /* Step Accordion */
    .step-accordion {
      background: transparent;
      border-radius: 0;
    }

    .accordion-item {
      background: #ffffff;
      border: 1px solid #d1d5db;
      border-left: 3px solid #0f1f3d;
      border-radius: 10px;
      margin-top: 16px;
      margin-bottom: 16px;
      padding: 0;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.35), 0 3px 8px rgba(0, 0, 0, 0.25);
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      overflow: hidden;
    }
    
    .accordion-item:hover {
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.45), 0 5px 12px rgba(0, 0, 0, 0.35);
      transform: translateY(-3px);
    }

    .accordion-item:first-child {
      margin-top: 0;
    }

    .accordion-item:last-child {
      margin-bottom: 0;
    }

    .accordion-item.active {
      border-left-color: #1e3a8a;
      background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
      box-shadow: 0 0 0 1px #93c5fd, 0 4px 16px rgba(59, 130, 246, 0.12);
      border-color: #93c5fd;
    }
    
    .accordion-item.active:hover {
      transform: translateY(-1px);
      box-shadow: 0 0 0 1px #3b82f6, 0 6px 20px rgba(59, 130, 246, 0.16);
    }
    
    .accordion-item.completed {
      border-left-color: #059669;
      background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
      box-shadow: 0 0 0 1px #a7f3d0, 0 2px 8px rgba(16, 185, 129, 0.08);
    }
    
    .accordion-item.completed:hover {
      box-shadow: 0 0 0 1px #10b981, 0 4px 12px rgba(16, 185, 129, 0.12);
    }
    
    .accordion-item.step-complete-flash {
      animation: stepCompleteFlash 2s ease-in-out;
    }
    
    @keyframes stepCompleteFlash {
      0%, 100% {
        background: linear-gradient(135deg, #ffffff 0%, #ffffff 100%);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.35), 0 3px 8px rgba(0, 0, 0, 0.25);
      }
      50% {
        background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
        box-shadow: 0 0 0 2px #10b981, 0 8px 24px rgba(16, 185, 129, 0.3);
        transform: scale(1.02);
      }
    }

    .accordion-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 18px 24px;
      cursor: pointer;
      transition: all 0.2s ease;
      background: transparent;
      border-radius: 10px 10px 0 0;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }

    .accordion-header:hover {
      background: rgba(0, 0, 0, 0.03);
    }

    .accordion-item.active .accordion-header {
      background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
      border-bottom-color: #1e3a8a;
    }

    .accordion-item.completed .accordion-header {
      background: rgba(16, 185, 129, 0.02);
      border-bottom-color: #d1fae5;
    }

    .accordion-left {
      display: flex;
      align-items: flex-start;
      gap: 16px;
      flex: 1;
    }

    .accordion-number {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      border: 2px solid #cbd5e1;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 20px;
      color: #64748b;
      flex-shrink: 0;
      transition: all 0.2s ease;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.06);
    }

    .accordion-item.active .accordion-number {
      background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
      border-color: #1e3a8a;
      color: white;
      box-shadow: 0 2px 8px rgba(30, 58, 138, 0.4), 0 0 0 3px rgba(30, 58, 138, 0.12);
    }

    .accordion-item.completed .accordion-number {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      border-color: #047857;
      color: white;
      box-shadow: 0 2px 6px rgba(16, 185, 129, 0.25);
    }

    .accordion-item.completed .accordion-number::after {
      content: '✓';
    }

    .accordion-title-area {
      flex: 1;
    }

    .accordion-title {
      font-size: 22px;
      font-weight: 700;
      color: #1d4ed8;
      margin-bottom: 6px;
      margin-top: 2px;
      line-height: 1.3;
      padding-bottom: 8px;
      border-bottom: 1px solid transparent;
      letter-spacing: -0.01em;
    }
    
    .accordion-item.active .accordion-title {
      color: #ffffff;
      border-bottom-color: rgba(255, 255, 255, 0.2);
    }
    
    .accordion-item.completed .accordion-title {
      color: #059669;
    }

    .accordion-subtitle {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.4;
      margin-top: 4px;
    }

    .accordion-item.active .accordion-subtitle {
      color: rgba(255, 255, 255, 0.9);
    }

    .accordion-toggle {
      font-size: 14px;
      color: var(--text-muted);
      transition: transform 0.3s ease;
      flex-shrink: 0;
    }

    .accordion-item.active .accordion-toggle {
      transform: rotate(180deg);
      color: rgba(255, 255, 255, 0.9);
    }

    .accordion-content {
      display: none;
      padding: 20px 24px 24px 24px;
      background: #ffffff;
      margin: 0;
      margin-top: 0;
      border-radius: 0 0 10px 10px;
      border-top: 1px solid #e5e7eb;
    }

    .accordion-item.active .accordion-content {
      display: block;
      background: #ffffff;
    }
    
    .accordion-item.completed .accordion-content {
      background: #f9fafb;
    }

    /* Accordion Content Sections */
    .accordion-content .step-warning {
      background: #fef9e7;
      border-left: 3px solid #f59e0b;
      padding: 10px 14px;
      border-radius: 6px;
      margin-bottom: 16px;
    }

    .accordion-content .step-warning strong {
      color: #92400e;
      font-weight: 700;
      display: block;
      margin-bottom: 4px;
    }

    .accordion-content .step-warning-text {
      font-size: 13px;
      color: #78350f;
    }

    .accordion-content .content-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-bottom: 16px;
    }

    @media (max-width: 968px) {
      .accordion-content .content-grid {
        grid-template-columns: 1fr;
      }
    }

    .accordion-content .section-block {
      background: white;
      border: 1px solid #e5e9ef;
      border-radius: 8px;
      padding: 16px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
      transition: all 0.2s ease;
    }
    
    .accordion-content .section-block:hover {
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
      transform: translateY(-1px);
    }

    .accordion-content .section-title {
      font-size: 14px;
      font-weight: 700;
      color: var(--navy-primary);
      margin-bottom: 12px;
    }

    .accordion-content .task-list {
      list-style: none;
      padding: 0;
    }

    .accordion-content .task-item {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 10px 12px;
      margin-bottom: 6px;
      background: white;
      border-radius: 6px;
      border: 1px solid #e5e9ef;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.03);
      transition: all 0.15s ease;
    }
    
    .accordion-content .task-item:hover {
      border-color: #cbd5e1;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      transform: translateX(2px);
    }

    .accordion-content .task-checkbox {
      width: 18px;
      height: 18px;
      border: 2px solid var(--border-dark);
      border-radius: 4px;
      flex-shrink: 0;
      margin-top: 2px;
      cursor: pointer;
      background: white;
    }

    .accordion-content .task-checkbox.checked {
      background: #10b981;
      border-color: #10b981;
      position: relative;
    }

    .accordion-content .task-checkbox.checked::after {
      content: '✓';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 11px;
      font-weight: bold;
    }

    .accordion-content .task-title {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .accordion-content .tool-grid {
      display: grid;
      gap: 8px;
    }

    .accordion-content .tool-card {
      background: white;
      border: 1px solid #e5e9ef;
      border-radius: 8px;
      padding: 12px 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.03);
    }

    .accordion-content .tool-card:hover {
      border-color: #3b82f6;
      box-shadow: 0 3px 10px rgba(59, 130, 246, 0.12);
      transform: translateY(-1px);
      background: linear-gradient(135deg, #ffffff 0%, #eff6ff 100%);
    }

    .accordion-content .tool-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .accordion-content .tool-name {
      font-size: 14px;
      font-weight: 600;
      color: var(--navy-dark);
    }

    .accordion-content .tool-arrow {
      color: var(--navy-primary);
      font-weight: bold;
    }

    .accordion-content .tool-desc {
      font-size: 12px;
      color: var(--text-secondary);
    }

    .accordion-content .tool-badge {
      display: inline-block;
      font-size: 9px;
      font-weight: 700;
      padding: 3px 6px;
      border-radius: 3px;
      margin-top: 6px;
      text-transform: uppercase;
    }

    .accordion-content .tool-badge.required {
      background: #fee2e2;
      color: #dc2626;
    }

    .accordion-content .tool-badge.recommended {
      background: #dbeafe;
      color: #2563eb;
    }

    .accordion-content .tool-badge.situational {
      background: #fef3c7;
      color: #d97706;
    }

    .accordion-content .step-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 20px;
      padding-top: 16px;
      border-top: 1px solid var(--border-light);
    }

    .accordion-content .btn {
      padding: 10px 20px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .accordion-content .btn-primary {
      background: var(--gold-accent);
      color: var(--navy-dark);
    }

    .accordion-content .btn-primary:hover {
      background: #c49b2e;
    }

    /* Next Step Preview - Subtle Vertical Guidance */
    .next-step-preview {
      margin-top: 32px;
      padding: 10px 14px;
      background: #fafafa;
      border: 1px solid #e5e5e5;
      border-radius: 4px;
      font-size: 10px;
      color: #9ca3af;
      text-align: center;
    }

    .next-step-preview-label {
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.6px;
      margin-bottom: 3px;
    }

    .next-step-preview-title {
      color: #6b7280;
      font-weight: 400;
      font-size: 11px;
    }

    /* Claim Readiness Status Indicator */
    .readiness-indicator {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 4px;
      padding: 8px 12px;
      margin-top: 48px;
      margin-bottom: 8px;
      display: flex;
      justify-content: center;
      text-align: center;
    }

    .readiness-icon {
      font-size: 12px;
      display: inline;
    }

    .readiness-content {
      text-align: center;
    }

    .readiness-status {
      font-size: 17px;
      font-weight: 600;
      margin-bottom: 2px;
      color: #1f2937;
    }

    .readiness-indicator.not-ready .readiness-status {
      color: #dc2626;
    }

    .readiness-indicator.partially-ready .readiness-status {
      color: #f59e0b;
    }

    .readiness-indicator.ready .readiness-status {
      color: #059669;
    }

    .readiness-message {
      font-size: 11px;
      color: #6b7280;
    }

    /* Step-by-Step Claim Guide Section Title */
    .claim-steps-title {
      font-size: 28px;
      font-weight: 700;
      color: #0f172a;
      margin-bottom: 24px;
      margin-top: 0;
      text-align: center;
      letter-spacing: -0.02em;
    }

    .step-critical-warning {
      background: #fef3c7;
      border-left: 4px solid #f59e0b;
      padding: 12px 16px;
      border-radius: 6px;
      margin-bottom: 16px;
      font-size: 14px;
      color: #92400e;
      font-weight: 500;
    }

    /* What This Prevents */
    .what-prevents {
      background: #eff6ff;
      border-left: 4px solid #3b82f6;
      padding: 12px 16px;
      border-radius: 6px;
      margin-bottom: 16px;
      font-size: 13px;
      color: #1e40af;
    }

    .what-prevents strong {
      font-weight: 700;
      display: block;
      margin-bottom: 4px;
    }

    /* Guardrail Warning */
    .guardrail-warning {
      background: #fee2e2;
      border-left: 4px solid #dc2626;
      padding: 12px 16px;
      border-radius: 6px;
      margin-bottom: 16px;
      font-size: 13px;
      color: #991b1b;
    }

    .guardrail-warning strong {
      font-weight: 700;
      display: block;
      margin-bottom: 4px;
    }

    /* Step 1 Refactored - Minimized Informational Note */
    .step-info-note {
      font-size: 12px;
      color: #6b7280;
      margin-top: 24px;
      margin-bottom: 16px;
      line-height: 1.6;
    }

    .step-info-note-icon {
      display: inline-block;
      margin-right: 4px;
      opacity: 0.7;
    }

    /* Tasks Intro (for Steps 2+) */
    .tasks-intro {
      font-size: 14px;
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 16px;
      padding: 12px 16px;
      background: #eff6ff;
      border-left: 3px solid #3b82f6;
      border-radius: 4px;
    }

    /* Before You Continue (for Steps 2+) */
    .before-you-continue {
      background: #fef9e7;
      border: 2px solid #f59e0b;
      border-radius: 8px;
      padding: 16px 20px;
      margin-bottom: 20px;
    }

    .before-you-continue-title {
      font-size: 15px;
      font-weight: 700;
      color: #92400e;
      margin-bottom: 12px;
    }

    .before-you-continue-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .before-you-continue-item {
      font-size: 13px;
      color: #78350f;
      margin-bottom: 6px;
      padding-left: 0;
      line-height: 1.5;
    }

    .before-you-continue-item:last-child {
      margin-bottom: 0;
    }

    .before-you-continue-item strong {
      font-weight: 700;
      color: #92400e;
    }

    /* Step 1 - Primary Action Container */
    .primary-action-container {
      margin-bottom: 32px;
      padding: 20px;
      background: #f9fafb;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
    }

    .primary-action-title {
      font-size: 18px;
      font-weight: 600;
      color: #111827;
      margin: 0 0 12px 0;
    }

    .primary-action-description {
      font-size: 14px;
      color: #4b5563;
      line-height: 1.6;
      margin: 0 0 16px 0;
    }

    /* Step 1 - Report Sections Container */
    .report-sections-container {
      margin-bottom: 24px;
      padding: 20px;
      background: #ffffff;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
    }

    .report-sections-title {
      font-size: 16px;
      font-weight: 600;
      color: #111827;
      margin: 0 0 8px 0;
    }

    .report-sections-description {
      font-size: 13px;
      color: #6b7280;
      line-height: 1.6;
      margin: 0 0 16px 0;
    }

    .report-sections-list {
      margin-top: 16px;
      padding: 16px;
      background: #f9fafb;
      border-radius: 6px;
      font-size: 13px;
      color: #374151;
    }

    .report-sections-list strong {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #111827;
    }

    .report-sections-list ul {
      margin: 0;
      padding-left: 20px;
      list-style: disc;
    }

    .report-sections-list li {
      margin-bottom: 4px;
      line-height: 1.5;
    }

    .report-sections-list li:last-child {
      margin-bottom: 0;
    }

    /* TASKS - PRIMARY WORK SURFACE (HIGHEST VISUAL WEIGHT) */
    
    /* Section Anchor */
    .section-anchor-tasks {
      font-size: 10px;
      font-weight: 700;
      color: #9ca3af;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 20px;
      margin-top: 8px;
    }

    /* Task List Container - Full width, clear work surface */
    .task-list-sequential {
      list-style: none;
      padding: 0;
      margin: 0 0 40px 0;
      background: #f8f9fa;
      border: 2px solid #e5e7eb;
      border-left: 4px solid #d1d5db;
      padding: 28px 24px;
      border-radius: 6px;
      position: relative;
    }

    /* Vertical guide line */
    .task-list-sequential::before {
      content: '';
      position: absolute;
      left: -4px;
      top: 0;
      bottom: 0;
      width: 4px;
      background: linear-gradient(180deg, #6b7280 0%, #d1d5db 100%);
    }

    .task-item-sequential {
      margin-bottom: 28px;
      padding: 24px;
      background: #FFFBF0;
      border: 2px solid #D4BF9F;
      border-radius: 6px;
      transition: all 0.2s;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .task-item-sequential:last-child {
      margin-bottom: 0;
    }

    .task-item-sequential:hover {
      border-color: #C4AF8F;
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
      transform: translateY(-2px);
      background: #FFF7E6;
    }

    .task-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, #1e3a5f 0%, #0f1f3d 100%);
      color: white;
      border-radius: 50%;
      font-weight: 700;
      font-size: 17px;
      margin-right: 16px;
      flex-shrink: 0;
    }

    .task-header-sequential {
      display: flex;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .task-title-sequential {
      font-size: 18px;
      font-weight: 700;
      color: #1e3a5f;
      flex: 1;
      line-height: 1.3;
    }

    .task-description-sequential {
      font-size: 15px;
      color: #4b5563;
      margin-left: 52px;
      line-height: 1.7;
    }

    /* TOOLS - REDUCED VISUAL WEIGHT (30-40% less than tasks) */
    .task-tool-inline {
      margin: 16px 0 0 52px;
      padding: 0;
      background: none;
      border: none;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
      transition: opacity 0.2s;
    }

    .task-tool-inline:hover {
      opacity: 1;
    }

    .task-tool-inline:hover .task-tool-title {
      text-decoration: underline;
      color: #3b82f6;
    }

    .task-tool-inline:hover .task-tool-arrow {
      color: #3b82f6;
    }

    .task-tool-arrow {
      font-size: 15px;
      color: #1d4ed8;
      flex-shrink: 0;
      font-weight: 700;
    }

    .task-tool-label {
      font-size: 15px;
      font-weight: 400;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      flex-shrink: 0;
    }

    .task-tool-title {
      font-size: 17px;
      font-weight: 700;
      color: #1d4ed8;
      flex: 1;
      text-transform: uppercase;
    }

    .task-tool-classification {
      font-size: 15px;
      font-weight: 400;
      padding: 2px 8px;
      border-radius: 3px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      opacity: 1;
      color: #6b7280;
    }

    .task-tool-classification.optional {
      background: transparent;
    }

    .task-tool-classification.required {
      background: transparent;
    }

    .task-tool-classification.situational {
      background: transparent;
    }

    /* Additional Tools - Minimal Visual Weight */
    
    .section-anchor-tools {
      font-size: 9px;
      font-weight: 600;
      color: #9ca3af;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      margin-bottom: 10px;
      margin-top: 28px;
    }

    .additional-tools-section {
      margin-top: 12px;
      padding: 0;
      background: transparent;
      border: none;
    }

    .additional-tools-title {
      display: none;
    }

    .additional-tools-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .additional-tool-item {
      padding: 0;
      background: none;
      border: none;
      margin-bottom: 8px;
      cursor: pointer;
      transition: opacity 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .additional-tool-item:last-child {
      margin-bottom: 0;
    }

    .additional-tool-item:hover {
      opacity: 1;
    }

    .additional-tool-item:hover .additional-tool-title {
      text-decoration: underline;
      color: #3b82f6;
    }

    .additional-tool-item:hover .additional-tool-arrow {
      color: #3b82f6;
    }

    .additional-tool-arrow {
      font-size: 9px;
      color: #d1d5db;
      font-weight: normal;
    }

    .additional-tool-title {
      font-size: 11px;
      font-weight: 400;
      color: #6b7280;
      flex: 1;
    }

    /* Policy Flags - Coinsurance Warning */
    .coinsurance-warning {
      margin-top: 20px;
      padding: 16px 20px;
      background: #fef3c7;
      border: 2px solid #f59e0b;
      border-left: 4px solid #f59e0b;
      border-radius: 8px;
    }

    .coinsurance-title {
      font-size: 14px;
      font-weight: 700;
      color: #92400e;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .coinsurance-content {
      font-size: 13px;
      color: #78350f;
      line-height: 1.6;
    }

    .coinsurance-requirement {
      display: inline-block;
      background: #fed7aa;
      padding: 2px 6px;
      border-radius: 3px;
      font-weight: 600;
      margin: 0 2px;
    }

    /* Policyholder Duties Checklist */
    .policyholder-duties {
      margin-top: 20px;
      padding: 18px 20px;
      background: #eff6ff;
      border: 2px solid #3b82f6;
      border-left: 4px solid #3b82f6;
      border-radius: 8px;
    }

    .duties-title {
      font-size: 14px;
      font-weight: 700;
      color: #1e40af;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .duties-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .duty-item {
      padding: 10px 12px;
      background: white;
      border: 1px solid #bfdbfe;
      border-radius: 6px;
      margin-bottom: 8px;
      display: flex;
      align-items: flex-start;
      gap: 12px;
    }

    .duty-item:last-child {
      margin-bottom: 0;
    }

    .duty-icon {
      font-size: 16px;
      flex-shrink: 0;
      margin-top: 2px;
    }

    .duty-content {
      flex: 1;
    }

    .duty-text {
      font-size: 13px;
      font-weight: 600;
      color: #1e3a5f;
      margin-bottom: 4px;
    }

    .duty-meta {
      font-size: 11px;
      color: #64748b;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .duty-deadline {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .duty-link {
      color: #2563eb;
      text-decoration: none;
      cursor: pointer;
      font-weight: 600;
    }

    .duty-link:hover {
      text-decoration: underline;
    }

    /* Expert Guidance Block */
    .expert-guidance {
      margin-top: 20px;
      padding: 18px 20px;
      background: #f0fdf4;
      border: 2px solid #86efac;
      border-left: 4px solid #22c55e;
      border-radius: 8px;
    }

    .expert-guidance-title {
      font-size: 14px;
      font-weight: 700;
      color: #166534;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .expert-conditions {
      margin-bottom: 16px;
    }

    .expert-conditions ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .expert-conditions li {
      padding: 8px 12px;
      background: white;
      border: 1px solid #bbf7d0;
      border-radius: 6px;
      margin-bottom: 6px;
      font-size: 13px;
      color: #166534;
      line-height: 1.5;
      padding-left: 32px;
      position: relative;
    }

    .expert-conditions li:last-child {
      margin-bottom: 0;
    }

    .expert-conditions li:before {
      content: "→";
      position: absolute;
      left: 12px;
      color: #22c55e;
      font-weight: bold;
    }

    .expert-types {
      padding-top: 12px;
      border-top: 1px solid #bbf7d0;
    }

    .expert-types-title {
      font-size: 12px;
      font-weight: 700;
      color: #166534;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 10px;
    }

    .expert-type-list {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
    }

    .expert-type-item {
      padding: 8px 10px;
      background: white;
      border: 1px solid #bbf7d0;
      border-radius: 4px;
      font-size: 12px;
    }

    .expert-type-name {
      font-weight: 600;
      color: #166534;
      display: block;
      margin-bottom: 2px;
    }

    .expert-type-when {
      font-size: 11px;
      color: #4ade80;
      font-style: italic;
    }

    @media (max-width: 768px) {
      .expert-type-list {
        grid-template-columns: 1fr;
      }
    }

    /* Mitigation Guidance Block (Step 2) */
    .mitigation-guidance {
      margin-top: 20px;
      padding: 18px 20px;
      background: #fef2f2;
      border: 2px solid #fca5a5;
      border-left: 4px solid #ef4444;
      border-radius: 8px;
    }

    .mitigation-guidance-title {
      font-size: 14px;
      font-weight: 700;
      color: #991b1b;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .mitigation-explanation {
      font-size: 13px;
      color: #7f1d1d;
      line-height: 1.6;
      margin-bottom: 16px;
      padding: 10px 12px;
      background: #fee2e2;
      border-radius: 4px;
    }

    .mitigation-section {
      margin-bottom: 12px;
    }

    .mitigation-section:last-child {
      margin-bottom: 0;
    }

    .mitigation-section-title {
      font-size: 12px;
      font-weight: 700;
      color: #991b1b;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
    }

    .mitigation-section ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .mitigation-section li {
      padding: 8px 12px;
      background: white;
      border: 1px solid #fecaca;
      border-radius: 4px;
      margin-bottom: 6px;
      font-size: 13px;
      color: #7f1d1d;
      padding-left: 32px;
      position: relative;
    }

    .mitigation-section li:last-child {
      margin-bottom: 0;
    }

    .mitigation-section li:before {
      content: "!";
      position: absolute;
      left: 12px;
      width: 18px;
      height: 18px;
      background: #ef4444;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 12px;
    }

    .mitigation-reimbursement {
      margin-top: 12px;
      padding: 10px 12px;
      background: #dcfce7;
      border: 1px solid #86efac;
      border-radius: 4px;
      font-size: 12px;
      color: #166534;
      font-weight: 600;
    }

    /* Mitigation Capture Block (Step 3) */
    .mitigation-capture {
      margin-top: 20px;
      padding: 18px 20px;
      background: #eff6ff;
      border: 2px solid #93c5fd;
      border-left: 4px solid #3b82f6;
      border-radius: 8px;
    }

    .mitigation-capture-title {
      font-size: 14px;
      font-weight: 700;
      color: #1e40af;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .mitigation-instructions {
      font-size: 13px;
      color: #1e3a8a;
      line-height: 1.6;
      margin-bottom: 12px;
    }

    .mitigation-upload-types {
      display: grid;
      gap: 8px;
    }

    .mitigation-upload-item {
      padding: 10px 12px;
      background: white;
      border: 1px solid #bfdbfe;
      border-radius: 6px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .mitigation-upload-type {
      font-size: 13px;
      font-weight: 600;
      color: #1e40af;
    }

    .mitigation-upload-desc {
      font-size: 12px;
      color: #64748b;
    }

    .mitigation-flow-note {
      margin-top: 12px;
      padding: 10px 12px;
      background: #dcfce7;
      border: 1px solid #86efac;
      border-radius: 4px;
      font-size: 12px;
      color: #166534;
      font-weight: 600;
    }

    /* Post-Claim Asset Section */
    .post-claim-section {
      background: #f9fafb;
      color: #0f172a;
      padding: 32px;
      border-radius: 12px;
      margin-top: 32px;
      border: 1px solid #e5e7eb;
    }

    .post-claim-section h3 {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 12px;
      color: #0f172a;
    }

    .post-claim-section p {
      font-size: 14px;
      line-height: 1.6;
      margin-bottom: 20px;
      color: #4b5563;
    }

    .post-claim-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .btn-post-claim {
      padding: 12px 24px;
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }

    .btn-post-claim:hover {
      background: #2563eb;
      transform: translateY(-1px);
    }

    .btn-post-claim.secondary {
      background: white;
      color: #1f2937;
      border: 1px solid #d1d5db;
    }

    .btn-post-claim.secondary:hover {
      background: #f3f4f6;
      border-color: #9ca3af;
    }

    /* Critical Claim Deadlines Section */
    /* Critical Claim Deadlines */
    .critical-deadlines {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 4px;
      padding: 8px 10px;
      margin-bottom: 8px;
    }

    .critical-deadlines-header {
      margin-bottom: 4px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .critical-deadlines-title {
      font-size: 17px;
      font-weight: 600;
      color: #0f172a;
      margin-bottom: 1px;
    }

    .critical-deadlines-subtext {
      font-size: 11px;
      color: #6b7280;
      margin-bottom: 8px;
    }

    .critical-deadlines-toggle {
      font-size: 10px;
      color: #6b7280;
      transition: transform 0.2s;
    }

    .critical-deadlines.expanded .critical-deadlines-toggle {
      transform: rotate(180deg);
    }

    .deadline-list {
      display: none;
    }

    .critical-deadlines.expanded .deadline-list {
      display: block;
      padding-top: 8px;
    }

    /* Claim Financial Summary - MONEY FOCAL ELEMENT */
    .claim-financial-summary {
      background: #f9fafb;
      border: 1px solid #cbd5e1;
      border-radius: 10px;
      padding: 12px 16px;
      margin-top: 48px;
      margin-bottom: 24px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
    }

    .financial-summary-header {
      margin-bottom: 10px;
      padding-bottom: 8px;
      border-bottom: 1px solid #e5e7eb;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .financial-summary-title {
      font-size: 16px;
      font-weight: 600;
      color: #0f172a;
      margin-bottom: 2px;
    }

    .financial-summary-subtext {
      font-size: 11px;
      color: #6b7280;
      line-height: 1.4;
    }

    .financial-summary-toggle {
      font-size: 10px;
      color: #6b7280;
      transition: transform 0.2s;
    }

    .claim-financial-summary.expanded .financial-summary-toggle {
      transform: rotate(180deg);
    }

    .financial-summary-content {
      display: none;
    }

    .claim-financial-summary.expanded .financial-summary-content {
      display: block;
    }

    .financial-top-line {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 12px;
      padding-bottom: 12px;
      border-bottom: 1px solid #e5e7eb;
    }

    .financial-metric {
      background: transparent;
      padding: 8px 12px;
      border-radius: 6px;
      border: none;
    }

    .financial-metric-label {
      font-size: 10px;
      font-weight: 600;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      margin-bottom: 4px;
    }

    .financial-metric-value {
      font-size: 20px;
      font-weight: 700;
      color: #0f172a;
      font-family: 'Inter', monospace;
    }

    .financial-metric-note {
      font-size: 9px;
      color: #9ca3af;
      margin-top: 2px;
      font-style: italic;
    }

    .financial-breakdown {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      margin-bottom: 12px;
    }

    .breakdown-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 8px;
      background: transparent;
      border-radius: 4px;
      border: none;
    }

    .breakdown-label {
      font-size: 11px;
      font-weight: 500;
      color: #6b7280;
    }

    .breakdown-value {
      font-size: 13px;
      font-weight: 600;
      color: #1f2937;
      font-family: 'Inter', monospace;
    }

    .financial-payments-section {
      margin-bottom: 12px;
      padding-top: 12px;
      border-top: 1px solid #e5e7eb;
    }

    .payments-title {
      font-size: 12px;
      font-weight: 700;
      color: #1f2937;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
    }

    .payments-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
    }

    .payment-item {
      display: flex;
      flex-direction: column;
      gap: 4px;
      padding: 8px;
      background: transparent;
      border-radius: 6px;
      border: none;
    }

    .payment-label {
      font-size: 10px;
      font-weight: 600;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }

    .payment-value {
      font-size: 14px;
      font-weight: 700;
      color: #0f172a;
      font-family: 'Inter', monospace;
    }

    .financial-status-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
    }

    .status-indicator {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 6px;
      background: transparent;
      border-radius: 6px;
      border: none;
      text-align: center;
    }

    .status-icon {
      font-size: 18px;
      margin-bottom: 4px;
    }

    .status-label {
      font-size: 9px;
      font-weight: 600;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      margin-bottom: 2px;
    }

    .status-value {
      font-size: 10px;
      font-weight: 600;
      color: #1f2937;
    }

    .status-indicator.incomplete .status-icon { color: #ef4444; }
    .status-indicator.incomplete .status-value { color: #ef4444; }
    
    .status-indicator.preliminary .status-icon { color: #f59e0b; }
    .status-indicator.preliminary .status-value { color: #f59e0b; }
    
    .status-indicator.complete .status-icon { color: #10b981; }
    .status-indicator.complete .status-value { color: #10b981; }
    
    .status-indicator.active .status-icon { color: #3b82f6; }
    .status-indicator.active .status-value { color: #3b82f6; }
    
    .status-indicator.inactive .status-icon { color: #9ca3af; }
    .status-indicator.inactive .status-value { color: #9ca3af; }

    @media (max-width: 968px) {
      .financial-top-line {
        grid-template-columns: 1fr;
      }
      
      .financial-breakdown {
        grid-template-columns: 1fr;
      }
      
      .payments-grid {
        grid-template-columns: 1fr;
      }
      
      .financial-status-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    .deadline-list {
      display: block;
    }

    .deadline-item {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      padding: 8px;
      border-radius: 6px;
      border: none;
      background: transparent;
      transition: all 0.2s;
      max-width: 700px;
      margin: 0 auto 8px auto;
    }

    .deadline-item:hover {
      background: rgba(0, 0, 0, 0.02);
    }

    .deadline-item.urgent {
      background: transparent;
      border: none;
    }

    .deadline-item.critical {
      background: transparent;
      border: none;
    }

    .deadline-icon {
      font-size: 16px;
      flex-shrink: 0;
      margin-top: 1px;
    }

    .deadline-content {
      flex: 1;
    }

    .deadline-date {
      font-size: 12px;
      font-weight: 700;
      color: #0f172a;
      margin-bottom: 2px;
    }

    .deadline-item.urgent .deadline-date {
      color: #dc2626;
    }

    .deadline-item.critical .deadline-date {
      color: #dc2626;
    }

    .deadline-description {
      font-size: 11px;
      color: #4b5563;
      margin-bottom: 3px;
      line-height: 1.4;
    }

    .deadline-step-link {
      font-size: 11px;
      color: #1e40af;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 2px;
    }

    .deadline-step-link:hover {
      color: #1e3a8a;
      text-decoration: underline;
    }

    @media (max-width: 968px) {
      .critical-deadlines {
        padding: 10px;
      }

      .deadline-item {
        flex-direction: column;
        gap: 6px;
      }

      .deadline-icon {
        font-size: 14px;
      }
    }

    /* Active Step Section */
    .active-step-section {
      background: var(--bg-white);
      border: 1px solid var(--border-light);
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 16px;
      box-shadow: var(--shadow-sm);
    }

    .active-step-header {
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 2px solid var(--border-light);
    }

    .active-step-label {
      display: inline-block;
      background: var(--navy-primary);
      color: white;
      font-size: 10px;
      font-weight: 700;
      padding: 4px 10px;
      border-radius: 4px;
      margin-bottom: 8px;
      letter-spacing: 0.5px;
    }

    .active-step-title {
      font-size: 22px;
      font-weight: 700;
      color: var(--navy-dark);
      margin-bottom: 6px;
      line-height: 1.2;
    }

    .active-step-subtitle {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    .step-content-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-bottom: 16px;
    }

    @media (max-width: 968px) {
      .step-content-grid {
        grid-template-columns: 1fr;
      }
    }

    .content-section {
      background: var(--bg-cream);
      border: 1px solid var(--border-light);
      border-radius: 8px;
      padding: 16px;
    }

    .section-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--border-light);
    }

    .section-icon {
      font-size: 20px;
    }

    .section-title {
      font-size: 16px;
      font-weight: 700;
      color: var(--navy-primary);
    }

    .task-list {
      list-style: none;
    }

    .task-item {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 16px;
      margin-bottom: 12px;
      background: var(--bg-white);
      border-radius: 8px;
      border: 1px solid var(--border-light);
      transition: all 0.2s ease;
    }

    .task-item:hover {
      border-color: var(--border-medium);
      box-shadow: var(--shadow-sm);
    }

    .task-checkbox {
      width: 22px;
      height: 22px;
      border: 2px solid var(--border-dark);
      border-radius: 5px;
      flex-shrink: 0;
      margin-top: 2px;
      cursor: pointer;
      transition: all 0.2s ease;
      background: var(--bg-white);
    }

    .task-checkbox:hover {
      border-color: var(--navy-primary);
    }

    .task-checkbox.checked {
      background: #10b981;
      border-color: #10b981;
      position: relative;
    }

    .task-checkbox.checked::after {
      content: '✓';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 14px;
      font-weight: bold;
    }

    .task-item-sequential:has(.task-checkbox.checked) .task-title-sequential,
    .task-item-sequential:has(.task-checkbox.checked) .task-description-sequential {
      opacity: 0.6;
    }
    }

    .task-content {
      flex: 1;
    }

    .task-title {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: 4px;
    }

    .task-description {
      font-size: 13px;
      color: var(--text-muted);
    }

    .tool-grid {
      display: grid;
      gap: 12px;
    }

    .tool-card {
      background: var(--bg-white);
      border: 1px solid var(--border-light);
      border-radius: 8px;
      padding: 18px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .tool-card:hover {
      border-color: var(--navy-primary);
      box-shadow: var(--shadow-md);
      transform: translateX(4px);
    }

    .tool-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .tool-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--navy-dark);
    }

    .tool-arrow {
      color: var(--navy-primary);
      font-size: 20px;
      font-weight: bold;
    }

    .tool-description {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    .tool-classification {
      display: inline-block;
      font-size: 11px;
      font-weight: 700;
      padding: 4px 8px;
      border-radius: 4px;
      margin-top: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .tool-classification.required {
      background: #fee2e2;
      color: #dc2626;
    }

    .tool-classification.recommended {
      background: #dbeafe;
      color: #2563eb;
    }

    .tool-classification.situational {
      background: #fef3c7;
      color: #d97706;
    }

    .step-warning {
      background: #fef9e7;
      border-left: 4px solid #f59e0b;
      padding: 16px 20px;
      margin-bottom: 24px;
      border-radius: 6px;
    }

    .step-warning strong {
      color: #92400e;
      font-weight: 700;
    }

    .step-warning-text {
      font-size: 14px;
      color: #78350f;
      margin-top: 4px;
    }

    .document-list {
      list-style: none;
    }

    .document-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px;
      margin-bottom: 10px;
      background: var(--bg-white);
      border-radius: 8px;
      border: 1px solid var(--border-light);
      flex-wrap: wrap;
    }

    .document-icon {
      font-size: 22px;
      flex-shrink: 0;
    }

    .document-name {
      flex: 1;
      min-width: 200px;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-primary);
    }

    .document-status {
      font-size: 12px;
      padding: 5px 10px;
      border-radius: 5px;
      font-weight: 600;
    }

    .document-status.required {
      background: #fee2e2;
      color: #dc2626;
    }

    .document-status.optional {
      background: #fef3c7;
      color: #d97706;
    }

    .btn-example {
      background: var(--bg-cream);
      border: 1px solid var(--border-medium);
      padding: 6px 12px;
      border-radius: 5px;
      font-size: 12px;
      font-weight: 600;
      color: var(--navy-primary);
      cursor: pointer;
      transition: all 0.2s ease;
      margin-right: 8px;
    }

    .btn-example:hover {
      background: var(--navy-primary);
      color: white;
    }

    /* Common Problems Section */
    .common-problems-section {
      background: #fef9e7;
      border: 2px solid #f59e0b;
      border-radius: 12px;
      margin-top: 32px;
      overflow: hidden;
    }

    .problems-header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 20px 24px;
      cursor: pointer;
      background: #fef3c7;
      transition: all 0.2s ease;
    }

    .problems-header:hover {
      background: #fde68a;
    }

    .problems-icon {
      font-size: 24px;
    }

    .problems-title {
      flex: 1;
      font-size: 18px;
      font-weight: 700;
      color: #92400e;
    }

    .problems-toggle {
      font-size: 18px;
      color: #92400e;
      transition: transform 0.3s ease;
    }

    .problems-header.open .problems-toggle {
      transform: rotate(180deg);
    }

    .problems-content {
      padding: 24px;
    }

    .problem-item {
      margin-bottom: 24px;
      padding-bottom: 24px;
      border-bottom: 1px solid #fde68a;
    }

    .problem-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }

    .problem-question {
      font-size: 16px;
      font-weight: 700;
      color: var(--navy-dark);
      margin-bottom: 12px;
    }

    .problem-answer {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.6;
    }

    .problem-answer ul {
      margin-top: 8px;
      padding-left: 24px;
      list-style: disc;
    }

    .problem-answer li {
      margin-bottom: 6px;
    }

    /* Step Actions */
    .step-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 32px;
      border-top: 2px solid var(--border-light);
      margin-bottom: 12px;
    }

    .action-right-group {
      display: flex;
      gap: 12px;
    }

    .action-note {
      text-align: center;
      font-size: 14px;
      color: var(--text-secondary);
      padding: 12px;
      background: var(--bg-cream);
      border-radius: 8px;
    }

    .btn {
      padding: 14px 28px;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
    }

    .btn-primary {
      background: var(--gold-accent);
      color: var(--navy-dark);
      font-weight: 700;
    }

    .btn-primary:hover {
      background: #c49b2e;
      box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: var(--bg-white);
      color: var(--navy-primary);
      border: 2px solid var(--navy-primary);
    }

    .btn-secondary:hover {
      background: var(--navy-primary);
      color: white;
    }

    .btn-save {
      background: var(--bg-white);
      color: var(--accent-blue);
      border: 2px solid var(--accent-blue);
      font-weight: 600;
    }

    .btn-save:hover {
      background: var(--accent-blue);
      color: white;
    }

    .btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    /* Visual Roadmap */
    .visual-roadmap {
      background: linear-gradient(135deg, var(--navy-primary) 0%, var(--navy-dark) 100%);
      border-radius: 8px;
      padding: 20px 32px;
      margin-top: 16px;
      box-shadow: none;
    }

    .roadmap-header {
      text-align: center;
      margin-bottom: 20px;
    }

    .roadmap-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-white);
      margin-bottom: 4px;
    }

    .roadmap-subtitle {
      font-size: 13px;
      color: rgba(255, 255, 255, 0.8);
    }

    .roadmap-track {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      position: relative;
      padding: 0 20px;
    }

    .roadmap-line {
      position: absolute;
      top: 20px;
      left: 60px;
      right: 60px;
      height: 3px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 2px;
    }

    .roadmap-line-progress {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      background: var(--gold-accent);
      transition: width 0.6s ease-out;
      border-radius: 2px;
      box-shadow: 0 0 12px rgba(212, 175, 55, 0.6);
    }

    .roadmap-node {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 1;
      max-width: 120px;
    }

    .roadmap-circle {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: var(--navy-dark);
      border: 3px solid rgba(255, 255, 255, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 16px;
      transition: all 0.3s ease;
      font-weight: 700;
      font-size: 16px;
      color: rgba(255, 255, 255, 0.5);
    }

    .roadmap-node.completed .roadmap-circle {
      border-color: var(--accent-green);
      background: var(--accent-green);
    }

    .roadmap-node.completed .roadmap-circle::after {
      content: '✓';
      color: white;
      font-size: 18px;
    }

    .roadmap-node.active .roadmap-circle {
      background: var(--gold-accent);
      border-color: var(--gold-accent);
      color: var(--navy-dark);
      box-shadow: 0 0 24px rgba(212, 175, 55, 0.6);
      font-weight: 800;
    }

    .roadmap-label {
      font-size: 13px;
      font-weight: 600;
      text-align: center;
      line-height: 1.3;
      color: rgba(255, 255, 255, 0.9);
    }

    .roadmap-node.completed .roadmap-label {
      color: rgba(255, 255, 255, 0.6);
    }

    .roadmap-node.active .roadmap-label {
      color: white;
      font-weight: 700;
    }

    .roadmap-node.pending .roadmap-label {
      color: rgba(255, 255, 255, 0.4);
    }

    .roadmap-microcopy {
      font-size: 11px;
      color: rgba(255, 255, 255, 0.6);
      margin-top: 4px;
      text-align: center;
    }

    .roadmap-node.pending .roadmap-microcopy {
      display: none;
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      .container {
        padding: 20px 16px;
      }

      .page-header {
        padding: 40px 24px;
        border-radius: 12px;
      }

      .page-title {
        font-size: 28px;
      }

      .page-subtitle {
        font-size: 16px;
      }

      .progress-indicator {
        top: 12px;
        right: 12px;
        padding: 8px 12px;
      }

      .claim-info-panel {
        padding: 20px;
      }

      .claim-info-grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }

      .quick-jump-grid {
        grid-template-columns: 1fr;
      }

      .step-list {
        grid-template-columns: 1fr;
      }

      .step-content-grid {
        grid-template-columns: 1fr;
      }

      .active-step-section {
        padding: 24px;
      }

      .active-step-title {
        font-size: 24px;
      }

      .step-actions {
        flex-direction: column;
        gap: 12px;
        align-items: stretch;
      }

      .action-right-group {
        flex-direction: column;
        width: 100%;
      }

      .btn {
        width: 100%;
        justify-content: center;
      }

      .roadmap-track {
        flex-wrap: wrap;
        justify-content: center;
        gap: 20px;
        padding: 0 20px;
      }

      .roadmap-line {
        display: none;
      }

      .roadmap-node {
        max-width: 100px;
      }

      .document-item {
        flex-direction: column;
        align-items: flex-start;
      }

      .document-name {
        width: 100%;
      }

      .btn-example {
        align-self: flex-start;
      }
    }
  </style>
</head>
<body>
  <!-- Global Navigation Header -->
  <header class="global-header">
    <nav class="global-nav">
      <a href="/" class="nav-brand">ClaimNavigatorAI</a>
      
      <ul class="nav-menu">
        <li class="nav-item">
          <a href="/claim-guide" class="nav-link nav-link-primary active">Claim Management Center</a>
        </li>
        
        <li class="nav-item nav-dropdown" id="uploadDropdown">
          <a href="#" class="nav-link dropdown-toggle" onclick="toggleDropdown(event); return false;">Upload Documents</a>
          <div class="dropdown-menu">
            <a href="/upload/policy" class="dropdown-item">Policy</a>
            <a href="/upload/estimate" class="dropdown-item">Estimate</a>
          </div>
        </li>
        
        <li class="nav-item">
          <a href="/claim-summary" class="nav-link">Claim Summary</a>
        </li>
        
        <li class="nav-item">
          <a href="/messages" class="nav-link">
            Messages
            <span class="nav-subtext">Claim Correspondence</span>
          </a>
        </li>
        
        <li class="nav-item">
          <a href="/resources" class="nav-link">Resources</a>
        </li>
      </ul>
    </nav>
  </header>

  <div class="container">
    <!-- Progress Indicator -->
    <div class="progress-indicator">
      <div class="progress-ring" style="--progress: 10">
        <svg width="36" height="36">
          <circle class="progress-ring-bg" cx="18" cy="18" r="16"></circle>
          <circle class="progress-ring-fill" cx="18" cy="18" r="16"></circle>
        </svg>
      </div>
      <div class="progress-text">
        <span class="progress-percent">10% Complete</span>
        <span class="progress-stage">Step 1 of 13</span>
      </div>
    </div>

    <!-- Page Header -->
    <header class="page-header">
      <h1 class="page-title">Claim Navigator<br>Claim Management Center</h1>
      <p class="page-subtitle">This is a mandatory, sequential execution guide. Some actions are irreversible. Do not skip steps. Do not skim. Follow this sequence exactly in order. Do not proceed to the next step until the current step is complete. Deviation from this sequence may result in claim denial, reduced payment, or loss of legal leverage.</p>
    </header>

    <!-- Claim Information Panel -->
    <section class="claim-info-panel">
      <div class="claim-info-header">
        <h2 class="claim-info-title">Your Claim Information</h2>
        <button class="btn-edit" onclick="editClaimInfo()">✏️ Edit</button>
      </div>
      <div class="claim-info-grid">
        <div class="claim-info-item">
          <span class="info-label">Claim Number:</span>
          <span class="info-value" id="claimNumber">CLM-2024-089456</span>
        </div>
        <div class="claim-info-item">
          <span class="info-label">Date of Loss:</span>
          <span class="info-value" id="dateOfLoss">November 15, 2024</span>
        </div>
        <div class="claim-info-item">
          <span class="info-label">Days Since Loss:</span>
          <span class="info-value urgent" id="daysSinceLoss">45 days</span>
        </div>
        <div class="claim-info-item">
          <span class="info-label">Insurance Company:</span>
          <span class="info-value" id="insurerName">State Farm</span>
        </div>
        <div class="claim-info-item">
          <span class="info-label">Adjuster Name:</span>
          <span class="info-value" id="adjusterName">Mike Johnson</span>
        </div>
        <div class="claim-info-item">
          <span class="info-label">Claim Status:</span>
          <span class="info-value status-active" id="claimStatus">Active - Under Review</span>
        </div>
      </div>
      <div class="deadline-alert">
        ⚠️ <strong>Upcoming Deadline:</strong> Proof of Loss due in 15 days (January 14, 2025)
      </div>
    </section>

    <!-- Content Area -->
    <div class="content-area">

    <!-- Step-by-Step Claim Guide Section -->
    <h2 class="claim-steps-title">Your Step-by-Step Claim Guide</h2>
    <p style="text-align: center; font-size: 14px; color: #4b5563; margin-bottom: 24px;">These are critical, time sensitive steps that will ensure you manage your claim properly.</p>

    <!-- Step Accordion -->
    <div class="step-accordion">
      
      <div class="accordion-item" data-step="1">
        <div class="accordion-header" onclick="openStep(1)">
          <div class="accordion-left">
            <div class="accordion-number">1</div>
            <div class="accordion-title-area">
              <div class="accordion-title">Policy Review & Coverage Analysis</div>
              <div class="accordion-subtitle">Upload your insurance policy for AI-assisted analysis of coverages, limits, endorsements, loss settlement terms, ALE eligibility, and contents rules. Review your coverage terms to understand what is covered and how your claim will be paid.</div>
            </div>
          </div>
          <div class="accordion-toggle">▼</div>
        </div>
        <div class="accordion-content">
          <!-- Content will be inserted by JavaScript -->
        </div>
      </div>

      <div class="accordion-item" data-step="2">
        <div class="accordion-header" onclick="openStep(2)">
          <div class="accordion-left">
            <div class="accordion-number">2</div>
            <div class="accordion-title-area">
              <div class="accordion-title">Policyholder Duties & Timelines</div>
              <div class="accordion-subtitle">Review your required duties including mitigation, timely notice, cooperation, property protection, and policy deadlines to ensure compliance.</div>
            </div>
          </div>
          <div class="accordion-toggle">▼</div>
        </div>
        <div class="accordion-content">
          <!-- Content will be inserted by JavaScript -->
        </div>
      </div>

      <div class="accordion-item" data-step="3">
        <div class="accordion-header" onclick="openStep(3)">
          <div class="accordion-left">
            <div class="accordion-number">3</div>
            <div class="accordion-title-area">
              <div class="accordion-title">Document the Damage</div>
              <div class="accordion-subtitle">Photograph all structural damage and damaged contents from multiple angles. Record condition before any cleanup or repairs.</div>
            </div>
          </div>
          <div class="accordion-toggle">▼</div>
        </div>
        <div class="accordion-content">
          <!-- Content will be inserted by JavaScript -->
        </div>
      </div>

      <div class="accordion-item" data-step="4">
        <div class="accordion-header" onclick="openStep(4)">
          <div class="accordion-left">
            <div class="accordion-number">4</div>
            <div class="accordion-title-area">
              <div class="accordion-title">Get a Professional Repair Estimate</div>
              <div class="accordion-subtitle">Hire a licensed contractor to provide a detailed repair estimate. This is your estimate, not the insurance company's estimate.</div>
            </div>
          </div>
          <div class="accordion-toggle">▼</div>
        </div>
        <div class="accordion-content">
          <!-- Content will be inserted by JavaScript -->
        </div>
      </div>

      <div class="accordion-item" data-step="5">
        <div class="accordion-header" onclick="openStep(5)">
          <div class="accordion-left">
            <div class="accordion-number">5</div>
            <div class="accordion-title-area">
              <div class="accordion-title">Estimate Analysis & Comparison (AI Expert Analysis)</div>
              <div class="accordion-subtitle">Compare your contractor estimate to the carrier estimate using AI analysis to identify missing scope, code upgrades, pricing errors, and omissions.</div>
            </div>
          </div>
          <div class="accordion-toggle">▼</div>
        </div>
        <div class="accordion-content">
          <!-- Content will be inserted by JavaScript -->
        </div>
      </div>

      <div class="accordion-item" data-step="6">
        <div class="accordion-header" onclick="openStep(6)">
          <div class="accordion-left">
            <div class="accordion-number">6</div>
            <div class="accordion-title-area">
              <div class="accordion-title">Align Loss With Policy Coverage</div>
              <div class="accordion-subtitle">Match your repair estimate and contents inventory to policy coverage limits, sub-limits, and exclusions. Identify any gaps or caps that apply.</div>
            </div>
          </div>
          <div class="accordion-toggle">▼</div>
        </div>
        <div class="accordion-content">
          <!-- Content will be inserted by JavaScript -->
        </div>
      </div>

      <div class="accordion-item" data-step="7">
        <div class="accordion-header" onclick="openStep(7)">
          <div class="accordion-left">
            <div class="accordion-number">7</div>
            <div class="accordion-title-area">
              <div class="accordion-title">Additional Living Expense (ALE) & Temporary Housing</div>
              <div class="accordion-subtitle">Determine ALE eligibility, document necessary expenses, and understand reasonable vs necessary standards and duration limits.</div>
            </div>
          </div>
          <div class="accordion-toggle">▼</div>
        </div>
        <div class="accordion-content">
          <!-- Content will be inserted by JavaScript -->
        </div>
      </div>

      <div class="accordion-item" data-step="8">
        <div class="accordion-header" onclick="openStep(8)">
          <div class="accordion-left">
            <div class="accordion-number">8</div>
            <div class="accordion-title-area">
              <div class="accordion-title">Build Contents Inventory</div>
              <div class="accordion-subtitle">Create a room-by-room inventory of all damaged personal property. List every item with description, quantity, condition, and age.</div>
            </div>
          </div>
          <div class="accordion-toggle">▼</div>
        </div>
        <div class="accordion-content">
          <!-- Content will be inserted by JavaScript -->
        </div>
      </div>

      <div class="accordion-item" data-step="9">
        <div class="accordion-header" onclick="openStep(9)">
          <div class="accordion-left">
            <div class="accordion-number">9</div>
            <div class="accordion-title-area">
              <div class="accordion-title">Contents Valuation (ACV / RCV)</div>
              <div class="accordion-subtitle">Calculate replacement cost value and actual cash value for each item in your inventory. Understand depreciation handling and RCV recovery requirements.</div>
            </div>
          </div>
          <div class="accordion-toggle">▼</div>
        </div>
        <div class="accordion-content">
          <!-- Content will be inserted by JavaScript -->
        </div>
      </div>

      <div class="accordion-item" data-step="10">
        <div class="accordion-header" onclick="openStep(10)">
          <div class="accordion-left">
            <div class="accordion-number">10</div>
            <div class="accordion-title-area">
              <div class="accordion-title">Assemble the Claim Package</div>
              <div class="accordion-subtitle">Compile your repair estimate, contents inventory, supporting documentation, and loss narrative into a complete claim submission package.</div>
            </div>
          </div>
          <div class="accordion-toggle">▼</div>
        </div>
        <div class="accordion-content">
          <!-- Content will be inserted by JavaScript -->
        </div>
      </div>

      <div class="accordion-item" data-step="11">
        <div class="accordion-header" onclick="openStep(11)">
          <div class="accordion-left">
            <div class="accordion-number">11</div>
            <div class="accordion-title-area">
              <div class="accordion-title">Submit the Claim</div>
              <div class="accordion-subtitle">Submit your complete claim package to the insurance carrier and obtain written confirmation of receipt.</div>
            </div>
          </div>
          <div class="accordion-toggle">▼</div>
        </div>
        <div class="accordion-content">
          <!-- Content will be inserted by JavaScript -->
        </div>
      </div>

      <div class="accordion-item" data-step="12">
        <div class="accordion-header" onclick="openStep(12)">
          <div class="accordion-left">
            <div class="accordion-number">12</div>
            <div class="accordion-title-area">
              <div class="accordion-title">Respond to Carrier Requests</div>
              <div class="accordion-subtitle">Address all carrier requests for additional information, documentation, or clarification. Respond promptly to avoid delays.</div>
            </div>
          </div>
          <div class="accordion-toggle">▼</div>
        </div>
        <div class="accordion-content">
          <!-- Content will be inserted by JavaScript -->
        </div>
      </div>

      <div class="accordion-item" data-step="13">
        <div class="accordion-header" onclick="openStep(13)">
          <div class="accordion-left">
            <div class="accordion-number">13</div>
            <div class="accordion-title-area">
              <div class="accordion-title">Correct Underpayments & Submit Supplements</div>
              <div class="accordion-subtitle">Identify underpayments, document additional damage, and submit supplemental claims. Negotiate until you reach a fair settlement that covers all documented damages. This step is complete only when you have accepted final payment and received all withheld depreciation.</div>
            </div>
          </div>
          <div class="accordion-toggle">▼</div>
        </div>
        <div class="accordion-content">
          <!-- Content will be inserted by JavaScript -->
        </div>
      </div>


    </div><!-- End step-accordion -->

    <!-- Claim Financial Summary -->
    <div class="claim-financial-summary expanded" id="financialSummary">
      <div class="financial-summary-header" onclick="toggleSection('financialSummary')">
        <div style="text-align: center; flex: 1;">
          <h2 class="financial-summary-title">Claim Financial Summary</h2>
          <p class="financial-summary-subtext">A live summary of your documented claim value based on uploaded evidence and verified coverage.</p>
        </div>
        <span class="financial-summary-toggle">▼</span>
      </div>
      
      <div class="financial-summary-content">
      <!-- Top Line Metrics -->
      <div class="financial-top-line">
        <div class="financial-metric">
          <div class="financial-metric-label">Current Documented Claim Value</div>
          <div class="financial-metric-value" id="documentedClaimValue">$0</div>
          <div class="financial-metric-note">Based on uploaded estimates and evidence</div>
        </div>
        
        <div class="financial-metric">
          <div class="financial-metric-label">Coverage-Adjusted Claim Value</div>
          <div class="financial-metric-value" id="coverageAdjustedValue">$0</div>
          <div class="financial-metric-note">After deductible and policy limits</div>
        </div>
      </div>
      
      <!-- Breakdown -->
      <div class="financial-breakdown">
        <div class="breakdown-item">
          <span class="breakdown-label">Structure</span>
          <span class="breakdown-value" id="structureValue">$0</span>
        </div>
        
        <div class="breakdown-item">
          <span class="breakdown-label">Contents</span>
          <span class="breakdown-value" id="contentsValue">$0</span>
        </div>
        
        <div class="breakdown-item">
          <span class="breakdown-label">ALE / Additional</span>
          <span class="breakdown-value" id="aleValue">$0</span>
        </div>
        
        <div class="breakdown-item">
          <span class="breakdown-label">Deductible Applied</span>
          <span class="breakdown-value" id="deductibleValue">-$0</span>
        </div>
        
        <div class="breakdown-item">
          <span class="breakdown-label">Depreciation Withheld</span>
          <span class="breakdown-value" id="depreciationValue">$0</span>
        </div>
        
        <div class="breakdown-item">
          <span class="breakdown-label">Net Payable</span>
          <span class="breakdown-value" id="netPayableValue">$0</span>
        </div>
      </div>
      
      <!-- Payments Received -->
      <div class="financial-payments-section">
        <div class="payments-title">Claim Payments</div>
        <div class="payments-grid">
          <div class="payment-item">
            <span class="payment-label">Payments Received to Date</span>
            <span class="payment-value" id="paymentsReceivedValue">$0</span>
          </div>
          <div class="payment-item">
            <span class="payment-label">Last Payment Date</span>
            <span class="payment-value" id="lastPaymentDate">—</span>
          </div>
          <div class="payment-item">
            <span class="payment-label">Remaining Gap</span>
            <span class="payment-value" id="remainingGapValue">$0</span>
          </div>
        </div>
      </div>
      
      <!-- Status Indicators -->
      <div class="financial-status-grid">
        <div class="status-indicator incomplete" id="docStatusIndicator">
          <div class="status-icon">📋</div>
          <div class="status-label">Documentation</div>
          <div class="status-value" id="docStatusValue">Incomplete</div>
        </div>
        
        <div class="status-indicator incomplete" id="submissionStatusIndicator">
          <div class="status-icon">📤</div>
          <div class="status-label">Submission</div>
          <div class="status-value" id="submissionStatusValue">Not Submitted</div>
        </div>
        
        <div class="status-indicator inactive" id="negotiationStatusIndicator">
          <div class="status-icon">💬</div>
          <div class="status-label">Negotiation</div>
          <div class="status-value" id="negotiationStatusValue">Inactive</div>
        </div>
        
        <div class="status-indicator inactive" id="depreciationStatusIndicator">
          <div class="status-icon">💰</div>
          <div class="status-label">Depreciation</div>
          <div class="status-value" id="depreciationStatusValue">Pending</div>
        </div>
      </div>
      </div> <!-- End financial-summary-content -->
    </div>

    <!-- Critical Claim Deadlines -->
    <div style="background: #f9fafb; border: 1px solid #cbd5e1; border-radius: 10px; padding: 16px 20px; margin: 24px 0; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);">
      <h2 style="font-size: 17px; font-weight: 600; color: #0f172a; text-align: center; margin-bottom: 4px;">Critical Claim Deadlines</h2>
      <p style="font-size: 12px; color: #6b7280; text-align: center; margin-bottom: 16px;">Missing these deadlines can delay or reduce payment.</p>
      
      <div style="max-width: 700px; margin: 0 auto;">
        <!-- Proof of Loss Deadline -->
        <div class="deadline-item urgent" onclick="navigateToStep(6)">
          <div class="deadline-icon">⚠️</div>
          <div class="deadline-content">
            <div class="deadline-date">Proof of Loss due in 15 days (January 14, 2025)</div>
            <div class="deadline-description">Submit sworn statement of loss with all supporting documentation. Late submission may result in claim denial.</div>
            <div class="deadline-step-link">→ Complete Step 6: File Your Proof of Loss with All Evidence</div>
          </div>
        </div>

        <!-- Suit Limitation Deadline -->
        <div class="deadline-item">
          <div class="deadline-icon">📅</div>
          <div class="deadline-content">
            <div class="deadline-date">Lawsuit filing deadline: 365 days from date of loss (November 15, 2025)</div>
            <div class="deadline-description">If claim is denied or settlement is inadequate, legal action must be filed before this date or you forfeit right to sue.</div>
            <div class="deadline-step-link">→ Relevant to Steps 7-9: Negotiation and Settlement Review</div>
          </div>
        </div>

        <!-- Appraisal Request Deadline -->
        <div class="deadline-item">
          <div class="deadline-icon">⚖️</div>
          <div class="deadline-content">
            <div class="deadline-date">Appraisal request: Must be invoked before suit limitation expires</div>
            <div class="deadline-description">If you and your insurer cannot agree on loss amount, either party may demand appraisal per policy terms.</div>
            <div class="deadline-step-link">→ Complete Step 8: Negotiate the Settlement (invoke if needed)</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Post-Claim Asset Section (Shown after Step 10 completion) -->
    <div class="post-claim-section" id="postClaimSection" style="display: none;">
      <h3>Your Claim File Is Now a Permanent Asset</h3>
      <p>This documentation serves as your official record for future disputes, property resale disclosures, warranty claims, tax deductions, and any additional damage discovered later. Maintain this archive indefinitely.</p>
      <div class="post-claim-actions">
        <button class="btn-post-claim" onclick="downloadClaimFile()">📥 Download Complete Claim File</button>
        <button class="btn-post-claim secondary" onclick="viewClaimArchive()">📂 View Archived Documents</button>
      </div>
    </div>

    <!-- Claim Readiness Status -->
    <div style="background: #f9fafb; border: 1px solid #cbd5e1; border-radius: 10px; padding: 16px 20px; margin: 48px 0 32px 0; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08); text-align: center;">
      <div style="font-size: 15px; font-weight: 600; color: #0f172a; margin-bottom: 4px;">
        <span id="readinessIcon">⚠️</span> <span id="readinessStatus">Claim Not Ready to Submit</span>
      </div>
      <div style="font-size: 12px; color: #6b7280;" id="readinessMessage">Complete required documentation steps to submit your claim.</div>
    </div>

    </div><!-- End content-area -->

  </div><!-- End container -->

  <script>
    // GLOBAL FUNCTIONS - Must be defined before any onclick handlers
    function toggleDropdown(e) {
      if (e) {
        e.preventDefault();
        e.stopPropagation();
      }
      
      const dropdown = document.getElementById('uploadDropdown');
      if (!dropdown) {
        console.error('Dropdown element not found');
        return;
      }
      
      const isOpen = dropdown.classList.contains('open');
      
      if (isOpen) {
        dropdown.classList.remove('open');
      } else {
        dropdown.classList.add('open');
      }
      
      console.log('Dropdown toggled:', isOpen ? 'closed' : 'opened');
    }
    
    // Step data for all 13 steps
    const stepData = {
      1: {
        label: 'STEP 1 OF 13',
        title: 'Policy Review & Coverage Analysis',
        subtitle: 'Upload your policy documents for AI analysis to understand your coverage, limits, and claim requirements.',
        primaryAction: {
          title: 'Upload Policy & Generate Analysis',
          description: 'Upload all policy documents (declarations page, full policy, endorsements, riders, amendments). The AI will automatically analyze your policy and generate a comprehensive Policy Intelligence Report.',
          tool: { id: 'policy-uploader', title: 'Upload Policy Documents', classification: 'required' }
        },
        reportSections: {
          title: 'Policy Intelligence Report',
          description: 'System-generated analysis of your policy coverage',
          viewTool: { id: 'policy-report-viewer', title: 'View Policy Intelligence Report', classification: 'required' },
          sections: [
            'Executive Summary',
            'Covered Losses & Property',
            'Coverage Limits & Sublimits',
            'Endorsements & Riders',
            'Exclusions & Restrictions',
            'Loss Settlement Terms (ACV/RCV)',
            'Policyholder Duties',
            'Deadlines & Time Requirements',
            'ALE Rules',
            'Contents Coverage Rules',
            'Critical Risk Flags',
            'Next Moves'
          ]
        },
        infoNote: 'Note: This policy analysis defines what is covered, how your claim will be paid, and which rules apply to your claim.',
        additionalTools: [
          { id: 'coverage-qa-chat', title: 'Coverage Q&A Chat' },
          { id: 'coverage-clarification-letter', title: 'Coverage Clarification Request Letter' },
          { id: 'policy-interpretation-letter', title: 'Policy Interpretation Confirmation Letter' },
          { id: 'download-policy-report', title: 'Download Policy Intelligence Report' }
        ]
      },
      2: {
        label: 'STEP 2 OF 13',
        title: 'Policyholder Duties & Timelines',
        subtitle: 'Review and track your policy duties and deadlines to ensure compliance and protect your coverage.',
        primaryAction: {
          title: 'Review Compliance Requirements',
          description: 'The system automatically imports policyholder duties and deadlines from your Policy Intelligence Report. Review your compliance status for mitigation, notice, cooperation, and documentation requirements.',
          tool: { id: 'compliance-review', title: 'Compliance Review Tool', classification: 'required' }
        },
        reportSections: {
          title: 'Compliance Status Report',
          description: 'System-generated analysis of your policy compliance',
          viewTool: { id: 'compliance-report-viewer', title: 'View Compliance Status Report', classification: 'required' },
          sections: [
            'Mitigation Compliance Status',
            'Notice of Loss Compliance',
            'Cooperation Compliance',
            'Property Protection Compliance',
            'Deadline Compliance Matrix',
            'Overall Compliance Status'
          ]
        },
        infoNote: 'Note: This step evaluates your compliance with policy requirements. Failure to comply with duties or deadlines can impact coverage.',
        additionalTools: [
          { id: 'deadline-calculator', title: 'Deadline Calculator' },
          { id: 'mitigation-documentation-tool', title: 'Mitigation Documentation Tool' },
          { id: 'proof-of-loss-tracker', title: 'Proof of Loss Tracker' },
          { id: 'euo-sworn-statement-guide', title: 'EUO / Sworn Statement Guide' }
        ]
      },
      3: {
        label: 'STEP 3 OF 13',
        title: 'Document the Damage',
        subtitle: 'Upload photos and videos of all damage. The AI will organize, analyze, and assess completeness.',
        primaryAction: {
          title: 'Upload Damage Documentation',
          description: 'Upload all photos and videos showing structural damage, contents damage, and cause of loss. Include multiple angles and close-ups of each damaged area. The AI will automatically label, organize, and analyze your documentation.',
          tool: { id: 'damage-documentation', title: 'Damage Documentation Tool', classification: 'required' }
        },
        reportSections: {
          title: 'Damage Documentation Report',
          description: 'AI-organized analysis of your damage evidence',
          viewTool: { id: 'damage-report-viewer', title: 'View Damage Documentation Report', classification: 'required' },
          sections: [
            'Structural Damage Summary',
            'Contents Damage Summary',
            'Cause of Loss Validation',
            'Photo/Video Completeness Score',
            'Missing Evidence Flags'
          ]
        },
        infoNote: 'Note: Insurance claims are decided based on evidence. This step ensures your damage is thoroughly documented.',
        additionalTools: [
          { id: 'photo-upload-organizer', title: 'Photo Upload Organizer' },
          { id: 'damage-labeling-tool', title: 'Damage Labeling Tool' },
          { id: 'missing-evidence-identifier', title: 'Missing Evidence Identifier' }
        ]
      },
      4: {
        label: 'STEP 4 OF 13',
        title: 'Get Professional Repair Estimate',
        subtitle: 'Upload your contractor\'s repair estimate for AI quality analysis and completeness validation.',
        primaryAction: {
          title: 'Upload & Analyze Contractor Estimate',
          description: 'Upload your contractor\'s repair estimate (PDF, DOC, XLS, or image). The AI automatically analyzes scope gaps, pricing issues, code upgrade requirements, missing trade items, and generates an Estimate Quality Report.',
          tool: { id: 'estimate-review', title: 'Estimate Review Tool', classification: 'required' }
        },
        reportSections: {
          title: 'Estimate Quality Report',
          description: 'AI analysis of your contractor estimate',
          viewTool: { id: 'estimate-quality-viewer', title: 'View Estimate Quality Report', classification: 'required' },
          sections: [
            'Estimator Credentials Check',
            'Scope Completeness Analysis',
            'Line-Item Detail Score',
            'Code Upgrade Identification',
            'Estimate Deficiency Flags'
          ]
        },
        infoNote: 'Note: A complete, professional estimate establishes the true cost of repairs and protects against underpayment.',
        additionalTools: [
          { id: 'contractor-scope-checklist', title: 'Contractor Scope Checklist' },
          { id: 'code-upgrade-identifier', title: 'Code Upgrade Identifier' },
          { id: 'missing-trade-detector', title: 'Missing Trade Detector' },
          { id: 'estimate-revision-request-generator', title: 'Estimate Revision Request Generator' }
        ]
      },
      5: {
        label: 'STEP 5 OF 13',
        title: 'Estimate Analysis & Comparison',
        subtitle: 'Compare your contractor estimate with the insurance company estimate to identify discrepancies.',
        primaryAction: {
          title: 'Upload & Compare Carrier Estimate',
          description: 'Upload the insurance company\'s estimate. The AI automatically performs a line-by-line comparison against your contractor estimate from Step 4, identifies discrepancies, scope omissions, pricing deviations, and generates an Estimate Comparison Report.',
          tool: { id: 'estimate-comparison', title: 'Estimate Comparison Tool', classification: 'required' }
        },
        reportSections: {
          title: 'Estimate Comparison Report',
          description: 'Line-by-line analysis of estimate differences',
          viewTool: { id: 'estimate-comparison-viewer', title: 'View Estimate Comparison Report', classification: 'required' },
          sections: [
            'Comparison Summary',
            'Scope Gaps',
            'Pricing Deltas',
            'Missing Line Items',
            'Negotiation Talking Points'
          ]
        },
        infoNote: 'Note: This comparison identifies underpayment, missing scope items, and pricing discrepancies between estimates.',
        additionalTools: [
          { id: 'line-item-discrepancy-finder', title: 'Line-Item Discrepancy Finder' },
          { id: 'pricing-deviation-analyzer', title: 'Pricing Deviation Analyzer' },
          { id: 'scope-omission-detector', title: 'Scope Omission Detector' },
          { id: 'negotiation-language-generator', title: 'Negotiation Language Generator' }
        ]
      },
      6: {
        label: 'STEP 6 OF 13',
        title: 'Align Loss With Policy Coverage',
        subtitle: 'Map documented losses to policy coverages, limits, and endorsements to ensure proper claim alignment.',
        primaryAction: {
          title: 'Align Loss to Coverage',
          description: 'The AI automatically imports policy details from Step 1 and loss documentation from Steps 3-5, maps all losses to applicable coverages, identifies sublimit impacts, flags exclusion conflicts, and generates a Coverage Alignment Report.',
          tool: { id: 'coverage-alignment', title: 'Coverage Alignment Engine', classification: 'required' }
        },
        reportSections: {
          title: 'Coverage Alignment Report',
          description: 'Mapping of losses to policy coverages',
          viewTool: { id: 'alignment-report-viewer', title: 'View Coverage Alignment Report', classification: 'required' },
          sections: [
            'Coverage Mapping Summary',
            'Sublimit Impact Analysis',
            'Exclusion Conflict Flags',
            'Missed Coverage Opportunities',
            'Claim Allocation Strategy'
          ]
        },
        infoNote: 'Note: This step ensures all documented losses are properly applied to available coverage and identifies missed opportunities.',
        additionalTools: [
          { id: 'coverage-mapping-visualizer', title: 'Coverage Mapping Visualizer' },
          { id: 'sublimit-impact-analyzer', title: 'Sublimit Impact Analyzer' },
          { id: 'endorsement-opportunity-identifier', title: 'Endorsement Opportunity Identifier' },
          { id: 'coverage-gap-detector', title: 'Coverage Gap Detector' }
        ]
      },
      7: {
        label: 'STEP 7 OF 13',
        title: 'ALE & Temporary Housing',
        subtitle: 'Track and validate Additional Living Expense (ALE) benefits for temporary housing and displacement costs.',
        primaryAction: {
          title: 'Track ALE Expenses',
          description: 'Log all additional living expenses including temporary housing, meals, transportation, laundry, storage, and other displacement costs. Upload receipts and documentation. The AI automatically validates expenses, checks eligibility, and tracks remaining limits.',
          tool: { id: 'ale-tracker', title: 'ALE Tracker / Validator', classification: 'required' }
        },
        reportSections: {
          title: 'ALE Compliance Report',
          description: 'Tracking and validation of displacement expenses',
          viewTool: { id: 'ale-report-viewer', title: 'View ALE Compliance Report', classification: 'required' },
          sections: [
            'ALE Eligibility Status',
            'Expense Summary by Category',
            'Remaining ALE Limits',
            'Compliance Flags',
            'Reimbursement Timeline'
          ]
        },
        infoNote: 'Note: ALE coverage reimburses increased living costs while your home is uninhabitable. This step remains active and can be updated throughout your claim.',
        additionalTools: [
          { id: 'expense-upload-tool', title: 'Expense Upload Tool' },
          { id: 'ale-eligibility-checker', title: 'ALE Eligibility Checker' },
          { id: 'remaining-ale-limit-calculator', title: 'Remaining ALE Limit Calculator' },
          { id: 'temporary-housing-documentation-helper', title: 'Temporary Housing Documentation Helper' }
        ]
      },
      8: {
        label: 'STEP 8 OF 13',
        title: 'Build Contents Inventory',
        subtitle: 'Create a complete room-by-room inventory of damaged personal property.',
        primaryAction: {
          title: 'Create Contents Inventory',
          description: 'Enter all damaged items with description, room/location, quantity, damage status, and photos/receipts if available. The AI automatically validates completeness, identifies missing categories and rooms, and generates an Inventory Completeness Report.',
          tool: { id: 'contents-inventory', title: 'Contents Inventory Tool', classification: 'required' }
        },
        reportSections: {
          title: 'Inventory Completeness Report',
          description: 'AI validation of your contents inventory',
          viewTool: { id: 'inventory-report-viewer', title: 'View Inventory Completeness Report', classification: 'required' },
          sections: [
            'Room Coverage Summary',
            'Category Completeness Score',
            'Missing Room Flags',
            'Missing Category Flags',
            'Documentation Quality Score'
          ]
        },
        infoNote: 'Note: Insurance companies only pay for items that are properly listed and documented. This step ensures completeness before valuation.',
        additionalTools: [
          { id: 'room-by-room-prompt-tool', title: 'Room-by-Room Prompt Tool' },
          { id: 'category-coverage-checker', title: 'Category Coverage Checker' },
          { id: 'contents-documentation-helper', title: 'Contents Documentation Helper' }
        ],
        isCritical: true
      },
      9: {
        label: 'STEP 9 OF 13',
        title: 'Contents Valuation',
        subtitle: 'Calculate ACV and RCV for all inventoried contents with AI-powered valuation.',
        primaryAction: {
          title: 'Calculate Contents Value',
          description: 'The AI automatically calculates RCV (Replacement Cost Value) and ACV (Actual Cash Value) for all items from Step 8 inventory. Review valuations, adjust if needed, and generate a Contents Valuation Report showing ACV/RCV totals, depreciation summary, and holdback amounts.',
          tool: { id: 'contents-valuation', title: 'Contents Valuation Tool', classification: 'required' }
        },
        reportSections: {
          title: 'Contents Valuation Report',
          description: 'ACV and RCV calculations for all items',
          viewTool: { id: 'valuation-report-viewer', title: 'View Contents Valuation Report', classification: 'required' },
          sections: [
            'RCV Total Summary',
            'ACV Total Summary',
            'Depreciation Analysis',
            'Holdback Amount',
            'Recovery Eligibility'
          ]
        },
        infoNote: 'Note: This step calculates replacement cost and actual cash value to ensure accurate contents reimbursement.',
        additionalTools: [
          { id: 'depreciation-calculator', title: 'Depreciation Calculator' },
          { id: 'comparable-item-finder', title: 'Comparable Item Finder' },
          { id: 'replacement-cost-justification-tool', title: 'Replacement Cost Justification Tool' }
        ]
      },
      10: {
        label: 'STEP 10 OF 13',
        title: 'Assemble the Claim Package',
        subtitle: 'Compile all reports and documentation into a professional, submission-ready claim package.',
        primaryAction: {
          title: 'Assemble Claim Package',
          description: 'The AI automatically imports all completed reports from Steps 1-9, compiles them into a professional submission package, evaluates completeness, identifies missing components and submission risks, and generates a Claim Package Readiness Report.',
          tool: { id: 'claim-package-assembly', title: 'Claim Package Assembly Engine', classification: 'required' }
        },
        reportSections: {
          title: 'Claim Package Readiness Report',
          description: 'Evaluation of submission readiness',
          viewTool: { id: 'readiness-report-viewer', title: 'View Claim Package Readiness Report', classification: 'required' },
          sections: [
            'Package Completeness Score',
            'Missing Component Flags',
            'Submission Risk Assessment',
            'Document Organization Summary',
            'Submission Checklist'
          ]
        },
        infoNote: 'Note: A complete, well-organized package strengthens your claim and reduces carrier delays.',
        additionalTools: [
          { id: 'submission-checklist-generator', title: 'Submission Checklist Generator' },
          { id: 'missing-document-identifier', title: 'Missing Document Identifier' },
          { id: 'pre-submission-risk-review-tool', title: 'Pre-Submission Risk Review Tool' },
          { id: 'carrier-submission-cover-letter-generator', title: 'Carrier Submission Cover Letter Generator' }
        ]
      },
      11: {
        label: 'STEP 11 OF 13',
        title: 'Submit the Claim',
        subtitle: 'Submit your complete claim package to the insurance carrier and document receipt confirmation.',
        primaryAction: {
          title: 'Submit Claim Package',
          description: 'Choose your submission method (certified mail, carrier portal, or email with receipt confirmation). Submit your complete claim package and obtain proof of submission. The AI tracks submission details and generates a confirmation report.',
          tool: { id: 'claim-submitter', title: 'Claim Submission Tool', classification: 'required' }
        },
        reportSections: {
          title: 'Submission Confirmation Report',
          description: 'Documentation of claim submission',
          viewTool: { id: 'submission-report-viewer', title: 'View Submission Confirmation Report', classification: 'required' },
          sections: [
            'Submission Method & Timestamp',
            'Carrier Acknowledgment Status',
            'Follow-Up Schedule',
            'Next Moves'
          ]
        },
        infoNote: 'Note: Document your submission method and obtain written confirmation of receipt to establish your claim timeline.',
        additionalTools: [
          { id: 'submission-method', title: 'Submission Method Guide' },
          { id: 'submission-confirmation-email', title: 'Submission Confirmation Email Template' },
          { id: 'followup-status-letter', title: 'Follow-Up Status Request Letter' },
          { id: 'download-submission-report', title: 'Download Submission Report' }
        ]
      },
      12: {
        label: 'STEP 12 OF 13',
        title: 'Respond to Carrier Requests',
        subtitle: 'Log and respond to insurance company requests with AI-guided analysis and response strategy.',
        primaryAction: {
          title: 'Log & Respond to Carrier Requests',
          description: 'Enter or upload carrier request details (email, letter, portal message). The AI automatically analyzes legitimacy, evaluates policy basis, assesses response scope, identifies overproduction risks, and generates a Carrier Response Analysis Report with recommended actions.',
          tool: { id: 'carrier-response', title: 'Carrier Request Response Engine', classification: 'required' }
        },
        reportSections: {
          title: 'Carrier Response Analysis Report',
          description: 'Analysis of carrier requests and response strategy',
          viewTool: { id: 'response-report-viewer', title: 'View Carrier Response Analysis Report', classification: 'required' },
          sections: [
            'Request Legitimacy Analysis',
            'Policy Basis Evaluation',
            'Response Scope Assessment',
            'Overproduction Risk Flags',
            'Recommended Response Strategy'
          ]
        },
        infoNote: 'Note: This step remains active throughout your claim. Log each new request individually for AI analysis and response guidance.',
        additionalTools: [
          { id: 'carrier-request-logger', title: 'Carrier Request Logger' },
          { id: 'deadline-response-tracker', title: 'Deadline & Response Tracker' },
          { id: 'response-letter-generator', title: 'Response Letter Generator' },
          { id: 'document-production-checklist', title: 'Document Production Checklist' }
        ]
      },
      13: {
        label: 'STEP 13 OF 13',
        title: 'Correct Underpayments & Supplements',
        subtitle: 'Identify underpayments and valuation errors. Generate supplement justification for negotiation.',
        primaryAction: {
          title: 'Analyze Underpayments & Generate Supplement',
          description: 'Upload updated estimates, additional documentation, carrier payment summaries, and prior correspondence. The AI automatically imports prior reports from Steps 5, 8, 9, 10, and 12, compares carrier offers to documented loss, identifies underpayments, and generates a Supplement Strategy Report.',
          tool: { id: 'supplement-analysis', title: 'Supplement & Underpayment Analysis Engine', classification: 'required' }
        },
        reportSections: {
          title: 'Supplement Strategy Report',
          description: 'Analysis of underpayments and negotiation strategy',
          viewTool: { id: 'supplement-report-viewer', title: 'View Supplement Strategy Report', classification: 'required' },
          sections: [
            'Underpayment Summary',
            'Scope Omissions',
            'Valuation Discrepancies',
            'Negotiation Positions',
            'Escalation Triggers'
          ]
        },
        infoNote: 'Note: This step may be repeated as needed until your claim is fully and properly paid. Compare carrier offers against documented losses.',
        additionalTools: [
          { id: 'supplement-calculation-tool', title: 'Supplement Calculation Tool' },
          { id: 'negotiation-strategy-generator', title: 'Negotiation Strategy Generator' },
          { id: 'supplement-cover-letter-generator', title: 'Supplement Cover Letter Generator' },
          { id: 'escalation-readiness-checker', title: 'Escalation Readiness Checker' }
        ]
      }
    };

    let currentStep = 1;
    let completedSteps = [];
    let taskCompletion = {}; // Track which tasks are completed per step

    // Load saved state from storage
    function loadSavedState() {
      const state = getClaimData('claimNavigatorState');
      if (state) {
        currentStep = state.currentStep || 1;
        completedSteps = state.completedSteps || [];
        taskCompletion = state.taskCompletion || {};
        
        // Load claim info
        if (state.claimInfo) {
          document.getElementById('claimNumber').textContent = state.claimInfo.claimNumber || 'Not set';
          document.getElementById('dateOfLoss').textContent = state.claimInfo.dateOfLoss || 'Not set';
          document.getElementById('daysSinceLoss').textContent = state.claimInfo.daysSinceLoss || '0 days';
          document.getElementById('insurerName').textContent = state.claimInfo.insurerName || 'Not set';
          document.getElementById('adjusterName').textContent = state.claimInfo.adjusterName || 'Not set';
          document.getElementById('claimStatus').textContent = state.claimInfo.claimStatus || 'Not started';
        }
      }
    }

    // Save state to storage
    function saveState() {
      const state = {
        currentStep: currentStep,
        completedSteps: completedSteps,
        taskCompletion: taskCompletion,
        claimInfo: {
          claimNumber: document.getElementById('claimNumber').textContent,
          dateOfLoss: document.getElementById('dateOfLoss').textContent,
          daysSinceLoss: document.getElementById('daysSinceLoss').textContent,
          insurerName: document.getElementById('insurerName').textContent,
          adjusterName: document.getElementById('adjusterName').textContent,
          claimStatus: document.getElementById('claimStatus').textContent
        },
        lastSaved: new Date().toISOString()
      };
      saveClaimData('claimNavigatorState', state);
    }

    // Calculate real progress based on completed tasks
    function calculateProgress() {
      let totalTasks = 0;
      let completedTasks = 0;
      
      // Count all tasks across all steps
      Object.values(stepData).forEach(step => {
        totalTasks += step.tasks.length;
      });
      
      // Count completed tasks
      Object.values(taskCompletion).forEach(stepTasks => {
        completedTasks += stepTasks.filter(t => t).length;
      });
      
      return Math.round((completedTasks / totalTasks) * 100);
    }

    function navigateToStep(stepNum) {
      currentStep = stepNum;
      updateUI();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function saveProgress() {
      saveState();
      const timestamp = new Date().toLocaleTimeString();
      alert(`✅ Progress saved at ${timestamp}!\n\nAll your progress is automatically saved.`);
    }

    function editClaimInfo() {
      const claimNumber = prompt('Claim Number:', document.getElementById('claimNumber').textContent);
      if (claimNumber !== null) document.getElementById('claimNumber').textContent = claimNumber;
      
      const dateOfLoss = prompt('Date of Loss:', document.getElementById('dateOfLoss').textContent);
      if (dateOfLoss !== null) {
        document.getElementById('dateOfLoss').textContent = dateOfLoss;
        // Calculate days since loss
        const lossDate = new Date(dateOfLoss);
        const today = new Date();
        const daysDiff = Math.floor((today - lossDate) / (1000 * 60 * 60 * 24));
        document.getElementById('daysSinceLoss').textContent = daysDiff + ' days';
      }
      
      const insurerName = prompt('Insurance Company:', document.getElementById('insurerName').textContent);
      if (insurerName !== null) document.getElementById('insurerName').textContent = insurerName;
      
      const adjusterName = prompt('Adjuster Name:', document.getElementById('adjusterName').textContent);
      if (adjusterName !== null) document.getElementById('adjusterName').textContent = adjusterName;
      
      const claimStatus = prompt('Claim Status:', document.getElementById('claimStatus').textContent);
      if (claimStatus !== null) document.getElementById('claimStatus').textContent = claimStatus;
      
      saveState();
    }

    function showExample(docName) {
      // Map document names to examples
      const exampleMap = {
        'Complete Insurance Policy (Declarations + Full Contract)': 'policy',
        'All Policy Endorsements & Riders': 'endorsements',
        'Premium Payment Records': 'payments',
        'Prior Claim History (if applicable)': 'history'
      };
      
      const examples = {
        'policy': 'This would show a sample insurance policy declarations page with coverage amounts, deductibles, and named insured information.',
        'endorsements': 'This would show what endorsements/riders look like - extra pages that modify your base policy coverage.',
        'payments': 'This would show a sample payment history statement showing your premium payments.',
        'history': 'This would show a sample prior claims history document (CLUE report or similar).',
        'default': 'Sample document example would be displayed here. In production, this would show an actual annotated example with explanations of each section.'
      };
      
      const key = exampleMap[docName] || 'default';
      alert('📄 EXAMPLE DOCUMENT\n\n' + examples[key]);
    }

    function toggleProblems(header) {
      const content = header.nextElementSibling;
      const isOpen = content.style.display === 'block';
      
      content.style.display = isOpen ? 'none' : 'block';
      header.classList.toggle('open');
    }

    function toggleSection(sectionId) {
      const section = document.getElementById(sectionId);
      if (section) {
        section.classList.toggle('expanded');
      }
    }

    function openTool(toolId, stepNum) {
      // Get tool configuration from registry
      const toolConfig = getToolConfig(toolId);
      
      if (!toolConfig) {
        console.error(`Tool ID "${toolId}" not found in registry`);
        alert(`⚠️ Tool "${toolId}" is not yet available.\n\nThis tool is currently being configured. Please try again later or contact support.`);
        return;
      }
      
      // Handle acknowledgment tools (stay on page)
      if (toolConfig.engine === 'acknowledgment') {
        const step = stepNum || currentStep;
        acknowledgeStep(step);
        return;
      }
      
      // Build URL with query parameters
      const step = stepNum || currentStep;
      const returnUrl = encodeURIComponent('/step-by-step-claim-guide.html');
      
      const url = `${toolConfig.url}`
        + `?engine=${toolConfig.engine}`
        + `&mode=${toolConfig.mode}`
        + `&toolId=${toolId}`
        + `&step=${step}`
        + `&return=${returnUrl}`;
      
      // Navigate to tool
      console.log(`Opening tool: ${toolId} → ${toolConfig.url}`);
      window.location.href = url;
    }
    
    // Acknowledge step completion
    function acknowledgeStep(stepNum) {
      // Check if primary tool output exists
      const hasPrimaryOutput = hasPrimaryToolOutput(stepNum);
      
      if (!hasPrimaryOutput && stepNum !== 11) {
        alert(`⚠️ Cannot acknowledge Step ${stepNum}\n\nYou must complete the primary tool and generate a report before acknowledging this step.`);
        return;
      }
      
      // Mark step as acknowledged
      if (!taskCompletion[stepNum]) {
        taskCompletion[stepNum] = [];
      }
      
      // Mark all tasks as complete
      const step = stepData[stepNum];
      if (step && step.tasks) {
        taskCompletion[stepNum] = step.tasks.map(() => true);
      }
      
      // Add to completed steps
      if (!completedSteps.includes(stepNum)) {
        completedSteps.push(stepNum);
      }
      
      // Save state
      saveState();
      
      // Update UI
      updateUI();
      updateProgressIndicator();
      
      // Show confirmation
      alert(`✅ Step ${stepNum} Acknowledged!\n\nYou can now proceed to Step ${stepNum + 1}.`);
      
      // Auto-open next step if not on Step 13
      if (stepNum < 13) {
        setTimeout(() => {
          openStep(stepNum + 1);
        }, 500);
      }
    }
    
    // Get stored tool output
    function getToolOutput(stepNum, toolId) {
      const key = `claim_step_${stepNum}_${toolId}_output`;
      return getClaimData(key);
    }
    
    // Save tool output
    function saveToolOutput(stepNum, toolId, output) {
      const key = `claim_step_${stepNum}_${toolId}_output`;
      saveClaimData(key, output);
    }
    
    // Check if primary tool output exists
    function hasPrimaryToolOutput(stepNum) {
      const step = stepData[stepNum];
      if (!step || !step.tasks) return false;
      
      // Define primary tools by step
      const primaryToolIds = {
        1: 'policy-intelligence-engine',
        2: 'compliance-review',
        3: 'damage-documentation',
        4: 'estimate-review',
        5: 'estimate-comparison',
        6: 'ale-tracker',
        7: 'contents-inventory',
        8: 'contents-valuation',
        9: 'coverage-alignment',
        10: 'claim-package-assembly',
        12: 'carrier-response',
        13: 'supplement-analysis'
      };
      
      const primaryToolId = primaryToolIds[stepNum];
      if (!primaryToolId) return false;
      
      const output = getToolOutput(stepNum, primaryToolId);
      return output !== null;
    }
    
    // Render tool outputs in step
    function renderToolOutputs(stepNum, contentElement) {
      const step = stepData[stepNum];
      if (!step) return;
      
      let outputsHtml = '';
      
      // Check for primary report
      const primaryToolId = getPrimaryToolId(stepNum);
      
      if (primaryToolId) {
        const output = getToolOutput(stepNum, primaryToolId);
        if (output) {
          const reportName = getReportName(stepNum);
          outputsHtml += `
            <div id="primary-report-${stepNum}" style="background: #f0fdf4; border: 2px solid #86efac; border-radius: 8px; padding: 16px; margin: 20px 0;">
              <div style="font-size: 14px; font-weight: 700; color: #166534; margin-bottom: 8px;">
                ✅ Primary Step Report Generated
              </div>
              <div style="font-size: 13px; color: #166534; margin-bottom: 12px;">
                ${output.summary || 'Report completed successfully.'}
              </div>
              <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                <button onclick="openTool('${primaryToolId}', ${stepNum})" style="padding: 8px 16px; background: #22c55e; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: 600;">
                  View Full Report →
                </button>
                <button onclick="exportReportPDF(${stepNum})" style="padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: 600;">
                  📥 Download PDF
                </button>
                <button onclick="exportReportDOC(${stepNum})" style="padding: 8px 16px; background: #8b5cf6; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: 600;">
                  📄 Download DOC
                </button>
              </div>
            </div>
          `;
        }
      }
      
      // Check for supporting tool outputs
      const supportingOutputs = [];
      if (step.additionalTools) {
        step.additionalTools.forEach(tool => {
          const output = getToolOutput(stepNum, tool.id);
          if (output) {
            supportingOutputs.push({
              title: tool.title,
              id: tool.id,
              output: output
            });
          }
        });
      }
      
      if (supportingOutputs.length > 0) {
        outputsHtml += `
          <div style="background: #eff6ff; border: 1px solid #bfdbfe; border-radius: 8px; padding: 16px; margin: 20px 0;">
            <div style="font-size: 13px; font-weight: 700; color: #1e40af; margin-bottom: 12px;">
              Supporting Tool Outputs
            </div>
        `;
        
        supportingOutputs.forEach(item => {
          outputsHtml += `
            <div style="background: white; border: 1px solid #bfdbfe; border-radius: 6px; padding: 12px; margin-bottom: 8px;">
              <div style="font-size: 12px; font-weight: 600; color: #1e3a5f; margin-bottom: 4px;">
                ${item.title}
              </div>
              <div style="font-size: 11px; color: #64748b;">
                ${item.output.summary || 'Completed'}
              </div>
              <button onclick="openTool('${item.id}', ${stepNum})" style="margin-top: 6px; padding: 6px 12px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: 600;">
                View →
              </button>
            </div>
          `;
        });
        
        outputsHtml += `</div>`;
      }
      
      if (outputsHtml) {
        const existingOutputs = contentElement.querySelector('.tool-outputs-container');
        if (existingOutputs) {
          existingOutputs.innerHTML = outputsHtml;
        } else {
          const container = document.createElement('div');
          container.className = 'tool-outputs-container';
          container.innerHTML = outputsHtml;
          contentElement.insertBefore(container, contentElement.firstChild);
        }
      }
    }

    function updateProgressIndicator() {
      const progress = calculateProgress();
      const completedTasksTotal = Object.values(taskCompletion).reduce((sum, stepTasks) => {
        return sum + stepTasks.filter(t => t).length;
      }, 0);
      const totalTasksTotal = Object.values(stepData).reduce((sum, step) => {
        return sum + step.tasks.length;
      }, 0);
      
      document.querySelector('.progress-percent').textContent = progress + '% Complete';
      document.querySelector('.progress-stage').textContent = `${completedTasksTotal} of ${totalTasksTotal} tasks done`;
      document.querySelector('.progress-ring').style.setProperty('--progress', progress);
    }

    function openStep(stepNum) {
      console.log('Opening step:', stepNum);
      
      // Close all accordion items
      const allItems = document.querySelectorAll('.accordion-item');
      allItems.forEach(item => item.classList.remove('active'));
      
      // Open selected item
      const selectedItem = document.querySelector(`.accordion-item[data-step="${stepNum}"]`);
      if (!selectedItem) {
        console.error('Could not find accordion item for step:', stepNum);
        return;
      }
      
      selectedItem.classList.add('active');
      
      // Update current step
      currentStep = stepNum;
      
      // Load content into accordion
      const data = stepData[stepNum];
      if (!data) {
        console.error('No data found for step:', stepNum);
        return;
      }
      
      const content = selectedItem.querySelector('.accordion-content');
      if (!content) {
        console.error('Could not find accordion-content element');
        return;
      }
      
      // Build content HTML
      let html = '';
      
      // ALL STEPS now use the unified structure
      if (data.primaryAction) {
        // Step 7 Critical Warning (if applicable)
        if (data.isCritical) {
          html += `
            <div class="step-critical-warning">
              This is where most claims lose money if handled incorrectly.
            </div>
          `;
        }
        
        // Primary action - upload and analyze
        html += `
          <div class="primary-action-container">
            <h3 class="primary-action-title">${data.primaryAction.title}</h3>
            <p class="primary-action-description">${data.primaryAction.description}</p>
        `;
        
        if (data.primaryAction.tool) {
          const classification = data.primaryAction.tool.classification || 'required';
          html += `
            <div class="task-tool-inline" onclick="openTool('${data.primaryAction.tool.id}', ${stepNum})">
              <span class="task-tool-arrow">→</span>
              <span class="task-tool-label">Use:</span>
              <span class="task-tool-title">${data.primaryAction.tool.title}</span>
              <span class="task-tool-classification ${classification}">${classification}</span>
            </div>
          `;
        }
        
        html += '</div>';
        
        // Report Sections
        if (data.reportSections) {
          html += `
            <div class="report-sections-container">
              <h3 class="report-sections-title">${data.reportSections.title}</h3>
              <p class="report-sections-description">${data.reportSections.description}</p>
          `;
          
          if (data.reportSections.viewTool) {
            const classification = data.reportSections.viewTool.classification || 'required';
            html += `
              <div class="task-tool-inline" onclick="openTool('${data.reportSections.viewTool.id}', ${stepNum})">
                <span class="task-tool-arrow">→</span>
                <span class="task-tool-label">View:</span>
                <span class="task-tool-title">${data.reportSections.viewTool.title}</span>
                <span class="task-tool-classification ${classification}">${classification}</span>
              </div>
            `;
          }
          
          // Report sections list
          html += '<div class="report-sections-list"><strong>Report Sections:</strong><ul>';
          data.reportSections.sections.forEach(section => {
            html += `<li>${section}</li>`;
          });
          html += '</ul></div>';
          
          html += '</div>';
        }
        
        // Informational note at bottom
        if (data.infoNote) {
          html += `
            <div class="step-info-note">
              <span class="step-info-note-icon">ℹ️</span>${data.infoNote}
            </div>
          `;
        }
      }
      // LEGACY FORMAT (should not be used anymore)
      else if (data.beforeYouContinue) {
        // Before You Continue block
        html += `
          <div class="before-you-continue">
            <div class="before-you-continue-title">Before You Continue</div>
            <ul class="before-you-continue-list">
              <li class="before-you-continue-item"><strong>If skipped:</strong> ${data.beforeYouContinue.ifSkipped}</li>
              <li class="before-you-continue-item"><strong>Prevents:</strong> ${data.beforeYouContinue.prevents}</li>
              <li class="before-you-continue-item"><strong>Do not:</strong> ${data.beforeYouContinue.doNot}</li>
            </ul>
          </div>
        `;
        
        // Tasks intro
        if (data.tasksIntro) {
          html += `<div class="tasks-intro">${data.tasksIntro}</div>`;
        }
        
        // Step 7 Critical Warning
        if (data.isCritical) {
          html += `
            <div class="step-critical-warning">
              This is where most claims lose money if handled incorrectly.
            </div>
          `;
        }
        
        // Minimum Proof Check
        if (data.minProofRequired) {
          const proofMet = checkMinProofRequirement(stepNum, data.minProofRequired);
          if (!proofMet) {
            html += `
              <div class="guardrail-warning">
                <strong>🔒 Proof Required:</strong>
                ${data.minProofRequired.message}
              </div>
            `;
          }
        }
        
        // HIERARCHY FIX: Section anchor for tasks
        html += '<div class="section-anchor-tasks">What you need to do now</div>';
        
        // Sequential task list with inline tools
        html += '<ul class="task-list-sequential">';
        data.tasks.forEach((task, index) => {
          html += `
            <li class="task-item-sequential">
              <div class="task-header-sequential">
                <div class="task-number">${index + 1}</div>
                <div class="task-title-sequential">${task.title}</div>
              </div>
              <div class="task-description-sequential">${task.description}</div>
          `;
          
          // Inline tool if present
          if (task.tool) {
            const classification = task.tool.classification || 'optional';
            html += `
              <div class="task-tool-inline" onclick="openTool('${task.tool.id}', ${stepNum})">
                <span class="task-tool-arrow">→</span>
                <span class="task-tool-label">Use:</span>
                <span class="task-tool-title">${task.tool.title}</span>
                <span class="task-tool-classification ${classification}">${classification}</span>
              </div>
            `;
          }
          
          html += '</li>';
        });
        html += '</ul>';
        
        // HIERARCHY FIX: Section anchor for tools
        // Additional Tools section
        if (data.additionalTools && data.additionalTools.length > 0) {
          html += '<div class="section-anchor-tools">Tools that help with this step</div>';
          html += `
            <div class="additional-tools-section">
              <div class="additional-tools-title">Additional Tools (Optional)</div>
              <ul class="additional-tools-list">
          `;
          data.additionalTools.forEach(tool => {
            html += `
              <li class="additional-tool-item" onclick="openTool('${tool.id}', ${stepNum})">
                <span class="additional-tool-arrow">→</span>
                <span class="additional-tool-title">${tool.title}</span>
              </li>
            `;
          });
          html += `
              </ul>
            </div>
          `;
        }
        
        // Step 1 Policy Flags: Coinsurance Warning
        if (stepNum === 1 && data.policyFlags && data.policyFlags.coinsurance && data.policyFlags.coinsurance.detected) {
          const coinsurance = data.policyFlags.coinsurance;
          html += `
            <div class="coinsurance-warning">
              <div class="coinsurance-title">⚠️ Coinsurance Requirement Detected</div>
              <div class="coinsurance-content">
                Your policy requires coverage of at least <span class="coinsurance-requirement">${coinsurance.requirement}</span> of replacement cost. ${coinsurance.explanation}
              </div>
            </div>
          `;
        }
        
        // Step 1 Policy Flags: Policyholder Duties
        if (stepNum === 1 && data.policyFlags && data.policyFlags.policyholderDuties && data.policyFlags.policyholderDuties.length > 0) {
          html += `
            <div class="policyholder-duties">
              <div class="duties-title">📋 Your Policy Duties After a Loss</div>
              <ul class="duties-list">
          `;
          data.policyFlags.policyholderDuties.forEach(duty => {
            html += `
              <li class="duty-item">
                <div class="duty-icon">✓</div>
                <div class="duty-content">
                  <div class="duty-text">${duty.duty}</div>
                  <div class="duty-meta">
                    <span class="duty-deadline">⏱️ ${duty.deadline}</span>
                    <span>•</span>
                    <a class="duty-link" onclick="navigateToStep(${duty.linkedStep})">→ Go to Step ${duty.linkedStep}</a>
                  </div>
                </div>
              </li>
            `;
          });
          html += `
              </ul>
            </div>
          `;
        }
        
        // Expert Guidance (Steps 4 & 5)
        if ((stepNum === 4 || stepNum === 5) && data.expertGuidance && data.expertGuidance.show) {
          const guidance = data.expertGuidance;
          html += `
            <div class="expert-guidance">
              <div class="expert-guidance-title">💡 ${guidance.title}</div>
              <div class="expert-conditions">
                <ul>
          `;
          guidance.conditions.forEach(condition => {
            html += `<li>${condition}</li>`;
          });
          html += `
                </ul>
              </div>
              <div class="expert-types">
                <div class="expert-types-title">Common Experts</div>
                <div class="expert-type-list">
          `;
          guidance.experts.forEach(expert => {
            html += `
              <div class="expert-type-item">
                <span class="expert-type-name">${expert.type}</span>
                <span class="expert-type-when">${expert.when}</span>
              </div>
            `;
          });
          html += `
                </div>
              </div>
            </div>
          `;
        }
        
        // Mitigation Guidance (Step 2)
        if (stepNum === 2 && data.mitigationGuidance && data.mitigationGuidance.show) {
          const mitigation = data.mitigationGuidance;
          html += `
            <div class="mitigation-guidance">
              <div class="mitigation-guidance-title">🚨 ${mitigation.title}</div>
              <div class="mitigation-explanation">${mitigation.explanation}</div>
              
              <div class="mitigation-section">
                <div class="mitigation-section-title">Immediate Actions Required</div>
                <ul>
          `;
          mitigation.immediateActions.forEach(action => {
            html += `<li>${action}</li>`;
          });
          html += `
                </ul>
              </div>
              
              <div class="mitigation-section">
                <div class="mitigation-section-title">What to Document</div>
                <ul>
          `;
          mitigation.documentationRequired.forEach(doc => {
            html += `<li>${doc}</li>`;
          });
          html += `
                </ul>
              </div>
              
              <div class="mitigation-reimbursement">
                💰 ${mitigation.reimbursement}
              </div>
            </div>
          `;
        }
        
        // Mitigation Capture (Step 3)
        if (stepNum === 3 && data.mitigationCapture && data.mitigationCapture.show) {
          const capture = data.mitigationCapture;
          html += `
            <div class="mitigation-capture">
              <div class="mitigation-capture-title">📋 ${capture.title}</div>
              <div class="mitigation-instructions">${capture.instructions}</div>
              
              <div class="mitigation-upload-types">
          `;
          capture.uploadTypes.forEach(upload => {
            html += `
              <div class="mitigation-upload-item">
                <div class="mitigation-upload-type">${upload.type}</div>
                <div class="mitigation-upload-desc">${upload.description}</div>
              </div>
            `;
          });
          html += `
              </div>
              
              <div class="mitigation-flow-note">
                ✓ ${capture.willFlowTo}
              </div>
            </div>
          `;
        }
      }
      
      // Actions (for all steps)
      html += `
        <div class="step-actions">
          <button class="btn btn-primary" onclick="completeAndNext(${stepNum})">
            ${stepNum === 10 ? '✅ Complete Claim' : 'Mark Complete & Continue →'}
          </button>
        </div>
      `;
      
      // HIERARCHY FIX: Quiet next step preview (only for steps 1-9)
      if (stepNum < 10) {
        const nextStep = stepData[stepNum + 1];
        if (nextStep) {
          html += `
            <div class="next-step-preview">
              <div class="next-step-preview-label">Next Step</div>
              <div class="next-step-preview-title">${nextStep.title}</div>
            </div>
          `;
        }
      }
      
      content.innerHTML = html;
      
      console.log('Step content loaded successfully');
      
      // Render tool outputs
      renderToolOutputs(stepNum, content);
      
      // Save state
      saveState();
      
      // Scroll to accordion item
      setTimeout(() => {
        selectedItem.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }, 100);
    }

    function toggleTask(stepNum, taskIndex, checkbox) {
      checkbox.classList.toggle('checked');
      
      if (!taskCompletion[stepNum]) {
        taskCompletion[stepNum] = [];
      }
      
      taskCompletion[stepNum][taskIndex] = checkbox.classList.contains('checked');
      saveState();
      updateProgressIndicator();
    }

    function completeAndNext(stepNum) {
      // Check if primary tool output exists
      if (!hasPrimaryToolOutput(stepNum)) {
        alert('⚠️ Cannot proceed: Primary step report required.\n\nYou must complete the primary tool for this step before proceeding.');
        return;
      }
      
      // Mark step as completed
      if (!completedSteps.includes(stepNum)) {
        completedSteps.push(stepNum);
      }
      
      // Update visual state
      const item = document.querySelector(`.accordion-item[data-step="${stepNum}"]`);
      item.classList.add('completed');
      
      // Update readiness status
      updateReadinessStatus();
      
      // Update financial summary
      updateFinancialSummary();
      
      // Open next step or show completion
      if (stepNum < 13) {
        openStep(stepNum + 1);
      } else {
        // Show post-claim asset section
        const postClaimSection = document.getElementById('postClaimSection');
        if (postClaimSection) {
          postClaimSection.style.display = 'block';
          setTimeout(() => {
            postClaimSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }, 300);
        }
        alert('🎉 Congratulations! You have completed your entire claim process. Your claim archive is now available below.');
      }
      
      saveState();
    }

    function navigateToStep(stepNum) {
      openStep(stepNum);
    }

    function previousStep() {
      if (currentStep > 1) {
        openStep(currentStep - 1);
      }
    }

    // Check if minimum proof requirement is met
    function checkMinProofRequirement(stepNum, requirement) {
      // This is a placeholder - in production, this would check actual uploads
      // For now, return true to not block progression in demo
      return true;
      
      // Example implementation:
      // if (requirement.type === 'photos') {
      //   const uploadedPhotos = getUploadedPhotos(stepNum);
      //   return uploadedPhotos.length >= requirement.count;
      // }
      // return true;
    }

    // Update Claim Readiness Status Indicator
    function updateReadinessStatus() {
      const icon = document.getElementById('readinessIcon');
      const status = document.getElementById('readinessStatus');
      const message = document.getElementById('readinessMessage');
      
      if (!icon || !status || !message) return;
      
      // Define critical steps for readiness
      const criticalSteps = [3, 5, 6]; // Photos, Estimate, Proof of Loss
      const criticalCompleted = criticalSteps.filter(s => completedSteps.includes(s)).length;
      
      if (criticalCompleted === 0) {
        // Not Ready
        icon.textContent = '⚠️';
        status.textContent = 'Claim Not Ready to Submit';
        message.textContent = 'Complete required documentation steps to submit your claim.';
      } else if (criticalCompleted < criticalSteps.length) {
        // Partially Ready
        icon.textContent = '⚠️';
        status.textContent = 'Partially Ready';
        message.textContent = `You have completed ${criticalCompleted} of ${criticalSteps.length} critical documentation steps.`;
      } else {
        // Ready to Submit
        icon.textContent = '✅';
        status.textContent = 'Ready to Submit';
        message.textContent = 'All critical documentation is complete. Your claim is ready for submission.';
      }
    }

    // Claim Financial Summary Calculation and Update
    function calculateFinancialSummary() {
      // This is a simulated calculation based on step completion
      // In production, this would pull from actual uploaded data and analysis results
      
      const financialData = {
        // Default values
        structure: 0,
        contents: 0,
        ale: 0,
        mitigationCosts: 0, // Emergency mitigation expenses
        deductible: 1000, // Default deductible
        depreciation: 0,
        
        // Policy data (Step 1)
        dwellingLimit: 250000,
        contentsLimit: 100000,
        aleLimit: 50000,
        coinsuranceRequirement: 0.80, // 80% requirement
        replacementCost: 300000, // Actual replacement cost
        insuredAmount: 250000, // Amount of insurance
        
        // Documentation status
        docStatus: 'incomplete',
        submissionStatus: 'not submitted',
        negotiationStatus: 'inactive',
        depreciationStatus: 'pending',
        
        // Estimates (Step 5)
        contractorEstimate: 0,
        insurerEstimate: 0,
        
        // Proof of Loss (Step 6)
        submittedAmount: 0,
        
        // Negotiation (Steps 7-9)
        carrierOffer: 0,
        counterDemand: 0,
        
        // Payments (Steps 9-10)
        paymentsReceived: 0,
        lastPaymentDate: null
      };
      
      // Derive values based on completed steps
      if (completedSteps.includes(1)) {
        // Step 1 completed: Policy analyzed
        // Use default policy limits set above
      }
      
      if (completedSteps.includes(2) || completedSteps.includes(3)) {
        // Steps 2-3: Mitigation costs documented
        // Simulate emergency mitigation expenses (tarps, water extraction, board-up, etc.)
        financialData.mitigationCosts = 2500;
      }
      
      if (completedSteps.includes(3)) {
        // Step 3 completed: Damage documented
        // Simulate documented damage values
        financialData.structure = 45000;
        financialData.contents = 15000;
        financialData.ale = 5000;
        financialData.docStatus = 'preliminary';
      }
      
      if (completedSteps.includes(5)) {
        // Step 5 completed: Estimates compared
        financialData.contractorEstimate = 58000;
        financialData.insurerEstimate = 42000;
        // Use contractor estimate as documented value
        financialData.structure = 48000;
        financialData.contents = 10000;
        financialData.docStatus = 'complete';
      }
      
      if (completedSteps.includes(6)) {
        // Step 6 completed: Proof of Loss filed
        financialData.submittedAmount = financialData.structure + financialData.contents + financialData.ale;
        financialData.submissionStatus = 'submitted';
      }
      
      if (completedSteps.includes(7) || completedSteps.includes(8)) {
        // Steps 7-8: Negotiation active
        financialData.negotiationStatus = 'active';
        financialData.carrierOffer = 42000;
        financialData.counterDemand = 58000;
      }
      
      if (completedSteps.includes(9)) {
        // Step 9: Settlement accepted, initial payment received
        financialData.paymentsReceived = 49000; // Initial payment (net after deductible, less depreciation)
        financialData.lastPaymentDate = new Date('2024-12-15');
      }
      
      if (completedSteps.includes(10)) {
        // Step 10 completed: Depreciation tracked
        financialData.depreciation = 8000;
        financialData.depreciationStatus = 'recoverable';
      }
      
      // Calculate totals (include mitigation costs in ALE/Additional category)
      const documentedTotal = financialData.structure + financialData.contents + financialData.ale + financialData.mitigationCosts;
      const afterDeductible = Math.max(0, documentedTotal - financialData.deductible);
      const netPayable = afterDeductible - financialData.depreciation;
      
      // Calculate remaining gap
      const remainingGap = Math.max(0, netPayable - financialData.paymentsReceived + financialData.depreciation);
      
      // Apply policy limits (mitigation costs are typically covered under ALE)
      const structureCapped = Math.min(financialData.structure, financialData.dwellingLimit);
      const contentsCapped = Math.min(financialData.contents, financialData.contentsLimit);
      const aleCapped = Math.min(financialData.ale + financialData.mitigationCosts, financialData.aleLimit);
      
      // Check for coinsurance penalty
      const requiredInsurance = financialData.replacementCost * financialData.coinsuranceRequirement;
      let coinsurancePenalty = 0;
      let coverageAdjustedTotal = (structureCapped + contentsCapped + aleCapped) - financialData.deductible;
      
      if (financialData.insuredAmount < requiredInsurance) {
        // Apply coinsurance penalty: (Insurance Carried / Insurance Required) × Loss
        const coinsuranceFactor = financialData.insuredAmount / requiredInsurance;
        coinsurancePenalty = coverageAdjustedTotal * (1 - coinsuranceFactor);
        coverageAdjustedTotal = Math.max(0, coverageAdjustedTotal - coinsurancePenalty);
      }
      
      return {
        documentedTotal,
        coverageAdjustedTotal,
        structure: financialData.structure,
        contents: financialData.contents,
        ale: financialData.ale,
        deductible: financialData.deductible,
        depreciation: financialData.depreciation,
        netPayable,
        paymentsReceived: financialData.paymentsReceived,
        lastPaymentDate: financialData.lastPaymentDate,
        remainingGap,
        docStatus: financialData.docStatus,
        submissionStatus: financialData.submissionStatus,
        negotiationStatus: financialData.negotiationStatus,
        depreciationStatus: financialData.depreciationStatus
      };
    }
    
    function updateFinancialSummary() {
      const summary = calculateFinancialSummary();
      
      // Format currency
      const formatCurrency = (amount) => {
        return '$' + Math.round(amount).toLocaleString('en-US');
      };
      
      // Update top line metrics
      const docValue = document.getElementById('documentedClaimValue');
      const covValue = document.getElementById('coverageAdjustedValue');
      if (docValue) docValue.textContent = formatCurrency(summary.documentedTotal);
      if (covValue) covValue.textContent = formatCurrency(summary.coverageAdjustedTotal);
      
      // Update breakdown
      const updateElement = (id, value) => {
        const el = document.getElementById(id);
        if (el) el.textContent = formatCurrency(value);
      };
      
      updateElement('structureValue', summary.structure);
      updateElement('contentsValue', summary.contents);
      updateElement('aleValue', summary.ale);
      updateElement('deductibleValue', summary.deductible);
      updateElement('depreciationValue', summary.depreciation);
      updateElement('netPayableValue', summary.netPayable);
      
      // Update payments section
      updateElement('paymentsReceivedValue', summary.paymentsReceived);
      updateElement('remainingGapValue', summary.remainingGap);
      
      const lastPaymentEl = document.getElementById('lastPaymentDate');
      if (lastPaymentEl) {
        if (summary.lastPaymentDate) {
          const dateStr = summary.lastPaymentDate.toLocaleDateString('en-US', { 
            year: 'numeric', 
            month: 'short', 
            day: 'numeric' 
          });
          lastPaymentEl.textContent = dateStr;
        } else {
          lastPaymentEl.textContent = '—';
        }
      }
      
      // Update status indicators
      const updateStatus = (indicatorId, valueId, status, statusText) => {
        const indicator = document.getElementById(indicatorId);
        const valueEl = document.getElementById(valueId);
        
        if (indicator && valueEl) {
          // Remove all status classes
          indicator.classList.remove('incomplete', 'preliminary', 'complete', 'active', 'inactive');
          
          // Add appropriate status class
          indicator.classList.add(status);
          valueEl.textContent = statusText;
        }
      };
      
      // Documentation status
      const docStatusMap = {
        'incomplete': 'Incomplete',
        'preliminary': 'Preliminary',
        'complete': 'Complete'
      };
      updateStatus('docStatusIndicator', 'docStatusValue', summary.docStatus, docStatusMap[summary.docStatus]);
      
      // Submission status
      const submissionStatusMap = {
        'not submitted': 'Not Submitted',
        'submitted': 'Submitted'
      };
      const submissionClass = summary.submissionStatus === 'submitted' ? 'complete' : 'incomplete';
      updateStatus('submissionStatusIndicator', 'submissionStatusValue', submissionClass, submissionStatusMap[summary.submissionStatus]);
      
      // Negotiation status
      const negotiationStatusMap = {
        'inactive': 'Inactive',
        'active': 'Active'
      };
      updateStatus('negotiationStatusIndicator', 'negotiationStatusValue', summary.negotiationStatus, negotiationStatusMap[summary.negotiationStatus]);
      
      // Depreciation status
      const depreciationStatusMap = {
        'pending': 'Pending',
        'recoverable': 'Recoverable',
        'recovered': 'Recovered'
      };
      const depreciationClass = summary.depreciationStatus === 'recovered' ? 'complete' : (summary.depreciationStatus === 'recoverable' ? 'active' : 'inactive');
      updateStatus('depreciationStatusIndicator', 'depreciationStatusValue', depreciationClass, depreciationStatusMap[summary.depreciationStatus]);
    }

    // Post-claim asset functions
    function downloadClaimFile() {
      alert('Your complete claim file will be downloaded as a ZIP archive containing all documents, photos, and correspondence.');
      // In production: trigger actual download
    }

    function viewClaimArchive() {
      alert('Opening your claim archive viewer...');
      // In production: navigate to archive interface
    }

    // Calculate days between two dates
    function daysBetween(date1, date2) {
      const oneDay = 24 * 60 * 60 * 1000;
      return Math.round((date2 - date1) / oneDay);
    }

    // Update deadline urgency based on days remaining
    function updateDeadlineUrgency() {
      // This would normally calculate based on actual dates
      // For demo purposes, deadlines are static in HTML
      // In production, this would:
      // 1. Calculate days remaining for each deadline
      // 2. Apply .urgent class if < 30 days
      // 3. Apply .critical class if < 7 days
      // 4. Update deadline text dynamically
      
      // Example production implementation:
      /*
      const today = new Date();
      const proofOfLossDate = new Date('2025-01-14');
      const daysUntilPOL = daysBetween(today, proofOfLossDate);
      
      const polItem = document.querySelector('.deadline-item[data-deadline="proof-of-loss"]');
      if (polItem) {
        polItem.classList.remove('urgent', 'critical');
        if (daysUntilPOL <= 7) {
          polItem.classList.add('critical');
        } else if (daysUntilPOL <= 30) {
          polItem.classList.add('urgent');
        }
        
        // Update text
        const dateEl = polItem.querySelector('.deadline-date');
        dateEl.textContent = `Proof of Loss due in ${daysUntilPOL} days (${proofOfLossDate.toLocaleDateString()})`;
      }
      */
    }

    // Get report name for step
    function getReportName(stepNum) {
      const reportNames = {
        1: 'Policy_Intelligence_Report',
        2: 'Compliance_Status_Report',
        3: 'Damage_Documentation_Report',
        4: 'Estimate_Quality_Report',
        5: 'Estimate_Comparison_Report',
        6: 'ALE_Compliance_Report',
        7: 'Inventory_Completeness_Report',
        8: 'Contents_Valuation_Report',
        9: 'Coverage_Alignment_Report',
        10: 'Claim_Package_Readiness_Report',
        12: 'Carrier_Response_Analysis_Report',
        13: 'Supplement_Strategy_Report'
      };
      return reportNames[stepNum] || `Step_${stepNum}_Report`;
    }
    
    // Log export activity
    function logExportActivity(stepNum, reportName, type) {
      const log = getClaimData('exportActivityLog') || [];
      log.push({
        step: stepNum,
        reportName: reportName,
        type: type,
        timestamp: new Date().toISOString()
      });
      saveClaimData('exportActivityLog', log);
    }
    
    // Export report as PDF
    function exportReportPDF(stepNum) {
      const output = getToolOutput(stepNum, getPrimaryToolId(stepNum));
      if (!output) {
        alert('No report data available to export.');
        return;
      }
      
      const reportName = getReportName(stepNum);
      const step = stepData[stepNum];
      const claimNumber = document.getElementById('claimNumber').textContent;
      const dateGenerated = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
      
      // Create PDF content
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      let yPos = 20;
      const lineHeight = 7;
      const pageHeight = doc.internal.pageSize.height;
      const margin = 20;
      
      // Header
      doc.setFontSize(18);
      doc.setFont(undefined, 'bold');
      doc.text('ClaimNavigator AI', margin, yPos);
      yPos += lineHeight + 3;
      
      doc.setFontSize(14);
      doc.text(`Step ${stepNum} Report`, margin, yPos);
      yPos += lineHeight + 2;
      
      doc.setFontSize(12);
      doc.setFont(undefined, 'normal');
      doc.text(step.title, margin, yPos);
      yPos += lineHeight + 5;
      
      // Metadata
      doc.setFontSize(10);
      doc.text(`Claim Number: ${claimNumber}`, margin, yPos);
      yPos += lineHeight;
      doc.text(`Date Generated: ${dateGenerated}`, margin, yPos);
      yPos += lineHeight + 5;
      
      // Separator
      doc.setDrawColor(200, 200, 200);
      doc.line(margin, yPos, doc.internal.pageSize.width - margin, yPos);
      yPos += 10;
      
      // Report content
      doc.setFontSize(11);
      
      if (output.sections && Array.isArray(output.sections)) {
        output.sections.forEach(section => {
          // Check page break
          if (yPos > pageHeight - 40) {
            doc.addPage();
            yPos = margin;
          }
          
          // Section header
          doc.setFont(undefined, 'bold');
          doc.text(section.title || 'Section', margin, yPos);
          yPos += lineHeight;
          
          // Section content
          doc.setFont(undefined, 'normal');
          const content = section.content || section.text || '';
          const lines = doc.splitTextToSize(content, doc.internal.pageSize.width - 2 * margin);
          
          lines.forEach(line => {
            if (yPos > pageHeight - 30) {
              doc.addPage();
              yPos = margin;
            }
            doc.text(line, margin, yPos);
            yPos += lineHeight;
          });
          
          yPos += 5;
        });
      } else if (output.content) {
        const lines = doc.splitTextToSize(output.content, doc.internal.pageSize.width - 2 * margin);
        lines.forEach(line => {
          if (yPos > pageHeight - 30) {
            doc.addPage();
            yPos = margin;
          }
          doc.text(line, margin, yPos);
          yPos += lineHeight;
        });
      } else if (output.summary) {
        const lines = doc.splitTextToSize(output.summary, doc.internal.pageSize.width - 2 * margin);
        lines.forEach(line => {
          if (yPos > pageHeight - 30) {
            doc.addPage();
            yPos = margin;
          }
          doc.text(line, margin, yPos);
          yPos += lineHeight;
        });
      }
      
      // Save PDF
      const filename = `ClaimNavigator_Step_${stepNum}_${reportName}.pdf`;
      doc.save(filename);
      
      // Log export activity
      logExportActivity(stepNum, reportName, 'PDF');
    }
    
    // Export report as DOC
    function exportReportDOC(stepNum) {
      const output = getToolOutput(stepNum, getPrimaryToolId(stepNum));
      if (!output) {
        alert('No report data available to export.');
        return;
      }
      
      const reportName = getReportName(stepNum);
      const step = stepData[stepNum];
      const claimNumber = document.getElementById('claimNumber').textContent;
      const dateGenerated = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
      
      // Build DOC content
      let docContent = '';
      
      // Header
      docContent += `ClaimNavigator AI\n`;
      docContent += `Step ${stepNum} Report\n`;
      docContent += `${step.title}\n\n`;
      docContent += `Claim Number: ${claimNumber}\n`;
      docContent += `Date Generated: ${dateGenerated}\n`;
      docContent += `${'='.repeat(80)}\n\n`;
      
      // Report content
      if (output.sections && Array.isArray(output.sections)) {
        output.sections.forEach(section => {
          docContent += `${section.title || 'Section'}\n`;
          docContent += `${'-'.repeat((section.title || 'Section').length)}\n`;
          docContent += `${section.content || section.text || ''}\n\n`;
        });
      } else if (output.content) {
        docContent += output.content + '\n\n';
      } else if (output.summary) {
        docContent += output.summary + '\n\n';
      }
      
      // Create blob and download
      const blob = new Blob([docContent], { type: 'application/msword' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `ClaimNavigator_Step_${stepNum}_${reportName}.doc`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      // Log export activity
      logExportActivity(stepNum, reportName, 'DOC');
    }
    
    // Get primary tool ID for step
    function getPrimaryToolId(stepNum) {
      const primaryToolIds = {
        1: 'policy-intelligence-engine',
        2: 'compliance-review',
        3: 'damage-documentation',
        4: 'estimate-review',
        5: 'estimate-comparison',
        6: 'ale-tracker',
        7: 'contents-inventory',
        8: 'contents-valuation',
        9: 'coverage-alignment',
        10: 'claim-package-assembly',
        11: 'claim-submitter',
        12: 'carrier-response',
        13: 'supplement-analysis'
      };
      
      return primaryToolIds[stepNum] || null;
    }
    
    // Handle return from tool
    function handleToolReturn() {
      const urlParams = new URLSearchParams(window.location.search);
      const stepNum = parseInt(urlParams.get('step'), 10);
      const saved = urlParams.get('saved');
      
      if (saved === 'true' && stepNum) {
        // Ensure step content loads and renders outputs
        openStep(stepNum);
        
        // Optional: visual confirmation
        setTimeout(() => {
          highlightStepCompletion(stepNum);
        }, 300);
        
        // Clean URL
        window.history.replaceState({}, document.title, window.location.pathname);
      }
    }
    
    // Visual confirmation of step completion
    function highlightStepCompletion(stepNum) {
      const stepEl = document.querySelector(`[data-step="${stepNum}"]`);
      if (!stepEl) return;
      
      stepEl.classList.add('step-complete-flash');
      setTimeout(() => {
        stepEl.classList.remove('step-complete-flash');
      }, 2000);
    }
    
    // Initialize on load
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Page initialized');
      
      // Close dropdown when clicking outside
      document.addEventListener('click', function(e) {
        const dropdown = document.getElementById('uploadDropdown');
        if (!dropdown) return;
        
        // Check if click was inside the dropdown
        const clickedInside = dropdown.contains(e.target);
        
        // If clicked outside and dropdown is open, close it
        if (!clickedInside && dropdown.classList.contains('open')) {
          dropdown.classList.remove('open');
          console.log('Dropdown closed (outside click)');
        }
      });
      
      // MAIN PAGE INITIALIZATION
      loadSavedState();
      
      // Handle tool return
      handleToolReturn();
      
      completedSteps.forEach(stepNum => {
        const item = document.querySelector(`.accordion-item[data-step="${stepNum}"]`);
        if (item) item.classList.add('completed');
      });
      
      if (!currentStep) {
        currentStep = 1;
      }
      
      // Update readiness status on load
      updateReadinessStatus();
      
      // Update deadline urgency on load
      updateDeadlineUrgency();
      
      // Update financial summary on load
      updateFinancialSummary();
      
      // Show post-claim section if Step 13 is completed
      if (completedSteps.includes(13)) {
        const postClaimSection = document.getElementById('postClaimSection');
        if (postClaimSection) {
          postClaimSection.style.display = 'block';
        }
      }
    });
  </script>
</body>
</html>