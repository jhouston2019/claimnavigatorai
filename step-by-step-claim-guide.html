<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Claim Management Center - Claim Navigator</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/app/assets/css/tool-visual-alignment.css">
  <link rel="stylesheet" href="/app/assets/css/workflow-tools-ai.css">
  
  <!-- CRITICAL: Load auth and paywall BEFORE any other scripts -->
  <script src="/app/assets/js/supabase-client.js"></script>
  <script src="/app/assets/js/auth.js" type="module"></script>
  <script src="/app/assets/js/paywall-enforcement.js"></script>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="storage/claimStorage.js"></script>
  <script src="ai-expert-config.js"></script>
  <script src="/app/assets/js/tool-registry.js"></script>
  <script src="/app/assets/js/disclaimer-component.js"></script>
  <script src="/app/assets/js/workflow-tools-ai.js"></script>
  
  <!-- BLOCKING GUARD: Hide content until access verified -->
  <!-- TEMPORARILY DISABLED FOR LOCAL TESTING -->
  <script>
    // AUTHENTICATION DISABLED - Allow page to display for local testing
    console.log('Authentication checks disabled for local testing');
    document.documentElement.style.visibility = 'visible';
    document.documentElement.style.opacity = '1';
    
    /* ORIGINAL AUTH CODE - COMMENTED OUT
    // Block rendering immediately
    document.documentElement.style.visibility = 'hidden';
    document.documentElement.style.opacity = '0';
    
    // Enforce access control before page loads
    (async function() {
      try {
        // Wait for auth system to load
        let attempts = 0;
        while (!window.CNAuth && attempts < 50) {
          await new Promise(resolve => setTimeout(resolve, 100));
          attempts++;
        }
        
        if (!window.CNAuth) {
          console.error('CN Auth system failed to load');
          window.location.href = '/app/access-denied.html';
          return;
        }
        
        // Check authentication
        const user = await window.CNAuth.currentUser();
        if (!user) {
          console.warn('CN Access Denied: No authenticated user');
          window.location.href = '/app/login.html?redirect=' + encodeURIComponent(window.location.pathname);
          return;
        }
        
        // Wait for Supabase client
        attempts = 0;
        while (!window.getSupabaseClient && attempts < 50) {
          await new Promise(resolve => setTimeout(resolve, 100));
          attempts++;
        }
        
        const supabase = await window.getSupabaseClient();
        if (!supabase) {
          console.error('CN Access Denied: Supabase unavailable');
          window.location.href = '/app/access-denied.html';
          return;
        }
        
        // Check for active claim
        const { data: claims, error } = await supabase
          .from('claims')
          .select('id, status')
          .eq('user_id', user.id)
          .eq('status', 'active')
          .limit(1);
        
        if (error) {
          console.error('CN Access Denied: Database error', error);
          window.location.href = '/app/access-denied.html';
          return;
        }
        
        if (!claims || claims.length === 0) {
          console.warn('CN Access Denied: No active claim');
          window.location.href = '/paywall/locked.html';
          return;
        }
        
        // Access granted - show page
        document.documentElement.style.visibility = 'visible';
        document.documentElement.style.opacity = '1';
        
      } catch (error) {
        console.error('CN Access Denied: Exception', error);
        window.location.href = '/app/access-denied.html';
      }
    })();
    */
  </script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --navy-primary: #0B2545;
      --navy-dark: #0B2545;
      --navy-light: #123A63;
      --teal-primary: #17BEBB;
      --teal-hover: #13a09d;
      --bg-page: #ffffff;
      --bg-white: #ffffff;
      --bg-light: #F7F9FC;
      --bg-card: #ffffff;
      --bg-card-hover: #F7F9FC;
      --border-light: #e5e7eb;
      --border-medium: #d1d5db;
      --border-dark: #9ca3af;
      --text-primary: #1f2937;
      --text-secondary: #4b5563;
      --text-muted: #6b7280;
      --text-white: #ffffff;
      --accent-blue: #3b82f6;
      --accent-green: #10b981;
      --accent-red: #ef4444;
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
      --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
    }

    /* Global Navigation Header */
    .global-header,
    header.global-header,
    body .global-header,
    body > .global-header,
    body header.global-header {
      background: linear-gradient(135deg, #0B2545 0%, #123A63 100%) !important;
      background-color: #0B2545 !important;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
      position: sticky !important;
      top: 0 !important;
      z-index: 1000 !important;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1) !important;
    }

    .global-nav {
      max-width: 1100px !important;
      margin: 0 auto !important;
      display: flex !important;
      align-items: center !important;
      justify-content: flex-start !important;
      padding: 0.5rem 0 0.5rem 20px !important;
      height: auto !important;
      background: transparent !important;
    }

    .nav-brand {
      font-size: 1.125rem !important;
      font-weight: 700 !important;
      color: #ffffff !important;
      text-decoration: none !important;
      margin-right: auto !important;
      padding-right: 40px !important;
      white-space: nowrap !important;
      order: -1 !important;
      flex-shrink: 0 !important;
    }

    .nav-menu {
      display: flex !important;
      align-items: center !important;
      gap: 1rem !important;
      list-style: none !important;
      margin: 0 !important;
      padding: 0 !important;
    }

    .nav-item {
      position: relative !important;
    }

    .nav-link {
      display: flex !important;
      align-items: center !important;
      padding: 10px 20px !important;
      color: #ffffff !important;
      text-decoration: none !important;
      font-size: 0.875rem !important;
      font-weight: 500 !important;
      transition: all 0.2s ease !important;
      border-bottom: 3px solid transparent !important;
      white-space: nowrap !important;
    }

    .nav-link:hover {
      background: rgba(255, 255, 255, 0.1) !important;
      color: #ffffff !important;
    }

    .nav-link.active {
      background: rgba(255, 255, 255, 0.15) !important;
      color: #ffffff !important;
      border-bottom-color: #ffffff !important;
      font-weight: 600 !important;
    }

    .nav-link-primary {
      color: #ffffff !important;
      font-weight: 500 !important;
    }

    .nav-dropdown {
      position: relative;
    }

    .dropdown-toggle::after {
      content: '▼';
      font-size: 10px;
      margin-left: 6px;
      opacity: 0.7;
      transition: transform 0.2s ease;
      display: inline-block;
    }

    .nav-dropdown.open .dropdown-toggle::after {
      transform: rotate(180deg);
    }

    .dropdown-menu {
      position: absolute;
      top: 100%;
      left: 0;
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 0 0 8px 8px;
      box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
      min-width: 200px;
      display: none;
      z-index: 1001;
    }

    /* Show dropdown when .open class is present */
    .nav-dropdown.open .dropdown-menu {
      display: block;
    }

    .dropdown-item {
      display: block;
      padding: 12px 20px;
      color: #1f2937;
      text-decoration: none;
      font-size: 0.875rem;
      transition: background 0.2s;
      border-bottom: 1px solid #e5e7eb;
    }

    .dropdown-item:last-child {
      border-bottom: none;
      border-radius: 0 0 8px 8px;
    }

    .dropdown-item:hover {
      background: #F7F9FC;
      color: #0B2545;
    }

    .nav-subtext {
      display: block;
      font-size: 11px;
      color: rgba(255, 255, 255, 0.6);
      font-weight: 400;
      margin-top: 2px;
    }

    /* Mobile Navigation */
    @media (max-width: 968px) {
      .global-nav {
        padding: 0.5rem 20px;
        height: auto;
        flex-direction: row;
        align-items: center;
      }

      .nav-brand {
        padding: 0;
      }

      .nav-menu {
        display: none;
      }

      .nav-item {
        width: auto;
        border-top: none;
      }

      .nav-link {
        width: auto;
        padding: 0;
        flex-direction: row;
        align-items: center;
        border-bottom: none;
      }

      .nav-link.active {
        border-bottom: none;
        border-left: none;
        padding-left: 0;
      }

      .nav-subtext {
        font-size: 0.75rem;
      }

      .dropdown-menu {
        position: absolute;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        border: 1px solid #e5e7eb;
        border-left: 1px solid #e5e7eb;
        border-radius: 0.5rem;
        margin-left: 0;
        background: #ffffff;
        display: none;
      }

      .nav-dropdown.open .dropdown-menu {
        display: block;
      }

      .dropdown-item {
        color: #1f2937;
        font-size: 0.875rem;
        padding: 10px 16px;
        border-bottom: 1px solid #e5e7eb;
      }

      .dropdown-item:hover {
        background: #F7F9FC;
        color: #0B2545;
      }
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: #F7F9FC;
      color: #1f2937;
      min-height: 100vh;
      line-height: 1.6;
      letter-spacing: 0.2px;
    }

    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 0;
    }

    /* Hero Header */
    .page-header {
      margin-bottom: 0;
      text-align: center;
      background: linear-gradient(135deg, #0B2545 0%, #123A63 100%);
      padding: 0.9375rem 0;
      border-radius: 0;
      box-shadow: none;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      width: 100vw;
      margin-left: calc(-50vw + 50%);
      margin-right: calc(-50vw + 50%);
    }

    .page-title {
      font-size: clamp(1.25rem, 2.5vw, 1.875rem);
      font-weight: 700;
      color: #ffffff;
      letter-spacing: -0.02em;
      margin-bottom: 0.5625rem;
      line-height: 1.3;
    }

    .page-subtitle {
      font-size: 1.1rem;
      color: rgba(255, 255, 255, 0.9);
      max-width: 900px;
      margin: 0 auto;
      font-weight: 400;
      line-height: 1.6;
      padding: 0 40px;
    }

    /* Quiet Progress Bar */
    .quiet-progress-bar {
      background: linear-gradient(135deg, #0B2545 0%, #123A63 100%);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      padding: 8px 0;
      width: 100vw;
      margin-left: calc(-50vw + 50%);
      margin-right: calc(-50vw + 50%);
    }

    .quiet-progress-container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 40px;
    }

    .quiet-progress-text {
      font-size: 0.75rem;
      color: #ffffff;
      font-weight: 500;
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .quiet-progress-track {
      height: 3px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 2px;
      overflow: hidden;
    }

    .quiet-progress-fill {
      height: 100%;
      background: #ffffff;
      transition: width 0.3s ease;
    }

    /* Upcoming Deadlines Section */
    .upcoming-deadlines-section {
      background: #ffffff;
      border: 1px solid #E5E7EB;
      border-radius: 6px;
      padding: 16px 24px;
      margin-bottom: 2rem;
    }

    .upcoming-deadlines-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 8px;
      text-transform: none;
      letter-spacing: 0;
    }

    .upcoming-deadlines-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .deadline-item {
      font-size: 0.875rem;
      color: #4b5563;
      line-height: 1.5;
    }

    .deadline-item strong {
      color: #1f2937;
      font-weight: 500;
    }

    /* Step Status Indicators */
    .step-status {
      display: inline-block;
      font-size: 0.6875rem;
      font-weight: 500;
      padding: 3px 8px;
      border-radius: 3px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-left: 12px;
    }

    .step-status.completed {
      background: #f3f4f6;
      color: #6b7280;
    }

    .step-status.in-progress {
      background: #f3f4f6;
      color: #0B2545;
    }

    .step-status.upcoming {
      background: #f3f4f6;
      color: #9ca3af;
    }
    
    @media (max-width: 768px) {
      .page-header {
        padding: 0.5625rem 0;
      }
      .page-title {
        font-size: 1.125rem;
        padding: 0 20px;
        margin-bottom: 0.375rem;
      }
      .page-subtitle {
        font-size: 1rem;
        padding: 0 20px;
      }
      
      .quiet-progress-container {
        padding: 0 20px;
      }
      
      .quiet-progress-text {
        font-size: 0.6875rem;
      }
      
      .upcoming-deadlines-section {
        padding: 12px 16px;
        margin-bottom: 1.5rem;
      }
      
      .upcoming-deadlines-title {
        font-size: 0.8125rem;
      }
      
      .deadline-item {
        font-size: 0.8125rem;
      }
      
      .step-status {
        font-size: 0.625rem;
        padding: 2px 6px;
        margin-left: 8px;
      }
    }

    /* Claim Information Panel */
    .claim-info-panel {
      background: linear-gradient(135deg, #0B2545 0%, #123A63 100%);
      border: none;
      border-radius: 0;
      padding: 0;
      margin-bottom: 0;
      box-shadow: none;
      width: 100vw;
      margin-left: calc(-50vw + 50%);
      margin-right: calc(-50vw + 50%);
    }

    .claim-info-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 40px;
      cursor: pointer;
      transition: background 0.2s ease;
      border-bottom: none;
    }

    .claim-info-header:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    .claim-info-title {
      font-size: 0.75rem;
      font-weight: 600;
      color: #ffffff;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .claim-info-summary {
      font-size: 0.75rem;
      color: rgba(255, 255, 255, 0.8);
      font-weight: 400;
      margin-left: 6px;
    }

    .panel-toggle-icon {
      font-size: 0.625rem;
      color: rgba(255, 255, 255, 0.8);
      transition: transform 0.2s ease;
      margin-left: 6px;
    }

    .claim-info-panel.expanded .panel-toggle-icon {
      transform: rotate(180deg);
    }

    .claim-info-content {
      display: none;
      padding: 8px 40px 12px 40px;
      background: #ffffff;
    }

    .claim-info-panel.expanded .claim-info-content {
      display: block;
    }

    .btn-edit {
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 0.625rem;
      font-weight: 600;
      color: #ffffff;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-edit:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.5);
      color: #ffffff;
    }

    .claim-info-header-right {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .claim-info-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 10px 16px;
      margin-bottom: 0;
    }

    .claim-info-details {
      display: flex;
      flex-wrap: wrap;
      gap: 10px 16px;
      margin-top: 8px;
      padding-top: 8px;
      border-top: none;
    }

    .claim-info-item {
      display: inline-flex;
      align-items: baseline;
      gap: 4px;
      white-space: nowrap;
    }

    .info-label {
      font-size: 0.6875rem;
      font-weight: 500;
      color: #6b7280;
      text-transform: none;
      letter-spacing: 0;
    }

    .info-label::after {
      content: ':';
    }

    .info-value {
      font-size: 0.75rem;
      font-weight: 600;
      color: #1f2937;
    }

    .info-value.urgent {
      color: #ef4444;
      font-weight: 700;
    }

    .info-value.status-active {
      color: #17BEBB;
    }

    .deadline-alert {
      background: #fef3c7;
      border: 1px solid #fbbf24;
      padding: 6px 10px;
      border-radius: 4px;
      font-size: 0.6875rem;
      color: #92400e;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 6px;
      margin-top: 8px;
    }

    .deadline-alert strong {
      font-weight: 700;
      color: #92400e;
    }

    /* Where Are You Section */
    .where-are-you-section {
      background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
      border: 2px solid #3b82f6;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
    }

    .section-heading {
      font-size: 18px;
      font-weight: 700;
      color: var(--navy-dark);
      text-align: center;
      margin-bottom: 6px;
    }

    .section-description {
      font-size: 13px;
      color: var(--text-secondary);
      text-align: center;
      margin-bottom: 12px;
    }

    .quick-jump-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 8px;
    }

    .quick-jump-btn {
      background: white;
      border: 1px solid var(--border-light);
      border-radius: 6px;
      padding: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: left;
    }

    .quick-jump-btn:hover {
      border-color: var(--navy-primary);
      box-shadow: var(--shadow-sm);
      transform: translateY(-1px);
    }

    .jump-icon {
      font-size: 20px;
      flex-shrink: 0;
    }

    .jump-text {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-primary);
      line-height: 1.3;
    }

    .content-area {
      max-width: 1100px;
      margin: 0 auto;
      padding: 3rem 20px;
    }
    
    @media (max-width: 768px) {
      .content-area {
        padding: 1.5rem 20px;
      }
    }

    /* Side Deadlines Block (replaces old progress indicator) */
    .progress-indicator {
      position: fixed;
      top: 80px;
      right: 24px;
      background: #ffffff;
      border: 1px solid #E5E7EB;
      border-radius: 6px;
      padding: 16px;
      max-width: 280px;
      z-index: 1000;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .progress-indicator .upcoming-deadlines-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 12px;
      text-transform: none;
      letter-spacing: 0;
    }

    .progress-indicator .upcoming-deadlines-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .progress-indicator .deadline-item {
      font-size: 0.8125rem;
      color: #4b5563;
      line-height: 1.5;
    }

    .progress-indicator .deadline-item strong {
      color: #1f2937;
      font-weight: 500;
    }

    /* Hide old progress elements */
    .progress-ring,
    .progress-text,
    .progress-percent,
    .progress-stage,
    .progress-readiness,
    .readiness-icon,
    .readiness-status {
      display: none;
    }
    
    @media (max-width: 768px) {
      .progress-indicator {
        display: none;
      }
    }

    /* Step Accordion - Clean Linear Blocks */
    .step-accordion {
      background: transparent;
      border-radius: 0;
    }

    .accordion-item {
      background: #ffffff;
      border: 1px solid #E5E7EB;
      border-radius: 8px;
      margin-top: 0;
      margin-bottom: 3rem;
      padding: 0;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25), 0 4px 12px rgba(0, 0, 0, 0.15);
      transition: box-shadow 0.2s ease;
      overflow: hidden;
    }
    
    .accordion-item:hover {
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3), 0 6px 16px rgba(0, 0, 0, 0.2);
      transform: none;
    }

    .accordion-item:first-child {
      margin-top: 0;
    }

    .accordion-item:last-child {
      margin-bottom: 0;
    }

    .accordion-item.active {
      background: #ffffff;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25), 0 4px 12px rgba(0, 0, 0, 0.15);
      border-color: #E5E7EB;
    }
    
    .accordion-item.active:hover {
      transform: none;
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3), 0 6px 16px rgba(0, 0, 0, 0.2);
    }
    
    .accordion-item.completed {
      background: #ffffff;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25), 0 4px 12px rgba(0, 0, 0, 0.15);
      opacity: 0.7;
    }
    
    .accordion-item.completed:hover {
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3), 0 6px 16px rgba(0, 0, 0, 0.2);
    }
    
    .accordion-item.step-complete-flash {
      animation: none;
    }
    
    @keyframes stepCompleteFlash {
      0%, 100% {
        background: #ffffff;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25), 0 4px 12px rgba(0, 0, 0, 0.15);
      }
      50% {
        background: #ffffff;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25), 0 4px 12px rgba(0, 0, 0, 0.15);
        transform: none;
      }
    }

    .accordion-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 24px 32px;
      cursor: pointer;
      transition: background 0.2s ease;
      background: transparent;
      border-radius: 0;
      border-bottom: 1px solid #e5e7eb;
    }

    .accordion-header:hover {
      background: rgba(255, 255, 255, 0.5);
    }

    .accordion-item.active .accordion-header {
      background: transparent;
      border-bottom-color: #e5e7eb;
    }

    .accordion-item.completed .accordion-header {
      background: transparent;
      border-bottom-color: #e5e7eb;
    }

    .accordion-left {
      display: flex;
      align-items: flex-start;
      gap: 16px;
      flex: 1;
    }

    .accordion-number-container {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 0;
      flex-shrink: 0;
      margin-right: 20px;
    }

    .accordion-step-label {
      font-size: 0.75rem;
      font-weight: 500;
      color: #6b7280;
      text-transform: none;
      letter-spacing: 0;
      margin-bottom: 4px;
    }

    .accordion-item.active .accordion-step-label {
      color: #6b7280;
    }

    .accordion-item.completed .accordion-step-label {
      color: #6b7280;
    }

    .accordion-number {
      width: auto;
      height: auto;
      border-radius: 0;
      background: transparent;
      border: none;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      font-weight: 600;
      font-size: 2rem;
      color: #0B2545;
      flex-shrink: 0;
      transition: none;
      box-shadow: none;
    }

    .accordion-item.active .accordion-number {
      background: transparent;
      border-color: transparent;
      color: #0B2545;
      box-shadow: none;
    }

    .accordion-item.completed .accordion-number {
      background: transparent;
      border-color: transparent;
      color: #0B2545;
      box-shadow: none;
    }

    .accordion-item.completed .accordion-number::after {
      content: '';
    }

    .accordion-title-area {
      flex: 1;
    }

    .accordion-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #1e40af;
      margin-bottom: 8px;
      margin-top: 0;
      line-height: 1.4;
      padding-bottom: 0;
      border-bottom: none;
      letter-spacing: 0;
    }
    
    .accordion-item.active .accordion-title {
      color: #1e40af !important;
      border-bottom-color: transparent;
    }
    
    .accordion-item.completed .accordion-title {
      color: #1e40af;
    }

    .accordion-subtitle {
      font-size: 0.9375rem;
      color: #6b7280;
      line-height: 1.6;
      margin-top: 0;
    }

    .accordion-item.active .accordion-subtitle {
      color: #6b7280 !important;
    }

    .accordion-toggle {
      font-size: 1rem;
      color: #9ca3af;
      transition: transform 0.2s ease;
      flex-shrink: 0;
    }

    .accordion-item.active .accordion-toggle {
      transform: rotate(180deg);
      color: #9ca3af !important;
    }

    .accordion-content {
      display: none;
      padding: 32px;
      background: #ffffff;
      margin: 0;
      margin-top: 0;
      border-radius: 0;
      border-top: none;
    }

    .accordion-item.active .accordion-content {
      display: block;
      background: #ffffff;
    }
    
    .accordion-item.completed .accordion-content {
      background: #ffffff;
    }
    
    @media (max-width: 768px) {
      .accordion-content {
        padding: 24px 20px;
      }
    }

    /* Accordion Content Sections */
    .accordion-content .step-warning {
      background: #fef9e7;
      border-left: 3px solid #f59e0b;
      padding: 10px 14px;
      border-radius: 6px;
      margin-bottom: 16px;
    }

    .accordion-content .step-warning strong {
      color: #92400e;
      font-weight: 700;
      display: block;
      margin-bottom: 4px;
    }

    .accordion-content .step-warning-text {
      font-size: 13px;
      color: #78350f;
    }

    .accordion-content .content-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-bottom: 16px;
    }

    @media (max-width: 968px) {
      .accordion-content .content-grid {
        grid-template-columns: 1fr;
      }
    }

    .accordion-content .section-block {
      background: white;
      border: 1px solid #e5e9ef;
      border-radius: 8px;
      padding: 16px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
      transition: all 0.2s ease;
    }
    
    .accordion-content .section-block:hover {
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
      transform: translateY(-1px);
    }

    .accordion-content .section-title {
      font-size: 14px;
      font-weight: 700;
      color: var(--navy-primary);
      margin-bottom: 12px;
    }

    .accordion-content .task-list {
      list-style: none;
      padding: 0;
    }

    .accordion-content .task-item {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 10px 12px;
      margin-bottom: 6px;
      background: white;
      border-radius: 6px;
      border: 1px solid #e5e9ef;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.03);
      transition: all 0.15s ease;
    }
    
    .accordion-content .task-item:hover {
      border-color: #cbd5e1;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      transform: translateX(2px);
    }

    .accordion-content .task-checkbox {
      width: 18px;
      height: 18px;
      border: 2px solid var(--border-dark);
      border-radius: 4px;
      flex-shrink: 0;
      margin-top: 2px;
      cursor: pointer;
      background: white;
    }

    .accordion-content .task-checkbox.checked {
      background: #10b981;
      border-color: #10b981;
      position: relative;
    }

    .accordion-content .task-checkbox.checked::after {
      content: '✓';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 11px;
      font-weight: bold;
    }

    .accordion-content .task-title {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .accordion-content .tool-grid {
      display: grid;
      gap: 8px;
    }

    .accordion-content .tool-card {
      background: white;
      border: 1px solid #e5e9ef;
      border-radius: 8px;
      padding: 12px 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.03);
    }

    .accordion-content .tool-card:hover {
      border-color: #3b82f6;
      box-shadow: 0 3px 10px rgba(59, 130, 246, 0.12);
      transform: translateY(-1px);
      background: linear-gradient(135deg, #ffffff 0%, #eff6ff 100%);
    }

    .accordion-content .tool-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .accordion-content .tool-name {
      font-size: 14px;
      font-weight: 600;
      color: var(--navy-dark);
    }

    .accordion-content .tool-arrow {
      color: var(--navy-primary);
      font-weight: bold;
    }

    .accordion-content .tool-desc {
      font-size: 12px;
      color: var(--text-secondary);
    }

    .accordion-content .tool-badge {
      display: inline-block;
      font-size: 9px;
      font-weight: 700;
      padding: 3px 6px;
      border-radius: 3px;
      margin-top: 6px;
      text-transform: uppercase;
    }

    .accordion-content .tool-badge.required {
      background: #fee2e2;
      color: #dc2626;
    }

    .accordion-content .tool-badge.recommended {
      background: #dbeafe;
      color: #2563eb;
    }

    .accordion-content .tool-badge.situational {
      background: #fef3c7;
      color: #d97706;
    }

    .accordion-content .step-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 20px;
      padding-top: 16px;
      border-top: 1px solid var(--border-light);
    }

    .accordion-content .btn {
      padding: 10px 20px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .accordion-content .btn-primary {
      background: var(--gold-accent);
      color: var(--navy-dark);
    }

    .accordion-content .btn-primary:hover {
      background: #c49b2e;
    }

    /* Next Step Preview - Minimal */
    .next-step-preview {
      margin-top: 32px;
      padding: 0;
      background: transparent;
      border: none;
      border-radius: 0;
      font-size: 0.75rem;
      color: #9ca3af;
      text-align: center;
    }

    .next-step-preview-label {
      font-weight: 500;
      text-transform: none;
      letter-spacing: 0;
      margin-bottom: 4px;
    }

    .next-step-preview-title {
      color: #6b7280;
      font-weight: 400;
      font-size: 0.875rem;
    }

    /* Claim Readiness Status Indicator */
    .readiness-indicator {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 4px;
      padding: 8px 12px;
      margin-top: 48px;
      margin-bottom: 8px;
      display: flex;
      justify-content: center;
      text-align: center;
    }

    /* Instruction Summary Block */
    .instruction-summary {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 24px 32px;
      margin-bottom: 32px;
      box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
    }

    .instruction-summary-title {
      font-size: 20px;
      font-weight: 700;
      color: #0f172a;
      margin: 0 0 24px 0;
      text-align: center;
    }

    .instruction-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 16px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .instruction-card {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      padding: 16px;
      display: flex;
      align-items: flex-start;
      gap: 12px;
      transition: all 0.2s ease;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    }

    .instruction-card:hover {
      border-color: #cbd5e1;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
      transform: translateY(-1px);
    }

    .instruction-card-number {
      flex-shrink: 0;
      width: 28px;
      height: 28px;
      background: #0a1628;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 13px;
    }

    .instruction-card-text {
      flex: 1;
      font-size: 14px;
      line-height: 1.5;
      color: #374151;
      padding-top: 4px;
    }

    /* Step-by-Step Claim Guide Section Title */
    .claim-steps-title {
      font-size: 1.8rem;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 1.25rem;
      margin-top: 0;
      text-align: center;
      letter-spacing: 0;
      max-width: 100%;
      margin-left: auto;
      margin-right: auto;
      white-space: nowrap;
      padding: 0 20px;
    }

    .claim-steps-subtitle {
      font-size: 1rem;
      font-weight: 400;
      color: #6b7280;
      margin: 0 0 2.25rem 0;
      text-align: center;
      letter-spacing: 0;
    }
    
    @media (max-width: 768px) {
      .claim-steps-title {
        font-size: 1.62rem;
        white-space: normal;
      }
      .claim-steps-subtitle {
        margin-bottom: 1.5rem;
      }
    }

    .step-critical-warning {
      background: #fef3c7;
      border-left: 3px solid #f59e0b;
      padding: 12px 16px;
      border-radius: 5px;
      margin-bottom: 24px;
      font-size: 0.875rem;
      color: #92400e;
      font-weight: 500;
    }

    /* What This Prevents */
    .what-prevents {
      background: #eff6ff;
      border-left: 4px solid #3b82f6;
      padding: 12px 16px;
      border-radius: 6px;
      margin-bottom: 16px;
      font-size: 13px;
      color: #1e40af;
    }

    .what-prevents strong {
      font-weight: 700;
      display: block;
      margin-bottom: 4px;
    }

    /* Guardrail Warning */
    .guardrail-warning {
      background: #fee2e2;
      border-left: 4px solid #dc2626;
      padding: 12px 16px;
      border-radius: 6px;
      margin-bottom: 16px;
      font-size: 13px;
      color: #991b1b;
    }

    .guardrail-warning strong {
      font-weight: 700;
      display: block;
      margin-bottom: 4px;
    }

    /* Step 1 Refactored - Minimized Informational Note */
    .step-info-note {
      font-size: 0.875rem;
      color: #6b7280;
      margin-top: 24px;
      margin-bottom: 0;
      line-height: 1.6;
      font-style: italic;
    }

    .step-info-note-icon {
      display: none;
    }

    /* Tasks Intro (for Steps 2+) */
    .tasks-intro {
      font-size: 14px;
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 16px;
      padding: 12px 16px;
      background: #eff6ff;
      border-left: 3px solid #3b82f6;
      border-radius: 4px;
    }

    /* Before You Continue (for Steps 2+) */
    .before-you-continue {
      background: #fef9e7;
      border: 2px solid #f59e0b;
      border-radius: 8px;
      padding: 16px 20px;
      margin-bottom: 20px;
    }

    .before-you-continue-title {
      font-size: 15px;
      font-weight: 700;
      color: #92400e;
      margin-bottom: 12px;
    }

    .before-you-continue-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .before-you-continue-item {
      font-size: 13px;
      color: #78350f;
      margin-bottom: 6px;
      padding-left: 0;
      line-height: 1.5;
    }

    .before-you-continue-item:last-child {
      margin-bottom: 0;
    }

    .before-you-continue-item strong {
      font-weight: 700;
      color: #92400e;
    }

    /* Step 1 - Primary Action Container */
    .primary-action-container {
      margin-bottom: 32px;
      padding: 0;
      background: transparent;
      border-radius: 0;
      border: none;
    }

    .primary-action-title {
      font-size: 1.125rem;
      font-weight: 600;
      color: #1f2937;
      margin: 0 0 12px 0;
    }

    .primary-action-description {
      font-size: 0.9375rem;
      color: #6b7280;
      line-height: 1.6;
      margin: 0 0 16px 0;
    }

    /* Step 1 - Report Sections Container */
    .report-sections-container {
      margin-bottom: 32px;
      padding: 0;
      background: transparent;
      border-radius: 0;
      border: none;
    }

    .report-sections-title {
      font-size: 1rem;
      font-weight: 600;
      color: #1f2937;
      margin: 0 0 8px 0;
    }

    .report-sections-description {
      font-size: 0.875rem;
      color: #6b7280;
      line-height: 1.6;
      margin: 0 0 16px 0;
    }

    .report-sections-list {
      margin-top: 16px;
      padding: 0;
      background: transparent;
      border-radius: 0;
      font-size: 0.875rem;
      color: #6b7280;
    }

    .report-sections-list strong {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #1f2937;
    }

    .report-sections-list ul {
      margin: 0;
      padding-left: 20px;
      list-style: disc;
    }

    .report-sections-list li {
      margin-bottom: 6px;
      line-height: 1.6;
    }

    .report-sections-list li:last-child {
      margin-bottom: 0;
    }

    /* TASKS - PRIMARY WORK SURFACE (HIGHEST VISUAL WEIGHT) */
    
    /* Section Anchor */
    .section-anchor-tasks {
      font-size: 0.875rem;
      font-weight: 600;
      color: #1f2937;
      text-transform: none;
      letter-spacing: 0;
      margin-bottom: 16px;
      margin-top: 0;
    }

    /* Task List Container - Full width, clear work surface */
    .task-list-sequential {
      list-style: none;
      padding: 0;
      margin: 0 0 32px 0;
      background: transparent;
      border: none;
      border-left: none;
      padding: 0;
      border-radius: 0;
      position: relative;
    }

    /* Vertical guide line */
    .task-list-sequential::before {
      display: none;
    }

    .task-item-sequential {
      margin-bottom: 24px;
      padding: 0;
      background: transparent;
      border: none;
      border-radius: 0;
      transition: none;
      box-shadow: none;
    }

    .task-item-sequential:last-child {
      margin-bottom: 0;
    }

    .task-item-sequential:hover {
      border-color: transparent;
      box-shadow: none;
      transform: none;
      background: transparent;
    }

    .task-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: auto;
      height: auto;
      background: transparent;
      color: #0B2545;
      border-radius: 0;
      font-weight: 500;
      font-size: 0.875rem;
      margin-right: 12px;
      flex-shrink: 0;
    }

    .task-header-sequential {
      display: flex;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .task-title-sequential {
      font-size: 1rem;
      font-weight: 600;
      color: #1f2937;
      flex: 1;
      line-height: 1.5;
    }

    .task-description-sequential {
      font-size: 0.9375rem;
      color: #6b7280;
      margin-left: 0;
      margin-top: 8px;
      line-height: 1.6;
    }

    /* TOOLS - CLICKABLE AND FUNCTIONAL */
    .task-tool-inline {
      margin: 12px 0 0 0;
      padding: 8px 12px;
      background: rgba(23, 190, 187, 0.05);
      border: 1px solid rgba(23, 190, 187, 0.2);
      border-radius: 6px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
    }

    .task-tool-inline:hover {
      background: rgba(23, 190, 187, 0.1);
      border-color: rgba(23, 190, 187, 0.4);
      transform: translateX(4px);
    }

    .task-tool-inline:hover .task-tool-title {
      color: #13a09d;
    }

    .task-tool-inline:hover .task-tool-arrow {
      color: #13a09d;
      transform: translateX(2px);
    }

    .task-tool-arrow {
      font-size: 1.75rem;
      color: #17BEBB;
      flex-shrink: 0;
      font-weight: 600;
      transition: transform 0.2s ease;
    }

    .task-tool-label {
      font-size: 1.75rem;
      font-weight: 400;
      color: #6b7280;
      text-transform: none;
      letter-spacing: 0;
      flex-shrink: 0;
    }

    .task-tool-title {
      font-size: 1.75rem;
      font-weight: 600;
      color: #17BEBB;
      flex: 1;
      text-transform: none;
    }

    .task-tool-classification {
      font-size: 1.5rem;
      font-weight: 400;
      padding: 2px 6px;
      border-radius: 3px;
      text-transform: none;
      letter-spacing: 0;
      opacity: 0.7;
      color: #6b7280;
    }

    .task-tool-classification.optional {
      background: transparent;
    }

    .task-tool-classification.required {
      background: transparent;
    }

    .task-tool-classification.situational {
      background: transparent;
    }

    /* Additional Tools - Minimal Visual Weight */
    
    .section-anchor-tools {
      font-size: 0.875rem;
      font-weight: 600;
      color: #1f2937;
      text-transform: none;
      letter-spacing: 0;
      margin-bottom: 12px;
      margin-top: 32px;
    }

    .additional-tools-section {
      margin-top: 12px;
      padding: 0;
      background: transparent;
      border: none;
    }

    .additional-tools-title {
      display: none;
    }

    .additional-tools-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .additional-tool-item {
      padding: 6px 10px;
      background: rgba(23, 190, 187, 0.03);
      border: 1px solid rgba(23, 190, 187, 0.15);
      border-radius: 4px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
    }

    .additional-tool-item:last-child {
      margin-bottom: 0;
    }

    .additional-tool-item:hover {
      background: rgba(23, 190, 187, 0.08);
      border-color: rgba(23, 190, 187, 0.3);
      transform: translateX(3px);
    }

    .additional-tool-item:hover .additional-tool-title {
      color: #13a09d;
    }

    .additional-tool-item:hover .additional-tool-arrow {
      color: #13a09d;
      transform: translateX(2px);
    }

    .additional-tool-arrow {
      font-size: 1.5rem;
      color: #17BEBB;
      font-weight: 600;
      transition: transform 0.2s ease;
    }

    .additional-tool-title {
      font-size: 1.75rem;
      font-weight: 400;
      color: #17BEBB;
      flex: 1;
    }

    /* Policy Flags - Coinsurance Warning */
    .coinsurance-warning {
      margin-top: 20px;
      padding: 16px 20px;
      background: #fef3c7;
      border: 2px solid #f59e0b;
      border-left: 4px solid #f59e0b;
      border-radius: 8px;
    }

    .coinsurance-title {
      font-size: 14px;
      font-weight: 700;
      color: #92400e;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .coinsurance-content {
      font-size: 13px;
      color: #78350f;
      line-height: 1.6;
    }

    .coinsurance-requirement {
      display: inline-block;
      background: #fed7aa;
      padding: 2px 6px;
      border-radius: 3px;
      font-weight: 600;
      margin: 0 2px;
    }

    /* Policyholder Duties Checklist */
    .policyholder-duties {
      margin-top: 20px;
      padding: 18px 20px;
      background: #eff6ff;
      border: 2px solid #3b82f6;
      border-left: 4px solid #3b82f6;
      border-radius: 8px;
    }

    .duties-title {
      font-size: 14px;
      font-weight: 700;
      color: #1e40af;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .duties-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .duty-item {
      padding: 10px 12px;
      background: white;
      border: 1px solid #bfdbfe;
      border-radius: 6px;
      margin-bottom: 8px;
      display: flex;
      align-items: flex-start;
      gap: 12px;
    }

    .duty-item:last-child {
      margin-bottom: 0;
    }

    .duty-icon {
      font-size: 16px;
      flex-shrink: 0;
      margin-top: 2px;
    }

    .duty-content {
      flex: 1;
    }

    .duty-text {
      font-size: 13px;
      font-weight: 600;
      color: #1e3a5f;
      margin-bottom: 4px;
    }

    .duty-meta {
      font-size: 11px;
      color: #64748b;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .duty-deadline {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .duty-link {
      color: #2563eb;
      text-decoration: none;
      cursor: pointer;
      font-weight: 600;
    }

    .duty-link:hover {
      text-decoration: underline;
    }

    /* Expert Guidance Block */
    .expert-guidance {
      margin-top: 20px;
      padding: 18px 20px;
      background: #f0fdf4;
      border: 2px solid #86efac;
      border-left: 4px solid #22c55e;
      border-radius: 8px;
    }

    .expert-guidance-title {
      font-size: 14px;
      font-weight: 700;
      color: #166534;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .expert-conditions {
      margin-bottom: 16px;
    }

    .expert-conditions ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .expert-conditions li {
      padding: 8px 12px;
      background: white;
      border: 1px solid #bbf7d0;
      border-radius: 6px;
      margin-bottom: 6px;
      font-size: 13px;
      color: #166534;
      line-height: 1.5;
      padding-left: 32px;
      position: relative;
    }

    .expert-conditions li:last-child {
      margin-bottom: 0;
    }

    .expert-conditions li:before {
      content: "→";
      position: absolute;
      left: 12px;
      color: #22c55e;
      font-weight: bold;
    }

    .expert-types {
      padding-top: 12px;
      border-top: 1px solid #bbf7d0;
    }

    .expert-types-title {
      font-size: 12px;
      font-weight: 700;
      color: #166534;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 10px;
    }

    .expert-type-list {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
    }

    .expert-type-item {
      padding: 8px 10px;
      background: white;
      border: 1px solid #bbf7d0;
      border-radius: 4px;
      font-size: 12px;
    }

    .expert-type-name {
      font-weight: 600;
      color: #166534;
      display: block;
      margin-bottom: 2px;
    }

    .expert-type-when {
      font-size: 11px;
      color: #4ade80;
      font-style: italic;
    }

    @media (max-width: 768px) {
      .expert-type-list {
        grid-template-columns: 1fr;
      }
    }

    /* Mitigation Guidance Block (Step 2) */
    .mitigation-guidance {
      margin-top: 20px;
      padding: 18px 20px;
      background: #fef2f2;
      border: 2px solid #fca5a5;
      border-left: 4px solid #ef4444;
      border-radius: 8px;
    }

    .mitigation-guidance-title {
      font-size: 14px;
      font-weight: 700;
      color: #991b1b;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .mitigation-explanation {
      font-size: 13px;
      color: #7f1d1d;
      line-height: 1.6;
      margin-bottom: 16px;
      padding: 10px 12px;
      background: #fee2e2;
      border-radius: 4px;
    }

    .mitigation-section {
      margin-bottom: 12px;
    }

    .mitigation-section:last-child {
      margin-bottom: 0;
    }

    .mitigation-section-title {
      font-size: 12px;
      font-weight: 700;
      color: #991b1b;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
    }

    .mitigation-section ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .mitigation-section li {
      padding: 8px 12px;
      background: white;
      border: 1px solid #fecaca;
      border-radius: 4px;
      margin-bottom: 6px;
      font-size: 13px;
      color: #7f1d1d;
      padding-left: 32px;
      position: relative;
    }

    .mitigation-section li:last-child {
      margin-bottom: 0;
    }

    .mitigation-section li:before {
      content: "!";
      position: absolute;
      left: 12px;
      width: 18px;
      height: 18px;
      background: #ef4444;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 12px;
    }

    .mitigation-reimbursement {
      margin-top: 12px;
      padding: 10px 12px;
      background: #dcfce7;
      border: 1px solid #86efac;
      border-radius: 4px;
      font-size: 12px;
      color: #166534;
      font-weight: 600;
    }

    /* Mitigation Capture Block (Step 3) */
    .mitigation-capture {
      margin-top: 20px;
      padding: 18px 20px;
      background: #eff6ff;
      border: 2px solid #93c5fd;
      border-left: 4px solid #3b82f6;
      border-radius: 8px;
    }

    .mitigation-capture-title {
      font-size: 14px;
      font-weight: 700;
      color: #1e40af;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .mitigation-instructions {
      font-size: 13px;
      color: #1e3a8a;
      line-height: 1.6;
      margin-bottom: 12px;
    }

    .mitigation-upload-types {
      display: grid;
      gap: 8px;
    }

    .mitigation-upload-item {
      padding: 10px 12px;
      background: white;
      border: 1px solid #bfdbfe;
      border-radius: 6px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .mitigation-upload-type {
      font-size: 13px;
      font-weight: 600;
      color: #1e40af;
    }

    .mitigation-upload-desc {
      font-size: 12px;
      color: #64748b;
    }

    .mitigation-flow-note {
      margin-top: 12px;
      padding: 10px 12px;
      background: #dcfce7;
      border: 1px solid #86efac;
      border-radius: 4px;
      font-size: 12px;
      color: #166534;
      font-weight: 600;
    }

    /* Post-Claim Asset Section */
    .post-claim-section {
      background: #f9fafb;
      color: #0f172a;
      padding: 32px;
      border-radius: 12px;
      margin-top: 32px;
      border: 1px solid #e5e7eb;
    }

    .post-claim-section h3 {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 12px;
      color: #0f172a;
    }

    .post-claim-section p {
      font-size: 14px;
      line-height: 1.6;
      margin-bottom: 20px;
      color: #4b5563;
    }

    .post-claim-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .btn-post-claim {
      padding: 12px 24px;
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }

    .btn-post-claim:hover {
      background: #2563eb;
      transform: translateY(-1px);
    }

    .btn-post-claim.secondary {
      background: white;
      color: #1f2937;
      border: 1px solid #d1d5db;
    }

    .btn-post-claim.secondary:hover {
      background: #f3f4f6;
      border-color: #9ca3af;
    }

    /* Critical Claim Deadlines Section */
    /* Critical Claim Deadlines */
    .critical-deadlines {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 4px;
      padding: 8px 10px;
      margin-bottom: 8px;
    }

    .critical-deadlines-header {
      margin-bottom: 4px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .critical-deadlines-title {
      font-size: 17px;
      font-weight: 600;
      color: #0f172a;
      margin-bottom: 1px;
    }

    .critical-deadlines-subtext {
      font-size: 11px;
      color: #6b7280;
      margin-bottom: 8px;
    }

    .critical-deadlines-toggle {
      font-size: 10px;
      color: #6b7280;
      transition: transform 0.2s;
    }

    .critical-deadlines.expanded .critical-deadlines-toggle {
      transform: rotate(180deg);
    }

    .deadline-list {
      display: none;
    }

    .critical-deadlines.expanded .deadline-list {
      display: block;
      padding-top: 8px;
    }

    /* Active Step Section */
    .active-step-section {
      background: var(--bg-white);
      border: 1px solid var(--border-light);
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 16px;
      box-shadow: var(--shadow-sm);
    }

    .active-step-header {
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 2px solid var(--border-light);
    }

    .active-step-label {
      display: inline-block;
      background: var(--navy-primary);
      color: white;
      font-size: 10px;
      font-weight: 700;
      padding: 4px 10px;
      border-radius: 4px;
      margin-bottom: 8px;
      letter-spacing: 0.5px;
    }

    .active-step-title {
      font-size: 22px;
      font-weight: 700;
      color: var(--navy-dark);
      margin-bottom: 6px;
      line-height: 1.2;
    }

    .active-step-subtitle {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    .step-content-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-bottom: 16px;
    }

    @media (max-width: 968px) {
      .step-content-grid {
        grid-template-columns: 1fr;
      }
    }

    .content-section {
      background: var(--bg-cream);
      border: 1px solid var(--border-light);
      border-radius: 8px;
      padding: 16px;
    }

    .section-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--border-light);
    }

    .section-icon {
      font-size: 20px;
    }

    .section-title {
      font-size: 16px;
      font-weight: 700;
      color: var(--navy-primary);
    }

    .task-list {
      list-style: none;
    }

    .task-item {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 16px;
      margin-bottom: 12px;
      background: var(--bg-white);
      border-radius: 8px;
      border: 1px solid var(--border-light);
      transition: all 0.2s ease;
    }

    .task-item:hover {
      border-color: var(--border-medium);
      box-shadow: var(--shadow-sm);
    }

    .task-checkbox {
      width: 22px;
      height: 22px;
      border: 2px solid var(--border-dark);
      border-radius: 5px;
      flex-shrink: 0;
      margin-top: 2px;
      cursor: pointer;
      transition: all 0.2s ease;
      background: var(--bg-white);
    }

    .task-checkbox:hover {
      border-color: var(--navy-primary);
    }

    .task-checkbox.checked {
      background: #10b981;
      border-color: #10b981;
      position: relative;
    }

    .task-checkbox.checked::after {
      content: '✓';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 14px;
      font-weight: bold;
    }

    .task-item-sequential:has(.task-checkbox.checked) .task-title-sequential,
    .task-item-sequential:has(.task-checkbox.checked) .task-description-sequential {
      opacity: 0.6;
    }

    .task-content {
      flex: 1;
    }

    .task-title {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: 4px;
    }

    .task-description {
      font-size: 13px;
      color: var(--text-muted);
    }

    .tool-grid {
      display: grid;
      gap: 12px;
    }

    .tool-card {
      background: var(--bg-white);
      border: 1px solid var(--border-light);
      border-radius: 8px;
      padding: 18px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .tool-card:hover {
      border-color: var(--navy-primary);
      box-shadow: var(--shadow-md);
      transform: translateX(4px);
    }

    .tool-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .tool-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--navy-dark);
    }

    .tool-arrow {
      color: var(--navy-primary);
      font-size: 20px;
      font-weight: bold;
    }

    .tool-description {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    .tool-classification {
      display: inline-block;
      font-size: 11px;
      font-weight: 700;
      padding: 4px 8px;
      border-radius: 4px;
      margin-top: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .tool-classification.required {
      background: #fee2e2;
      color: #dc2626;
    }

    .tool-classification.recommended {
      background: #dbeafe;
      color: #2563eb;
    }

    .tool-classification.situational {
      background: #fef3c7;
      color: #d97706;
    }

    .step-warning {
      background: #fef9e7;
      border-left: 4px solid #f59e0b;
      padding: 16px 20px;
      margin-bottom: 24px;
      border-radius: 6px;
    }

    .step-warning strong {
      color: #92400e;
      font-weight: 700;
    }

    .step-warning-text {
      font-size: 14px;
      color: #78350f;
      margin-top: 4px;
    }

    .document-list {
      list-style: none;
    }

    .document-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px;
      margin-bottom: 10px;
      background: var(--bg-white);
      border-radius: 8px;
      border: 1px solid var(--border-light);
      flex-wrap: wrap;
    }

    .document-icon {
      font-size: 22px;
      flex-shrink: 0;
    }

    .document-name {
      flex: 1;
      min-width: 200px;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-primary);
    }

    .document-status {
      font-size: 12px;
      padding: 5px 10px;
      border-radius: 5px;
      font-weight: 600;
    }

    .document-status.required {
      background: #fee2e2;
      color: #dc2626;
    }

    .document-status.optional {
      background: #fef3c7;
      color: #d97706;
    }

    .btn-example {
      background: var(--bg-cream);
      border: 1px solid var(--border-medium);
      padding: 6px 12px;
      border-radius: 5px;
      font-size: 12px;
      font-weight: 600;
      color: var(--navy-primary);
      cursor: pointer;
      transition: all 0.2s ease;
      margin-right: 8px;
    }

    .btn-example:hover {
      background: var(--navy-primary);
      color: white;
    }

    /* Common Problems Section */
    .common-problems-section {
      background: #fef9e7;
      border: 2px solid #f59e0b;
      border-radius: 12px;
      margin-top: 32px;
      overflow: hidden;
    }

    .problems-header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 20px 24px;
      cursor: pointer;
      background: #fef3c7;
      transition: all 0.2s ease;
    }

    .problems-header:hover {
      background: #fde68a;
    }

    .problems-icon {
      font-size: 24px;
    }

    .problems-title {
      flex: 1;
      font-size: 18px;
      font-weight: 700;
      color: #92400e;
    }

    .problems-toggle {
      font-size: 18px;
      color: #92400e;
      transition: transform 0.3s ease;
    }

    .problems-header.open .problems-toggle {
      transform: rotate(180deg);
    }

    .problems-content {
      padding: 24px;
    }

    .problem-item {
      margin-bottom: 24px;
      padding-bottom: 24px;
      border-bottom: 1px solid #fde68a;
    }

    .problem-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }

    .problem-question {
      font-size: 16px;
      font-weight: 700;
      color: var(--navy-dark);
      margin-bottom: 12px;
    }

    .problem-answer {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.6;
    }

    .problem-answer ul {
      margin-top: 8px;
      padding-left: 24px;
      list-style: disc;
    }

    .problem-answer li {
      margin-bottom: 6px;
    }

    /* Step Actions */
    .step-actions {
      display: flex;
      justify-content: flex-start;
      align-items: center;
      padding-top: 32px;
      border-top: 1px solid #e5e7eb;
      margin-bottom: 0;
      margin-top: 32px;
    }

    .action-right-group {
      display: flex;
      gap: 12px;
    }

    .action-note {
      text-align: center;
      font-size: 14px;
      color: var(--text-secondary);
      padding: 12px;
      background: var(--bg-cream);
      border-radius: 8px;
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border-radius: 5px;
      font-size: 0.9rem;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: background 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
    }

    .btn-primary {
      background: #17BEBB;
      color: #ffffff;
      font-weight: 600;
    }

    .btn-primary:hover {
      background: #13a09d;
      box-shadow: none;
      transform: none;
    }

    .btn-secondary {
      background: transparent;
      color: #4b5563;
      border: 1px solid #d1d5db;
    }

    .btn-secondary:hover {
      background: #F7F9FC;
      color: #1f2937;
      border-color: #9ca3af;
    }

    .btn-save {
      background: var(--bg-white);
      color: var(--accent-blue);
      border: 2px solid var(--accent-blue);
      font-weight: 600;
    }

    .btn-save:hover {
      background: var(--accent-blue);
      color: white;
    }

    .btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    /* Visual Roadmap */
    .visual-roadmap {
      background: linear-gradient(135deg, var(--navy-primary) 0%, var(--navy-dark) 100%);
      border-radius: 8px;
      padding: 20px 32px;
      margin-top: 16px;
      box-shadow: none;
    }

    .roadmap-header {
      text-align: center;
      margin-bottom: 20px;
    }

    .roadmap-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-white);
      margin-bottom: 4px;
    }

    .roadmap-subtitle {
      font-size: 13px;
      color: rgba(255, 255, 255, 0.8);
    }

    .roadmap-track {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      position: relative;
      padding: 0 20px;
    }

    .roadmap-line {
      position: absolute;
      top: 20px;
      left: 60px;
      right: 60px;
      height: 3px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 2px;
    }

    .roadmap-line-progress {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      background: var(--gold-accent);
      transition: width 0.6s ease-out;
      border-radius: 2px;
      box-shadow: 0 0 12px rgba(212, 175, 55, 0.6);
    }

    .roadmap-node {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 1;
      max-width: 120px;
    }

    .roadmap-circle {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: var(--navy-dark);
      border: 3px solid rgba(255, 255, 255, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 16px;
      transition: all 0.3s ease;
      font-weight: 700;
      font-size: 16px;
      color: rgba(255, 255, 255, 0.5);
    }

    .roadmap-node.completed .roadmap-circle {
      border-color: var(--accent-green);
      background: var(--accent-green);
    }

    .roadmap-node.completed .roadmap-circle::after {
      content: '✓';
      color: white;
      font-size: 18px;
    }

    .roadmap-node.active .roadmap-circle {
      background: var(--gold-accent);
      border-color: var(--gold-accent);
      color: var(--navy-dark);
      box-shadow: 0 0 24px rgba(212, 175, 55, 0.6);
      font-weight: 800;
    }

    .roadmap-label {
      font-size: 13px;
      font-weight: 600;
      text-align: center;
      line-height: 1.3;
      color: rgba(255, 255, 255, 0.9);
    }

    .roadmap-node.completed .roadmap-label {
      color: rgba(255, 255, 255, 0.6);
    }

    .roadmap-node.active .roadmap-label {
      color: white;
      font-weight: 700;
    }

    .roadmap-node.pending .roadmap-label {
      color: rgba(255, 255, 255, 0.4);
    }

    .roadmap-microcopy {
      font-size: 11px;
      color: rgba(255, 255, 255, 0.6);
      margin-top: 4px;
      text-align: center;
    }

    .roadmap-node.pending .roadmap-microcopy {
      display: none;
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      .container {
        padding: 20px 16px;
      }

      .page-header {
        padding: 12px 24px;
        border-radius: 0;
      }

      .page-title {
        font-size: 28px;
      }

      .page-subtitle {
        font-size: 16px;
      }

      .progress-indicator {
        top: 12px;
        right: 12px;
        padding: 8px 12px;
      }

      .claim-info-panel {
        padding: 0;
      }

      .claim-info-header {
        padding: 6px 20px;
      }

      .claim-info-content {
        padding: 6px 20px 8px 20px;
      }

      .claim-info-title {
        font-size: 0.625rem;
        flex-direction: column;
        align-items: flex-start;
        gap: 3px;
      }

      .claim-info-summary {
        font-size: 0.625rem;
        margin-left: 0;
      }

      .claim-info-grid {
        grid-template-columns: 1fr 1fr;
        gap: 8px;
      }

      .claim-info-details {
        grid-template-columns: 1fr;
        gap: 8px;
      }

      .quick-jump-grid {
        grid-template-columns: 1fr;
      }

      .step-list {
        grid-template-columns: 1fr;
      }

      .step-content-grid {
        grid-template-columns: 1fr;
      }

      .active-step-section {
        padding: 24px;
      }

      .active-step-title {
        font-size: 24px;
      }

      .step-actions {
        flex-direction: column;
        gap: 12px;
        align-items: stretch;
      }

      .action-right-group {
        flex-direction: column;
        width: 100%;
      }

      .btn {
        width: 100%;
        justify-content: center;
      }

      .roadmap-track {
        flex-wrap: wrap;
        justify-content: center;
        gap: 20px;
        padding: 0 20px;
      }

      .roadmap-line {
        display: none;
      }

      .roadmap-node {
        max-width: 100px;
      }

      .document-item {
        flex-direction: column;
        align-items: flex-start;
      }

      .document-name {
        width: 100%;
      }

      .btn-example {
        align-self: flex-start;
      }
    }

    /* ===== STEP 1 ENHANCED STYLES ===== */
    
    /* Value Statement - Bottom (subtle, small) */
    .value-statement-bottom {
      background: transparent;
      border: none;
      padding: 16px 0;
      margin-top: 24px;
      margin-bottom: 24px;
      font-size: 12px;
      line-height: 1.5;
      color: #9ca3af;
      text-align: left;
    }

    .value-statement-bottom strong {
      color: #6b7280;
      display: inline;
      margin-right: 4px;
      font-size: 12px;
      font-weight: 600;
    }

    /* Process Phases */
    .process-phases {
      display: grid;
      gap: 24px;
      margin-bottom: 32px;
    }

    .phase-card {
      background: white;
      border: 2px solid var(--border-light);
      border-radius: 12px;
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .phase-card:hover {
      box-shadow: var(--shadow-md);
      border-color: var(--navy-primary);
    }

    .phase-header {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 20px;
      background: linear-gradient(135deg, var(--navy-primary) 0%, var(--navy-dark) 100%);
      color: white;
    }

    .phase-number {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: #e5e7eb;
      color: var(--navy-dark);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      font-weight: 700;
      flex-shrink: 0;
    }

    .phase-header h4 {
      font-size: 18px;
      font-weight: 700;
      margin: 0 0 4px 0;
    }

    .phase-header p {
      font-size: 14px;
      opacity: 0.9;
      margin: 0;
    }

    .phase-content {
      padding: 24px;
    }

    .phase-intro {
      font-size: 15px;
      color: var(--text-secondary);
      margin-bottom: 20px;
      font-weight: 500;
    }

    /* Upload Checklist */
    .upload-checklist {
      background: var(--bg-light);
      border: 1px solid var(--border-light);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 20px;
    }

    .checklist-item {
      padding: 10px;
      font-size: 14px;
      color: var(--text-primary);
      font-weight: 500;
    }

    /* Report Highlights */
    .report-highlights {
      display: grid;
      gap: 16px;
      margin-bottom: 24px;
    }

    .highlight-item {
      display: flex;
      align-items: flex-start;
      gap: 16px;
      padding: 16px;
      background: var(--bg-light);
      border: 1px solid var(--border-light);
      border-radius: 8px;
      transition: all 0.2s ease;
    }

    .highlight-item:hover {
      border-color: var(--navy-primary);
      box-shadow: var(--shadow-sm);
    }

    .highlight-icon {
      font-size: 28px;
      flex-shrink: 0;
    }

    .highlight-item > div {
      flex: 1;
    }

    .highlight-item strong {
      display: block;
      font-size: 15px;
      font-weight: 600;
      color: var(--navy-dark);
      margin-bottom: 4px;
    }

    .highlight-item span {
      display: block;
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    /* Phase Action Button */
    .btn-phase-action {
      width: 100%;
      padding: 16px 24px;
      background: #e5e7eb;
      color: var(--navy-dark);
      border: none;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-phase-action:hover:not(:disabled) {
      background: #d1d5db;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .btn-phase-action:disabled,
    .btn-phase-action.btn-disabled {
      background: #e5e7eb;
      color: #9ca3af;
      cursor: not-allowed;
      transform: none;
    }

    /* Phase Tip */
    .phase-tip {
      margin-top: 16px;
      padding: 12px 16px;
      background: #eff6ff;
      border-left: 3px solid #3b82f6;
      border-radius: 6px;
      font-size: 13px;
      color: #1e40af;
    }

    .phase-tip strong {
      font-weight: 600;
      color: #1e3a8a;
    }

    /* Prevents Box */
    .prevents-box {
      background: #f9fafb;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 32px;
    }

    .prevents-box strong {
      display: block;
      font-size: 16px;
      font-weight: 700;
      color: #4b5563;
      margin-bottom: 12px;
    }

    .prevents-box ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .prevents-box li {
      padding: 8px 0 8px 28px;
      position: relative;
      font-size: 14px;
      color: #6b7280;
      line-height: 1.5;
    }

    .prevents-box li:before {
      content: "✓";
      position: absolute;
      left: 0;
      color: #9ca3af;
      font-weight: bold;
      font-size: 16px;
    }

    /* Step Completion */
    .step-completion {
      background: white;
      border: 2px solid var(--border-medium);
      border-radius: 12px;
      padding: 24px;
      margin-top: 32px;
    }

    .completion-checklist {
      margin-bottom: 20px;
    }

    .completion-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      margin-bottom: 8px;
      background: var(--bg-light);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .completion-item:hover {
      background: #f0f4f8;
    }

    .completion-checkbox {
      width: 24px;
      height: 24px;
      border: 2px solid var(--border-dark);
      border-radius: 6px;
      flex-shrink: 0;
      transition: all 0.2s ease;
      background: white;
    }

    .completion-item.checked .completion-checkbox {
      background: var(--accent-green);
      border-color: var(--accent-green);
      position: relative;
    }

    .completion-item.checked .completion-checkbox::after {
      content: '✓';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 14px;
      font-weight: bold;
    }

    .completion-item span:last-child {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-primary);
    }

    .btn-complete-step {
      width: 100%;
      padding: 16px 24px;
      background: var(--navy-primary);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-complete-step:hover {
      background: var(--navy-dark);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(30, 58, 95, 0.3);
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }

    /* ===== STEP 2 COMPONENTS - UNIFIED COLOR SCHEME ===== */
    
    /* Action Steps */
    .action-steps {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-bottom: 24px;
    }

    /* Action Buttons Grid */
    .action-buttons-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 20px;
    }

    @media (max-width: 768px) {
      .action-buttons-grid {
        grid-template-columns: 1fr;
      }
    }

    .action-step {
      display: flex;
      align-items: flex-start;
      gap: 16px;
      padding: 16px;
      background: var(--bg-cream);
      border: 1px solid var(--border-light);
      border-radius: 8px;
    }

    .step-icon {
      font-size: 28px;
      flex-shrink: 0;
    }

    .action-step strong {
      display: block;
      font-size: 15px;
      font-weight: 600;
      color: var(--navy-dark);
      margin-bottom: 6px;
    }

    .action-step p {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.5;
      margin: 0;
    }

    /* Script Box */
    .script-box {
      background: white;
      border: 2px solid var(--border-medium);
      border-radius: 8px;
      padding: 16px;
      margin-top: 8px;
      font-size: 14px;
      font-family: 'Courier New', monospace;
      color: var(--text-primary);
      line-height: 1.6;
      font-style: italic;
    }

    /* Info Box - UNIFIED STYLE */
    .info-box {
      background: var(--bg-cream);
      border-left: 3px solid var(--navy-primary);
      padding: 16px;
      border-radius: 6px;
      margin-bottom: 16px;
    }

    .info-box strong {
      display: block;
      font-size: 14px;
      font-weight: 700;
      color: var(--navy-dark);
      margin-bottom: 8px;
    }

    .info-box ul,
    .info-box ol {
      margin: 8px 0 0 0;
      padding-left: 20px;
    }

    .info-box li {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.6;
      margin-bottom: 6px;
      padding-left: 0;
    }

    .info-box li:before {
      content: none;
    }

    .info-box span {
      font-weight: 600;
      color: var(--navy-primary);
    }

    /* Duties Grid */
    .duties-grid {
      display: grid;
      gap: 20px;
      margin-top: 20px;
    }

    .duty-card {
      background: white;
      border: 2px solid var(--border-light);
      border-radius: 12px;
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .duty-card:hover {
      border-color: var(--navy-primary);
      box-shadow: var(--shadow-md);
    }

    .duty-header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
      background: var(--bg-cream);
      border-bottom: 1px solid var(--border-light);
    }

    .duty-icon {
      font-size: 28px;
      flex-shrink: 0;
    }

    .duty-header strong {
      display: block;
      font-size: 15px;
      font-weight: 700;
      color: var(--navy-dark);
      margin-bottom: 4px;
    }

    .duty-deadline {
      display: block;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .duty-content {
      padding: 20px;
    }

    .duty-description {
      font-size: 14px;
      color: var(--text-primary);
      line-height: 1.6;
      margin-bottom: 16px;
    }

    .btn-duty-tool {
      width: 100%;
      padding: 12px 20px;
      background: #e5e7eb;
      border: none;
      color: var(--navy-dark);
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-duty-tool:hover {
      background: #d1d5db;
      transform: translateY(-1px);
    }

    /* Written Notice Benefits */
    .written-notice-benefits {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-bottom: 24px;
    }

    .notice-benefit {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 16px;
      background: var(--bg-cream);
      border: 1px solid var(--border-light);
      border-radius: 8px;
    }

    .benefit-icon {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: var(--navy-primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 16px;
      flex-shrink: 0;
    }

    .notice-benefit strong {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: var(--navy-dark);
      margin-bottom: 4px;
    }

    .notice-benefit p {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.5;
      margin: 0;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .duty-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      
      .duty-icon {
        font-size: 24px;
      }
    }

    /* Step 3 Components */

    /* Photo Guidance */
    .photo-guidance,
    .inventory-guidance {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin-bottom: 24px;
    }

    .guidance-section {
      background: var(--bg-cream);
      border: 1px solid var(--border-light);
      padding: 16px;
      border-radius: 8px;
    }

    .guidance-section strong {
      display: block;
      font-size: 15px;
      font-weight: 700;
      color: var(--navy-dark);
      margin-bottom: 10px;
    }

    .guidance-section p {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.6;
      margin: 0;
    }

    .guidance-section ul {
      list-style: none;
      padding: 0;
      margin: 8px 0 0 0;
    }

    .guidance-section li {
      padding: 6px 0 6px 20px;
      position: relative;
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.6;
    }

    .guidance-section li:before {
      content: "→";
      position: absolute;
      left: 0;
      color: var(--navy-primary);
      font-weight: bold;
    }

    .guidance-section li strong {
      display: inline;
      font-size: 14px;
      color: var(--navy-dark);
      margin: 0;
    }

    /* Example Comparison */
    .example-comparison {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-top: 16px;
    }

    @media (max-width: 768px) {
      .example-comparison {
        grid-template-columns: 1fr;
      }
    }

    .bad-example,
    .good-example {
      padding: 16px;
      border-radius: 8px;
      border: 2px solid;
    }

    .bad-example {
      background: #fef2f2;
      border-color: #fca5a5;
    }

    .bad-example strong {
      color: #dc2626;
      font-size: 14px;
      display: block;
      margin-bottom: 8px;
    }

    .bad-example p {
      color: #991b1b;
      font-size: 13px;
      margin: 0;
      font-family: 'Courier New', monospace;
    }

    .good-example {
      background: #f0fdf4;
      border-color: #86efac;
    }

    .good-example strong {
      color: #166534;
      font-size: 14px;
      display: block;
      margin-bottom: 8px;
    }

    .good-example p {
      color: #166534;
      font-size: 13px;
      margin: 0;
      line-height: 1.6;
    }

    /* Proof Types */
    .proof-types {
      display: grid;
      gap: 16px;
      margin-bottom: 24px;
    }

    .proof-category {
      display: flex;
      align-items: flex-start;
      gap: 16px;
      padding: 16px;
      background: var(--bg-cream);
      border: 1px solid var(--border-light);
      border-radius: 8px;
    }

    .category-icon {
      font-size: 32px;
      flex-shrink: 0;
    }

    .proof-category strong {
      display: block;
      font-size: 15px;
      font-weight: 700;
      color: var(--navy-dark);
      margin-bottom: 6px;
    }

    .proof-category p {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.5;
      margin: 0;
    }

    /* Step Completion Heading */
    .step-completion h3 {
      font-size: 16px;
      font-weight: 700;
      color: var(--navy-dark);
      margin-bottom: 16px;
    }
  </style>
</head>
<body>
  <!-- Global Navigation Header -->
  <header class="global-header">
    <nav class="global-nav">
      <a href="/" class="nav-brand">Claim Navigator</a>
      
      <ul class="nav-menu">
        <li class="nav-item">
          <a href="app/claim-summary.html" class="nav-link">Claim Summary</a>
        </li>
        
        <li class="nav-item">
          <a href="/claim-guide" class="nav-link nav-link-primary active">Steps / Guide</a>
        </li>
        
        <li class="nav-item nav-dropdown" id="uploadDropdown">
          <a href="#" class="nav-link dropdown-toggle" onclick="toggleDropdown(event); return false;">Upload Documents</a>
          <div class="dropdown-menu">
            <a href="app/tools/policy-uploader.html" class="dropdown-item">Policy Documents</a>
            <a href="app/tools/photo-upload-organizer.html" class="dropdown-item">Photos & Videos</a>
            <a href="app/tools/expense-upload-tool.html" class="dropdown-item">Receipts & Expenses</a>
          </div>
        </li>
        
        <li class="nav-item">
          <a href="app/claim-journal.html" class="nav-link">Claim Journal</a>
        </li>
        
        <li class="nav-item">
          <a href="app/claim-financial-summary.html" class="nav-link">Financial Summary</a>
        </li>
        
        <li class="nav-item">
          <a href="app/claim-deadlines.html" class="nav-link">Claim Deadlines</a>
        </li>
        
        <li class="nav-item">
          <a href="app/claim-correspondence.html" class="nav-link">
            Messages
            <span class="nav-subtext">Claim Correspondence</span>
          </a>
        </li>
        
        <li class="nav-item">
          <a href="app/resources.html" class="nav-link">Resources</a>
        </li>
      </ul>
    </nav>
  </header>

  <div class="container">
    <!-- Side Deadlines Block -->
    <div class="progress-indicator">
      <div class="upcoming-deadlines-title">Deadlines</div>
      <div class="upcoming-deadlines-list">
        <div class="deadline-item"><strong>Notice of Loss</strong> — January 8, 2025</div>
        <div class="deadline-item"><strong>Proof of Loss</strong> — January 14, 2025</div>
      </div>
    </div>

    <!-- Page Header -->
    <header class="page-header">
      <h1 class="page-title">Claim Management Center</h1>
      <p class="page-subtitle">Step-by-step claim management with AI-powered analysis</p>
      <p style="font-size: 0.75rem; color: #6b7280; margin-top: 0.75rem; max-width: 800px; margin-left: auto; margin-right: auto;">This tool provides guidance and documentation support based on the information you provide. It does not replace professional legal or adjusting advice.</p>
    </header>

    <!-- Quiet Progress Bar -->
    <div class="quiet-progress-bar">
      <div class="quiet-progress-container">
        <div class="quiet-progress-text" id="quietProgressText">Step 1 of 14</div>
        <div class="quiet-progress-track">
          <div class="quiet-progress-fill" id="quietProgressFill" style="width: 7%;"></div>
        </div>
      </div>
    </div>

    <!-- Claim Information Panel -->
    <section class="claim-info-panel" id="claimInfoPanel">
      <div class="claim-info-header" onclick="toggleClaimInfoPanel()">
        <div>
          <h2 class="claim-info-title">
            Your Claim Information
            <span class="claim-info-summary">CLM-2024-089456 • State Farm</span>
            <span class="panel-toggle-icon">▼</span>
          </h2>
        </div>
        <div class="claim-info-header-right">
          <button class="btn-edit" onclick="editClaimInfo(); event.stopPropagation();">✏️ Edit</button>
        </div>
      </div>
      <div class="claim-info-content">
        <div class="claim-info-grid">
          <div class="claim-info-item">
            <span class="info-label">Claim Number</span>
            <span class="info-value" id="claimNumber">CLM-2024-089456</span>
          </div>
          <div class="claim-info-item">
            <span class="info-label">Insurance Company</span>
            <span class="info-value" id="insurerName">State Farm</span>
          </div>
          <div class="claim-info-item">
            <span class="info-label">Claim Status</span>
            <span class="info-value status-active" id="claimStatus">Active - Under Review</span>
          </div>
        </div>
        <div class="claim-info-details expanded" id="claimDetails">
          <div class="claim-info-item">
            <span class="info-label">Date of Loss</span>
            <span class="info-value" id="dateOfLoss">November 15, 2024</span>
          </div>
          <div class="claim-info-item">
            <span class="info-label">Days Since Loss</span>
            <span class="info-value urgent" id="daysSinceLoss">45 days</span>
          </div>
          <div class="claim-info-item">
            <span class="info-label">Adjuster Name</span>
            <span class="info-value" id="adjusterName">Mike Johnson</span>
          </div>
        </div>
        <div class="deadline-alert">
          ⚠️ <strong>Upcoming Deadline</strong> Proof of Loss due in 15 days (January 14, 2025)
        </div>
      </div>
    </section>

    <!-- Content Area -->
    <div class="content-area">

    <!-- Step-by-Step Claim Guide Section -->
    <h2 class="claim-steps-title">Take the Following Action Steps to Properly Manage Your Claim</h2>
    <p class="claim-steps-subtitle">Step-by-Step Claim Guide</p>

    <!-- Step Accordion -->
    <div class="step-accordion">
      
      <div class="accordion-item" data-step="1">
        <div class="accordion-header" onclick="openStep(1)">
          <div class="accordion-left">
            <div class="accordion-number-container">
              <span class="accordion-step-label">STEP</span>
              <div class="accordion-number">1</div>
            </div>
            <div class="accordion-title-area">
              <div class="accordion-title">Upload your insurance policy for AI-powered coverage analysis<span class="step-status in-progress">In Progress</span></div>
              <div class="accordion-subtitle">Upload your insurance policy for AI-assisted analysis of coverages, limits, endorsements, loss settlement terms, ALE eligibility, and contents rules. Review your coverage terms to understand what is covered and how your claim will be paid.</div>
            </div>
          </div>
          <div class="accordion-toggle">▼</div>
        </div>
        <div class="accordion-content">
          <!-- Content will be inserted by JavaScript -->
        </div>
      </div>

      <div class="accordion-item" data-step="2">
        <div class="accordion-header" onclick="openStep(2)">
          <div class="accordion-left">
            <div class="accordion-number-container">
              <span class="accordion-step-label">STEP</span>
              <div class="accordion-number">2</div>
            </div>
            <div class="accordion-title-area">
              <div class="accordion-title">Report Your Loss, Send Written Notice, and Understand Your Policy Duties<span class="step-status upcoming">Upcoming</span></div>
              <div class="accordion-subtitle">Call your insurance company, send written notice to create legal proof, and learn what your policy requires you to do.</div>
            </div>
          </div>
          <div class="accordion-toggle">▼</div>
        </div>
        <div class="accordion-content">
          <!-- Content will be inserted by JavaScript -->
        </div>
      </div>

      <div class="accordion-item" data-step="3">
        <div class="accordion-header" onclick="openStep(3)">
          <div class="accordion-left">
            <div class="accordion-number-container">
              <span class="accordion-step-label">STEP</span>
              <div class="accordion-number">3</div>
            </div>
            <div class="accordion-title-area">
              <div class="accordion-title">Document Your Loss & Damage<span class="step-status upcoming">Upcoming</span></div>
              <div class="accordion-subtitle">Photograph everything, create detailed inventory, and gather proof of ownership before the adjuster arrives.</div>
            </div>
          </div>
          <div class="accordion-toggle">▼</div>
        </div>
        <div class="accordion-content">
          <!-- Content will be inserted by JavaScript -->
        </div>
      </div>

      <div class="accordion-item" data-step="4">
        <div class="accordion-header" onclick="openStep(4)">
          <div class="accordion-left">
            <div class="accordion-number-container">
              <span class="accordion-step-label">STEP</span>
              <div class="accordion-number">4</div>
            </div>
            <div class="accordion-title-area">
              <div class="accordion-title">Obtain a professional repair estimate from a licensed contractor</div>
              <div class="accordion-subtitle">Hire a licensed contractor to provide a detailed repair estimate. This is your estimate, not the insurance company's estimate.</div>
            </div>
          </div>
          <div class="accordion-toggle">▼</div>
        </div>
        <div class="accordion-content">
          <!-- Content will be inserted by JavaScript -->
        </div>
      </div>

      <div class="accordion-item" data-step="5">
        <div class="accordion-header" onclick="openStep(5)">
          <div class="accordion-left">
            <div class="accordion-number-container">
              <span class="accordion-step-label">STEP</span>
              <div class="accordion-number">5</div>
            </div>
            <div class="accordion-title-area">
              <div class="accordion-title">Compare your estimate to the carrier's estimate using AI analysis</div>
              <div class="accordion-subtitle">Upload the insurance company's estimate and compare it line-by-line against your contractor estimate to identify discrepancies, scope omissions, and pricing deviations.</div>
            </div>
          </div>
          <div class="accordion-toggle">▼</div>
        </div>
        <div class="accordion-content">
          <!-- Content will be inserted by JavaScript -->
        </div>
      </div>

      <div class="accordion-item" data-step="6">
        <div class="accordion-header" onclick="openStep(6)">
          <div class="accordion-left">
            <div class="accordion-number-container">
              <span class="accordion-step-label">STEP</span>
              <div class="accordion-number">6</div>
            </div>
            <div class="accordion-title-area">
              <div class="accordion-title">Align your documented loss with your policy coverage limits and terms</div>
              <div class="accordion-subtitle">Map documented losses to policy coverages, limits, and endorsements to ensure proper claim alignment and identify any coverage gaps or caps.</div>
            </div>
          </div>
          <div class="accordion-toggle">▼</div>
        </div>
        <div class="accordion-content">
          <!-- Content will be inserted by JavaScript -->
        </div>
      </div>

      <div class="accordion-item" data-step="7">
        <div class="accordion-header" onclick="openStep(7)">
          <div class="accordion-left">
            <div class="accordion-number-container">
              <span class="accordion-step-label">STEP</span>
              <div class="accordion-number">7</div>
            </div>
            <div class="accordion-title-area">
              <div class="accordion-title">Track and document all additional living expenses if displaced from your home</div>
              <div class="accordion-subtitle">Track and validate Additional Living Expense (ALE) benefits for temporary housing and displacement costs. Document all necessary expenses.</div>
            </div>
          </div>
          <div class="accordion-toggle">▼</div>
        </div>
        <div class="accordion-content">
          <!-- Content will be inserted by JavaScript -->
        </div>
      </div>

      <div class="accordion-item" data-step="8">
        <div class="accordion-header" onclick="openStep(8)">
          <div class="accordion-left">
            <div class="accordion-number-container">
              <span class="accordion-step-label">STEP</span>
              <div class="accordion-number">8</div>
            </div>
            <div class="accordion-title-area">
              <div class="accordion-title">Organize and inventory all damaged personal property with values</div>
              <div class="accordion-subtitle">Create a complete room-by-room inventory of damaged personal property. List every item with description, quantity, condition, and estimated value.</div>
            </div>
          </div>
          <div class="accordion-toggle">▼</div>
        </div>
        <div class="accordion-content">
          <!-- Content will be inserted by JavaScript -->
        </div>
      </div>

      <div class="accordion-item" data-step="9">
        <div class="accordion-header" onclick="openStep(9)">
          <div class="accordion-left">
            <div class="accordion-number-container">
              <span class="accordion-step-label">STEP</span>
              <div class="accordion-number">9</div>
            </div>
            <div class="accordion-title-area">
              <div class="accordion-title">Determine replacement cost values for your contents</div>
              <div class="accordion-subtitle">Calculate ACV and RCV for all inventoried contents with AI-powered valuation. Understand depreciation and recovery requirements.</div>
            </div>
          </div>
          <div class="accordion-toggle">▼</div>
        </div>
        <div class="accordion-content">
          <!-- Content will be inserted by JavaScript -->
        </div>
      </div>

      <div class="accordion-item" data-step="10">
        <div class="accordion-header" onclick="openStep(10)">
          <div class="accordion-left">
            <div class="accordion-number-container">
              <span class="accordion-step-label">STEP</span>
              <div class="accordion-number">10</div>
            </div>
            <div class="accordion-title-area">
              <div class="accordion-title">Review the carrier's settlement offer and identify any discrepancies</div>
              <div class="accordion-subtitle">Analyze the insurance company's settlement offer, compare it to your documented loss, and identify any underpayment or discrepancies.</div>
            </div>
          </div>
          <div class="accordion-toggle">▼</div>
        </div>
        <div class="accordion-content">
          <!-- Content will be inserted by JavaScript -->
        </div>
      </div>

      <div class="accordion-item" data-step="11">
        <div class="accordion-header" onclick="openStep(11)">
          <div class="accordion-left">
            <div class="accordion-number-container">
              <span class="accordion-step-label">STEP</span>
              <div class="accordion-number">11</div>
            </div>
            <div class="accordion-title-area">
              <div class="accordion-title">Negotiate the settlement amount with your insurance adjuster</div>
              <div class="accordion-subtitle">Use your documented evidence and analysis to negotiate the settlement amount with your insurance adjuster to reach a fair resolution.</div>
            </div>
          </div>
          <div class="accordion-toggle">▼</div>
        </div>
        <div class="accordion-content">
          <!-- Content will be inserted by JavaScript -->
        </div>
      </div>

      <div class="accordion-item" data-step="12">
        <div class="accordion-header" onclick="openStep(12)">
          <div class="accordion-left">
            <div class="accordion-number-container">
              <span class="accordion-step-label">STEP</span>
              <div class="accordion-number">12</div>
            </div>
            <div class="accordion-title-area">
              <div class="accordion-title">Submit your formal Proof of Loss statement with all supporting documentation</div>
              <div class="accordion-subtitle">Submit your complete Proof of Loss statement with all supporting documentation to the insurance carrier and document receipt confirmation.</div>
            </div>
          </div>
          <div class="accordion-toggle">▼</div>
        </div>
        <div class="accordion-content">
          <!-- Content will be inserted by JavaScript -->
        </div>
      </div>

      <div class="accordion-item" data-step="13">
        <div class="accordion-header" onclick="openStep(13)">
          <div class="accordion-left">
            <div class="accordion-number-container">
              <span class="accordion-step-label">STEP</span>
              <div class="accordion-number">13</div>
            </div>
            <div class="accordion-title-area">
              <div class="accordion-title">Track payment status and follow up on any outstanding claim amounts</div>
              <div class="accordion-subtitle">Monitor payment status, track all received payments, and follow up on any outstanding claim amounts including withheld depreciation and supplements.</div>
            </div>
          </div>
          <div class="accordion-toggle">▼</div>
        </div>
        <div class="accordion-content">
          <!-- Content will be inserted by JavaScript -->
        </div>
      </div>


    </div><!-- End step-accordion -->

    <!-- Post-Claim Asset Section (Shown after Step 10 completion) -->
    <div class="post-claim-section" id="postClaimSection" style="display: none;">
      <h3>Your Claim File Is Now a Permanent Asset</h3>
      <p>This documentation serves as your official record for future disputes, property resale disclosures, warranty claims, tax deductions, and any additional damage discovered later. Maintain this archive indefinitely.</p>
      <div class="post-claim-actions">
        <button class="btn-post-claim" onclick="downloadClaimFile()">📥 Download Complete Claim File</button>
        <button class="btn-post-claim secondary" onclick="viewClaimArchive()">📂 View Archived Documents</button>
      </div>
    </div>

    </div><!-- End content-area -->

  </div><!-- End container -->

  <script>
    // GLOBAL FUNCTIONS - Must be defined before any onclick handlers
    function toggleDropdown(e) {
      if (e) {
        e.preventDefault();
        e.stopPropagation();
      }
      
      const dropdown = document.getElementById('uploadDropdown');
      if (!dropdown) {
        console.error('Dropdown element not found');
        return;
      }
      
      const isOpen = dropdown.classList.contains('open');
      
      if (isOpen) {
        dropdown.classList.remove('open');
      } else {
        dropdown.classList.add('open');
      }
      
      console.log('Dropdown toggled:', isOpen ? 'closed' : 'opened');
    }

    function toggleClaimInfoPanel() {
      const panel = document.getElementById('claimInfoPanel');
      
      if (!panel) {
        console.error('Claim info panel not found');
        return;
      }
      
      const isExpanded = panel.classList.contains('expanded');
      
      if (isExpanded) {
        panel.classList.remove('expanded');
      } else {
        panel.classList.add('expanded');
      }
    }
    
    // Step data for all 13 steps
    const stepData = {
      1: {
        label: 'STEP 1 OF 13',
        title: 'Determine Your Policy Coverages (AI Policy Analysis)',
        subtitle: 'Find your insurance policy, read the sections that apply to your damage, and write down your coverage limits.',
        customContent: true,
        htmlContent: `
    <div class="process-phases">
      <div class="phase-card phase-upload">
        <div class="phase-header">
          <span class="phase-number">1</span>
          <div>
            <h4>Upload Your Policy Documents</h4>
            <p>Get everything in one place</p>
          </div>
        </div>
        
        <div class="phase-content">
          <div class="upload-checklist">
            <div class="checklist-item">✓ Declarations page (shows your coverages)</div>
            <div class="checklist-item">✓ Full policy contract (all pages)</div>
            <div class="checklist-item">✓ All endorsements/riders/amendments</div>
          </div>
          
          <button class="btn-phase-action" onclick="window.location.href='app/tools/policy-analyzer-complete.html'">📤 Upload Policy Documents</button>
          
          <div class="phase-tip">
            <strong>Can't find your policy?</strong> Contact your insurance carrier or broker and demand a certified copy of your policy as you are legally entitled to it.
          </div>
        </div>
      </div>
      
      <div class="phase-card phase-review">
        <div class="phase-header">
          <span class="phase-number">2</span>
          <div>
            <h4>Review Your Coverage Intelligence Report</h4>
            <p>Understand exactly what you're covered for</p>
          </div>
        </div>
        
        <div class="phase-content">
          <p class="phase-intro">Once uploaded, you'll get a plain-English report that tells you:</p>
          
          <div class="report-highlights">
            <div class="highlight-item">
              <span class="highlight-icon">💰</span>
              <div>
                <strong>Your Coverage Limits</strong>
                <span>Maximum amounts you can claim for dwelling, contents, and living expenses</span>
              </div>
            </div>
            
            <div class="highlight-item">
              <span class="highlight-icon">✅</span>
              <div>
                <strong>What's Covered</strong>
                <span>Types of damage and property your policy pays for</span>
              </div>
            </div>
            
            <div class="highlight-item">
              <span class="highlight-icon">❌</span>
              <div>
                <strong>What's Excluded</strong>
                <span>Limitations and exclusions that could affect your claim</span>
              </div>
            </div>
            
            <div class="highlight-item">
              <span class="highlight-icon">⏰</span>
              <div>
                <strong>Critical Deadlines</strong>
                <span>Time limits for filing, proof of loss, and legal action</span>
              </div>
            </div>
            
            <div class="highlight-item">
              <span class="highlight-icon">📋</span>
              <div>
                <strong>Your Duties</strong>
                <span>What the policy requires you to do (and when)</span>
              </div>
            </div>
            
            <div class="highlight-item">
              <span class="highlight-icon">🏠</span>
              <div>
                <strong>How You'll Be Paid</strong>
                <span>ACV vs RCV, depreciation, and holdback rules</span>
              </div>
            </div>
          </div>
          
          <button class="btn-phase-action" onclick="window.location.href='app/tools/policy-analyzer-demo.html'">📊 View Sample Coverage Report</button>
        </div>
      </div>
    </div>

    <div class="prevents-box">
      <strong>🛡️ What This Prevents:</strong>
      <ul>
        <li>Accepting a denial for something that's actually covered</li>
        <li>Missing coverage for additional living expenses or code upgrades</li>
        <li>Agreeing to terms that contradict your policy language</li>
        <li>Missing critical filing deadlines you didn't know existed</li>
      </ul>
    </div>

    <div class="value-statement-bottom">
      <strong>Why You Need This:</strong>
      Insurance companies know exactly what your policy says. Most policyholders don't. This puts you at a disadvantage from day one. Before you talk to an adjuster or file anything, you need to know what you're entitled to—in plain English.
    </div>

    <div class="step-completion">
      <div class="completion-checklist">
        <div class="completion-item" onclick="toggleCompletion(this)">
          <span class="completion-checkbox"></span>
          <span>Policy documents uploaded</span>
        </div>
        <div class="completion-item" onclick="toggleCompletion(this)">
          <span class="completion-checkbox"></span>
          <span>Coverage report reviewed</span>
        </div>
        <div class="completion-item" onclick="toggleCompletion(this)">
          <span class="completion-checkbox"></span>
          <span>Coverage limits and deadlines documented</span>
        </div>
      </div>
      
      <button class="btn-complete-step" onclick="completeAndNext(1)">✓ I Understand My Coverage - Continue to Step 2</button>
    </div>
  `
      },
      2: {
        label: 'STEP 2 OF 13',
        title: 'Report Your Loss, Send Written Notice, and Understand Your Policy Duties',
        subtitle: 'Call your insurance company, send written notice to create legal proof, and learn what your policy requires you to do.',
        whatThisPrevents: 'This step prevents late notice denials and duty-to-cooperate violations that void coverage even when damage is clearly covered.',
        guardrail: 'Do not describe the full extent of damage or provide damage estimates during the initial report - only report that a loss occurred.',
        skipWarning: 'Missing the reporting deadline can void your entire claim - most policies require notice within 24-72 hours.',
        customContent: true,
        htmlContent: `
    <div class="value-statement">
      <strong>⚠️ Critical Deadline Alert:</strong>
      Most policies require notice within 24-72 hours of loss discovery. Late notice can void your entire claim. Call your insurance company today.
    </div>

    <div class="process-phases">
      
      <!-- PHASE 1: Report the Loss -->
      <div class="phase-card">
        <div class="phase-header">
          <span class="phase-number">1</span>
          <div>
            <h4>Report the Loss Within 24-72 Hours</h4>
            <p>Make the call today - this starts your claim clock</p>
          </div>
        </div>
        
        <div class="phase-content">
          <div class="action-steps">
            <div class="action-step">
              <span class="step-icon">📞</span>
              <div>
                <strong>Find Your Policy Number</strong>
                <p>Look on your declarations page, insurance card, or policy documents</p>
              </div>
            </div>
            
            <div class="action-step">
              <span class="step-icon">📝</span>
              <div>
                <strong>Use This Script</strong>
                <div class="script-box">
                  "I'm calling to report a [type] loss at my property on [date]. 
                  I need to open a claim and get a claim number. My policy number is [number]."
                </div>
              </div>
            </div>
            
            <div class="action-step">
              <span class="step-icon">✍️</span>
              <div>
                <strong>Write Down Immediately</strong>
                <p>Claim number, adjuster name, phone number, reference numbers, date/time of call</p>
              </div>
            </div>
          </div>
          
          <div class="info-box">
            <strong>What NOT to Say:</strong>
            <ul>
              <li>Don't estimate damage amounts</li>
              <li>Don't agree to recorded statements yet</li>
              <li>Don't speculate about cause</li>
              <li>Just report that a loss occurred</li>
            </ul>
          </div>
          
          <button class="btn-phase-action" onclick="window.location.href='app/claim-journal.html'">📋 Log Call in Claim Journal</button>
        </div>
      </div>
      
      <!-- PHASE 2: Send Written Notice -->
      <div class="phase-card">
        <div class="phase-header">
          <span class="phase-number">2</span>
          <div>
            <h4>Send Written Notice of Loss</h4>
            <p>Create legal proof you reported on time</p>
          </div>
        </div>
        
        <div class="phase-content">
          <p class="phase-intro">Always follow up your phone call with written notice. This creates legal proof that you reported within the required timeframe.</p>
          
          <div class="written-notice-benefits">
            <div class="notice-benefit">
              <span class="benefit-icon">✓</span>
              <div>
                <strong>Proves Timely Notice</strong>
                <p>If the insurer later claims you reported late, you have written proof with date stamps.</p>
              </div>
            </div>
            
            <div class="notice-benefit">
              <span class="benefit-icon">✓</span>
              <div>
                <strong>Creates Paper Trail</strong>
                <p>Documents exactly what you reported and when - prevents "he said, she said" disputes.</p>
              </div>
            </div>
            
            <div class="notice-benefit">
              <span class="benefit-icon">✓</span>
              <div>
                <strong>Shows Professionalism</strong>
                <p>Insurers take written claims more seriously than phone-only reports.</p>
              </div>
            </div>
          </div>
          
          <div class="info-box">
            <strong>How to Send:</strong>
            <ol>
              <li>Email to claims department (immediate delivery, date stamped)</li>
              <li>Certified mail with return receipt (legal proof of delivery)</li>
              <li>Keep copies of both for your records</li>
            </ol>
          </div>
          
          <button class="btn-phase-action" onclick="window.location.href='app/tools/written-notice-generator.html'">📧 Generate Written Notice Letter</button>
        </div>
      </div>
      
      <!-- PHASE 3: Understand Your Policy Duties -->
      <div class="phase-card">
        <div class="phase-header">
          <span class="phase-number">3</span>
          <div>
            <h4>Your Policy Duties Activate Now</h4>
            <p>What you're legally required to do (pulled from your policy)</p>
          </div>
        </div>
        
        <div class="phase-content">
          <p class="phase-intro">Your policy requires these actions. Failure to comply = coverage denial even if damage is legitimate.</p>
          
          <div class="duties-grid">
            
            <div class="duty-card">
              <div class="duty-header">
                <span class="duty-icon">🛡️</span>
                <div>
                  <strong>DUTY 1: Protect the Property</strong>
                  <span class="duty-deadline">Timeline: Immediately</span>
                </div>
              </div>
              <div class="duty-content">
                <p class="duty-description">Make reasonable emergency repairs to prevent further damage. Board windows, tarp roof, turn off water, secure the property.</p>
                <div class="info-box">
                  <strong>Why it matters:</strong> If you don't mitigate, the insurer won't pay for additional damage that could have been prevented.
                </div>
                <button class="btn-duty-tool" onclick="window.location.href='app/tools/mitigation-documentation-tool.html'">📝 Emergency Mitigation Log</button>
              </div>
            </div>
            
            <div class="duty-card">
              <div class="duty-header">
                <span class="duty-icon">🤝</span>
                <div>
                  <strong>DUTY 2: Cooperate with Investigation</strong>
                  <span class="duty-deadline">Timeline: Throughout claim</span>
                </div>
              </div>
              <div class="duty-content">
                <p class="duty-description">Answer questions, allow property inspections, provide requested documents, attend examinations under oath if requested.</p>
                <div class="info-box">
                  <strong>Why it matters:</strong> "Lack of cooperation" is the most common reason insurers use to deny otherwise valid claims.
                </div>
                <div class="info-box">
                  <strong>Cooperate BUT:</strong> Don't give recorded statements without reviewing your rights. Don't sign anything without reading it first.
                </div>
                <button class="btn-duty-tool" onclick="window.location.href='app/tools/compliance-review.html'">📊 Cooperation Tracker</button>
              </div>
            </div>
            
            <div class="duty-card">
              <div class="duty-header">
                <span class="duty-icon">📸</span>
                <div>
                  <strong>DUTY 3: Document Everything</strong>
                  <span class="duty-deadline">Timeline: Before adjuster inspection</span>
                </div>
              </div>
              <div class="duty-content">
                <p class="duty-description">Take comprehensive photos, create itemized inventory of damaged property, save receipts, gather proof of ownership.</p>
                <div class="info-box">
                  <strong>Why it matters:</strong> The burden of proof is on YOU. Without documentation, you can't prove what was damaged or its value.
                </div>
                <button class="btn-duty-tool" onclick="window.location.href='app/tools/photo-upload-organizer.html'">📁 Photo & Evidence Organizer</button>
              </div>
            </div>
            
            <div class="duty-card">
              <div class="duty-header">
                <span class="duty-icon">⏰</span>
                <div>
                  <strong>DUTY 4: File Proof of Loss</strong>
                  <span class="duty-deadline">Timeline: Within 60 days (varies by policy)</span>
                </div>
              </div>
              <div class="duty-content">
                <p class="duty-description">Submit a sworn statement of loss with itemized damages, estimates, and supporting documentation by the policy deadline.</p>
                <div class="info-box">
                  <strong>Why it matters:</strong> This is your formal legal claim. Miss this deadline and your coverage is void—no exceptions.
                </div>
                <div class="info-box">
                  <strong>Your deadline:</strong> <span id="polDeadline">[Calculated from your loss date]</span>
                </div>
                <button class="btn-duty-tool" onclick="window.location.href='app/tools/proof-of-loss-tracker.html'">📄 Proof of Loss Tracker</button>
              </div>
            </div>
            
            <div class="duty-card">
              <div class="duty-header">
                <span class="duty-icon">🚫</span>
                <div>
                  <strong>DUTY 5: Don't Make Permanent Repairs Yet</strong>
                  <span class="duty-deadline">Timeline: Until inspection or authorization</span>
                </div>
              </div>
              <div class="duty-content">
                <p class="duty-description">Emergency mitigation only. Don't make permanent repairs until the insurer inspects or authorizes repairs in writing.</p>
                <div class="info-box">
                  <strong>Why it matters:</strong> The insurer has the right to inspect damage before repairs. If you repair first, they can deny payment.
                </div>
                <div class="info-box">
                  <strong>Exception:</strong> Keep all receipts for emergency repairs (tarps, water extraction, boarding). These are reimbursable even without pre-approval.
                </div>
                <button class="btn-duty-tool" onclick="window.location.href='app/tools/compliance-review.html'">📋 Duty Compliance Tracker</button>
              </div>
            </div>
            
          </div>
        </div>
      </div>
      
    </div>

    <div class="prevents-box">
      <strong>🛡️ What This Step Prevents:</strong>
      <ul>
        <li>Late notice denials (most common reason claims are voided)</li>
        <li>"Lack of cooperation" denials due to missed duties</li>
        <li>Loss of coverage for failing to protect property</li>
        <li>Denial for making repairs before inspection</li>
        <li>"He said, she said" disputes about what was reported and when</li>
      </ul>
    </div>

    <div class="step-completion">
      <div class="completion-checklist">
        <div class="completion-item" onclick="toggleCompletion(this)">
          <span class="completion-checkbox"></span>
          <span>Called insurance company and reported loss</span>
        </div>
        <div class="completion-item" onclick="toggleCompletion(this)">
          <span class="completion-checkbox"></span>
          <span>Received claim number in writing</span>
        </div>
        <div class="completion-item" onclick="toggleCompletion(this)">
          <span class="completion-checkbox"></span>
          <span>Documented the call in claim diary</span>
        </div>
        <div class="completion-item" onclick="toggleCompletion(this)">
          <span class="completion-checkbox"></span>
          <span>Understand all 5 policy duties</span>
        </div>
        <div class="completion-item" onclick="toggleCompletion(this)">
          <span class="completion-checkbox"></span>
          <span>Sent written notice via email/certified mail</span>
        </div>
        <div class="completion-item" onclick="toggleCompletion(this)">
          <span class="completion-checkbox"></span>
          <span>Started emergency mitigation (if needed)</span>
        </div>
      </div>
      
      <button class="btn-complete-step" onclick="completeAndNext(2)">✓ Loss Reported & Duties Understood - Continue to Step 3</button>
    </div>
  `
      },
      3: {
        label: 'STEP 3 OF 13',
        title: 'Document Your Loss & Damage',
        subtitle: 'Photograph everything, create detailed inventory, and gather proof of ownership before the adjuster arrives.',
        whatThisPrevents: 'This step prevents denial for insufficient proof of loss and undervaluation because you cannot prove what was damaged or its value.',
        guardrail: 'Do not throw away damaged items or begin repairs until you have photographed everything and the adjuster has completed their inspection.',
        skipWarning: 'Without documentation, you cannot prove what was damaged. The burden of proof is entirely on you—no photos = no payment.',
        customContent: true,
        htmlContent: `
          <div class="value-statement">
            <strong>Why This Is Critical:</strong>
            Insurance claims are won or lost based on documentation. The burden of proof is entirely on YOU to prove what was damaged and its value. Without comprehensive photos, itemized inventory, and proof of ownership, the insurer can deny your claim or severely undervalue it. This documentation must be completed before the adjuster inspection.
          </div>

          <div class="process-phases">
            
            <!-- PHASE 1: Photograph All Damage -->
            <div class="phase-card">
              <div class="phase-header">
                <span class="phase-number">1</span>
                <div>
                  <h4>Photograph All Damage Comprehensively</h4>
                  <p>Visual proof is your strongest evidence</p>
                </div>
              </div>
              
              <div class="phase-content">
                <p class="phase-intro">Take detailed photos of every damaged area from multiple angles. Poor documentation is the #1 reason claims are underpaid.</p>
                
                <div class="photo-guidance">
                  <div class="guidance-section">
                    <strong>What to Photograph:</strong>
                    <ul>
                      <li>All structural damage (roof, walls, ceilings, floors, windows, doors)</li>
                      <li>All damaged personal property (furniture, electronics, clothing, etc.)</li>
                      <li>Cause of loss (water source, tree damage, fire origin, etc.)</li>
                      <li>Surrounding context (entire room, building exterior, property overview)</li>
                    </ul>
                  </div>
                  
                  <div class="guidance-section">
                    <strong>How to Photograph:</strong>
                    <ul>
                      <li>Multiple angles of each damaged area (wide shot, medium, close-up)</li>
                      <li>Use good lighting or flash—dark photos are worthless</li>
                      <li>Include reference objects for scale (ruler, coin, hand)</li>
                      <li>Capture serial numbers, model numbers, brand labels</li>
                      <li>Date stamp if possible (use phone camera default settings)</li>
                    </ul>
                  </div>
                  
                  <div class="info-box">
                    <strong>Common Mistakes to Avoid:</strong>
                    Poor lighting, missing room context, only photographing "worst" damage (photograph EVERYTHING), not capturing model/serial numbers, deleting "bad" photos (adjusters want to see all angles).
                  </div>
                </div>
                
                <button class="btn-phase-action" onclick="window.location.href='app/tools/photo-upload-organizer.html'">📸 Upload & Organize Damage Photos</button>
                
                <div class="info-box" style="margin-top: 16px;">
                  <strong>How Many Photos?</strong>
                  Minimum 10-20 photos for small claims. For major damage, 50-100+ photos is normal. More is better—you cannot over-document.
                </div>
              </div>
            </div>
            
            <!-- PHASE 2: Create Itemized Inventory -->
            <div class="phase-card">
              <div class="phase-header">
                <span class="phase-number">2</span>
                <div>
                  <h4>Create Detailed Itemized Inventory</h4>
                  <p>List every damaged item with description and value</p>
                </div>
              </div>
              
              <div class="phase-content">
                <p class="phase-intro">Create a room-by-room inventory of all damaged property—both structural elements and personal belongings. Generic descriptions like "clothing" or "furniture" result in lowball payments.</p>
                
                <div class="inventory-guidance">
                  <div class="guidance-section">
                    <strong>For Each Damaged Item, Document:</strong>
                    <ul>
                      <li><strong>Description:</strong> Specific details (brand, model, size, color, material)</li>
                      <li><strong>Age/Purchase Date:</strong> When you bought it</li>
                      <li><strong>Purchase Price:</strong> What you originally paid</li>
                      <li><strong>Replacement Cost:</strong> What it would cost to replace today</li>
                      <li><strong>Condition Before Loss:</strong> Excellent, good, fair, poor</li>
                      <li><strong>Location:</strong> Which room (for organization)</li>
                    </ul>
                  </div>
                  
                  <div class="example-comparison">
                    <div class="bad-example">
                      <strong>❌ Bad Inventory Entry:</strong>
                      <p>"TV - $500"</p>
                    </div>
                    <div class="good-example">
                      <strong>✓ Good Inventory Entry:</strong>
                      <p>"Samsung 55" QLED 4K Smart TV, Model QN55Q60RAFXZA, purchased 3/2021 from Best Buy for $897.99, excellent condition, living room"</p>
                    </div>
                  </div>
                  
                  <div class="info-box">
                    <strong>Don't Skip Small Items:</strong>
                    Kitchenware, linens, toiletries, cleaning supplies, tools, decorations—it all adds up. A fully stocked home has $50,000-$100,000+ in contents. Document everything or you're leaving money on the table.
                  </div>
                </div>
                
                <button class="btn-phase-action" onclick="window.location.href='app/tools/contents-inventory.html'">📋 Create Digital Inventory</button>
              </div>
            </div>
            
            <!-- PHASE 3: Gather Proof of Ownership & Value -->
            <div class="phase-card">
              <div class="phase-header">
                <span class="phase-number">3</span>
                <div>
                  <h4>Gather Proof of Ownership & Value</h4>
                  <p>Back up your inventory with documentation</p>
                </div>
              </div>
              
              <div class="phase-content">
                <p class="phase-intro">The insurer will question high-value items without proof. Gather any documentation that shows you owned the items and their value.</p>
                
                <div class="proof-types">
                  <div class="proof-category">
                    <span class="category-icon">🧾</span>
                    <div>
                      <strong>Purchase Documentation</strong>
                      <p>Receipts, credit card statements, bank statements, invoices, order confirmations, delivery records</p>
                    </div>
                  </div>
                  
                  <div class="proof-category">
                    <span class="category-icon">📄</span>
                    <div>
                      <strong>Product Documentation</strong>
                      <p>Warranty cards, owner's manuals, product registration, appraisals, certificates of authenticity</p>
                    </div>
                  </div>
                  
                  <div class="proof-category">
                    <span class="category-icon">📸</span>
                    <div>
                      <strong>Pre-Loss Photos/Videos</strong>
                      <p>Family photos showing items in background, social media posts, home tour videos, real estate listing photos, vacation photos</p>
                    </div>
                  </div>
                  
                  <div class="proof-category">
                    <span class="category-icon">💳</span>
                    <div>
                      <strong>Financial Records</strong>
                      <p>Insurance schedules (jewelry, art), tax records (home office equipment), moving company inventories</p>
                    </div>
                  </div>
                </div>
                
                <div class="info-box">
                  <strong>Can't Find Receipts?</strong>
                  Don't panic. Use online purchase history (Amazon, retailers), credit card statements, bank transaction history, and even ask retailers to reprint receipts using your loyalty card number. Pre-loss photos from social media can also establish ownership.
                </div>
                
                <button class="btn-phase-action" onclick="window.location.href='app/tools/damage-documentation.html'">📁 Upload Proof Documents</button>
              </div>
            </div>
            
          </div>

          <div class="prevents-box">
            <strong>🛡️ What This Step Prevents:</strong>
            <ul>
              <li>Denial for "insufficient proof of loss" or inability to verify damage</li>
              <li>Severe undervaluation because you can't prove what you owned or its value</li>
              <li>Adjuster claiming damage "wasn't there" or "pre-existed" because you lack photos</li>
              <li>Missing thousands in contents claims because you forgot items in the chaos</li>
              <li>Disputes about scope of damage (your photos vs their memory months later)</li>
            </ul>
          </div>

          <div class="step-completion">
            <h3 style="font-size: 16px; font-weight: 700; color: var(--navy-dark); margin-bottom: 16px;">Documentation Readiness Checklist</h3>
            
            <div class="completion-checklist">
              <div class="completion-item" onclick="toggleCompletion(this)">
                <span class="completion-checkbox"></span>
                <span>Uploaded 10+ comprehensive damage photos (all angles, good lighting)</span>
              </div>
              <div class="completion-item" onclick="toggleCompletion(this)">
                <span class="completion-checkbox"></span>
                <span>Created detailed room-by-room inventory with descriptions and values</span>
              </div>
              <div class="completion-item" onclick="toggleCompletion(this)">
                <span class="completion-checkbox"></span>
                <span>Gathered proof of ownership (receipts, statements, pre-loss photos)</span>
              </div>
              <div class="completion-item" onclick="toggleCompletion(this)">
                <span class="completion-checkbox"></span>
                <span>Organized all documentation in Evidence Organizer</span>
              </div>
            </div>
            
            <div class="info-box" style="margin: 20px 0;">
              <strong>Before Moving to Step 4:</strong>
              Make sure your documentation is complete. Once the adjuster inspects, it's too late to add forgotten items or take additional photos of damage that's been repaired.
            </div>
            
            <button class="btn-complete-step" onclick="completeAndNext(3)">✓ Documentation Complete - Continue to Step 4</button>
          </div>
        `
      },
      4: {
        label: 'STEP 4 OF 13',
        title: 'Obtain a professional repair estimate from a licensed contractor',
        subtitle: 'Upload your contractor\'s repair estimate for AI quality analysis and completeness validation.',
        primaryAction: {
          title: 'Upload & Analyze Contractor Estimate',
          description: 'Upload your contractor\'s repair estimate (PDF, DOC, XLS, or image). The AI automatically analyzes scope gaps, pricing issues, code upgrade requirements, missing trade items, and generates an Estimate Quality Report.',
          tool: { id: 'estimate-review', title: 'Estimate Review Tool', classification: 'required' }
        },
        reportSections: {
          title: 'Estimate Quality Report',
          description: 'AI analysis of your contractor estimate',
          viewTool: { id: 'estimate-quality-viewer', title: 'View Estimate Quality Report', classification: 'required' },
          sections: [
            'Estimator Credentials Check',
            'Scope Completeness Analysis',
            'Line-Item Detail Score',
            'Code Upgrade Identification',
            'Estimate Deficiency Flags'
          ]
        },
        infoNote: 'Note: A complete, professional estimate establishes the true cost of repairs and protects against underpayment.',
        additionalTools: [
          { id: 'contractor-scope-checklist', title: 'Contractor Scope Checklist' },
          { id: 'code-upgrade-identifier', title: 'Code Upgrade Identifier' },
          { id: 'missing-trade-detector', title: 'Missing Trade Detector' },
          { id: 'estimate-revision-request-generator', title: 'Estimate Revision Request Generator' }
        ]
      },
      5: {
        label: 'STEP 5 OF 13',
        title: 'Compare your estimate to the carrier\'s estimate using AI analysis',
        subtitle: 'Compare your contractor estimate with the insurance company estimate to identify discrepancies.',
        primaryAction: {
          title: 'Upload & Compare Carrier Estimate',
          description: 'Upload the insurance company\'s estimate. The AI automatically performs a line-by-line comparison against your contractor estimate from Step 4, identifies discrepancies, scope omissions, pricing deviations, and generates an Estimate Comparison Report.',
          tool: { id: 'estimate-comparison', title: 'Estimate Comparison Tool', classification: 'required' }
        },
        reportSections: {
          title: 'Estimate Comparison Report',
          description: 'Line-by-line analysis of estimate differences',
          viewTool: { id: 'estimate-comparison-viewer', title: 'View Estimate Comparison Report', classification: 'required' },
          sections: [
            'Comparison Summary',
            'Scope Gaps',
            'Pricing Deltas',
            'Missing Line Items',
            'Negotiation Talking Points'
          ]
        },
        infoNote: 'Note: This comparison identifies underpayment, missing scope items, and pricing discrepancies between estimates.',
        additionalTools: [
          { id: 'line-item-discrepancy-finder', title: 'Line-Item Discrepancy Finder' },
          { id: 'pricing-deviation-analyzer', title: 'Pricing Deviation Analyzer' },
          { id: 'scope-omission-detector', title: 'Scope Omission Detector' },
          { id: 'negotiation-language-generator', title: 'Negotiation Language Generator' }
        ]
      },
      6: {
        label: 'STEP 6 OF 13',
        title: 'Align your documented loss with your policy coverage limits and terms',
        subtitle: 'Map documented losses to policy coverages, limits, and endorsements to ensure proper claim alignment.',
        primaryAction: {
          title: 'Align Loss to Coverage',
          description: 'The AI automatically imports policy details from Step 1 and loss documentation from Steps 3-5, maps all losses to applicable coverages, identifies sublimit impacts, flags exclusion conflicts, and generates a Coverage Alignment Report.',
          tool: { id: 'coverage-alignment', title: 'Coverage Alignment Engine', classification: 'required' }
        },
        reportSections: {
          title: 'Coverage Alignment Report',
          description: 'Mapping of losses to policy coverages',
          viewTool: { id: 'alignment-report-viewer', title: 'View Coverage Alignment Report', classification: 'required' },
          sections: [
            'Coverage Mapping Summary',
            'Sublimit Impact Analysis',
            'Exclusion Conflict Flags',
            'Missed Coverage Opportunities',
            'Claim Allocation Strategy'
          ]
        },
        infoNote: 'Note: This step ensures all documented losses are properly applied to available coverage and identifies missed opportunities.',
        additionalTools: [
          { id: 'coverage-mapping-visualizer', title: 'Coverage Mapping Visualizer' },
          { id: 'sublimit-impact-analyzer', title: 'Sublimit Impact Analyzer' },
          { id: 'endorsement-opportunity-identifier', title: 'Endorsement Opportunity Identifier' },
          { id: 'coverage-gap-detector', title: 'Coverage Gap Detector' }
        ]
      },
      7: {
        label: 'STEP 7 OF 13',
        title: 'Track and document all additional living expenses if displaced from your home',
        subtitle: 'Track and validate Additional Living Expense (ALE) benefits for temporary housing and displacement costs.',
        primaryAction: {
          title: 'Track ALE Expenses',
          description: 'Log all additional living expenses including temporary housing, meals, transportation, laundry, storage, and other displacement costs. Upload receipts and documentation. The AI automatically validates expenses, checks eligibility, and tracks remaining limits.',
          tool: { id: 'ale-tracker', title: 'ALE Tracker / Validator', classification: 'required' }
        },
        reportSections: {
          title: 'ALE Compliance Report',
          description: 'Tracking and validation of displacement expenses',
          viewTool: { id: 'ale-report-viewer', title: 'View ALE Compliance Report', classification: 'required' },
          sections: [
            'ALE Eligibility Status',
            'Expense Summary by Category',
            'Remaining ALE Limits',
            'Compliance Flags',
            'Reimbursement Timeline'
          ]
        },
        infoNote: 'Note: ALE coverage reimburses increased living costs while your home is uninhabitable. This step remains active and can be updated throughout your claim.',
        additionalTools: [
          { id: 'expense-upload-tool', title: 'Expense Upload Tool' },
          { id: 'ale-eligibility-checker', title: 'ALE Eligibility Checker' },
          { id: 'remaining-ale-limit-calculator', title: 'Remaining ALE Limit Calculator' },
          { id: 'temporary-housing-documentation-helper', title: 'Temporary Housing Documentation Helper' }
        ]
      },
      8: {
        label: 'STEP 8 OF 13',
        title: 'Organize and inventory all damaged personal property with values',
        subtitle: 'Create a complete room-by-room inventory of damaged personal property.',
        primaryAction: {
          title: 'Create Contents Inventory',
          description: 'Enter all damaged items with description, room/location, quantity, damage status, and photos/receipts if available. The AI automatically validates completeness, identifies missing categories and rooms, and generates an Inventory Completeness Report.',
          tool: { id: 'contents-inventory', title: 'Contents Inventory Tool', classification: 'required' }
        },
        reportSections: {
          title: 'Inventory Completeness Report',
          description: 'AI validation of your contents inventory',
          viewTool: { id: 'inventory-report-viewer', title: 'View Inventory Completeness Report', classification: 'required' },
          sections: [
            'Room Coverage Summary',
            'Category Completeness Score',
            'Missing Room Flags',
            'Missing Category Flags',
            'Documentation Quality Score'
          ]
        },
        infoNote: 'Note: Insurance companies only pay for items that are properly listed and documented. This step ensures completeness before valuation.',
        additionalTools: [
          { id: 'room-by-room-prompt-tool', title: 'Room-by-Room Prompt Tool' },
          { id: 'category-coverage-checker', title: 'Category Coverage Checker' },
          { id: 'contents-documentation-helper', title: 'Contents Documentation Helper' }
        ],
        isCritical: true
      },
      9: {
        label: 'STEP 9 OF 13',
        title: 'Determine replacement cost values for your contents',
        subtitle: 'Calculate ACV and RCV for all inventoried contents with AI-powered valuation.',
        primaryAction: {
          title: 'Calculate Contents Value',
          description: 'The AI automatically calculates RCV (Replacement Cost Value) and ACV (Actual Cash Value) for all items from Step 8 inventory. Review valuations, adjust if needed, and generate a Contents Valuation Report showing ACV/RCV totals, depreciation summary, and holdback amounts.',
          tool: { id: 'contents-valuation', title: 'Contents Valuation Tool', classification: 'required' }
        },
        reportSections: {
          title: 'Contents Valuation Report',
          description: 'ACV and RCV calculations for all items',
          viewTool: { id: 'valuation-report-viewer', title: 'View Contents Valuation Report', classification: 'required' },
          sections: [
            'RCV Total Summary',
            'ACV Total Summary',
            'Depreciation Analysis',
            'Holdback Amount',
            'Recovery Eligibility'
          ]
        },
        infoNote: 'Note: This step calculates replacement cost and actual cash value to ensure accurate contents reimbursement.',
        additionalTools: [
          { id: 'depreciation-calculator', title: 'Depreciation Calculator' },
          { id: 'comparable-item-finder', title: 'Comparable Item Finder' },
          { id: 'replacement-cost-justification-tool', title: 'Replacement Cost Justification Tool' }
        ]
      },
      10: {
        label: 'STEP 10 OF 13',
        title: 'Review the carrier\'s settlement offer and identify any discrepancies',
        subtitle: 'Compile all reports and documentation into a professional, submission-ready claim package.',
        primaryAction: {
          title: 'Assemble Claim Package',
          description: 'The AI automatically imports all completed reports from Steps 1-9, compiles them into a professional submission package, evaluates completeness, identifies missing components and submission risks, and generates a Claim Package Readiness Report.',
          tool: { id: 'claim-package-assembly', title: 'Claim Package Assembly Engine', classification: 'required' }
        },
        reportSections: {
          title: 'Claim Package Readiness Report',
          description: 'Evaluation of submission readiness',
          viewTool: { id: 'readiness-report-viewer', title: 'View Claim Package Readiness Report', classification: 'required' },
          sections: [
            'Package Completeness Score',
            'Missing Component Flags',
            'Submission Risk Assessment',
            'Document Organization Summary',
            'Submission Checklist'
          ]
        },
        infoNote: 'Note: A complete, well-organized package strengthens your claim and reduces carrier delays.',
        additionalTools: [
          { id: 'submission-checklist-generator', title: 'Submission Checklist Generator' },
          { id: 'missing-document-identifier', title: 'Missing Document Identifier' },
          { id: 'pre-submission-risk-review-tool', title: 'Pre-Submission Risk Review Tool' },
          { id: 'carrier-submission-cover-letter-generator', title: 'Carrier Submission Cover Letter Generator' }
        ]
      },
      11: {
        label: 'STEP 11 OF 13',
        title: 'Negotiate the settlement amount with your insurance adjuster',
        subtitle: 'Submit your complete claim package to the insurance carrier and document receipt confirmation.',
        primaryAction: {
          title: 'Submit Claim Package',
          description: 'Choose your submission method (certified mail, carrier portal, or email with receipt confirmation). Submit your complete claim package and obtain proof of submission. The AI tracks submission details and generates a confirmation report.',
          tool: { id: 'claim-submitter', title: 'Claim Submission Tool', classification: 'required' }
        },
        reportSections: {
          title: 'Submission Confirmation Report',
          description: 'Documentation of claim submission',
          viewTool: { id: 'submission-report-viewer', title: 'View Submission Confirmation Report', classification: 'required' },
          sections: [
            'Submission Method & Timestamp',
            'Carrier Acknowledgment Status',
            'Follow-Up Schedule',
            'Next Moves'
          ]
        },
        infoNote: 'Note: Document your submission method and obtain written confirmation of receipt to establish your claim timeline.',
        additionalTools: [
          { id: 'submission-method', title: 'Submission Method Guide' },
          { id: 'submission-confirmation-email', title: 'Submission Confirmation Email Template' },
          { id: 'followup-status-letter', title: 'Follow-Up Status Request Letter' },
          { id: 'download-submission-report', title: 'Download Submission Report' }
        ]
      },
      12: {
        label: 'STEP 12 OF 13',
        title: 'Submit your formal Proof of Loss statement with all supporting documentation',
        subtitle: 'Log and respond to insurance company requests with AI-guided analysis and response strategy.',
        primaryAction: {
          title: 'Log & Respond to Carrier Requests',
          description: 'Enter or upload carrier request details (email, letter, portal message). The AI automatically analyzes legitimacy, evaluates policy basis, assesses response scope, identifies overproduction risks, and generates a Carrier Response Analysis Report with recommended actions.',
          tool: { id: 'carrier-response', title: 'Carrier Request Response Engine', classification: 'required' }
        },
        reportSections: {
          title: 'Carrier Response Analysis Report',
          description: 'Analysis of carrier requests and response strategy',
          viewTool: { id: 'response-report-viewer', title: 'View Carrier Response Analysis Report', classification: 'required' },
          sections: [
            'Request Legitimacy Analysis',
            'Policy Basis Evaluation',
            'Response Scope Assessment',
            'Overproduction Risk Flags',
            'Recommended Response Strategy'
          ]
        },
        infoNote: 'Note: This step remains active throughout your claim. Log each new request individually for AI analysis and response guidance.',
        additionalTools: [
          { id: 'carrier-request-logger', title: 'Carrier Request Logger' },
          { id: 'deadline-response-tracker', title: 'Deadline & Response Tracker' },
          { id: 'response-letter-generator', title: 'Response Letter Generator' },
          { id: 'document-production-checklist', title: 'Document Production Checklist' }
        ]
      },
      13: {
        label: 'STEP 13 OF 13',
        title: 'Track payment status and follow up on any outstanding claim amounts',
        subtitle: 'Identify underpayments and valuation errors. Generate supplement justification for negotiation.',
        primaryAction: {
          title: 'Analyze Underpayments & Generate Supplement',
          description: 'Upload updated estimates, additional documentation, carrier payment summaries, and prior correspondence. The AI automatically imports prior reports from Steps 5, 8, 9, 10, and 12, compares carrier offers to documented loss, identifies underpayments, and generates a Supplement Strategy Report.',
          tool: { id: 'supplement-analysis', title: 'Supplement & Underpayment Analysis Engine', classification: 'required' }
        },
        reportSections: {
          title: 'Supplement Strategy Report',
          description: 'Analysis of underpayments and negotiation strategy',
          viewTool: { id: 'supplement-report-viewer', title: 'View Supplement Strategy Report', classification: 'required' },
          sections: [
            'Underpayment Summary',
            'Scope Omissions',
            'Valuation Discrepancies',
            'Negotiation Positions',
            'Escalation Triggers'
          ]
        },
        infoNote: 'Note: This step may be repeated as needed until your claim is fully and properly paid. Compare carrier offers against documented losses.',
        additionalTools: [
          { id: 'supplement-calculation-tool', title: 'Supplement Calculation Tool' },
          { id: 'negotiation-strategy-generator', title: 'Negotiation Strategy Generator' },
          { id: 'supplement-cover-letter-generator', title: 'Supplement Cover Letter Generator' },
          { id: 'escalation-readiness-checker', title: 'Escalation Readiness Checker' }
        ]
      }
    };

    let currentStep = 1;
    let completedSteps = [];
    let taskCompletion = {}; // Track which tasks are completed per step

    // Load saved state from storage
    function loadSavedState() {
      const state = getClaimData('claimNavigatorState');
      if (state) {
        currentStep = state.currentStep || 1;
        completedSteps = state.completedSteps || [];
        taskCompletion = state.taskCompletion || {};
        
        // Load claim info
        if (state.claimInfo) {
          document.getElementById('claimNumber').textContent = state.claimInfo.claimNumber || 'Not set';
          document.getElementById('dateOfLoss').textContent = state.claimInfo.dateOfLoss || 'Not set';
          document.getElementById('daysSinceLoss').textContent = state.claimInfo.daysSinceLoss || '0 days';
          document.getElementById('insurerName').textContent = state.claimInfo.insurerName || 'Not set';
          document.getElementById('adjusterName').textContent = state.claimInfo.adjusterName || 'Not set';
          document.getElementById('claimStatus').textContent = state.claimInfo.claimStatus || 'Not started';
        }
      }
    }

    // Save state to storage
    function saveState() {
      const state = {
        currentStep: currentStep,
        completedSteps: completedSteps,
        taskCompletion: taskCompletion,
        claimInfo: {
          claimNumber: document.getElementById('claimNumber').textContent,
          dateOfLoss: document.getElementById('dateOfLoss').textContent,
          daysSinceLoss: document.getElementById('daysSinceLoss').textContent,
          insurerName: document.getElementById('insurerName').textContent,
          adjusterName: document.getElementById('adjusterName').textContent,
          claimStatus: document.getElementById('claimStatus').textContent
        },
        lastSaved: new Date().toISOString()
      };
      saveClaimData('claimNavigatorState', state);
    }

    // Calculate real progress based on completed tasks
    function calculateProgress() {
      let totalTasks = 0;
      let completedTasks = 0;
      
      // Count all tasks across all steps
      Object.values(stepData).forEach(step => {
        totalTasks += step.tasks.length;
      });
      
      // Count completed tasks
      Object.values(taskCompletion).forEach(stepTasks => {
        completedTasks += stepTasks.filter(t => t).length;
      });
      
      return Math.round((completedTasks / totalTasks) * 100);
    }

    function navigateToStep(stepNum) {
      currentStep = stepNum;
      updateUI();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function saveProgress() {
      saveState();
      const timestamp = new Date().toLocaleTimeString();
      alert(`✅ Progress saved at ${timestamp}!\n\nAll your progress is automatically saved.`);
    }

    // Step 1 Enhanced Functions
    function toggleCompletion(element) {
      element.classList.toggle('checked');
      saveState();
      
      // Check if all items are checked to enable complete button
      const allChecked = document.querySelectorAll('.completion-item.checked').length === 
                         document.querySelectorAll('.completion-item').length;
      
      if (allChecked) {
        const completeBtn = document.querySelector('.btn-complete-step');
        if (completeBtn) {
          completeBtn.style.animation = 'pulse 1s ease-in-out';
        }
      }
    }

    function completeAndNext(stepNum) {
      // Mark step as complete
      if (!completedSteps.includes(stepNum)) {
        completedSteps.push(stepNum);
      }
      
      // Save state
      saveState();
      
      // Move to next step
      currentStep = stepNum + 1;
      
      // Close current step and open next
      const currentItem = document.querySelector(`.accordion-item[data-step="${stepNum}"]`);
      if (currentItem) {
        currentItem.classList.remove('active');
      }
      
      // Open next step
      openStep(stepNum + 1);
      
      // Scroll to top
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function editClaimInfo() {
      const claimNumber = prompt('Claim Number:', document.getElementById('claimNumber').textContent);
      if (claimNumber !== null) document.getElementById('claimNumber').textContent = claimNumber;
      
      const dateOfLoss = prompt('Date of Loss:', document.getElementById('dateOfLoss').textContent);
      if (dateOfLoss !== null) {
        document.getElementById('dateOfLoss').textContent = dateOfLoss;
        // Calculate days since loss
        const lossDate = new Date(dateOfLoss);
        const today = new Date();
        const daysDiff = Math.floor((today - lossDate) / (1000 * 60 * 60 * 24));
        document.getElementById('daysSinceLoss').textContent = daysDiff + ' days';
      }
      
      const insurerName = prompt('Insurance Company:', document.getElementById('insurerName').textContent);
      if (insurerName !== null) document.getElementById('insurerName').textContent = insurerName;
      
      const adjusterName = prompt('Adjuster Name:', document.getElementById('adjusterName').textContent);
      if (adjusterName !== null) document.getElementById('adjusterName').textContent = adjusterName;
      
      const claimStatus = prompt('Claim Status:', document.getElementById('claimStatus').textContent);
      if (claimStatus !== null) document.getElementById('claimStatus').textContent = claimStatus;
      
      saveState();
    }

    function showExample(docName) {
      // Map document names to examples
      const exampleMap = {
        'Complete Insurance Policy (Declarations + Full Contract)': 'policy',
        'All Policy Endorsements & Riders': 'endorsements',
        'Premium Payment Records': 'payments',
        'Prior Claim History (if applicable)': 'history'
      };
      
      const examples = {
        'policy': 'This would show a sample insurance policy declarations page with coverage amounts, deductibles, and named insured information.',
        'endorsements': 'This would show what endorsements/riders look like - extra pages that modify your base policy coverage.',
        'payments': 'This would show a sample payment history statement showing your premium payments.',
        'history': 'This would show a sample prior claims history document (CLUE report or similar).',
        'default': 'Sample document example would be displayed here. In production, this would show an actual annotated example with explanations of each section.'
      };
      
      const key = exampleMap[docName] || 'default';
      alert('📄 EXAMPLE DOCUMENT\n\n' + examples[key]);
    }

    function toggleProblems(header) {
      const content = header.nextElementSibling;
      const isOpen = content.style.display === 'block';
      
      content.style.display = isOpen ? 'none' : 'block';
      header.classList.toggle('open');
    }

    function toggleSection(sectionId) {
      const section = document.getElementById(sectionId);
      if (section) {
        section.classList.toggle('expanded');
      }
    }

    // Get tool file path from tool ID
    function getToolPath(toolId) {
      // Comprehensive tool ID to file path mapping
      const toolMapping = {
        // Step 1 - Policy Review (Updated to use comprehensive analyzer)
        'policy-uploader': 'app/tools/policy-analyzer-complete.html',
        'policy-intelligence-engine': 'app/tools/policy-analyzer-complete.html',
        'policy-report-viewer': 'app/tools/policy-analyzer-complete.html',
        'coverage-qa-chat': 'app/tools/coverage-qa-chat.html',
        'coverage-clarification-letter': 'app/tools/coverage-clarification-letter.html',
        'policy-interpretation-letter': 'app/tools/policy-interpretation-letter.html',
        'download-policy-report': 'app/tools/download-policy-report.html',
        
        // Step 2 - Compliance
        'compliance-review': 'app/tools/compliance-review.html',
        'compliance-report-viewer': 'app/tools/compliance-report-viewer.html',
        'compliance-auto-import': 'app/tools/compliance-auto-import.html',
        'deadline-calculator': 'app/tools/deadline-calculator.html',
        'mitigation-documentation-tool': 'app/tools/mitigation-documentation-tool.html',
        'proof-of-loss-tracker': 'app/tools/proof-of-loss-tracker.html',
        'euo-sworn-statement-guide': 'app/tools/euo-sworn-statement-guide.html',
        
        // Step 3 - FNOL
        'fnol-generator': 'app/document-library/first-notice-of-loss.html',
        'fnol-email-generator': 'app/document-library/first-notice-of-loss.html',
        'loss-report-viewer': 'app/claim-journal.html',
        'loss-description-assistant': 'app/tools/first-notice-of-loss.html',
        'adjuster-contact-log': 'app/tools/carrier-request-logger.html',
        'fnol-follow-up-tracker': 'app/tools/deadline-response-tracker.html',
        
        // Step 4 - Damage Documentation
        'damage-documentation': 'app/tools/damage-documentation-tool.html',
        'damage-documentation-tool': 'app/tools/damage-documentation-tool.html',
        'damage-report-viewer': 'app/tools/damage-report-viewer.html',
        'damage-report-engine': 'app/tools/damage-report-engine.html',
        'photo-upload-organizer': 'app/tools/photo-upload-organizer.html',
        'damage-labeling-tool': 'app/tools/damage-labeling-tool.html',
        'room-by-room-prompt-tool': 'app/tools/room-by-room-prompt-tool.html',
        'missing-evidence-identifier': 'app/tools/missing-evidence-identifier.html',
        
        // Step 5 - Estimate Review
        'estimate-review': 'app/tools/estimate-review.html',
        'estimate-review-tool': 'app/tools/estimate-review.html',
        'estimate-quality-viewer': 'app/tools/estimate-review.html',
        'contractor-scope-checklist': 'app/tools/contractor-scope-checklist.html',
        'missing-trade-detector': 'app/tools/missing-trade-detector.html',
        'code-upgrade-identifier': 'app/tools/code-upgrade-identifier.html',
        'scope-omission-detector': 'app/tools/scope-omission-detector.html',
        
        // Step 6 - Estimate Comparison
        'estimate-comparison': 'app/tools/estimate-comparison.html',
        'estimate-comparison-viewer': 'app/tools/estimate-comparison.html',
        'line-item-discrepancy-finder': 'app/tools/line-item-discrepancy-finder.html',
        'pricing-deviation-analyzer': 'app/tools/pricing-deviation-analyzer.html',
        'estimate-revision-request-generator': 'app/tools/estimate-revision-request-generator.html',
        
        // Step 7 - Coverage Alignment
        'coverage-alignment': 'app/tools/coverage-alignment.html',
        'alignment-report-viewer': 'app/tools/coverage-alignment.html',
        'coverage-mapping-visualizer': 'app/tools/coverage-mapping-visualizer.html',
        'sublimit-impact-analyzer': 'app/tools/sublimit-impact-analyzer.html',
        'coverage-gap-detector': 'app/tools/coverage-gap-detector.html',
        'category-coverage-checker': 'app/tools/category-coverage-checker.html',
        
        // Step 8 - ALE Tracking
        'ale-tracker': 'app/tools/ale-tracker.html',
        'ale-report-viewer': 'app/tools/ale-tracker.html',
        'ale-eligibility-checker': 'app/tools/ale-eligibility-checker.html',
        'temporary-housing-documentation-helper': 'app/tools/temporary-housing-documentation-helper.html',
        'expense-upload-tool': 'app/tools/expense-upload-tool.html',
        'remaining-ale-limit-calculator': 'app/tools/remaining-ale-limit-calculator.html',
        
        // Step 9 - Contents Inventory
        'contents-inventory': 'app/tools/contents-inventory.html',
        'inventory-report-viewer': 'app/tools/contents-inventory.html',
        'contents-documentation-helper': 'app/tools/contents-documentation-helper.html',
        'comparable-item-finder': 'app/tools/comparable-item-finder.html',
        
        // Step 10 - Contents Valuation
        'contents-valuation': 'app/tools/contents-valuation.html',
        'valuation-report-viewer': 'app/tools/contents-valuation.html',
        'depreciation-calculator': 'app/tools/depreciation-calculator.html',
        'replacement-cost-justification-tool': 'app/tools/replacement-cost-justification-tool.html',
        
        // Step 11 - Claim Package Assembly
        'claim-package-assembly': 'app/tools/claim-package-assembly.html',
        'readiness-report-viewer': 'app/tools/claim-package-assembly.html',
        'missing-document-identifier': 'app/tools/missing-document-identifier.html',
        'document-production-checklist': 'app/tools/document-production-checklist.html',
        'pre-submission-risk-review-tool': 'app/tools/pre-submission-risk-review-tool.html',
        
        // Step 12 - Claim Submission
        'claim-submitter': 'app/tools/claim-submitter.html',
        'submission-report-viewer': 'app/tools/submission-report-engine.html',
        'submission-method': 'app/tools/submission-method.html',
        'submission-checklist-generator': 'app/tools/submission-checklist-generator.html',
        'carrier-submission-cover-letter-generator': 'app/tools/carrier-submission-cover-letter-generator.html',
        'submission-confirmation-email': 'app/tools/submission-confirmation-email.html',
        'submission-report-engine': 'app/tools/submission-report-engine.html',
        'download-submission-report': 'app/tools/download-submission-report.html',
        
        // Step 13 - Carrier Response
        'carrier-response': 'app/tools/carrier-response.html',
        'response-report-viewer': 'app/tools/carrier-response.html',
        'carrier-request-logger': 'app/tools/carrier-request-logger.html',
        'response-letter-generator': 'app/tools/response-letter-generator.html',
        'escalation-readiness-checker': 'app/tools/escalation-readiness-checker.html',
        
        // Step 14 - Supplement Analysis
        'supplement-analysis': 'app/tools/supplement-analysis.html',
        'supplement-report-viewer': 'app/tools/supplement-analysis.html',
        'supplement-calculation-tool': 'app/tools/supplement-calculation-tool.html',
        'supplement-cover-letter-generator': 'app/tools/supplement-cover-letter-generator.html',
        'negotiation-strategy-generator': 'app/tools/negotiation-strategy-generator.html',
        'negotiation-language-generator': 'app/tools/negotiation-language-generator.html',
        
        // Acknowledgment tools (stay on page)
        'step1-acknowledgment': 'acknowledgment',
        'step2-acknowledgment': 'acknowledgment',
        'step3-acknowledgment': 'acknowledgment',
        'step11-acknowledgment': 'acknowledgment',
        'step11-next-moves': 'acknowledgment',
        
        // Additional tools
        'expert-opinion': 'app/tools/expert-opinion.html',
        'acknowledgment-status-view': 'app/tools/acknowledgment-status-view.html',
        'followup-schedule-view': 'app/tools/followup-schedule-view.html',
        'followup-status-letter': 'app/tools/followup-status-letter.html',
        'method-timestamp-view': 'app/tools/method-timestamp-view.html',
        'endorsement-opportunity-identifier': 'app/tools/endorsement-opportunity-identifier.html'
      };
      
      return toolMapping[toolId] || '#';
    }
    
    // Acknowledge step completion
    function acknowledgeStep(stepNum) {
      // Check if primary tool output exists
      const hasPrimaryOutput = hasPrimaryToolOutput(stepNum);
      
      if (!hasPrimaryOutput && stepNum !== 11) {
        alert(`⚠️ Cannot acknowledge Step ${stepNum}\n\nYou must complete the primary tool and generate a report before acknowledging this step.`);
        return;
      }
      
      // Mark step as acknowledged
      if (!taskCompletion[stepNum]) {
        taskCompletion[stepNum] = [];
      }
      
      // Mark all tasks as complete
      const step = stepData[stepNum];
      if (step && step.tasks) {
        taskCompletion[stepNum] = step.tasks.map(() => true);
      }
      
      // Add to completed steps
      if (!completedSteps.includes(stepNum)) {
        completedSteps.push(stepNum);
      }
      
      // SB-3: Log step completion to timeline
      (async () => {
        try {
          const { addTimelineEvent } = await import('./app/assets/js/utils/timeline-autosync.js');
          await addTimelineEvent({
            type: 'step_completed',
            date: new Date().toISOString().split('T')[0],
            source: 'step-guide',
            title: `Step ${stepNum} Completed`,
            description: step.title || `Completed step ${stepNum}`,
            metadata: {
              step_id: stepNum,
              step_name: step.title,
              actor: 'user'
            }
          });
        } catch (error) {
          console.warn('Failed to log step completion:', error);
        }
      })();
      
      // Save state
      saveState();
      
      // Update UI
      updateUI();
      updateProgressIndicator();
      
      // Show confirmation
      alert(`✅ Step ${stepNum} Acknowledged!\n\nYou can now proceed to Step ${stepNum + 1}.`);
      
      // Auto-open next step if not on Step 13
      if (stepNum < 13) {
        setTimeout(() => {
          openStep(stepNum + 1);
        }, 500);
      }
    }
    
    // Get stored tool output
    function getToolOutput(stepNum, toolId) {
      const key = `claim_step_${stepNum}_${toolId}_output`;
      return getClaimData(key);
    }
    
    // Save tool output
    function saveToolOutput(stepNum, toolId, output) {
      const key = `claim_step_${stepNum}_${toolId}_output`;
      saveClaimData(key, output);
    }
    
    // Check if primary tool output exists
    function hasPrimaryToolOutput(stepNum) {
      const step = stepData[stepNum];
      if (!step || !step.tasks) return false;
      
      // Define primary tools by step
      const primaryToolIds = {
        1: 'policy-intelligence-engine',
        2: 'compliance-review',
        3: 'damage-documentation',
        4: 'estimate-review',
        5: 'estimate-comparison',
        6: 'ale-tracker',
        7: 'contents-inventory',
        8: 'contents-valuation',
        9: 'coverage-alignment',
        10: 'claim-package-assembly',
        12: 'carrier-response',
        13: 'supplement-analysis'
      };
      
      const primaryToolId = primaryToolIds[stepNum];
      if (!primaryToolId) return false;
      
      const output = getToolOutput(stepNum, primaryToolId);
      return output !== null;
    }
    
    // Render tool outputs in step
    function renderToolOutputs(stepNum, contentElement) {
      const step = stepData[stepNum];
      if (!step) return;
      
      let outputsHtml = '';
      
      // Check for primary report
      const primaryToolId = getPrimaryToolId(stepNum);
      
      if (primaryToolId) {
        const output = getToolOutput(stepNum, primaryToolId);
        if (output) {
          const reportName = getReportName(stepNum);
          outputsHtml += `
            <div id="primary-report-${stepNum}" style="background: #f0fdf4; border: 2px solid #86efac; border-radius: 8px; padding: 16px; margin: 20px 0;">
              <div style="font-size: 14px; font-weight: 700; color: #166534; margin-bottom: 8px;">
                ✅ Primary Step Report Generated
              </div>
              <div style="font-size: 13px; color: #166534; margin-bottom: 12px;">
                ${output.summary || 'Report completed successfully.'}
              </div>
              <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                <button onclick="openTool('${primaryToolId}', ${stepNum})" style="padding: 8px 16px; background: #22c55e; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: 600;">
                  View Full Report →
                </button>
                <button onclick="exportReportPDF(${stepNum})" style="padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: 600;">
                  📥 Download PDF
                </button>
                <button onclick="exportReportDOC(${stepNum})" style="padding: 8px 16px; background: #8b5cf6; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: 600;">
                  📄 Download DOC
                </button>
              </div>
            </div>
          `;
        }
      }
      
      // Check for supporting tool outputs
      const supportingOutputs = [];
      if (step.additionalTools) {
        step.additionalTools.forEach(tool => {
          const output = getToolOutput(stepNum, tool.id);
          if (output) {
            supportingOutputs.push({
              title: tool.title,
              id: tool.id,
              output: output
            });
          }
        });
      }
      
      if (supportingOutputs.length > 0) {
        outputsHtml += `
          <div style="background: #eff6ff; border: 1px solid #bfdbfe; border-radius: 8px; padding: 16px; margin: 20px 0;">
            <div style="font-size: 13px; font-weight: 700; color: #1e40af; margin-bottom: 12px;">
              Supporting Tool Outputs
            </div>
        `;
        
        supportingOutputs.forEach(item => {
          outputsHtml += `
            <div style="background: white; border: 1px solid #bfdbfe; border-radius: 6px; padding: 12px; margin-bottom: 8px;">
              <div style="font-size: 12px; font-weight: 600; color: #1e3a5f; margin-bottom: 4px;">
                ${item.title}
              </div>
              <div style="font-size: 11px; color: #64748b;">
                ${item.output.summary || 'Completed'}
              </div>
              <button onclick="openTool('${item.id}', ${stepNum})" style="margin-top: 6px; padding: 6px 12px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: 600;">
                View →
              </button>
            </div>
          `;
        });
        
        outputsHtml += `</div>`;
      }
      
      if (outputsHtml) {
        const existingOutputs = contentElement.querySelector('.tool-outputs-container');
        if (existingOutputs) {
          existingOutputs.innerHTML = outputsHtml;
        } else {
          const container = document.createElement('div');
          container.className = 'tool-outputs-container';
          container.innerHTML = outputsHtml;
          contentElement.insertBefore(container, contentElement.firstChild);
        }
      }
    }

    function updateProgressIndicator() {
      const stageEl = document.querySelector('.progress-stage');
      if (stageEl) {
        stageEl.textContent = `Step ${currentStep} of 14`;
      }
      
      // Update quiet progress bar
      const quietProgressText = document.getElementById('quietProgressText');
      const quietProgressFill = document.getElementById('quietProgressFill');
      if (quietProgressText) {
        quietProgressText.textContent = `Step ${currentStep} of 14`;
      }
      if (quietProgressFill) {
        const progressPercent = (currentStep / 14) * 100;
        quietProgressFill.style.width = `${progressPercent}%`;
      }
    }

    // Helper function to load step content without toggling
    function loadStepContent(stepNum) {
      const selectedItem = document.querySelector(`.accordion-item[data-step="${stepNum}"]`);
      if (!selectedItem) {
        console.warn('Could not find item for step:', stepNum);
        return;
      }
      
      const content = selectedItem.querySelector('.accordion-content');
      if (!content) {
        console.warn('Could not find content element for step:', stepNum);
        return;
      }
      
      // Check if content already loaded (skip if it has substantial content)
      const currentContent = content.innerHTML.trim();
      if (currentContent && 
          !currentContent.includes('Content will be inserted') &&
          currentContent.length > 100) {
        console.log('Content already loaded for step:', stepNum);
        return;
      }
      
      console.log('Loading content for step:', stepNum);
      buildStepContent(stepNum, content);
    }

    function openStep(stepNum) {
      console.log('Toggling step:', stepNum);
      
      // Get selected item
      const selectedItem = document.querySelector(`.accordion-item[data-step="${stepNum}"]`);
      if (!selectedItem) {
        console.error('Could not find accordion item for step:', stepNum);
        return;
      }
      
      // Check if already active
      const isActive = selectedItem.classList.contains('active');
      
      // Toggle the selected item (don't close others - allow multiple open)
      if (isActive) {
        // Close this item
        selectedItem.classList.remove('active');
        console.log('Step closed:', stepNum);
        return;
      }
      
      // Open this item
      selectedItem.classList.add('active');
      console.log('Step opened:', stepNum);
      
      // Load content if not already loaded
      loadStepContent(stepNum);
      
      // Update current step
      currentStep = stepNum;
    }

    // Build step content HTML
    function buildStepContent(stepNum, content) {
      const data = stepData[stepNum];
      if (!data) {
        console.error('No data found for step:', stepNum);
        return;
      }
      
      // Build content HTML
      let html = '';
      
      // CHECK FOR CUSTOM CONTENT FIRST
      if (data.customContent && data.htmlContent) {
        html = data.htmlContent;
        content.innerHTML = html;
        console.log('Step content loaded successfully (custom content)');
        return;
      }
      
      // ALL STEPS now use the unified structure
      if (data.primaryAction) {
        // Step 7 Critical Warning (if applicable)
        if (data.isCritical) {
          html += `
            <div class="step-critical-warning">
              This is where most claims lose money if handled incorrectly.
            </div>
          `;
        }
        
        // Primary action - upload and analyze
        html += `
          <div class="primary-action-container">
            <h3 class="primary-action-title">${data.primaryAction.title}</h3>
            <p class="primary-action-description">${data.primaryAction.description}</p>
        `;
        
        if (data.primaryAction.tool) {
          const classification = data.primaryAction.tool.classification || 'required';
          const toolPath = getToolPath(data.primaryAction.tool.id);
          html += `
            <a href="${toolPath}" class="task-tool-inline">
              <span class="task-tool-arrow">→</span>
              <span class="task-tool-label">Use:</span>
              <span class="task-tool-title">${data.primaryAction.tool.title}</span>
              <span class="task-tool-classification ${classification}">${classification}</span>
            </a>
          `;
        }
        
        html += '</div>';
        
        // Report Sections
        if (data.reportSections) {
          html += `
            <div class="report-sections-container">
              <h3 class="report-sections-title">${data.reportSections.title}</h3>
              <p class="report-sections-description">${data.reportSections.description}</p>
          `;
          
          if (data.reportSections.viewTool) {
            const classification = data.reportSections.viewTool.classification || 'required';
            html += `
              <a href="${getToolPath(data.reportSections.viewTool.id)}" class="task-tool-inline">
                <span class="task-tool-arrow">→</span>
                <span class="task-tool-label">View:</span>
                <span class="task-tool-title">${data.reportSections.viewTool.title}</span>
                <span class="task-tool-classification ${classification}">${classification}</span>
              </a>
            `;
          }
          
          // Report sections list
          html += '<div class="report-sections-list"><strong>Report Sections:</strong><ul>';
          data.reportSections.sections.forEach(section => {
            html += `<li>${section}</li>`;
          });
          html += '</ul></div>';
          
          html += '</div>';
        }
        
        // Informational note at bottom
        if (data.infoNote) {
          html += `
            <div class="step-info-note">
              <span class="step-info-note-icon">ℹ️</span>${data.infoNote}
            </div>
          `;
        }
      }
      // LEGACY FORMAT (should not be used anymore)
      else if (data.beforeYouContinue) {
        // Before You Continue block
        html += `
          <div class="before-you-continue">
            <div class="before-you-continue-title">Before You Continue</div>
            <ul class="before-you-continue-list">
              <li class="before-you-continue-item"><strong>If skipped:</strong> ${data.beforeYouContinue.ifSkipped}</li>
              <li class="before-you-continue-item"><strong>Prevents:</strong> ${data.beforeYouContinue.prevents}</li>
              <li class="before-you-continue-item"><strong>Do not:</strong> ${data.beforeYouContinue.doNot}</li>
            </ul>
          </div>
        `;
        
        // Tasks intro
        if (data.tasksIntro) {
          html += `<div class="tasks-intro">${data.tasksIntro}</div>`;
        }
        
        // Step 7 Critical Warning
        if (data.isCritical) {
          html += `
            <div class="step-critical-warning">
              This is where most claims lose money if handled incorrectly.
            </div>
          `;
        }
        
        // Minimum Proof Check
        if (data.minProofRequired) {
          const proofMet = checkMinProofRequirement(stepNum, data.minProofRequired);
          if (!proofMet) {
            html += `
              <div class="guardrail-warning">
                <strong>🔒 Proof Required:</strong>
                ${data.minProofRequired.message}
              </div>
            `;
          }
        }
        
        // HIERARCHY FIX: Section anchor for tasks
        html += '<div class="section-anchor-tasks">What you need to do now</div>';
        
        // Sequential task list with inline tools
        html += '<ul class="task-list-sequential">';
        data.tasks.forEach((task, index) => {
          html += `
            <li class="task-item-sequential">
              <div class="task-header-sequential">
                <div class="task-number">${index + 1}</div>
                <div class="task-title-sequential">${task.title}</div>
              </div>
              <div class="task-description-sequential">${task.description}</div>
          `;
          
          // Inline tool if present
          if (task.tool) {
            const classification = task.tool.classification || 'optional';
            html += `
              <a href="${getToolPath(task.tool.id)}" class="task-tool-inline">
                <span class="task-tool-arrow">→</span>
                <span class="task-tool-label">Use:</span>
                <span class="task-tool-title">${task.tool.title}</span>
                <span class="task-tool-classification ${classification}">${classification}</span>
              </a>
            `;
          }
          
          html += '</li>';
        });
        html += '</ul>';
        
        // HIERARCHY FIX: Section anchor for tools
        // Additional Tools section
        if (data.additionalTools && data.additionalTools.length > 0) {
          html += '<div class="section-anchor-tools">Tools that help with this step</div>';
          html += `
            <div class="additional-tools-section">
              <div class="additional-tools-title">Additional Tools (Optional)</div>
              <ul class="additional-tools-list">
          `;
          data.additionalTools.forEach(tool => {
            html += `
              <li class="additional-tool-item">
                <a href="${getToolPath(tool.id)}" style="display: flex; align-items: center; gap: 8px; text-decoration: none; color: inherit;">
                  <span class="additional-tool-arrow">→</span>
                  <span class="additional-tool-title">${tool.title}</span>
                </a>
              </li>
            `;
          });
          html += `
              </ul>
            </div>
          `;
        }
        
        // Step 1 Policy Flags: Coinsurance Warning
        if (stepNum === 1 && data.policyFlags && data.policyFlags.coinsurance && data.policyFlags.coinsurance.detected) {
          const coinsurance = data.policyFlags.coinsurance;
          html += `
            <div class="coinsurance-warning">
              <div class="coinsurance-title">⚠️ Coinsurance Requirement Detected</div>
              <div class="coinsurance-content">
                Your policy requires coverage of at least <span class="coinsurance-requirement">${coinsurance.requirement}</span> of replacement cost. ${coinsurance.explanation}
              </div>
            </div>
          `;
        }
        
        // Step 1 Policy Flags: Policyholder Duties
        if (stepNum === 1 && data.policyFlags && data.policyFlags.policyholderDuties && data.policyFlags.policyholderDuties.length > 0) {
          html += `
            <div class="policyholder-duties">
              <div class="duties-title">📋 Your Policy Duties After a Loss</div>
              <ul class="duties-list">
          `;
          data.policyFlags.policyholderDuties.forEach(duty => {
            html += `
              <li class="duty-item">
                <div class="duty-icon">✓</div>
                <div class="duty-content">
                  <div class="duty-text">${duty.duty}</div>
                  <div class="duty-meta">
                    <span class="duty-deadline">⏱️ ${duty.deadline}</span>
                    <span>•</span>
                    <a class="duty-link" onclick="navigateToStep(${duty.linkedStep})">→ Go to Step ${duty.linkedStep}</a>
                  </div>
                </div>
              </li>
            `;
          });
          html += `
              </ul>
            </div>
          `;
        }
        
        // Expert Guidance (Steps 4 & 5)
        if ((stepNum === 4 || stepNum === 5) && data.expertGuidance && data.expertGuidance.show) {
          const guidance = data.expertGuidance;
          html += `
            <div class="expert-guidance">
              <div class="expert-guidance-title">💡 ${guidance.title}</div>
              <div class="expert-conditions">
                <ul>
          `;
          guidance.conditions.forEach(condition => {
            html += `<li>${condition}</li>`;
          });
          html += `
                </ul>
              </div>
              <div class="expert-types">
                <div class="expert-types-title">Common Experts</div>
                <div class="expert-type-list">
          `;
          guidance.experts.forEach(expert => {
            html += `
              <div class="expert-type-item">
                <span class="expert-type-name">${expert.type}</span>
                <span class="expert-type-when">${expert.when}</span>
              </div>
            `;
          });
          html += `
                </div>
              </div>
            </div>
          `;
        }
        
        // Mitigation Guidance (Step 2)
        if (stepNum === 2 && data.mitigationGuidance && data.mitigationGuidance.show) {
          const mitigation = data.mitigationGuidance;
          html += `
            <div class="mitigation-guidance">
              <div class="mitigation-guidance-title">🚨 ${mitigation.title}</div>
              <div class="mitigation-explanation">${mitigation.explanation}</div>
              
              <div class="mitigation-section">
                <div class="mitigation-section-title">Immediate Actions Required</div>
                <ul>
          `;
          mitigation.immediateActions.forEach(action => {
            html += `<li>${action}</li>`;
          });
          html += `
                </ul>
              </div>
              
              <div class="mitigation-section">
                <div class="mitigation-section-title">What to Document</div>
                <ul>
          `;
          mitigation.documentationRequired.forEach(doc => {
            html += `<li>${doc}</li>`;
          });
          html += `
                </ul>
              </div>
              
              <div class="mitigation-reimbursement">
                💰 ${mitigation.reimbursement}
              </div>
            </div>
          `;
        }
        
        // Mitigation Capture (Step 3)
        if (stepNum === 3 && data.mitigationCapture && data.mitigationCapture.show) {
          const capture = data.mitigationCapture;
          html += `
            <div class="mitigation-capture">
              <div class="mitigation-capture-title">📋 ${capture.title}</div>
              <div class="mitigation-instructions">${capture.instructions}</div>
              
              <div class="mitigation-upload-types">
          `;
          capture.uploadTypes.forEach(upload => {
            html += `
              <div class="mitigation-upload-item">
                <div class="mitigation-upload-type">${upload.type}</div>
                <div class="mitigation-upload-desc">${upload.description}</div>
              </div>
            `;
          });
          html += `
              </div>
              
              <div class="mitigation-flow-note">
                ✓ ${capture.willFlowTo}
              </div>
            </div>
          `;
        }
      }
      
      // Step Reassurance (before actions)
      const stepReassurance = {
        1: "If you've completed this step, you understand your coverage and are ready to proceed.",
        2: "Most claim issues originate when compliance requirements are missed.",
        3: "Timely notice protects your claim rights.",
        4: "Proper documentation is the foundation of every successful claim.",
        5: "A complete contractor estimate establishes the true cost of repairs.",
        6: "Identifying estimate discrepancies early prevents underpayment.",
        7: "This step ensures all documented losses are properly applied to available coverage.",
        8: "ALE tracking remains active throughout your claim.",
        9: "Insurance companies only pay for items that are properly listed and documented.",
        10: "Accurate valuation ensures proper contents reimbursement.",
        11: "A complete, well-organized package strengthens your claim.",
        12: "Document your submission method to establish your claim timeline.",
        13: "This step remains active throughout your claim.",
        14: "This step may be repeated as needed until your claim is fully paid."
      };
      
      if (stepReassurance[stepNum]) {
        html += `
          <div style="background: #eff6ff; border-left: 3px solid #3b82f6; padding: 12px 16px; margin: 20px 0; font-size: 0.875rem; color: #1e40af;">
            ${stepReassurance[stepNum]}
          </div>
        `;
      }
      
      // Actions (for all steps)
      html += `
        <div class="step-actions">
          <button class="btn btn-primary" onclick="completeAndNext(${stepNum})">
            ${stepNum === 10 ? '✅ Complete Claim' : 'Mark Complete & Continue →'}
          </button>
        </div>
      `;
      
      // HIERARCHY FIX: Quiet next step preview (only for steps 1-9)
      if (stepNum < 10) {
        const nextStep = stepData[stepNum + 1];
        if (nextStep) {
          html += `
            <div class="next-step-preview">
              <div class="next-step-preview-label">Next Step</div>
              <div class="next-step-preview-title">${nextStep.title}</div>
            </div>
          `;
        }
      }
      
      content.innerHTML = html;
      
      console.log('Step content loaded successfully');
      
      // Render tool outputs
      renderToolOutputs(stepNum, content);
      
      // Save state
      saveState();
      
      // Scroll to accordion item
      setTimeout(() => {
        selectedItem.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }, 100);
    }

    function toggleTask(stepNum, taskIndex, checkbox) {
      checkbox.classList.toggle('checked');
      
      if (!taskCompletion[stepNum]) {
        taskCompletion[stepNum] = [];
      }
      
      taskCompletion[stepNum][taskIndex] = checkbox.classList.contains('checked');
      saveState();
      updateProgressIndicator();
    }

    function completeAndNext(stepNum) {
      // Check if primary tool output exists
      if (!hasPrimaryToolOutput(stepNum)) {
        alert('⚠️ Cannot proceed: Primary step report required.\n\nYou must complete the primary tool for this step before proceeding.');
        return;
      }
      
      // Show disclaimer modal before completing step
      if (window.CNDisclaimer) {
        window.CNDisclaimer.showModal(function() {
          // Proceed with completion after acknowledgment
          proceedWithStepCompletion(stepNum);
        });
      } else {
        // Fallback if disclaimer not loaded
        proceedWithStepCompletion(stepNum);
      }
    }
    
    function proceedWithStepCompletion(stepNum) {
      // Mark step as completed
      if (!completedSteps.includes(stepNum)) {
        completedSteps.push(stepNum);
      }
      
      // SB-3: Log step completion to timeline
      (async () => {
        try {
          const step = stepData[stepNum];
          const { addTimelineEvent } = await import('./app/assets/js/utils/timeline-autosync.js');
          await addTimelineEvent({
            type: 'step_completed',
            date: new Date().toISOString().split('T')[0],
            source: 'step-guide',
            title: `Step ${stepNum} Completed`,
            description: step.title || `Completed step ${stepNum}`,
            metadata: {
              step_id: stepNum,
              step_name: step.title,
              actor: 'user'
            }
          });
        } catch (error) {
          console.warn('Failed to log step completion:', error);
        }
      })();
      
      // Update visual state
      const item = document.querySelector(`.accordion-item[data-step="${stepNum}"]`);
      item.classList.add('completed');
      
      // Update readiness status
      updateReadinessStatus();
      
      // Update financial summary
      updateFinancialSummary();
      
      // Open next step or show completion
      if (stepNum < 13) {
        openStep(stepNum + 1);
      } else {
        // Show post-claim asset section
        const postClaimSection = document.getElementById('postClaimSection');
        if (postClaimSection) {
          postClaimSection.style.display = 'block';
          
          // Add disclaimer to completion screen
          if (window.CNDisclaimer) {
            setTimeout(() => {
              window.CNDisclaimer.addToCompletion('postClaimSection');
            }, 100);
          }
          
          setTimeout(() => {
            postClaimSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }, 300);
        }
        alert('🎉 Congratulations! You have completed your entire claim process. Your claim archive is now available below.');
      }
      
      saveState();
    }

    function navigateToStep(stepNum) {
      openStep(stepNum);
    }

    function previousStep() {
      if (currentStep > 1) {
        openStep(currentStep - 1);
      }
    }

    // Check if minimum proof requirement is met
    function checkMinProofRequirement(stepNum, requirement) {
      // This is a placeholder - in production, this would check actual uploads
      // For now, return true to not block progression in demo
      return true;
      
      // Example implementation:
      // if (requirement.type === 'photos') {
      //   const uploadedPhotos = getUploadedPhotos(stepNum);
      //   return uploadedPhotos.length >= requirement.count;
      // }
      // return true;
    }

    // Update Claim Readiness Status Indicator
    function updateReadinessStatus() {
      const icon = document.getElementById('readinessIcon');
      const status = document.getElementById('readinessStatus');
      
      if (!icon || !status) return;
      
      // Define critical steps for readiness
      const criticalSteps = [3, 5, 6]; // Photos, Estimate, Proof of Loss
      const criticalCompleted = criticalSteps.filter(s => completedSteps.includes(s)).length;
      
      if (criticalCompleted === 0) {
        // Not Ready
        icon.textContent = '⚠️';
        status.textContent = 'Not Ready';
      } else if (criticalCompleted < criticalSteps.length) {
        // Partially Ready
        icon.textContent = '⚙️';
        status.textContent = 'Partial';
      } else {
        // Ready to Submit
        icon.textContent = '✅';
        status.textContent = 'Ready';
      }
    }

    // Claim Financial Summary Calculation and Update
    function calculateFinancialSummary() {
      // This is a simulated calculation based on step completion
      // In production, this would pull from actual uploaded data and analysis results
      
      const financialData = {
        // Default values
        structure: 0,
        contents: 0,
        ale: 0,
        mitigationCosts: 0, // Emergency mitigation expenses
        deductible: 1000, // Default deductible
        depreciation: 0,
        
        // Policy data (Step 1)
        dwellingLimit: 250000,
        contentsLimit: 100000,
        aleLimit: 50000,
        coinsuranceRequirement: 0.80, // 80% requirement
        replacementCost: 300000, // Actual replacement cost
        insuredAmount: 250000, // Amount of insurance
        
        // Documentation status
        docStatus: 'incomplete',
        submissionStatus: 'not submitted',
        negotiationStatus: 'inactive',
        depreciationStatus: 'pending',
        
        // Estimates (Step 5)
        contractorEstimate: 0,
        insurerEstimate: 0,
        
        // Proof of Loss (Step 6)
        submittedAmount: 0,
        
        // Negotiation (Steps 7-9)
        carrierOffer: 0,
        counterDemand: 0,
        
        // Payments (Steps 9-10)
        paymentsReceived: 0,
        lastPaymentDate: null
      };
      
      // Derive values based on completed steps
      if (completedSteps.includes(1)) {
        // Step 1 completed: Policy analyzed
        // Use default policy limits set above
      }
      
      if (completedSteps.includes(2) || completedSteps.includes(3)) {
        // Steps 2-3: Mitigation costs documented
        // Simulate emergency mitigation expenses (tarps, water extraction, board-up, etc.)
        financialData.mitigationCosts = 2500;
      }
      
      if (completedSteps.includes(3)) {
        // Step 3 completed: Damage documented
        // Simulate documented damage values
        financialData.structure = 45000;
        financialData.contents = 15000;
        financialData.ale = 5000;
        financialData.docStatus = 'preliminary';
      }
      
      if (completedSteps.includes(5)) {
        // Step 5 completed: Estimates compared
        financialData.contractorEstimate = 58000;
        financialData.insurerEstimate = 42000;
        // Use contractor estimate as documented value
        financialData.structure = 48000;
        financialData.contents = 10000;
        financialData.docStatus = 'complete';
      }
      
      if (completedSteps.includes(6)) {
        // Step 6 completed: Proof of Loss filed
        financialData.submittedAmount = financialData.structure + financialData.contents + financialData.ale;
        financialData.submissionStatus = 'submitted';
      }
      
      if (completedSteps.includes(7) || completedSteps.includes(8)) {
        // Steps 7-8: Negotiation active
        financialData.negotiationStatus = 'active';
        financialData.carrierOffer = 42000;
        financialData.counterDemand = 58000;
      }
      
      if (completedSteps.includes(9)) {
        // Step 9: Settlement accepted, initial payment received
        financialData.paymentsReceived = 49000; // Initial payment (net after deductible, less depreciation)
        financialData.lastPaymentDate = new Date('2024-12-15');
      }
      
      if (completedSteps.includes(10)) {
        // Step 10 completed: Depreciation tracked
        financialData.depreciation = 8000;
        financialData.depreciationStatus = 'recoverable';
      }
      
      // Calculate totals (include mitigation costs in ALE/Additional category)
      const documentedTotal = financialData.structure + financialData.contents + financialData.ale + financialData.mitigationCosts;
      const afterDeductible = Math.max(0, documentedTotal - financialData.deductible);
      const netPayable = afterDeductible - financialData.depreciation;
      
      // Calculate remaining gap
      const remainingGap = Math.max(0, netPayable - financialData.paymentsReceived + financialData.depreciation);
      
      // Apply policy limits (mitigation costs are typically covered under ALE)
      const structureCapped = Math.min(financialData.structure, financialData.dwellingLimit);
      const contentsCapped = Math.min(financialData.contents, financialData.contentsLimit);
      const aleCapped = Math.min(financialData.ale + financialData.mitigationCosts, financialData.aleLimit);
      
      // Check for coinsurance penalty
      const requiredInsurance = financialData.replacementCost * financialData.coinsuranceRequirement;
      let coinsurancePenalty = 0;
      let coverageAdjustedTotal = (structureCapped + contentsCapped + aleCapped) - financialData.deductible;
      
      if (financialData.insuredAmount < requiredInsurance) {
        // Apply coinsurance penalty: (Insurance Carried / Insurance Required) × Loss
        const coinsuranceFactor = financialData.insuredAmount / requiredInsurance;
        coinsurancePenalty = coverageAdjustedTotal * (1 - coinsuranceFactor);
        coverageAdjustedTotal = Math.max(0, coverageAdjustedTotal - coinsurancePenalty);
      }
      
      return {
        documentedTotal,
        coverageAdjustedTotal,
        structure: financialData.structure,
        contents: financialData.contents,
        ale: financialData.ale,
        deductible: financialData.deductible,
        depreciation: financialData.depreciation,
        netPayable,
        paymentsReceived: financialData.paymentsReceived,
        lastPaymentDate: financialData.lastPaymentDate,
        remainingGap,
        docStatus: financialData.docStatus,
        submissionStatus: financialData.submissionStatus,
        negotiationStatus: financialData.negotiationStatus,
        depreciationStatus: financialData.depreciationStatus
      };
    }
    
    function updateFinancialSummary() {
      const summary = calculateFinancialSummary();
      
      // Format currency
      const formatCurrency = (amount) => {
        return '$' + Math.round(amount).toLocaleString('en-US');
      };
      
      // Update top line metrics
      const docValue = document.getElementById('documentedClaimValue');
      const covValue = document.getElementById('coverageAdjustedValue');
      if (docValue) docValue.textContent = formatCurrency(summary.documentedTotal);
      if (covValue) covValue.textContent = formatCurrency(summary.coverageAdjustedTotal);
      
      // Update breakdown
      const updateElement = (id, value) => {
        const el = document.getElementById(id);
        if (el) el.textContent = formatCurrency(value);
      };
      
      updateElement('structureValue', summary.structure);
      updateElement('contentsValue', summary.contents);
      updateElement('aleValue', summary.ale);
      updateElement('deductibleValue', summary.deductible);
      updateElement('depreciationValue', summary.depreciation);
      updateElement('netPayableValue', summary.netPayable);
      
      // Update payments section
      updateElement('paymentsReceivedValue', summary.paymentsReceived);
      updateElement('remainingGapValue', summary.remainingGap);
      
      const lastPaymentEl = document.getElementById('lastPaymentDate');
      if (lastPaymentEl) {
        if (summary.lastPaymentDate) {
          const dateStr = summary.lastPaymentDate.toLocaleDateString('en-US', { 
            year: 'numeric', 
            month: 'short', 
            day: 'numeric' 
          });
          lastPaymentEl.textContent = dateStr;
        } else {
          lastPaymentEl.textContent = '—';
        }
      }
      
      // Update status indicators
      const updateStatus = (indicatorId, valueId, status, statusText) => {
        const indicator = document.getElementById(indicatorId);
        const valueEl = document.getElementById(valueId);
        
        if (indicator && valueEl) {
          // Remove all status classes
          indicator.classList.remove('incomplete', 'preliminary', 'complete', 'active', 'inactive');
          
          // Add appropriate status class
          indicator.classList.add(status);
          valueEl.textContent = statusText;
        }
      };
      
      // Documentation status
      const docStatusMap = {
        'incomplete': 'Incomplete',
        'preliminary': 'Preliminary',
        'complete': 'Complete'
      };
      updateStatus('docStatusIndicator', 'docStatusValue', summary.docStatus, docStatusMap[summary.docStatus]);
      
      // Submission status
      const submissionStatusMap = {
        'not submitted': 'Not Submitted',
        'submitted': 'Submitted'
      };
      const submissionClass = summary.submissionStatus === 'submitted' ? 'complete' : 'incomplete';
      updateStatus('submissionStatusIndicator', 'submissionStatusValue', submissionClass, submissionStatusMap[summary.submissionStatus]);
      
      // Negotiation status
      const negotiationStatusMap = {
        'inactive': 'Inactive',
        'active': 'Active'
      };
      updateStatus('negotiationStatusIndicator', 'negotiationStatusValue', summary.negotiationStatus, negotiationStatusMap[summary.negotiationStatus]);
      
      // Depreciation status
      const depreciationStatusMap = {
        'pending': 'Pending',
        'recoverable': 'Recoverable',
        'recovered': 'Recovered'
      };
      const depreciationClass = summary.depreciationStatus === 'recovered' ? 'complete' : (summary.depreciationStatus === 'recoverable' ? 'active' : 'inactive');
      updateStatus('depreciationStatusIndicator', 'depreciationStatusValue', depreciationClass, depreciationStatusMap[summary.depreciationStatus]);
    }

    // Post-claim asset functions
    function downloadClaimFile() {
      alert('Your complete claim file will be downloaded as a ZIP archive containing all documents, photos, and correspondence.');
      // In production: trigger actual download
    }

    function viewClaimArchive() {
      alert('Opening your claim archive viewer...');
      // In production: navigate to archive interface
    }

    // Calculate days between two dates
    function daysBetween(date1, date2) {
      const oneDay = 24 * 60 * 60 * 1000;
      return Math.round((date2 - date1) / oneDay);
    }

    // Update deadline urgency based on days remaining
    function updateDeadlineUrgency() {
      // This would normally calculate based on actual dates
      // For demo purposes, deadlines are static in HTML
      // In production, this would:
      // 1. Calculate days remaining for each deadline
      // 2. Apply .urgent class if < 30 days
      // 3. Apply .critical class if < 7 days
      // 4. Update deadline text dynamically
      
      // Example production implementation:
      /*
      const today = new Date();
      const proofOfLossDate = new Date('2025-01-14');
      const daysUntilPOL = daysBetween(today, proofOfLossDate);
      
      const polItem = document.querySelector('.deadline-item[data-deadline="proof-of-loss"]');
      if (polItem) {
        polItem.classList.remove('urgent', 'critical');
        if (daysUntilPOL <= 7) {
          polItem.classList.add('critical');
        } else if (daysUntilPOL <= 30) {
          polItem.classList.add('urgent');
        }
        
        // Update text
        const dateEl = polItem.querySelector('.deadline-date');
        dateEl.textContent = `Proof of Loss due in ${daysUntilPOL} days (${proofOfLossDate.toLocaleDateString()})`;
      }
      */
    }

    // Get report name for step
    function getReportName(stepNum) {
      const reportNames = {
        1: 'Policy_Intelligence_Report',
        2: 'Compliance_Status_Report',
        3: 'Damage_Documentation_Report',
        4: 'Estimate_Quality_Report',
        5: 'Estimate_Comparison_Report',
        6: 'ALE_Compliance_Report',
        7: 'Inventory_Completeness_Report',
        8: 'Contents_Valuation_Report',
        9: 'Coverage_Alignment_Report',
        10: 'Claim_Package_Readiness_Report',
        12: 'Carrier_Response_Analysis_Report',
        13: 'Supplement_Strategy_Report'
      };
      return reportNames[stepNum] || `Step_${stepNum}_Report`;
    }
    
    // Log export activity
    function logExportActivity(stepNum, reportName, type) {
      const log = getClaimData('exportActivityLog') || [];
      log.push({
        step: stepNum,
        reportName: reportName,
        type: type,
        timestamp: new Date().toISOString()
      });
      saveClaimData('exportActivityLog', log);
    }
    
    // Export report as PDF
    function exportReportPDF(stepNum) {
      const output = getToolOutput(stepNum, getPrimaryToolId(stepNum));
      if (!output) {
        alert('No report data available to export.');
        return;
      }
      
      const reportName = getReportName(stepNum);
      const step = stepData[stepNum];
      const claimNumber = document.getElementById('claimNumber').textContent;
      const dateGenerated = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
      
      // Create PDF content
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      let yPos = 20;
      const lineHeight = 7;
      const pageHeight = doc.internal.pageSize.height;
      const margin = 20;
      
      // Header
      doc.setFontSize(18);
      doc.setFont(undefined, 'bold');
      doc.text('ClaimNavigator AI', margin, yPos);
      yPos += lineHeight + 3;
      
      doc.setFontSize(14);
      doc.text(`Step ${stepNum} Report`, margin, yPos);
      yPos += lineHeight + 2;
      
      doc.setFontSize(12);
      doc.setFont(undefined, 'normal');
      doc.text(step.title, margin, yPos);
      yPos += lineHeight + 5;
      
      // Metadata
      doc.setFontSize(10);
      doc.text(`Claim Number: ${claimNumber}`, margin, yPos);
      yPos += lineHeight;
      doc.text(`Date Generated: ${dateGenerated}`, margin, yPos);
      yPos += lineHeight + 5;
      
      // Separator
      doc.setDrawColor(200, 200, 200);
      doc.line(margin, yPos, doc.internal.pageSize.width - margin, yPos);
      yPos += 10;
      
      // Report content
      doc.setFontSize(11);
      
      if (output.sections && Array.isArray(output.sections)) {
        output.sections.forEach(section => {
          // Check page break
          if (yPos > pageHeight - 40) {
            doc.addPage();
            yPos = margin;
          }
          
          // Section header
          doc.setFont(undefined, 'bold');
          doc.text(section.title || 'Section', margin, yPos);
          yPos += lineHeight;
          
          // Section content
          doc.setFont(undefined, 'normal');
          const content = section.content || section.text || '';
          const lines = doc.splitTextToSize(content, doc.internal.pageSize.width - 2 * margin);
          
          lines.forEach(line => {
            if (yPos > pageHeight - 30) {
              doc.addPage();
              yPos = margin;
            }
            doc.text(line, margin, yPos);
            yPos += lineHeight;
          });
          
          yPos += 5;
        });
      } else if (output.content) {
        const lines = doc.splitTextToSize(output.content, doc.internal.pageSize.width - 2 * margin);
        lines.forEach(line => {
          if (yPos > pageHeight - 30) {
            doc.addPage();
            yPos = margin;
          }
          doc.text(line, margin, yPos);
          yPos += lineHeight;
        });
      } else if (output.summary) {
        const lines = doc.splitTextToSize(output.summary, doc.internal.pageSize.width - 2 * margin);
        lines.forEach(line => {
          if (yPos > pageHeight - 30) {
            doc.addPage();
            yPos = margin;
          }
          doc.text(line, margin, yPos);
          yPos += lineHeight;
        });
      }
      
      // Save PDF
      const filename = `ClaimNavigator_Step_${stepNum}_${reportName}.pdf`;
      doc.save(filename);
      
      // Log export activity
      logExportActivity(stepNum, reportName, 'PDF');
    }
    
    // Export report as DOC
    function exportReportDOC(stepNum) {
      const output = getToolOutput(stepNum, getPrimaryToolId(stepNum));
      if (!output) {
        alert('No report data available to export.');
        return;
      }
      
      const reportName = getReportName(stepNum);
      const step = stepData[stepNum];
      const claimNumber = document.getElementById('claimNumber').textContent;
      const dateGenerated = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
      
      // Build DOC content
      let docContent = '';
      
      // Header
      docContent += `ClaimNavigator AI\n`;
      docContent += `Step ${stepNum} Report\n`;
      docContent += `${step.title}\n\n`;
      docContent += `Claim Number: ${claimNumber}\n`;
      docContent += `Date Generated: ${dateGenerated}\n`;
      docContent += `${'='.repeat(80)}\n\n`;
      
      // Report content
      if (output.sections && Array.isArray(output.sections)) {
        output.sections.forEach(section => {
          docContent += `${section.title || 'Section'}\n`;
          docContent += `${'-'.repeat((section.title || 'Section').length)}\n`;
          docContent += `${section.content || section.text || ''}\n\n`;
        });
      } else if (output.content) {
        docContent += output.content + '\n\n';
      } else if (output.summary) {
        docContent += output.summary + '\n\n';
      }
      
      // Create blob and download
      const blob = new Blob([docContent], { type: 'application/msword' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `ClaimNavigator_Step_${stepNum}_${reportName}.doc`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      // Log export activity
      logExportActivity(stepNum, reportName, 'DOC');
    }
    
    // Get primary tool ID for step
    function getPrimaryToolId(stepNum) {
      const primaryToolIds = {
        1: 'policy-intelligence-engine',
        2: 'compliance-review',
        3: 'damage-documentation',
        4: 'estimate-review',
        5: 'estimate-comparison',
        6: 'ale-tracker',
        7: 'contents-inventory',
        8: 'contents-valuation',
        9: 'coverage-alignment',
        10: 'claim-package-assembly',
        11: 'claim-submitter',
        12: 'carrier-response',
        13: 'supplement-analysis'
      };
      
      return primaryToolIds[stepNum] || null;
    }
    
    // Handle return from tool
    function handleToolReturn() {
      const urlParams = new URLSearchParams(window.location.search);
      const stepNum = parseInt(urlParams.get('step'), 10);
      const saved = urlParams.get('saved');
      
      if (saved === 'true' && stepNum) {
        // Ensure step content loads and renders outputs
        openStep(stepNum);
        
        // Optional: visual confirmation
        setTimeout(() => {
          highlightStepCompletion(stepNum);
        }, 300);
        
        // Clean URL
        window.history.replaceState({}, document.title, window.location.pathname);
      }
    }
    
    // Visual confirmation of step completion
    function highlightStepCompletion(stepNum) {
      const stepEl = document.querySelector(`[data-step="${stepNum}"]`);
      if (!stepEl) return;
      
      stepEl.classList.add('step-complete-flash');
      setTimeout(() => {
        stepEl.classList.remove('step-complete-flash');
      }, 2000);
    }
    
    // Initialize on load
    // Calculate Proof of Loss deadline based on date of loss
    function calculatePOLDeadline() {
      // Get date of loss from claim info panel
      const dateOfLossText = document.getElementById('dateOfLoss')?.textContent;
      
      if (dateOfLossText && dateOfLossText !== 'Not set') {
        const lossDate = new Date(dateOfLossText);
        
        // Add 60 days (standard POL deadline - adjust based on policy)
        const polDate = new Date(lossDate);
        polDate.setDate(polDate.getDate() + 60);
        
        // Calculate days remaining
        const today = new Date();
        const daysRemaining = Math.ceil((polDate - today) / (1000 * 60 * 60 * 24));
        
        // Update deadline display in Step 2 if it exists
        const polDeadlineEl = document.getElementById('polDeadline');
        if (polDeadlineEl) {
          if (daysRemaining > 0) {
            polDeadlineEl.textContent = `${polDate.toLocaleDateString()} (${daysRemaining} days remaining)`;
            polDeadlineEl.style.color = daysRemaining <= 14 ? '#dc2626' : '#f59e0b';
          } else {
            polDeadlineEl.textContent = `OVERDUE by ${Math.abs(daysRemaining)} days`;
            polDeadlineEl.style.color = '#dc2626';
            polDeadlineEl.style.fontWeight = '700';
          }
        }
      }
    }

    document.addEventListener('DOMContentLoaded', function() {
      console.log('Page initialized');
      
      // Close dropdown when clicking outside
      document.addEventListener('click', function(e) {
        const dropdown = document.getElementById('uploadDropdown');
        if (!dropdown) return;
        
        // Check if click was inside the dropdown
        const clickedInside = dropdown.contains(e.target);
        
        // If clicked outside and dropdown is open, close it
        if (!clickedInside && dropdown.classList.contains('open')) {
          dropdown.classList.remove('open');
          console.log('Dropdown closed (outside click)');
        }
      });
      
      // MAIN PAGE INITIALIZATION
      loadSavedState();
      
      // Calculate POL deadline
      calculatePOLDeadline();
      
      // Handle tool return
      handleToolReturn();
      
      completedSteps.forEach(stepNum => {
        const item = document.querySelector(`.accordion-item[data-step="${stepNum}"]`);
        if (item) item.classList.add('completed');
      });
      
      if (!currentStep) {
        currentStep = 1;
      }
      
      // Update readiness status on load
      updateReadinessStatus();
      
      // Update deadline urgency on load
      updateDeadlineUrgency();
      
      // Update financial summary on load
      updateFinancialSummary();
      
      // Show post-claim section if Step 13 is completed
      if (completedSteps.includes(13)) {
        const postClaimSection = document.getElementById('postClaimSection');
        if (postClaimSection) {
          postClaimSection.style.display = 'block';
        }
      }
      
      // All steps closed by default - user must click to open
      console.log('All steps closed by default - click to expand');
    });
  </script>

  <!-- DOCUMENT GENERATOR MODALS -->
  <div id="documentGeneratorModal" class="doc-gen-modal" style="display: none;">
    <div class="doc-gen-modal-overlay" onclick="closeDocumentGenerator()"></div>
    <div class="doc-gen-modal-content">
      <div class="doc-gen-modal-header">
        <h2 id="docGenTitle">Document Generator</h2>
        <button class="doc-gen-close-btn" onclick="closeDocumentGenerator()">×</button>
      </div>
      <div class="doc-gen-modal-body" id="docGenBody">
        <!-- Content will be inserted dynamically -->
      </div>
    </div>
  </div>

  <style>
    .doc-gen-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 10000;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .doc-gen-modal-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
    }

    .doc-gen-modal-content {
      position: relative;
      background: white;
      border-radius: 12px;
      width: 90%;
      max-width: 800px;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: modalSlideIn 0.3s ease-out;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .doc-gen-modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 24px;
      border-bottom: 1px solid #e5e7eb;
    }

    .doc-gen-modal-header h2 {
      margin: 0;
      font-size: 20px;
      font-weight: 700;
      color: var(--navy-primary);
    }

    .doc-gen-close-btn {
      background: none;
      border: none;
      font-size: 32px;
      color: #6b7280;
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      transition: all 0.2s;
    }

    .doc-gen-close-btn:hover {
      background: #f3f4f6;
      color: #1f2937;
    }

    .doc-gen-modal-body {
      padding: 24px;
      overflow-y: auto;
      flex: 1;
    }

    .doc-gen-form-group {
      margin-bottom: 20px;
    }

    .doc-gen-form-group label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 8px;
    }

    .doc-gen-form-group input,
    .doc-gen-form-group textarea,
    .doc-gen-form-group select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 14px;
      font-family: inherit;
      transition: border-color 0.2s;
    }

    .doc-gen-form-group input:focus,
    .doc-gen-form-group textarea:focus,
    .doc-gen-form-group select:focus {
      outline: none;
      border-color: var(--teal-primary);
      box-shadow: 0 0 0 3px rgba(23, 190, 187, 0.1);
    }

    .doc-gen-form-group textarea {
      min-height: 100px;
      resize: vertical;
    }

    .doc-gen-form-group small {
      display: block;
      margin-top: 4px;
      font-size: 12px;
      color: #6b7280;
    }

    .doc-gen-actions {
      display: flex;
      gap: 12px;
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid #e5e7eb;
    }

    .doc-gen-btn {
      flex: 1;
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .doc-gen-btn-primary {
      background: var(--teal-primary);
      color: white;
    }

    .doc-gen-btn-primary:hover {
      background: var(--teal-hover);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(23, 190, 187, 0.3);
    }

    .doc-gen-btn-primary:disabled {
      background: #9ca3af;
      cursor: not-allowed;
      transform: none;
    }

    .doc-gen-btn-secondary {
      background: #f3f4f6;
      color: #1f2937;
    }

    .doc-gen-btn-secondary:hover {
      background: #e5e7eb;
    }

    .doc-gen-output {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
    }

    .doc-gen-output-title {
      font-size: 16px;
      font-weight: 700;
      color: var(--navy-primary);
      margin-bottom: 16px;
    }

    .doc-gen-output-content {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      padding: 16px;
      font-size: 14px;
      line-height: 1.6;
      white-space: pre-wrap;
      max-height: 400px;
      overflow-y: auto;
    }

    .doc-gen-loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px;
      color: #6b7280;
    }

    .doc-gen-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #e5e7eb;
      border-top-color: var(--teal-primary);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-right: 12px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .doc-gen-success {
      background: #f0fdf4;
      border: 1px solid #86efac;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 20px;
      color: #166534;
      font-size: 14px;
    }

    .doc-gen-error {
      background: #fef2f2;
      border: 1px solid #fca5a5;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 20px;
      color: #991b1b;
      font-size: 14px;
    }
  </style>

  <script>
    // Document Generator System
    const documentGenerators = {
      'carrier-submission-cover-letter-generator': {
        title: 'Carrier Submission Cover Letter Generator',
        description: 'Generate a professional cover letter for your claim package submission',
        fields: [
          { name: 'insurerName', label: 'Insurance Company Name', type: 'text', required: true },
          { name: 'policyNumber', label: 'Policy Number', type: 'text', required: true },
          { name: 'claimNumber', label: 'Claim Number (if assigned)', type: 'text', required: false },
          { name: 'dateOfLoss', label: 'Date of Loss', type: 'date', required: true },
          { name: 'propertyAddress', label: 'Property Address', type: 'textarea', required: true },
          { name: 'lossType', label: 'Type of Loss', type: 'select', options: ['Fire', 'Water Damage', 'Wind/Hail', 'Theft', 'Other'], required: true },
          { name: 'documentsIncluded', label: 'Documents Included in Package', type: 'textarea', required: true, placeholder: 'List all documents being submitted (e.g., Proof of Loss, estimates, photos, receipts)' },
          { name: 'totalClaimAmount', label: 'Total Claim Amount', type: 'number', required: true },
          { name: 'additionalNotes', label: 'Additional Notes or Special Circumstances', type: 'textarea', required: false }
        ]
      },
      'coverage-clarification-letter': {
        title: 'Coverage Clarification Letter',
        description: 'Request clarification on policy coverage and interpretation',
        fields: [
          { name: 'insurerName', label: 'Insurance Company Name', type: 'text', required: true },
          { name: 'policyNumber', label: 'Policy Number', type: 'text', required: true },
          { name: 'claimNumber', label: 'Claim Number', type: 'text', required: false },
          { name: 'coverageQuestion', label: 'Coverage Question or Issue', type: 'textarea', required: true, placeholder: 'Describe what coverage aspect needs clarification' },
          { name: 'policySection', label: 'Relevant Policy Section/Endorsement', type: 'text', required: false },
          { name: 'specificLanguage', label: 'Specific Policy Language in Question', type: 'textarea', required: false },
          { name: 'yourInterpretation', label: 'Your Understanding of Coverage', type: 'textarea', required: true },
          { name: 'requestedAction', label: 'What You\'re Requesting', type: 'textarea', required: true }
        ]
      },
      'estimate-revision-request-generator': {
        title: 'Estimate Revision Request Generator',
        description: 'Request revisions to the insurance company\'s estimate',
        fields: [
          { name: 'insurerName', label: 'Insurance Company Name', type: 'text', required: true },
          { name: 'adjusterName', label: 'Adjuster Name', type: 'text', required: true },
          { name: 'claimNumber', label: 'Claim Number', type: 'text', required: true },
          { name: 'estimateDate', label: 'Date of Original Estimate', type: 'date', required: true },
          { name: 'estimateAmount', label: 'Original Estimate Amount', type: 'number', required: true },
          { name: 'discrepancies', label: 'Specific Discrepancies or Omissions', type: 'textarea', required: true, placeholder: 'List specific line items, omissions, or pricing issues' },
          { name: 'supportingEvidence', label: 'Supporting Evidence Available', type: 'textarea', required: true, placeholder: 'Photos, contractor estimates, expert opinions, etc.' },
          { name: 'requestedAmount', label: 'Requested Revised Amount', type: 'number', required: false },
          { name: 'urgencyReason', label: 'Reason for Urgency (if applicable)', type: 'textarea', required: false }
        ]
      },
      'euo-sworn-statement-guide': {
        title: 'EUO Sworn Statement Guide',
        description: 'Prepare for Examination Under Oath with guidance document',
        fields: [
          { name: 'insurerName', label: 'Insurance Company Name', type: 'text', required: true },
          { name: 'claimNumber', label: 'Claim Number', type: 'text', required: true },
          { name: 'euoDate', label: 'Scheduled EUO Date', type: 'date', required: false },
          { name: 'euoLocation', label: 'EUO Location', type: 'text', required: false },
          { name: 'lossType', label: 'Type of Loss', type: 'text', required: true },
          { name: 'dateOfLoss', label: 'Date of Loss', type: 'date', required: true },
          { name: 'keyFacts', label: 'Key Facts About Your Claim', type: 'textarea', required: true, placeholder: 'Important facts you need to remember and communicate' },
          { name: 'concernAreas', label: 'Areas of Concern or Complex Issues', type: 'textarea', required: false },
          { name: 'documentsToReview', label: 'Documents to Review Before EUO', type: 'textarea', required: false }
        ]
      },
      'followup-status-letter': {
        title: 'Follow-Up Status Request Letter',
        description: 'Request status update on your claim',
        fields: [
          { name: 'insurerName', label: 'Insurance Company Name', type: 'text', required: true },
          { name: 'claimNumber', label: 'Claim Number', type: 'text', required: true },
          { name: 'adjusterName', label: 'Adjuster Name', type: 'text', required: false },
          { name: 'submissionDate', label: 'Date Claim/Documents Submitted', type: 'date', required: true },
          { name: 'daysSinceSubmission', label: 'Days Since Submission', type: 'number', required: true },
          { name: 'lastContact', label: 'Date of Last Contact', type: 'date', required: false },
          { name: 'pendingItems', label: 'Items Pending Response', type: 'textarea', required: true, placeholder: 'What are you waiting for? (e.g., estimate review, payment, coverage decision)' },
          { name: 'stateDeadline', label: 'State-Mandated Response Deadline (if applicable)', type: 'text', required: false },
          { name: 'urgencyReason', label: 'Reason for Urgency', type: 'textarea', required: false }
        ]
      },
      'policy-interpretation-letter': {
        title: 'Policy Interpretation Letter',
        description: 'Document your interpretation of policy language',
        fields: [
          { name: 'insurerName', label: 'Insurance Company Name', type: 'text', required: true },
          { name: 'policyNumber', label: 'Policy Number', type: 'text', required: true },
          { name: 'claimNumber', label: 'Claim Number', type: 'text', required: false },
          { name: 'policySection', label: 'Policy Section/Provision', type: 'text', required: true },
          { name: 'policyLanguage', label: 'Exact Policy Language', type: 'textarea', required: true },
          { name: 'yourInterpretation', label: 'Your Interpretation', type: 'textarea', required: true },
          { name: 'insurerPosition', label: 'Insurer\'s Interpretation (if stated)', type: 'textarea', required: false },
          { name: 'supportingAuthority', label: 'Supporting Authority', type: 'textarea', required: false, placeholder: 'Case law, state regulations, or other policy provisions that support your interpretation' },
          { name: 'requestedAction', label: 'Requested Action', type: 'textarea', required: true }
        ]
      },
      'submission-confirmation-email': {
        title: 'Submission Confirmation Email',
        description: 'Confirm receipt of your claim submission',
        fields: [
          { name: 'insurerName', label: 'Insurance Company Name', type: 'text', required: true },
          { name: 'recipientName', label: 'Recipient Name', type: 'text', required: false },
          { name: 'recipientEmail', label: 'Recipient Email', type: 'email', required: false },
          { name: 'claimNumber', label: 'Claim Number', type: 'text', required: false },
          { name: 'submissionDate', label: 'Submission Date', type: 'date', required: true },
          { name: 'submissionMethod', label: 'Submission Method', type: 'select', options: ['Email', 'Certified Mail', 'Online Portal', 'In Person', 'Fax'], required: true },
          { name: 'trackingNumber', label: 'Tracking Number (if applicable)', type: 'text', required: false },
          { name: 'documentsSubmitted', label: 'Documents Submitted', type: 'textarea', required: true, placeholder: 'List all documents included in submission' },
          { name: 'requestedResponse', label: 'Requested Response Timeframe', type: 'text', required: false }
        ]
      },
      'supplement-cover-letter-generator': {
        title: 'Supplement Cover Letter Generator',
        description: 'Generate cover letter for supplemental claim submission',
        fields: [
          { name: 'insurerName', label: 'Insurance Company Name', type: 'text', required: true },
          { name: 'claimNumber', label: 'Claim Number', type: 'text', required: true },
          { name: 'adjusterName', label: 'Adjuster Name', type: 'text', required: false },
          { name: 'originalClaimDate', label: 'Original Claim Date', type: 'date', required: true },
          { name: 'originalAmount', label: 'Original Claim Amount', type: 'number', required: true },
          { name: 'supplementReason', label: 'Reason for Supplement', type: 'textarea', required: true, placeholder: 'Why are you filing a supplement? (e.g., additional damage discovered, omitted items, pricing corrections)' },
          { name: 'supplementAmount', label: 'Supplement Amount', type: 'number', required: true },
          { name: 'newDocumentation', label: 'New Documentation Included', type: 'textarea', required: true },
          { name: 'totalRevisedAmount', label: 'Total Revised Claim Amount', type: 'number', required: true }
        ]
      }
    };

    function openDocumentGenerator(toolId) {
      const generator = documentGenerators[toolId];
      if (!generator) {
        console.error('Document generator not found:', toolId);
        return;
      }

      const modal = document.getElementById('documentGeneratorModal');
      const title = document.getElementById('docGenTitle');
      const body = document.getElementById('docGenBody');

      title.textContent = generator.title;
      
      let html = `
        <p style="color: #6b7280; margin-bottom: 24px;">${generator.description}</p>
        <form id="docGenForm" onsubmit="generateDocument(event, '${toolId}'); return false;">
      `;

      generator.fields.forEach(field => {
        html += `<div class="doc-gen-form-group">`;
        html += `<label for="${field.name}">${field.label}${field.required ? ' <span style="color: #ef4444;">*</span>' : ''}</label>`;
        
        if (field.type === 'textarea') {
          html += `<textarea id="${field.name}" name="${field.name}" ${field.required ? 'required' : ''} placeholder="${field.placeholder || ''}"></textarea>`;
        } else if (field.type === 'select') {
          html += `<select id="${field.name}" name="${field.name}" ${field.required ? 'required' : ''}>`;
          html += `<option value="">Select...</option>`;
          field.options.forEach(opt => {
            html += `<option value="${opt}">${opt}</option>`;
          });
          html += `</select>`;
        } else {
          html += `<input type="${field.type}" id="${field.name}" name="${field.name}" ${field.required ? 'required' : ''} placeholder="${field.placeholder || ''}">`;
        }
        
        if (field.placeholder && field.type !== 'textarea') {
          html += `<small>${field.placeholder}</small>`;
        }
        html += `</div>`;
      });

      html += `
          <div class="doc-gen-actions">
            <button type="button" class="doc-gen-btn doc-gen-btn-secondary" onclick="closeDocumentGenerator()">Cancel</button>
            <button type="submit" class="doc-gen-btn doc-gen-btn-primary">
              <span>✨ Generate with AI</span>
            </button>
          </div>
        </form>
        <div id="docGenOutput"></div>
      `;

      body.innerHTML = html;
      modal.style.display = 'flex';
    }

    function closeDocumentGenerator() {
      const modal = document.getElementById('documentGeneratorModal');
      modal.style.display = 'none';
    }

    async function generateDocument(event, toolId) {
      event.preventDefault();
      
      const form = event.target;
      const formData = new FormData(form);
      const data = {};
      
      for (let [key, value] of formData.entries()) {
        data[key] = value;
      }

      const outputDiv = document.getElementById('docGenOutput');
      outputDiv.innerHTML = `
        <div class="doc-gen-loading">
          <div class="doc-gen-spinner"></div>
          <span>Generating your document with AI...</span>
        </div>
      `;

      try {
        const generator = documentGenerators[toolId];
        
        // Call AI generation endpoint
        const response = await fetch('/netlify/functions/ai-document-generator', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            template_type: toolId,
            document_type: generator.title,
            user_inputs: data
          })
        });

        if (!response.ok) {
          throw new Error('Failed to generate document');
        }

        const result = await response.json();
        
        if (result.success && result.data && result.data.document_text) {
          outputDiv.innerHTML = `
            <div class="doc-gen-success">
              ✅ Document generated successfully!
            </div>
            <div class="doc-gen-output">
              <div class="doc-gen-output-title">${generator.title}</div>
              <div class="doc-gen-output-content">${result.data.document_text}</div>
              <div class="doc-gen-actions">
                <button type="button" class="doc-gen-btn doc-gen-btn-primary" onclick="copyToClipboard()">
                  📋 Copy to Clipboard
                </button>
                <button type="button" class="doc-gen-btn doc-gen-btn-primary" onclick="downloadDocument('${generator.title}')">
                  📥 Download as PDF
                </button>
                <button type="button" class="doc-gen-btn doc-gen-btn-secondary" onclick="resetForm()">
                  🔄 Generate Another
                </button>
              </div>
            </div>
          `;
          
          // Store the generated document
          window.currentGeneratedDocument = result.data.document_text;
        } else {
          throw new Error(result.error?.message || 'Unknown error');
        }
      } catch (error) {
        console.error('Document generation error:', error);
        outputDiv.innerHTML = `
          <div class="doc-gen-error">
            ❌ Error generating document: ${error.message}
          </div>
          <div class="doc-gen-actions">
            <button type="button" class="doc-gen-btn doc-gen-btn-primary" onclick="resetForm()">
              🔄 Try Again
            </button>
          </div>
        `;
      }
    }

    function copyToClipboard() {
      const content = document.querySelector('.doc-gen-output-content').textContent;
      navigator.clipboard.writeText(content).then(() => {
        alert('✅ Document copied to clipboard!');
      }).catch(err => {
        console.error('Copy failed:', err);
        alert('❌ Failed to copy to clipboard');
      });
    }

    function downloadDocument(title) {
      const content = window.currentGeneratedDocument || document.querySelector('.doc-gen-output-content').textContent;
      
      // Create a simple PDF-like download (text file for now)
      const blob = new Blob([content], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${title.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.txt`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      alert('✅ Document downloaded! You can copy this text into a Word document for further formatting.');
    }

    function resetForm() {
      const outputDiv = document.getElementById('docGenOutput');
      outputDiv.innerHTML = '';
      document.getElementById('docGenForm').reset();
    }

    // Override the openTool function to handle document generators
    const originalOpenTool = window.openTool;
    window.openTool = function(toolId, stepNum) {
      // Check if this is a document generator
      if (documentGenerators[toolId]) {
        openDocumentGenerator(toolId);
        return;
      }
      
      // Otherwise use original function
      if (originalOpenTool) {
        originalOpenTool(toolId, stepNum);
      }
    };
  </script>
</body>
</html>