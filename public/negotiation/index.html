<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Negotiation Scripts - ClaimNavigatorAI</title>
  <style>
    :root {
      --primary: #1e3a8a;
      --accent: #3b82f6;
      --bg-light: #f9fafb;
      --border: #e5e7eb;
      --text-dark: #111827;
    }

    body {
      font-family: Inter, sans-serif;
      background: var(--bg-light);
      margin: 0;
      padding: 0;
    }

    header {
      background: var(--primary);
      color: white;
      padding: 1rem 2rem;
    }

    header h1 {
      margin: 0;
      font-size: 1.5rem;
    }

    header a {
      color: #93c5fd;
      text-decoration: none;
      margin-right: 1rem;
    }

    .container {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      padding: 2rem;
      max-width: 1200px;
      margin: auto;
      gap: 1.5rem;
    }

    .card {
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      border-radius: 8px;
      padding: 1.5rem;
      flex: 1;
      min-width: 350px;
    }

    .card h2 {
      margin-top: 0;
      color: var(--primary);
      font-size: 1.2rem;
    }

    label {
      display: block;
      margin-top: 0.75rem;
      font-weight: 600;
      color: var(--text-dark);
    }

    input, select, textarea {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.25rem;
      border: 1px solid var(--border);
      border-radius: 6px;
      font-size: 1rem;
    }

    button {
      background: linear-gradient(90deg, var(--primary), var(--accent));
      color: white;
      border: none;
      border-radius: 8px;
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      cursor: pointer;
      margin-top: 1rem;
      transition: 0.2s;
    }

    button:hover {
      opacity: 0.9;
    }

    .output-area {
      height: 400px;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1rem;
      background: #fff;
      white-space: pre-wrap;
      overflow-y: auto;
      font-size: 1rem;
      line-height: 1.5;
    }

    .output-actions {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
    }

    .output-actions button {
      flex: 1;
    }

    @media (max-width: 900px) {
      .container {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <header>
    <a href="../index.html">&larr; Resource Center</a>
    <h1>Negotiation Scripts</h1>
  </header>

  <div class="container">
    <!-- LEFT PANEL -->
    <div class="card">
      <h2>Claim & Negotiation Details</h2>

      <label>Your Name</label>
      <input type="text" id="name" />

      <label>Policy #</label>
      <input type="text" id="policy" />

      <label>Claim #</label>
      <input type="text" id="claim" />

      <label>Date of Loss</label>
      <input type="date" id="dateOfLoss" />

      <label>Insurance Company</label>
      <input type="text" id="insurer" />

      <label>Phone Number</label>
      <input type="text" id="phone" />

      <label>Email</label>
      <input type="email" id="email" />

      <label>Your Address</label>
      <input type="text" id="address" />

      <label>Insurer Offer ($)</label>
      <input type="number" id="insurerOffer" />

      <label>Contractor Estimate ($)</label>
      <input type="number" id="contractorEstimate" />

      <label>Coverage Basis</label>
      <select id="coverageBasis">
        <option value="RCV">RCV</option>
        <option value="ACV">ACV</option>
        <option value="Other">Other</option>
      </select>

      <label>Negotiation Goal</label>
      <select id="negotiationGoal">
        <option value="Increase Low Offer">Increase Low Offer</option>
        <option value="Dispute Depreciation">Dispute Depreciation</option>
        <option value="Request Reinspection">Request Reinspection</option>
        <option value="Submit Supplemental Estimate">Submit Supplemental Estimate</option>
        <option value="Dispute Denial">Dispute Denial</option>
        <option value="Recover Withheld Depreciation">Recover Withheld Depreciation</option>
        <option value="Request Supervisor Escalation">Request Supervisor Escalation</option>
        <option value="Invoke Appraisal Clause">Invoke Appraisal Clause</option>
        <option value="Address Unreasonable Delay">Address Unreasonable Delay</option>
        <option value="Clarify Coverage or Exclusion">Clarify Coverage or Exclusion</option>
      </select>

      <label>Tone</label>
      <select id="tone">
        <option value="Polite & Professional">Polite & Professional</option>
        <option value="Firm & Assertive">Firm & Assertive</option>
        <option value="Contractor / Technical">Contractor / Technical</option>
        <option value="Legal / Escalation">Legal / Escalation</option>
      </select>

      <button id="generateBtn">Generate Script</button>
    </div>

    <!-- RIGHT PANEL -->
    <div class="card">
      <h2>Generated Script</h2>
      <div id="output" class="output-area">Your AI-generated negotiation script will appear here...</div>

      <div class="output-actions">
        <button id="copyBtn">Copy Script</button>
        <button id="downloadBtn">Download PDF</button>
        <button id="emailBtn">Email to Adjuster</button>
      </div>
    </div>
  </div>

  <script>
    const generateBtn = document.getElementById("generateBtn");
    const outputDiv = document.getElementById("output");
    const copyBtn = document.getElementById("copyBtn");
    const downloadBtn = document.getElementById("downloadBtn");
    const emailBtn = document.getElementById("emailBtn");

    async function generateScript() {
      const payload = {
        name: document.getElementById("name").value,
        policy: document.getElementById("policy").value,
        claim: document.getElementById("claim").value,
        dateOfLoss: document.getElementById("dateOfLoss").value,
        insurer: document.getElementById("insurer").value,
        phone: document.getElementById("phone").value,
        email: document.getElementById("email").value,
        address: document.getElementById("address").value,
        insurerOffer: document.getElementById("insurerOffer").value,
        contractorEstimate: document.getElementById("contractorEstimate").value,
        coverageBasis: document.getElementById("coverageBasis").value,
        negotiationGoal: document.getElementById("negotiationGoal").value,
        tone: document.getElementById("tone").value,
      };

      outputDiv.textContent = "Generating negotiation script...";

      try {
        const res = await fetch("/.netlify/functions/generate-script", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });

        const data = await res.json();
        if (data.script) {
          outputDiv.textContent = data.script;
        } else {
          outputDiv.textContent = "Error: No script generated.";
        }
      } catch (err) {
        console.error(err);
        outputDiv.textContent = "Network error. Please try again.";
      }
    }

    function copyScript() {
      navigator.clipboard.writeText(outputDiv.textContent);
      alert("Script copied to clipboard!");
    }

    function downloadPDF() {
      const text = outputDiv.textContent;
      const blob = new Blob([text], { type: "application/pdf" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "Negotiation_Script.pdf";
      link.click();
    }

    function emailScript() {
      const subject = encodeURIComponent("Claim Negotiation Script");
      const body = encodeURIComponent(outputDiv.textContent);
      window.location.href = `mailto:?subject=${subject}&body=${body}`;
    }

    generateBtn.addEventListener("click", generateScript);
    copyBtn.addEventListener("click", copyScript);
    downloadBtn.addEventListener("click", downloadPDF);
    emailBtn.addEventListener("click", emailScript);
  </script>
</body>
</html>