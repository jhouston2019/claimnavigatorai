<!doctype html><html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Coverage Position Request</title>
<link rel="stylesheet" href="/app/assets/css/style.css"/></head><body>
<header class="header"><div class="bar container"><div class="brand"><div class="logo"></div><div>Coverage Position Request</div></div>
<nav class="nav"><a href="/app/documents/index.html">← Documents</a></nav></div></header>
<main class="container" id="main">
  <div class="card"><h2>Coverage Position Request</h2></div>
  <div class="card">
    <h3>Claim Information</h3>
    <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(200px,1fr))">
      <label>Your Name<input id="name" placeholder="Your Name"/></label>
      <label>Policy #<input id="policy" placeholder="Policy #"/></label>
      <label>Claim #<input id="claim" placeholder="Claim #"/></label>
      <label>Date of Loss<input id="dol" type="date"/></label>
      <label>Insurance Company<input id="insurerName" placeholder="Insurance Company"/></label>
      <label>Phone Number<input id="phoneNumber" type="tel" placeholder="Phone Number"/></label>
      <label>Email Address<input id="email" type="email" placeholder="Email Address"/></label>
      <label>Your Address<input id="claimantAddress" placeholder="Your Address"/></label>
    </div>
    <label style="display:block;margin-top:8px">Details<textarea id="details" placeholder="Provide specifics to tailor the draft…"></textarea></label>
    <div style="display:flex;gap:8px;margin-top:10px">
      <button class="btn btn-primary" id="draft">Draft with AI</button>
      <button class="btn" id="pdf">Export PDF</button>
      <button class="btn" id="docx">Export DOCX</button>
    </div>
    <div id="out" class="card" style="margin-top:12px"></div>
  </div>
</main>
<script type="module">
  import {qs,on} from '/app/assets/js/ui-helpers.js';
  import { callAI, createDoc } from '/app/assets/js/api-client.js';
  const slug='coverage-position-request';
  // URL prefill
  const u=new URL(location.href); ['policy','claim','name','dol'].forEach(k=>{ const v=u.searchParams.get(k); if(v) qs('#'+k).value=v; });
  on(qs('#draft'),'click', async ()=>{
    // Collect claim information
    const claimInfo = {
      name: qs('#name').value || 'Not provided',
      policy: qs('#policy').value || 'Not provided',
      claim: qs('#claim').value || 'Not provided',
      dol: qs('#dol').value || 'Not provided',
      insurerName: qs('#insurerName').value || 'Not provided',
      phoneNumber: qs('#phoneNumber').value || 'Not provided',
      email: qs('#email').value || 'Not provided',
      claimantAddress: qs('#claimantAddress').value || 'Not provided'
    };
    
    // Generate claim header
    const claimHeader = `CLAIM INFORMATION
================
Policyholder: ${claimInfo.name}
Address: ${claimInfo.claimantAddress}
Phone: ${claimInfo.phoneNumber}
Email: ${claimInfo.email}

Policy Number: ${claimInfo.policy}
Claim Number: ${claimInfo.claim}
Date of Loss: ${claimInfo.dol}
Insurance Company: ${claimInfo.insurerName}

Generated: ${new Date().toLocaleDateString()}
Document Type: COVERAGE POSITION REQUEST

========================================

`;
    
    const body={type:slug,name:qs('#name').value,policy:qs('#policy').value,claim:qs('#claim').value,dol:qs('#dol').value,details:qs('#details').value};
    qs('#out').innerHTML='Drafting…'; 
    const r=await callAI(body,{type:slug}); 
    const response = r.response||r.analysis||'(no content)';
    qs('#out').innerHTML = claimHeader + response;
  });
  async function exportAs(fmt){ const html=qs('#out').innerHTML.trim(); if(!html) return alert('Draft first.');
    const r=await createDoc({content:html,format:fmt,type:slug,filename:`${slug}_${Date.now()}`}); location.href=r.url||r.downloadUrl; }
  on(qs('#pdf'),'click',()=>exportAs('pdf')); on(qs('#docx'),'click',()=>exportAs('docx'));
</script>
<script type="module" src="/app/assets/js/diagnostics.js"></script>
</body></html>