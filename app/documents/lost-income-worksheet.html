<!doctype html><html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Lost Income Worksheet</title><link rel="stylesheet" href="/app/assets/css/style.css"/></head><body>
<header class="header"><div class="bar container"><div class="brand"><div class="logo"></div><div>Lost Income Worksheet</div></div>
<nav class="nav"><a href="/app/documents/index.html">← Documents</a></nav></div></header>
<main class="container" id="main">
  <div class="card">
    <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(220px,1fr))">
      <label>Baseline Monthly Revenue<input id="baseline" placeholder="$"/></label>
      <label>Trend % (YoY)<input id="trend" placeholder="e.g., 5"/></label>
      <label>Outage Days<input id="outage" placeholder="e.g., 14"/></label>
      <label>Period (months)<input id="months" placeholder="e.g., 1"/></label>
    </div>
    <div style="margin-top:8px"><button class="btn btn-primary" id="calc">Calculate</button></div>
    <div id="summary" class="card" style="margin-top:12px"></div>
  </div>

  <div class="card">
    <h3>Supporting Transactions (CSV)</h3>
    <p class="small">CSV format: <code>date, label, amount</code></p>
    <textarea id="csv" placeholder="2025-01-02, Catering order canceled, 1200"></textarea>
    <div style="margin-top:8px"><button class="btn" id="sum">Summarize CSV</button></div>
    <div id="csvout" class="card" style="margin-top:12px"></div>
  </div>

  <div class="card">
    <h3>Claim Information</h3>
    <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-bottom:12px">
      <label>Your Name<input id="claimantName" placeholder="Your Name"/></label>
      <label>Policy #<input id="policyNumber" placeholder="Policy #"/></label>
      <label>Claim #<input id="claimNumber" placeholder="Claim #"/></label>
      <label>Date of Loss<input id="dateOfLoss" type="date"/></label>
      <label>Insurance Company<input id="insurerName" placeholder="Insurance Company"/></label>
      <label>Phone Number<input id="phoneNumber" type="tel" placeholder="Phone Number"/></label>
      <label>Email Address<input id="email" type="email" placeholder="Email Address"/></label>
      <label>Your Address<input id="claimantAddress" placeholder="Your Address"/></label>
    </div>
    <h3>Draft BI Narrative</h3>
    <textarea id="details" placeholder="Describe how the interruption reduced income, include dates, cancellations, capacity constraints, etc."></textarea>
    <div style="margin-top:8px;display:flex;gap:8px">
      <button class="btn btn-primary" id="draft">Draft with AI</button>
      <button class="btn" id="pdf">Export PDF</button>
    </div>
    <div id="out" class="card" style="margin-top:12px"></div>
  </div>
</main>
<script type="module">
  import {qs,on} from '/app/assets/js/ui-helpers.js';
  import { callAI, createDoc } from '/app/assets/js/api-client.js';
  import { computeLostIncome, summarizeCSV } from '/app/assets/js/bi-tools.js';
  on(qs('#calc'),'click', ()=>{
    const res = computeLostIncome({ baselineMonthly:qs('#baseline').value, trendPct:qs('#trend').value, outageDays:qs('#outage').value, periodMonths:qs('#months').value });
    qs('#summary').innerHTML = `Daily Revenue: ${res.daily}<br/>Projected Period Revenue: ${res.projected}<br/><b>Estimated Lost Income:</b> ${res.lost}`;
  });
  on(qs('#sum'),'click', ()=>{
    const s = summarizeCSV(qs('#csv').value);
    const rows = s.rows.map(r=>`<tr><td>${r.date}</td><td>${r.label}</td><td style="text-align:right">${r.amount}</td></tr>`).join('');
    qs('#csvout').innerHTML = `<table><thead><tr><th>Date</th><th>Label</th><th style="text-align:right">Amount</th></tr></thead><tbody>${rows}</tbody><tfoot><tr><td colspan="2" style="text-align:right">TOTAL</td><td style="text-align:right"><b>${s.totalFmt}</b></td></tr></tfoot></table>`;
  });
  on(qs('#draft'),'click', async ()=>{
    // Collect claim information
    const claimInfo = {
      claimantName: qs('#claimantName').value || 'Not provided',
      policyNumber: qs('#policyNumber').value || 'Not provided',
      claimNumber: qs('#claimNumber').value || 'Not provided',
      dateOfLoss: qs('#dateOfLoss').value || 'Not provided',
      insurerName: qs('#insurerName').value || 'Not provided',
      phoneNumber: qs('#phoneNumber').value || 'Not provided',
      email: qs('#email').value || 'Not provided',
      claimantAddress: qs('#claimantAddress').value || 'Not provided'
    };
    
    // Generate claim header
    const claimHeader = `CLAIM INFORMATION
================
Policyholder: ${claimInfo.claimantName}
Address: ${claimInfo.claimantAddress}
Phone: ${claimInfo.phoneNumber}
Email: ${claimInfo.email}

Policy Number: ${claimInfo.policyNumber}
Claim Number: ${claimInfo.claimNumber}
Date of Loss: ${claimInfo.dateOfLoss}
Insurance Company: ${claimInfo.insurerName}

Generated: ${new Date().toLocaleDateString()}
Document Type: LOST INCOME WORKSHEET

========================================

`;
    
    const text = `BI Summary:\n${qs('#summary').innerText}\n\nTransactions:\n${qs('#csv').value}\n\nDetails:\n${qs('#details').value}`;
    qs('#out').innerHTML='Drafting…';
    const r = await callAI({inputText:text,type:'lost-income-worksheet'}); 
    const response = r.response||'(no content)';
    qs('#out').innerHTML = claimHeader + response;
  });
  on(qs('#pdf'),'click', async ()=>{
    const html=qs('#out').innerHTML.trim(); if(!html) return alert('Draft first.');
    const r=await createDoc({content:html,format:'pdf',type:'lost-income-worksheet',filename:'lost_income_'+Date.now()}); location.href=r.url||r.downloadUrl;
  });
</script>
<script type="module" src="/app/assets/js/diagnostics.js"></script>
</body></html>