<!doctype html><html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Profit & Loss Claim Summary</title><link rel="stylesheet" href="/app/assets/css/style.css"/></head><body>
<header class="header"><div class="bar container"><div class="brand"><div class="logo"></div><div>P&L Claim Summary</div></div>
<nav class="nav"><a href="/app/documents/index.html">← Documents</a></nav></div></header>
<main class="container" id="main">
  <div class="card">
    <h3>Revenue (CSV: date, label, amount)</h3>
    <textarea id="rev"></textarea>
    <h3>Expenses (CSV: date, label, amount)</h3>
    <textarea id="exp"></textarea>
    <div style="margin-top:8px"><button class="btn btn-primary" id="build">Build Summary</button></div>
    <div id="out" class="card" style="margin-top:12px"></div>
  </div>
  <div class="card">
    <h3>Draft Narrative</h3>
    <textarea id="details" placeholder="Context: seasonality, contracts lost, constraints, mitigation…"></textarea>
    <button class="btn" id="draft">Draft with AI</button>
    <div id="draftout" class="card" style="margin-top:12px"></div>
  </div>
</main>
<script type="module">
  import {qs,on} from '/app/assets/js/ui-helpers.js';
  import { summarizeCSV } from '/app/assets/js/bi-tools.js';
  import { callAI } from '/app/assets/js/api-client.js';
  on(qs('#build'),'click', ()=>{
    const R=summarizeCSV(qs('#rev').value), E=summarizeCSV(qs('#exp').value);
    const net = R.total - E.total;
    qs('#out').innerHTML = `<b>Revenue:</b> ${R.totalFmt}<br/><b>Expenses:</b> ${E.totalFmt}<br/><b>Net Impact:</b> ${(new Intl.NumberFormat(undefined,{style:'currency',currency:'USD'})).format(net)}`;
  });
  on(qs('#draft'),'click', async ()=>{
    const payload = `Revenue CSV:\n${qs('#rev').value}\n\nExpenses CSV:\n${qs('#exp').value}\n\nNotes:\n${qs('#details').value}`;
    qs('#draftout').innerHTML='Drafting…';
    const r=await callAI({inputText:payload,type:'pnl-claim-summary'}); qs('#draftout').innerHTML=r.response||'(no content)';
  });
</script>
<script type="module" src="/app/assets/js/diagnostics.js"></script>
</body></html>