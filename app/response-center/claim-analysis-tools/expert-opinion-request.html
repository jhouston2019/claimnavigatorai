<!doctype html><html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Expert Opinion Request Generator</title>
<link rel="stylesheet" href="/app/assets/css/style.css"/>
</head><body>
<header class="header"><div class="bar container">
<div class="brand"><div class="logo"></div><div>Expert Opinion Request Generator</div></div>
<nav class="nav"><a href="/app/response-center.html">‚Üê Resource Center</a></nav>
</div></header>
<main class="container" id="main">
<div class="card">
<h2>Expert Opinion Request Generator</h2>
<p class="small">Generate professional requests for expert opinions to strengthen your claim with independent assessments.</p>
</div>
<div class="card">
<h3>Claim Information</h3>
<div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(220px,1fr))">
<label>Policyholder Name<input id="policyholder" placeholder="Your full name"/></label>
<label>Policy Number<input id="policy" placeholder="Policy number"/></label>
<label>Claim Number<input id="claim" placeholder="Claim number"/></label>
<label>Date of Loss<input id="loss-date" type="date"/></label>
</div>
</div>
<div class="card">
<h3>Expert Opinion Details</h3>
<div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(220px,1fr))">
<label>Expert Type<select id="expert-type">
<option value="">Select expert type</option>
<option value="structural-engineer">Structural Engineer</option>
<option value="electrical-engineer">Electrical Engineer</option>
<option value="plumbing-specialist">Plumbing Specialist</option>
<option value="hvac-technician">HVAC Technician</option>
<option value="roofing-contractor">Roofing Contractor</option>
<option value="water-damage-specialist">Water Damage Specialist</option>
<option value="fire-investigator">Fire Investigator</option>
<option value="appraiser">Property Appraiser</option>
<option value="accountant">Forensic Accountant</option>
<option value="other">Other (specify in details)</option>
</select></label>
<label>Expert Name<input id="expert-name" placeholder="Expert's name (if known)"/></label>
<label>Expert Company<input id="expert-company" placeholder="Expert's company"/></label>
<label>Expert License<input id="expert-license" placeholder="License number (if applicable)"/></label>
</div>
</div>
<div class="card">
<h3>Damage Description</h3>
<textarea id="damage-desc" placeholder="Describe the damage that requires expert opinion. Include specific areas, extent of damage, and any visible issues."></textarea>
</div>
<div class="card">
<h3>Specific Questions for Expert</h3>
<div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(300px,1fr))">
<div>
<h4>Standard Questions</h4>
<label><input type="checkbox" id="q1" checked/> What is the cause of the damage?</label>
<label><input type="checkbox" id="q2" checked/> What is the extent of the damage?</label>
<label><input type="checkbox" id="q3" checked/> What repairs are necessary?</label>
<label><input type="checkbox" id="q4" checked/> What is the estimated cost of repairs?</label>
<label><input type="checkbox" id="q5" checked/> Are there any safety concerns?</label>
<label><input type="checkbox" id="q6" checked/> What is the timeline for repairs?</label>
</div>
<div>
<h4>Additional Questions</h4>
<textarea id="custom-questions" placeholder="Add any specific questions for this expert..."></textarea>
</div>
</div>
</div>
<div class="card">
<h3>Timeline & Requirements</h3>
<div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(220px,1fr))">
<label>Requested Completion Date<input id="completion-date" type="date"/></label>
<label>Site Access Date<input id="access-date" type="date"/></label>
<label>Report Format<select id="report-format">
<option value="written">Written Report</option>
<option value="verbal">Verbal Consultation</option>
<option value="both">Both Written & Verbal</option>
</select></label>
<label>Urgency<select id="urgency">
<option value="standard">Standard (2-3 weeks)</option>
<option value="expedited">Expedited (1 week)</option>
<option value="urgent">Urgent (3-5 days)</option>
</select></label>
</div>
</div>
<div class="card">
<h3>Contact Information</h3>
<div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(220px,1fr))">
<label>Your Phone<input id="phone" placeholder="Your phone number"/></label>
<label>Your Email<input id="email" placeholder="Your email address"/></label>
<label>Preferred Contact Method<select id="contact-method">
<option value="phone">Phone</option>
<option value="email">Email</option>
<option value="both">Both</option>
</select></label>
<label>Best Time to Contact<input id="best-time" placeholder="e.g., 9 AM - 5 PM weekdays"/></label>
</div>
</div>
<div style="margin-top:16px;display:flex;gap:8px;flex-wrap:wrap">
<button class="btn btn-primary" id="generate">Generate Expert Opinion Request</button>
<button class="btn" id="save-draft">Save Draft</button>
<button class="btn" id="load-draft">Load Draft</button>
</div>
<div id="output" class="card" style="margin-top:16px;display:none"></div>
</main>
<script type="module">
import {qs,on} from '/app/assets/js/ui-helpers.js';
import { callAI, createDoc } from '/app/assets/js/api-client.js';
import { fmtMoney } from '/app/assets/js/validation-utils.js';

function getSelectedQuestions(){
const questions = [];
if(qs('#q1').checked) questions.push('What is the cause of the damage?');
if(qs('#q2').checked) questions.push('What is the extent of the damage?');
if(qs('#q3').checked) questions.push('What repairs are necessary?');
if(qs('#q4').checked) questions.push('What is the estimated cost of repairs?');
if(qs('#q5').checked) questions.push('Are there any safety concerns?');
if(qs('#q6').checked) questions.push('What is the timeline for repairs?');
const custom = qs('#custom-questions').value.trim();
if(custom) questions.push(custom);
return questions;
}

function collectData(){
return {
policyholder: qs('#policyholder').value.trim(),
policy: qs('#policy').value.trim(),
claim: qs('#claim').value.trim(),
lossDate: qs('#loss-date').value,
expertType: qs('#expert-type').value,
expertName: qs('#expert-name').value.trim(),
expertCompany: qs('#expert-company').value.trim(),
expertLicense: qs('#expert-license').value.trim(),
damageDesc: qs('#damage-desc').value.trim(),
questions: getSelectedQuestions(),
completionDate: qs('#completion-date').value,
accessDate: qs('#access-date').value,
reportFormat: qs('#report-format').value,
urgency: qs('#urgency').value,
phone: qs('#phone').value.trim(),
email: qs('#email').value.trim(),
contactMethod: qs('#contact-method').value,
bestTime: qs('#best-time').value.trim()
};
}

function populateData(data){
qs('#policyholder').value = data.policyholder || '';
qs('#policy').value = data.policy || '';
qs('#claim').value = data.claim || '';
qs('#loss-date').value = data.lossDate || '';
qs('#expert-type').value = data.expertType || '';
qs('#expert-name').value = data.expertName || '';
qs('#expert-company').value = data.expertCompany || '';
qs('#expert-license').value = data.expertLicense || '';
qs('#damage-desc').value = data.damageDesc || '';
qs('#completion-date').value = data.completionDate || '';
qs('#access-date').value = data.accessDate || '';
qs('#report-format').value = data.reportFormat || 'written';
qs('#urgency').value = data.urgency || 'standard';
qs('#phone').value = data.phone || '';
qs('#email').value = data.email || '';
qs('#contact-method').value = data.contactMethod || 'phone';
qs('#best-time').value = data.bestTime || '';
if(data.questions){
qs('#custom-questions').value = data.questions.filter(q => 
!['What is the cause of the damage?','What is the extent of the damage?',
'What repairs are necessary?','What is the estimated cost of repairs?',
'Are there any safety concerns?','What is the timeline for repairs?'].includes(q)
).join('\n');
}
}

on(qs('#generate'),'click', async ()=>{
const data = collectData();
if(!data.policyholder || !data.expertType || !data.damageDesc){
return alert('Please fill in at least: Policyholder Name, Expert Type, and Damage Description.');
}
const payload = `Expert Opinion Request:
Policyholder: ${data.policyholder}
Policy: ${data.policy}
Claim: ${data.claim}
Loss Date: ${data.lossDate}
Expert Type: ${data.expertType}
Expert: ${data.expertName || 'TBD'}
Company: ${data.expertCompany || 'TBD'}
License: ${data.expertLicense || 'N/A'}
Damage: ${data.damageDesc}
Questions: ${data.questions.join('; ')}
Completion: ${data.completionDate}
Access: ${data.accessDate}
Format: ${data.reportFormat}
Urgency: ${data.urgency}
Contact: ${data.phone} / ${data.email}
Method: ${data.contactMethod}
Best Time: ${data.bestTime}`;
qs('#output').style.display='block';
qs('#output').innerHTML='Generating expert opinion request...';
const r = await callAI({inputText:payload,type:'expert-opinion-request'});
qs('#output').innerHTML=r.response||'(no content)';
});

on(qs('#save-draft'),'click', ()=>{
const data = collectData();
localStorage.setItem('expert_opinion_draft', JSON.stringify(data));
alert('Draft saved successfully!');
});

on(qs('#load-draft'),'click', ()=>{
const saved = localStorage.getItem('expert_opinion_draft');
if(!saved) return alert('No draft found.');
try{
const data = JSON.parse(saved);
populateData(data);
alert('Draft loaded successfully!');
}catch(e){
alert('Error loading draft: '+e.message);
}
});

// Auto-save every 30 seconds
setInterval(()=>{
const data = collectData();
localStorage.setItem('expert_opinion_autosave', JSON.stringify(data));
}, 30000);

// Load autosave on page load
const autosave = localStorage.getItem('expert_opinion_autosave');
if(autosave){
try{
const data = JSON.parse(autosave);
populateData(data);
}catch(e){}
}
</script>
<script type="module" src="/app/assets/js/diagnostics.js"></script>
</body></html>
