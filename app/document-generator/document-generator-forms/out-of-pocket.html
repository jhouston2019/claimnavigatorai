<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Out-of-Pocket Log - Document Generator</title>
    <meta name="description" content="Generate a comprehensive out-of-pocket expense log for your insurance claim">
    <link rel="stylesheet" href="/app/assets/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', sans-serif;
            background-color: #f9fafb;
            color: #111827;
            line-height: 1.6;
        }

        .header {
            background: #1e40af;
            color: white;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 600;
            font-size: 1.25rem;
        }

        .nav a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            transition: background-color 0.2s;
        }

        .nav a:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .breadcrumb {
            background: white;
            padding: 0.75rem 2rem;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.875rem;
            color: #6b7280;
        }

        .breadcrumb a {
            color: #1e40af;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .main-container {
            max-width: 100%;
            margin: 0 auto;
            padding: 2rem;
        }

        .page-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .page-header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1e40af;
            margin-bottom: 1rem;
        }

        .page-header .subtitle {
            font-size: 1.125rem;
            color: #6b7280;
            max-width: 600px;
            margin: 0 auto 1rem;
        }

        .explainer {
            background: #f0fdf4;
            border: 1px solid #22c55e;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 2rem;
            color: #166534;
            font-size: 0.875rem;
        }

        .form-container {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: #374151;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 1rem;
            color: #111827;
            transition: border-color 0.2s;
            background: white;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #1e40af;
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: #9ca3af;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            margin-left: 0.5rem;
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #374151;
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 0.5rem;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.75rem;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
            min-width: 150px;
            justify-content: center;
        }

        .btn-primary {
            background: #1e40af;
            color: white;
        }

        .btn-primary:hover {
            background: #1e3a8a;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .btn-success {
            background: #059669;
            color: white;
        }

        .btn-success:hover {
            background: #047857;
        }

        .btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .result-container {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 2rem;
            margin-top: 2rem;
            display: none;
        }

        .result-container.show {
            display: block;
        }

        .result-content {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            line-height: 1.5;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            display: inline-block;
            width: 2rem;
            height: 2rem;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #1e40af;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
        }

        @media (max-width: 768px) {
            .main-container {
                padding: 1rem;
            }

            .page-header h1 {
                font-size: 2rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .header .container {
                padding: 0 1rem;
            }

            .breadcrumb {
                padding: 0.75rem 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Header -->
    <header class="header">
        <div class="container">
            <div class="brand">
                <div>üí∞</div>
                <div>Out-of-Pocket Log Generator</div>
            </div>
            <nav class="nav">
                <a href="../index.html">‚Üê Document Generator</a>
            </nav>
        </div>
    </header>

    <!-- Breadcrumb -->
    <div class="breadcrumb">
        <a href="/app/response-center.html">‚Üê Resource Center</a> / <a href="../index.html">Document Generator</a> / Out-of-Pocket Log
    </div>

    <main class="main-container">
        <div class="page-header">
            <h1>üí∞ Out-of-Pocket Log</h1>
            <p class="subtitle">Document all additional living expenses and out-of-pocket costs</p>
        </div>

        <div class="explainer">
            <strong>What is an Out-of-Pocket Log?</strong> This document tracks all additional living expenses (ALE) and other out-of-pocket costs you've incurred as a result of your loss. This includes temporary housing, meals, transportation, and other expenses that exceed your normal living costs. These expenses are often covered under your policy's Additional Living Expenses coverage.
        </div>

        <div class="form-container">
            <form id="outOfPocketForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="claimantName">Your Full Name</label>
                        <input type="text" id="claimantName" name="claimantName" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="claimantAddress">Your Address</label>
                        <textarea id="claimantAddress" name="claimantAddress" rows="3" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="insurerName">Insurance Company</label>
                        <input type="text" id="insurerName" name="insurerName" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="policyNumber">Policy Number</label>
                        <input type="text" id="policyNumber" name="policyNumber" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="claimNumber">Claim Number</label>
                        <input type="text" id="claimNumber" name="claimNumber" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="dateOfLoss">Date of Loss</label>
                        <input type="date" id="dateOfLoss" name="dateOfLoss" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="displacementStart">Displacement Start Date <span class="tooltip">?<span class="tooltiptext">When did you have to leave your home?</span></span></label>
                        <input type="date" id="displacementStart" name="displacementStart" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="displacementEnd">Displacement End Date <span class="tooltip">?<span class="tooltiptext">When did you return home or find permanent housing?</span></span></label>
                        <input type="date" id="displacementEnd" name="displacementEnd">
                    </div>
                    
                    <div class="form-group">
                        <label for="phoneNumber">Phone Number</label>
                        <input type="tel" id="phoneNumber" name="phoneNumber" placeholder="(555) 123-4567">
                    </div>
                    
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" name="email" placeholder="your.email@example.com">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="expenses">Expense Details <span class="tooltip">?<span class="tooltiptext">List all out-of-pocket expenses with dates and amounts</span></span></label>
                    <textarea id="expenses" name="expenses" rows="8" placeholder="List all out-of-pocket expenses:

Example:
- 2024-01-15: Hotel accommodation - $150/night x 3 nights = $450
- 2024-01-16: Restaurant meals - $75/day x 3 days = $225
- 2024-01-17: Laundry services - $25
- 2024-01-18: Transportation (rental car) - $45/day x 4 days = $180
- 2024-01-19: Storage unit - $100/month
- 2024-01-20: Pet boarding - $35/day x 5 days = $175" required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="totalAmount">Total Amount</label>
                    <input type="number" id="totalAmount" name="totalAmount" step="0.01" placeholder="0.00" required>
                </div>
                
                <div class="form-group">
                    <label for="normalExpenses">Normal Living Expenses <span class="tooltip">?<span class="tooltiptext">What were your normal living expenses before the loss?</span></span></label>
                    <textarea id="normalExpenses" name="normalExpenses" rows="4" placeholder="Normal living expenses before the loss:
- Mortgage/rent: $X
- Utilities: $X
- Groceries: $X
- Transportation: $X
- Other normal expenses: $X"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="supportingDocuments">Supporting Documents <span class="tooltip">?<span class="tooltiptext">List all receipts and documentation</span></span></label>
                    <textarea id="supportingDocuments" name="supportingDocuments" rows="4" placeholder="Supporting documentation:
- Hotel receipts
- Restaurant receipts
- Transportation receipts
- Storage receipts
- Other receipts"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="additionalInfo">Additional Information</label>
                    <textarea id="additionalInfo" name="additionalInfo" rows="4" placeholder="Any additional information about your out-of-pocket expenses..."></textarea>
                </div>
            </form>
        </div>

        <div class="action-buttons">
            <button type="button" class="btn btn-primary" id="draftBtn">
                ü§ñ Draft with AI
            </button>
            <button type="button" class="btn btn-secondary" id="exportPdfBtn" disabled>
                üìÑ Export PDF
            </button>
            <button type="button" class="btn btn-success" id="exportDocxBtn" disabled>
                üìù Export DOCX
            </button>
        </div>

        <!-- Loading State -->
        <div class="loading" id="loadingState">
            <div class="spinner"></div>
            <p>Generating your Out-of-Pocket Log...</p>
        </div>

        <!-- Results -->
        <div class="result-container" id="resultContainer">
            <h3>Generated Out-of-Pocket Log</h3>
            <div class="result-content" id="resultContent"></div>
        </div>
    </main>

    <script>
        class OutOfPocketGenerator {
            constructor() {
                this.generatedContent = null;
                this.init();
            }

            init() {
                this.setupEventListeners();
            }

            setupEventListeners() {
                const draftBtn = document.getElementById('draftBtn');
                const exportPdfBtn = document.getElementById('exportPdfBtn');
                const exportDocxBtn = document.getElementById('exportDocxBtn');

                draftBtn.addEventListener('click', () => this.draftWithAI());
                exportPdfBtn.addEventListener('click', () => this.exportPDF());
                exportDocxBtn.addEventListener('click', () => this.exportDOCX());
            }

            async draftWithAI() {
                const form = document.getElementById('outOfPocketForm');
                const formData = new FormData(form);
                const data = Object.fromEntries(formData);

                // Validate required fields
                if (!data.claimantName || !data.claimantAddress || !data.insurerName || !data.policyNumber || !data.claimNumber || !data.dateOfLoss || !data.displacementStart || !data.expenses || !data.totalAmount) {
                    alert('Please fill in all required fields.');
                    return;
                }

                const loadingState = document.getElementById('loadingState');
                const resultContainer = document.getElementById('resultContainer');
                const draftBtn = document.getElementById('draftBtn');
                const exportPdfBtn = document.getElementById('exportPdfBtn');
                const exportDocxBtn = document.getElementById('exportDocxBtn');

                // Show loading
                loadingState.classList.add('show');
                resultContainer.classList.remove('show');
                draftBtn.disabled = true;
                draftBtn.textContent = 'Generating...';

                try {
                    // Call the Netlify function for AI generation
                    const response = await fetch('/netlify/functions/generate-letter', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            documentType: 'out-of-pocket',
                            formData: data
                        })
                    });

                    if (response.ok) {
                        const result = await response.json();
                        this.generatedContent = result.content;
                        this.displayResults(result.content);
                        exportPdfBtn.disabled = false;
                        exportDocxBtn.disabled = false;
                    } else {
                        throw new Error('AI generation failed');
                    }
                    
                } catch (error) {
                    console.error('AI Generation Error:', error);
                    // Fallback to static template
                    this.generatedContent = this.generateFallbackDocument(data);
                    this.displayResults(this.generatedContent);
                    exportPdfBtn.disabled = false;
                    exportDocxBtn.disabled = false;
                } finally {
                    // Hide loading
                    loadingState.classList.remove('show');
                    draftBtn.disabled = false;
                    draftBtn.textContent = 'ü§ñ Draft with AI';
                }
            }

            generateFallbackDocument(data) {
                const today = new Date().toLocaleDateString();
                return `
OUT-OF-POCKET EXPENSE LOG

Date: ${today}

Policy Number: ${data.policyNumber}
Claim Number: ${data.claimNumber}
Date of Loss: ${data.dateOfLoss}
Displacement Period: ${data.displacementStart} to ${data.displacementEnd || 'Ongoing'}

CLAIMANT INFORMATION:
${data.claimantName}
${data.claimantAddress}
${data.phoneNumber ? 'Phone: ' + data.phoneNumber : ''}
${data.email ? 'Email: ' + data.email : ''}

EXPENSE DETAILS:
${data.expenses}

TOTAL AMOUNT: $${data.totalAmount}

NORMAL LIVING EXPENSES:
${data.normalExpenses || 'Not provided'}

SUPPORTING DOCUMENTS:
${data.supportingDocuments || 'None provided'}

ADDITIONAL INFORMATION:
${data.additionalInfo || 'None'}

I declare under penalty of perjury that the foregoing is true and correct to the best of my knowledge and belief.

Signature: _________________________ Date: _________

${data.claimantName}

---
Policy Number: ${data.policyNumber}
Claim Number: ${data.claimNumber}
Date of Loss: ${data.dateOfLoss}
Total Amount: $${data.totalAmount}
                `.trim();
            }

            displayResults(content) {
                const resultContainer = document.getElementById('resultContainer');
                const resultContent = document.getElementById('resultContent');
                
                resultContent.textContent = content;
                resultContainer.classList.add('show');
                
                // Scroll to results
                resultContainer.scrollIntoView({ behavior: 'smooth' });
            }

            async exportPDF() {
                if (!this.generatedContent) {
                    alert('Please generate a document first.');
                    return;
                }

                try {
                    const response = await fetch('/netlify/functions/export-pdf', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            content: this.generatedContent,
                            filename: 'out-of-pocket-log.pdf'
                        })
                    });

                    if (response.ok) {
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'out-of-pocket-log.pdf';
                        document.body.appendChild(a);
                        a.click();
                        window.URL.revokeObjectURL(url);
                        document.body.removeChild(a);
                    } else {
                        throw new Error('PDF export failed');
                    }
                } catch (error) {
                    console.error('PDF Export Error:', error);
                    alert('Failed to export PDF. Please try again.');
                }
            }

            async exportDOCX() {
                if (!this.generatedContent) {
                    alert('Please generate a document first.');
                    return;
                }

                try {
                    const response = await fetch('/netlify/functions/export-docx', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            content: this.generatedContent,
                            filename: 'out-of-pocket-log.docx'
                        })
                    });

                    if (response.ok) {
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'out-of-pocket-log.docx';
                        document.body.appendChild(a);
                        a.click();
                        window.URL.revokeObjectURL(url);
                        document.body.removeChild(a);
                    } else {
                        throw new Error('DOCX export failed');
                    }
                } catch (error) {
                    console.error('DOCX Export Error:', error);
                    alert('Failed to export DOCX. Please try again.');
                }
            }
        }

        // Initialize the generator when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            new OutOfPocketGenerator();
        });
    </script>
</body>
</html>
