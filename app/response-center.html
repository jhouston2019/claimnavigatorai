<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Response Center - ClaimNavigatorAI</title>
  <meta name="description" content="AI-powered claim response center with document library, AI response generation, and claim analysis tools.">
  <style>
    :root {
      --primary: #1e40af;
      --accent: #3b82f6;
      --border: #e5e7eb;
      --text-secondary: #6b7280;
      --bg-light: #f9fafb;
    }
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#fff; }
    header { background:#0f172a; padding:1rem; color:#fff; position:sticky; top:0; }
    nav { display:flex; justify-content:space-between; align-items:center; }
    .nav-links { display:flex; gap:1rem; }
    .nav-links a { color:#fff; text-decoration:none; }
    .main-content { padding:2rem; }
    .tabs { display:flex; border-bottom:2px solid var(--border); margin-bottom:1.5rem; }
    .tab { padding:1rem; cursor:pointer; }
    .tab.active { border-bottom:3px solid var(--primary); font-weight:bold; }
    .tab-content { display:none; }
    .tab-content.active { display:block; }
    .btn-primary { background:var(--primary); color:#fff; border:none; border-radius:0.5rem; padding:0.5rem 1rem; cursor:pointer; }
    .btn-secondary { background:var(--accent); color:#fff; border:none; border-radius:0.5rem; padding:0.5rem 1rem; cursor:pointer; }
    .tool-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(320px,1fr)); gap:1rem; }
    .tool-card { background:var(--bg-light); padding:1rem; border:1px solid var(--border); border-radius:0.5rem; }
    .tool-title { font-weight:bold; margin-bottom:0.5rem; }
    .tool-desc { font-size:0.9rem; color:var(--text-secondary); margin-bottom:0.5rem; }
    .tool-output { display:none; background:#fff; border:1px solid var(--border); border-radius:0.5rem; padding:0.75rem; white-space:pre-wrap; margin-top:0.5rem; min-height:80px; }
    .action-buttons { display:flex; gap:0.5rem; flex-wrap:wrap; margin-top:0.5rem; }
    .spinner { border:3px solid #f3f3f3; border-top:3px solid var(--primary); border-radius:50%; width:18px; height:18px; animation:spin 1s linear infinite; display:inline-block; }
    @keyframes spin { 0% { transform:rotate(0deg);} 100%{ transform:rotate(360deg);} }
  </style>
</head>
<body>
  <header>
    <nav>
      <div class="logo">ClaimNavigatorAI</div>
      <div class="nav-links">
        <a href="../index.html">Home</a>
        <a href="../product.html">Product</a>
        <a href="response-center.html">Response Center</a>
        <a href="settings.html">Settings</a>
        <a href="#" onclick="logout()">Logout</a>
      </div>
    </nav>
  </header>

  <main class="main-content">
    <h1>Response Center</h1>
    <p>AI-powered tools to strengthen your claim and generate professional responses</p>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab active" onclick="switchTab('ai-agent')">AI Response & Analysis Agent</button>
      <button class="tab" onclick="switchTab('my-documents')">My Documents</button>
      <button class="tab" onclick="switchTab('analysis-tools')">Claim Analysis Tools</button>
      <button class="tab" onclick="switchTab('settings')">Settings</button>
    </div>

    <!-- AI Agent -->
    <div id="ai-agent" class="tab-content active">
      <textarea id="input-text" class="tool-output" style="display:block; min-height:120px;" placeholder="Paste insurer correspondence..."></textarea>
      <div class="action-buttons">
        <button class="btn-primary" onclick="generateResponse()">Generate Response</button>
        <button class="btn-primary" onclick="exportDoc('docx')">Export DOCX</button>
        <button class="btn-primary" onclick="exportDoc('pdf')">Export PDF</button>
        <button class="btn-primary" onclick="saveDraft()">Save to My Documents</button>
        <select id="language-select" style="padding:0.5rem; border-radius:0.5rem;">
          <option value="en">English</option>
          <option value="es">Espa√±ol</option>
        </select>
      </div>
      <div id="ai-output" class="tool-output"></div>
      <div id="confidence-meter" style="margin-top:0.5rem; font-size:0.9rem; color:var(--text-secondary);"></div>
      <h3>Session History</h3>
      <div id="session-history"></div>
    </div>

    <!-- My Documents -->
    <div id="my-documents" class="tab-content">
      <input type="text" id="doc-search" placeholder="Search documents..." oninput="filterDocuments()" style="width:100%; margin-bottom:1rem; padding:0.5rem;">
      <input type="file" id="doc-upload" onchange="uploadDocument()" style="margin-bottom:1rem;">
      <div id="documents-container"></div>
    </div>

    <!-- Claim Analysis Tools -->
    <div id="analysis-tools" class="tab-content">
      <h2>Claim Analysis Tools</h2>
      <div class="tool-grid" id="tool-grid">
        <!-- Tool cards injected by JS for maintainability -->
      </div>
    </div>

    <!-- Settings -->
    <div id="settings" class="tab-content">
      <h2>Account Settings</h2>
      <div id="credit-log"></div>
      <button class="btn-secondary" onclick="downloadAllOutputs()">Download All Outputs (ZIP)</button>
    </div>
  </main>

  <script>
    // --- Tab + Session Helpers ---
    function switchTab(tab){document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));document.getElementById(tab).classList.add('active');event.target.classList.add('active');}
    function logout(){localStorage.removeItem('userEmail');window.location.href='../index.html';}
    function getLanguage(){return document.getElementById('language-select')?.value || 'en';}
    function addToHistory(tool,text){const h=document.getElementById('session-history');const div=document.createElement('div');div.innerText=`${tool}: ${text.substring(0,100)}...`;h.prepend(div);if(h.childNodes.length>10)h.removeChild(h.lastChild);}

    // --- AI Agent ---
    async function generateResponse(){
      const input=document.getElementById('input-text').value.trim();
      if(!input)return alert("Please paste text first.");
      const out=document.getElementById('ai-output');
      out.style.display='block';out.innerHTML=`<div class="spinner"></div> Generating...`;
      try{
        const res=await fetch('/.netlify/functions/generate-response',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email:localStorage.getItem('userEmail'),inputText:input,language:getLanguage()})});
        const data=await res.json();
        if(res.ok&&data.draft){out.textContent=data.draft;document.getElementById('confidence-meter').innerText="Confidence: High";addToHistory("ai-agent",data.draft);}else out.textContent=data.error||"Failed.";
      }catch(e){console.error(e);out.textContent="Error generating.";}
    }

    // --- Claim Analysis Tools ---
    const tools=[
      {id:'reserve-inquiry',title:'Reserve Inquiry Letter',desc:'Request insurer reserve information.'},
      {id:'coverage-analyzer',title:'Coverage Letter Analyzer',desc:'Analyze insurer coverage letters.'},
      {id:'supplement-request',title:'Supplement Request Draft',desc:'Request additional scope items.'},
      {id:'pol-checklist',title:'Proof of Loss Checklist',desc:'Checklist of Proof of Loss requirements.'},
      {id:'depreciation-release',title:'Depreciation Release Request',desc:'Request release of recoverable depreciation.'},
      {id:'ale-extension',title:'ALE Extension Letter',desc:'Request ALE extension.'},
      {id:'settlement-analyzer',title:'Settlement Analyzer',desc:'Analyze settlement offers.'},
      {id:'badfaith-checker',title:'Bad Faith Checker',desc:'Check for bad faith indicators.'},
      {id:'escalation-drafts',title:'Escalation Drafts',desc:'Generate escalation drafts.'},
      {id:'timeline-builder',title:'Timeline Builder',desc:'Build claim event timelines.'},
      {id:'policy-analyzer',title:'Policy Language Analyzer',desc:'Explain policy language.'},
      {id:'demand-letter',title:'Demand Letter Generator',desc:'Draft persuasive demand letters.'},
      {id:'attorney-prep',title:'Attorney Prep Sheet',desc:'Summarize claim for attorneys.'},
      {id:'badfaith-complaint',title:'Bad Faith Complaint Letter',desc:'Draft DOI complaints.'},
    ];

    function renderTools(){
      const grid=document.getElementById('tool-grid');
      grid.innerHTML="";
      tools.forEach(t=>{
        grid.innerHTML+=`
          <div class="tool-card">
            <div class="tool-title">${t.title}</div>
            <div class="tool-desc">${t.desc}</div>
            <button class="btn-primary" onclick="runTool('${t.id}')">Generate</button>
            <div id="${t.id}-output" class="tool-output"></div>
            <div id="${t.id}-actions" class="action-buttons" style="display:none;">
              <button class="btn-primary" onclick="copyToolOutput('${t.id}')">Copy</button>
              <button class="btn-primary" onclick="downloadToolOutput('${t.id}')">Download</button>
              <button class="btn-primary" onclick="clearOutput('${t.id}')">Clear</button>
              ${t.id==='timeline-builder'?'<button class="btn-primary" onclick="exportTimeline()">Export CSV</button>':""}
            </div>
          </div>`;
      });
    }

    async function runTool(tool){
      const out=document.getElementById(`${tool}-output`);
      const actions=document.getElementById(`${tool}-actions`);
      out.style.display='block';out.innerHTML=`<div class="spinner"></div> Generating...`;actions.style.display='none';
      try{
        const res=await fetch('/.netlify/functions/generate-response',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email:localStorage.getItem('userEmail'),mode:tool,inputText:`Run tool: ${tool}`,language:getLanguage()})});
        const data=await res.json();
        if(res.ok&&data.draft){out.textContent=data.draft;actions.style.display='flex';addToHistory(tool,data.draft);}else out.textContent=data.error||"Failed.";
      }catch(err){console.error(err);out.textContent="Error generating.";}
    }

    function copyToolOutput(t){const text=document.getElementById(`${t}-output`).innerText;if(!text)return alert("No content.");navigator.clipboard.writeText(text).then(()=>alert("Copied!"));}
    function downloadToolOutput(t){const text=document.getElementById(`${t}-output`).innerText;if(!text)return;const blob=new Blob([text],{type:'text/plain'});const link=document.createElement('a');link.href=URL.createObjectURL(blob);link.download=`${t}-output.txt`;link.click();}
    function clearOutput(t){document.getElementById(`${t}-output`).textContent='';document.getElementById(`${t}-actions`).style.display='none';}
    function exportDoc(type){fetch('/.netlify/functions/export-doc',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email:localStorage.getItem('userEmail'),type})}).then(res=>res.blob()).then(blob=>{const link=document.createElement('a');link.href=URL.createObjectURL(blob);link.download=`response.${type}`;link.click();});}
    function saveDraft(){const text=document.getElementById('ai-output').innerText;if(!text)return alert("No draft.");fetch('/.netlify/functions/save-draft',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email:localStorage.getItem('userEmail'),content:text})}).then(()=>alert("Draft saved."));}
    function filterDocuments(){/* search Supabase */} 
    function uploadDocument(){const file=document.getElementById('doc-upload').files[0];if(!file)return;const formData=new FormData();formData.append('file',file);formData.append('email',localStorage.getItem('userEmail'));fetch('/.netlify/functions/classify-upload',{method:'POST',body:formData}).then(()=>alert("Uploaded."));}
    function downloadAllOutputs(){fetch('/.netlify/functions/download-all',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email:localStorage.getItem('userEmail')})}).then(res=>res.blob()).then(blob=>{const link=document.createElement('a');link.href=URL.createObjectURL(blob);link.download="All-Outputs.zip";link.click();});}
    function exportTimeline(){alert("Timeline export would return CSV/Excel (backend).");}

    // Render on load
    document.addEventListener('DOMContentLoaded',renderTools);
  </script>
</body>
</html>
