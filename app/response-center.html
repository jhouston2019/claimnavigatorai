<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Response Center - ClaimNavigatorAI</title>
  <meta name="description" content="AI-powered claim response center with document library, AI response generation, claim analysis tools, and playbook.">
  <style>
    :root {
      --primary: #1e40af;
      --accent: #3b82f6;
      --border: #e5e7eb;
      --text-secondary: #6b7280;
      --bg-light: #f9fafb;
    }
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#fff; }
    header { background:#0f172a; padding:1rem; color:#fff; position:sticky; top:0; }
    nav { display:flex; justify-content:space-between; align-items:center; }
    .nav-links { display:flex; gap:1rem; }
    .nav-links a { color:#fff; text-decoration:none; }
    .main-content { padding:2rem; }
    .tabs { display:flex; border-bottom:2px solid var(--border); margin-bottom:1.5rem; flex-wrap:wrap; }
    .tab { padding:1rem; cursor:pointer; }
    .tab.active { border-bottom:3px solid var(--primary); font-weight:bold; }
    .tab-content { display:none; }
    .tab-content.active { display:block; }
    .btn-primary { background:var(--primary); color:#fff; border:none; border-radius:0.5rem; padding:0.5rem 1rem; cursor:pointer; text-decoration:none; display:inline-block; }
    .btn-secondary { background:var(--accent); color:#fff; border:none; border-radius:0.5rem; padding:0.5rem 1rem; cursor:pointer; text-decoration:none; display:inline-block; }
    .tool-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(320px,1fr)); gap:1rem; }
    .tool-card { background:var(--bg-light); padding:1rem; border:1px solid var(--border); border-radius:0.5rem; }
    .tool-title { font-weight:bold; margin-bottom:0.5rem; }
    .tool-desc { font-size:0.9rem; color:var(--text-secondary); margin-bottom:0.5rem; }
    .tool-output { display:none; background:#fff; border:1px solid var(--border); border-radius:0.5rem; padding:0.75rem; white-space:pre-wrap; margin-top:0.5rem; min-height:80px; }
    .action-buttons { display:flex; gap:0.5rem; flex-wrap:wrap; margin-top:0.5rem; }
    .spinner { border:3px solid #f3f3f3; border-top:3px solid var(--primary); border-radius:50%; width:18px; height:18px; animation:spin 1s linear infinite; display:inline-block; }
    @keyframes spin { 0% { transform:rotate(0deg);} 100%{ transform:rotate(360deg);} }

    /* Accordion for Claim Playbook */
    .accordion .accordion-item { border:1px solid var(--border); border-radius:0.5rem; margin-bottom:1rem; overflow:hidden; }
    .accordion-header { width:100%; text-align:left; background:var(--bg-light); padding:0.75rem; border:none; font-weight:bold; cursor:pointer; }
    .accordion-body { display:none; padding:1rem; background:#fff; border-top:1px solid var(--border); }
    .accordion-item.active .accordion-body { display:block; }
    .accordion-body ul { list-style:none; padding:0; }
    .accordion-body li { margin-bottom:0.5rem; }

    /* Affiliate Tools Styles */
    .affiliate-disclosure { background:var(--bg-light); padding:1rem; border-radius:0.5rem; border-left:4px solid var(--primary); margin:2rem 0; font-size:0.875rem; color:var(--text-secondary); }
    .resource-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:1rem; margin-top:1rem; }
    .resource-card { background:var(--bg-light); padding:1rem; border:1px solid var(--border); border-radius:0.5rem; }
    .resource-badge { background:var(--primary); color:#fff; padding:0.25rem 0.5rem; border-radius:0.25rem; font-size:0.75rem; font-weight:bold; text-transform:uppercase; }
    .resource-card h4 { color:#000; margin:0.5rem 0; font-size:1.1rem; }
    .resource-card p { color:var(--text-secondary); font-size:0.9rem; margin-bottom:1rem; }
  </style>
</head>
<body>
  <header>
    <nav>
      <div class="logo">ClaimNavigatorAI</div>
      <div class="nav-links">
        <a href="../index.html">Home</a>
        <a href="../product.html">Product</a>
        <a href="response-center.html">Response Center</a>
        <a href="settings.html">Settings</a>
        <a href="#" onclick="logout()">Logout</a>
      </div>
    </nav>
  </header>

  <main class="main-content">
    <h1>Response Center</h1>
    <p>AI-powered tools to strengthen your claim and generate professional responses</p>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab active" onclick="switchTab(event,'ai-agent')">AI Response & Analysis Agent</button>
      <button class="tab" onclick="switchTab(event,'my-documents')">My Documents</button>
      <button class="tab" onclick="switchTab(event,'analysis-tools')">Claim Analysis Tools</button>
      <button class="tab" onclick="switchTab(event,'claim-playbook')">Claim Playbook</button>
      <button class="tab" onclick="switchTab(event,'claim-documentation-guides')">Claim Documentation Guides</button>
      <button class="tab" onclick="switchTab(event,'recommended-resources')">Recommended Resources</button>
      <button class="tab" onclick="switchTab(event,'recommended-tools')">Recommended Tools</button>
      <button class="tab" onclick="switchTab(event,'settings')">Settings</button>
    </div>

    <!-- AI Agent -->
    <div id="ai-agent" class="tab-content active">
      <textarea id="input-text" style="width:100%; min-height:120px; margin-bottom:1rem;" placeholder="Paste insurer correspondence..."></textarea>
      <div class="action-buttons">
        <button class="btn-primary" onclick="generateResponse()">Generate Response</button>
        <button class="btn-primary" onclick="exportDoc('docx')">Export DOCX</button>
        <button class="btn-primary" onclick="exportDoc('pdf')">Export PDF</button>
        <button class="btn-primary" onclick="saveDraft()">Save to My Documents</button>
        <select id="language-select" style="padding:0.5rem; border-radius:0.5rem;">
          <option value="en">English</option>
          <option value="es">Español</option>
        </select>
      </div>
      <div id="ai-output" class="tool-output"></div>
      <div id="confidence-meter" style="margin-top:0.5rem; font-size:0.9rem; color:var(--text-secondary);"></div>
      <h3>Session History</h3>
      <div id="session-history"></div>
    </div>

    <!-- My Documents -->
    <div id="my-documents" class="tab-content">
      <h2>My Documents</h2>
      <div class="lang-toggle" style="margin-bottom:1rem;">
        <button id="lang-en" onclick="setLang('en')" class="btn-primary">English</button>
        <button id="lang-es" onclick="setLang('es')" class="btn-secondary">Español</button>
      </div>
      <input type="text" id="doc-search" placeholder="Search documents..."
        oninput="filterDocuments()" style="width:100%; margin-bottom:1rem; padding:0.5rem;">
      <input type="file" id="doc-upload" onchange="uploadDocument()" style="margin-bottom:1rem;">
      <div id="documents-container"></div>
    </div>

    <!-- Claim Analysis Tools -->
    <div id="analysis-tools" class="tab-content">
      <h2>Claim Analysis Tools</h2>
      <p>Professional tools to analyze your claim, review coverage, and assess damages</p>
      
      <div class="tool-grid" id="tool-grid">
        <!-- Policy Review Tool -->
        <div class="tool-card">
          <div class="tool-title">Policy Review & Coverage Analysis</div>
          <div class="tool-desc">Upload your policy documents for AI-powered coverage analysis and gap identification</div>
          <textarea id="policy-input" placeholder="Paste your policy information here or upload documents..." style="width: 100%; min-height: 80px; margin: 0.5rem 0; padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 0.5rem;"></textarea>
          <div class="action-buttons">
            <button class="btn-primary" onclick="analyzePolicy()">Analyze Policy</button>
            <button class="btn-secondary" onclick="downloadPolicyChecklist()">Download Checklist</button>
          </div>
          <div id="policy-analysis-output" class="tool-output"></div>
        </div>

        <!-- Damage Assessment Tool -->
        <div class="tool-card">
          <div class="tool-title">Damage Assessment Calculator</div>
          <div class="tool-desc">Calculate and document property damage with line-item estimates and depreciation analysis</div>
          <textarea id="damage-input" placeholder="Describe the damage, paste estimates, or upload photos..." style="width: 100%; min-height: 80px; margin: 0.5rem 0; padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 0.5rem;"></textarea>
          <div class="action-buttons">
            <button class="btn-primary" onclick="assessDamage()">Start Assessment</button>
            <button class="btn-secondary" onclick="downloadDamageForm()">Download Form</button>
          </div>
          <div id="damage-assessment-output" class="tool-output"></div>
        </div>

        <!-- Estimate Review Tool -->
        <div class="tool-card">
          <div class="tool-title">Estimate Review & Comparison</div>
          <div class="tool-desc">Compare contractor estimates with insurer estimates and identify discrepancies</div>
          <textarea id="estimate-input" placeholder="Paste contractor and insurer estimates for comparison..." style="width: 100%; min-height: 80px; margin: 0.5rem 0; padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 0.5rem;"></textarea>
          <div class="action-buttons">
            <button class="btn-primary" onclick="reviewEstimate()">Review Estimate</button>
            <button class="btn-secondary" onclick="downloadComparison()">Download Comparison</button>
          </div>
          <div id="estimate-review-output" class="tool-output"></div>
        </div>

        <!-- Business Interruption Tool -->
        <div class="tool-card">
          <div class="tool-title">Business Interruption Calculator</div>
          <div class="tool-desc">Calculate business interruption losses including lost revenue and extra expenses</div>
          <textarea id="bi-input" placeholder="Provide business financial information, revenue data, and expenses..." style="width: 100%; min-height: 80px; margin: 0.5rem 0; padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 0.5rem;"></textarea>
          <div class="action-buttons">
            <button class="btn-primary" onclick="calculateBI()">Calculate BI Loss</button>
            <button class="btn-secondary" onclick="downloadBICalc()">Download Calculator</button>
          </div>
          <div id="bi-calculator-output" class="tool-output"></div>
        </div>

        <!-- Expert Opinion Tool -->
        <div class="tool-card">
          <div class="tool-title">Expert Opinion Request Generator</div>
          <div class="tool-desc">Generate professional requests for expert opinions on damage assessment or policy interpretation</div>
          <textarea id="expert-input" placeholder="Describe the claim situation and type of expert opinion needed..." style="width: 100%; min-height: 80px; margin: 0.5rem 0; padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 0.5rem;"></textarea>
          <div class="action-buttons">
            <button class="btn-primary" onclick="requestExpertOpinion()">Generate Request</button>
            <button class="btn-secondary" onclick="downloadExpertForm()">Download Form</button>
          </div>
          <div id="expert-opinion-output" class="tool-output"></div>
        </div>

        <!-- Settlement Analysis Tool -->
        <div class="tool-card">
          <div class="tool-title">Settlement Analysis & Negotiation</div>
          <div class="tool-desc">Analyze settlement offers and generate negotiation strategies with supporting documentation</div>
          <textarea id="settlement-input" placeholder="Paste settlement offer details and your claim information..." style="width: 100%; min-height: 80px; margin: 0.5rem 0; padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 0.5rem;"></textarea>
          <div class="action-buttons">
            <button class="btn-primary" onclick="analyzeSettlement()">Analyze Settlement</button>
            <button class="btn-secondary" onclick="downloadNegotiation()">Download Strategy</button>
          </div>
          <div id="settlement-analysis-output" class="tool-output"></div>
        </div>
      </div>
    </div>

    <!-- Claim Playbook -->
    <div id="claim-playbook" class="tab-content">
      <h2>Claim Playbook</h2>
      <p>Step-by-step roadmap for managing your insurance claim. Expand each phase for checklists, decision points, and the right documents.</p>

      <div class="accordion">

        <div class="accordion-item">
          <button class="accordion-header">Phase 1: Initial Notice of Loss</button>
          <div class="accordion-body">
            <ul>
              <li>Notify insurer immediately after the loss</li>
              <li>Submit initial claim form</li>
              <li>Document date/time of event and initial damages</li>
              <li>Upload proof of loss (photos, receipts)</li>
              <li>Track claim number & adjuster contact</li>
            </ul>
          </div>
        </div>

        <div class="accordion-item">
          <button class="accordion-header">Phase 2: Documentation & Evidence</button>
          <div class="accordion-body">
            <ul>
              <li>Collect receipts, invoices, estimates</li>
              <li>Upload contractor reports</li>
              <li>Maintain expense log for ALE (Additional Living Expenses)</li>
              <li>Cross-reference with policy limits</li>
            </ul>
          </div>
        </div>

        <div class="accordion-item">
          <button class="accordion-header">Phase 3: Adjuster Inspection</button>
          <div class="accordion-body">
            <ul>
              <li>Schedule inspection with insurer’s adjuster</li>
              <li>Prepare property for walkthrough</li>
              <li>Provide all requested documentation</li>
              <li>Request a copy of the adjuster’s report</li>
            </ul>
          </div>
        </div>

        <div class="accordion-item">
          <button class="accordion-header">Phase 4: Estimate Review</button>
          <div class="accordion-body">
            <ul>
              <li>Review insurer’s estimate line-by-line</li>
              <li>Compare with contractor estimates</li>
              <li>Highlight discrepancies for negotiation</li>
              <li>Prepare supplemental documentation</li>
            </ul>
          </div>
        </div>

        <div class="accordion-item">
          <button class="accordion-header">Phase 5: Negotiation</button>
          <div class="accordion-body">
            <ul>
              <li>Communicate discrepancies to adjuster</li>
              <li>Submit revised estimates</li>
              <li>Keep written record of all communications</li>
              <li>Escalate if adjuster refuses fair settlement</li>
            </ul>
          </div>
        </div>

        <div class="accordion-item">
          <button class="accordion-header">Phase 6: Supplemental Claims</button>
          <div class="accordion-body">
            <ul>
              <li>File additional claims for missed damages</li>
              <li>Submit contractor invoices for hidden damages</li>
              <li>Document ongoing ALE expenses</li>
              <li>Track all supplemental claim approvals</li>
            </ul>
          </div>
        </div>

        <div class="accordion-item">
          <button class="accordion-header">Phase 7: Escalation</button>
          <div class="accordion-body">
            <ul>
              <li>Send formal demand letter</li>
              <li>Request supervisor review</li>
              <li>Engage public adjuster or legal counsel</li>
              <li>Prepare for appraisal or mediation</li>
            </ul>
          </div>
        </div>

        <div class="accordion-item">
          <button class="accordion-header">Phase 8: Appraisal / Mediation</button>
          <div class="accordion-body">
            <ul>
              <li>Initiate appraisal clause if available</li>
              <li>Hire independent appraiser</li>
              <li>Engage mediation/arbitration if required</li>
              <li>Maintain documentation trail for litigation</li>
            </ul>
          </div>
        </div>

        <div class="accordion-item">
          <button class="accordion-header">Phase 9: Final Settlement & Payment</button>
          <div class="accordion-body">
            <ul>
              <li>Review final settlement offer</li>
              <li>Ensure payment matches settlement</li>
              <li>Confirm ALE reimbursement</li>
              <li>Close out claim and archive documents</li>
            </ul>
          </div>
        </div>

      </div>
    </div>

    <!-- Claim Documentation Guides -->
    <div id="claim-documentation-guides" class="tab-content">
      <h2>Claim Documentation Guides</h2>
      <p>Expert guidance and recommended tools for every stage of your claim</p>

      <!-- 10 Essential Apps Guide -->
      <div class="tool-card" style="margin-bottom: 2rem;">
        <div class="tool-title">📱 10 Essential Apps Every Policyholder Needs</div>
        <div class="tool-desc">From document scanning to photo evidence, these apps will help you build a stronger claim. Includes our top picks for iOS and Android.</div>
        
        <div style="margin-top: 1rem;">
          <h4 style="color: var(--primary); margin-bottom: 1rem;">Document Scanning & Organization</h4>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
            <div style="background: #f8fafc; padding: 1rem; border-radius: 8px; border-left: 4px solid var(--primary);">
              <div style="font-weight: 600; margin-bottom: 0.5rem;">📄 Adobe Scan</div>
              <div style="font-size: 0.9rem; color: #64748b; margin-bottom: 0.5rem;">Free PDF scanner with OCR text recognition</div>
              <div style="font-size: 0.85rem; color: var(--primary); margin-bottom: 0.5rem;"><strong>Best for:</strong> Converting paper documents to searchable PDFs</div>
              <a href="https://www.amazon.com/dp/B00X4WHP5E?tag=ash202500-20" target="_blank" rel="noopener noreferrer" style="font-size: 0.85rem; color: var(--primary); text-decoration: none; font-weight: 500;">Get Adobe Scan →</a>
            </div>
            <div style="background: #f8fafc; padding: 1rem; border-radius: 8px; border-left: 4px solid var(--primary);">
              <div style="font-weight: 600; margin-bottom: 0.5rem;">📁 Dropbox</div>
              <div style="font-size: 0.9rem; color: #64748b; margin-bottom: 0.5rem;">Cloud storage with automatic photo backup</div>
              <div style="font-size: 0.85rem; color: var(--primary); margin-bottom: 0.5rem;"><strong>Best for:</strong> Secure document storage and sharing</div>
              <a href="https://www.dropbox.com/business" target="_blank" rel="noopener noreferrer" style="font-size: 0.85rem; color: var(--primary); text-decoration: none; font-weight: 500;">Get Dropbox Business →</a>
            </div>
            <div style="background: #f8fafc; padding: 1rem; border-radius: 8px; border-left: 4px solid var(--primary);">
              <div style="font-weight: 600; margin-bottom: 0.5rem;">📝 Evernote</div>
              <div style="font-size: 0.9rem; color: #64748b; margin-bottom: 0.5rem;">Note-taking with document attachment</div>
              <div style="font-size: 0.85rem; color: var(--primary); margin-bottom: 0.5rem;"><strong>Best for:</strong> Creating searchable claim journals</div>
              <a href="https://evernote.com" target="_blank" rel="noopener noreferrer" style="font-size: 0.85rem; color: var(--primary); text-decoration: none; font-weight: 500;">Get Evernote →</a>
            </div>
          </div>

          <h4 style="color: var(--primary); margin-bottom: 1rem;">Photo Documentation</h4>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
            <div style="background: #f8fafc; padding: 1rem; border-radius: 8px; border-left: 4px solid var(--primary);">
              <div style="font-weight: 600; margin-bottom: 0.5rem;">📸 Camera+ 2</div>
              <div style="font-size: 0.9rem; color: #64748b; margin-bottom: 0.5rem;">Professional camera app with manual controls</div>
              <div style="font-size: 0.85rem; color: var(--primary); margin-bottom: 0.5rem;"><strong>Best for:</strong> High-quality damage photos with metadata</div>
              <a href="https://apps.apple.com/app/camera-2/id6444682319" target="_blank" rel="noopener noreferrer" style="font-size: 0.85rem; color: var(--primary); text-decoration: none; font-weight: 500;">Get Camera+ 2 →</a>
            </div>
            <div style="background: #f8fafc; padding: 1rem; border-radius: 8px; border-left: 4px solid var(--primary);">
              <div style="font-weight: 600; margin-bottom: 0.5rem;">📏 Photo Measures</div>
              <div style="font-size: 0.9rem; color: #64748b; margin-bottom: 0.5rem;">Add measurements and annotations to photos</div>
              <div style="font-size: 0.85rem; color: var(--primary); margin-bottom: 0.5rem;"><strong>Best for:</strong> Documenting damage dimensions</div>
              <a href="https://apps.apple.com/app/photo-measures/id337025123" target="_blank" rel="noopener noreferrer" style="font-size: 0.85rem; color: var(--primary); text-decoration: none; font-weight: 500;">Get Photo Measures →</a>
            </div>
            <div style="background: #f8fafc; padding: 1rem; border-radius: 8px; border-left: 4px solid var(--primary);">
              <div style="font-weight: 600; margin-bottom: 0.5rem;">🌧️ Moisture Meter</div>
              <div style="font-size: 0.9rem; color: #64748b; margin-bottom: 0.5rem;">Detect water damage with your phone</div>
              <div style="font-size: 0.85rem; color: var(--primary); margin-bottom: 0.5rem;"><strong>Best for:</strong> Water damage documentation</div>
              <a href="https://www.amazon.com/dp/B09B1DHP5F?tag=ash202500-20" target="_blank" rel="noopener noreferrer" style="font-size: 0.85rem; color: var(--primary); text-decoration: none; font-weight: 500;">Get Photo Evidence Kit →</a>
            </div>
          </div>

          <h4 style="color: var(--primary); margin-bottom: 1rem;">Communication & Tracking</h4>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
            <div style="background: #f8fafc; padding: 1rem; border-radius: 8px; border-left: 4px solid var(--primary);">
              <div style="font-weight: 600; margin-bottom: 0.5rem;">📞 Call Recorder</div>
              <div style="font-size: 0.9rem; color: #64748b; margin-bottom: 0.5rem;">Record phone calls with adjusters (check local laws)</div>
              <div style="font-size: 0.85rem; color: var(--primary); margin-bottom: 0.5rem;"><strong>Best for:</strong> Documenting conversations</div>
              <a href="https://apps.apple.com/app/tapeacall-call-recorder/id292990399" target="_blank" rel="noopener noreferrer" style="font-size: 0.85rem; color: var(--primary); text-decoration: none; font-weight: 500;">Get Call Recorder →</a>
            </div>
            <div style="background: #f8fafc; padding: 1rem; border-radius: 8px; border-left: 4px solid var(--primary);">
              <div style="font-weight: 600; margin-bottom: 0.5rem;">📅 Google Calendar</div>
              <div style="font-size: 0.9rem; color: #64748b; margin-bottom: 0.5rem;">Track deadlines and appointments</div>
              <div style="font-size: 0.85rem; color: var(--primary); margin-bottom: 0.5rem;"><strong>Best for:</strong> Meeting reminders and deadline tracking</div>
              <a href="https://calendar.google.com" target="_blank" rel="noopener noreferrer" style="font-size: 0.85rem; color: var(--primary); text-decoration: none; font-weight: 500;">Get Google Calendar →</a>
            </div>
            <div style="background: #f8fafc; padding: 1rem; border-radius: 8px; border-left: 4px solid var(--primary);">
              <div style="font-weight: 600; margin-bottom: 0.5rem;">📧 Gmail</div>
              <div style="font-size: 0.9rem; color: #64748b; margin-bottom: 0.5rem;">Email with automatic backup and search</div>
              <div style="font-size: 0.85rem; color: var(--primary); margin-bottom: 0.5rem;"><strong>Best for:</strong> Email correspondence tracking</div>
              <a href="https://gmail.com" target="_blank" rel="noopener noreferrer" style="font-size: 0.85rem; color: var(--primary); text-decoration: none; font-weight: 500;">Get Gmail →</a>
            </div>
          </div>

          <h4 style="color: var(--primary); margin-bottom: 1rem;">Financial Tracking</h4>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
            <div style="background: #f8fafc; padding: 1rem; border-radius: 8px; border-left: 4px solid var(--primary);">
              <div style="font-weight: 600; margin-bottom: 0.5rem;">💰 Mint</div>
              <div style="font-size: 0.9rem; color: #64748b; margin-bottom: 0.5rem;">Track expenses and receipts</div>
              <div style="font-size: 0.85rem; color: var(--primary); margin-bottom: 0.5rem;"><strong>Best for:</strong> Additional Living Expenses (ALE) tracking</div>
              <a href="https://mint.intuit.com" target="_blank" rel="noopener noreferrer" style="font-size: 0.85rem; color: var(--primary); text-decoration: none; font-weight: 500;">Get Mint →</a>
            </div>
            <div style="background: #f8fafc; padding: 1rem; border-radius: 8px; border-left: 4px solid var(--primary);">
              <div style="font-weight: 600; margin-bottom: 0.5rem;">🧾 Receipt Scanner</div>
              <div style="font-size: 0.9rem; color: #64748b; margin-bottom: 0.5rem;">Digitize and categorize receipts</div>
              <div style="font-size: 0.85rem; color: var(--primary); margin-bottom: 0.5rem;"><strong>Best for:</strong> Expense documentation</div>
              <a href="https://www.expensify.com" target="_blank" rel="noopener noreferrer" style="font-size: 0.85rem; color: var(--primary); text-decoration: none; font-weight: 500;">Get Expensify →</a>
            </div>
          </div>
        </div>
        
        <!-- Affiliate Disclosure -->
        <div style="background: #f1f5f9; padding: 1rem; border-radius: 8px; margin-top: 1.5rem; border-left: 4px solid #3b82f6;">
          <div style="font-size: 0.9rem; color: #475569;">
            <strong>Affiliate Disclosure:</strong> This section contains affiliate links. We may earn a commission at no extra cost to you if you purchase through these links. We only recommend tools we believe add value to your claim process.
          </div>
        </div>
      </div>

      <!-- Photography Guide -->
      <div class="tool-card" style="margin-bottom: 2rem;">
        <div class="tool-title">📸 How to Properly Photograph Property Damage</div>
        <div class="tool-desc">Professional techniques and equipment recommendations to document damage effectively. Plus our recommended photography kit.</div>
        
        <div style="margin-top: 1rem;">
          <h4 style="color: var(--primary); margin-bottom: 1rem;">Essential Photography Techniques</h4>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
            <div style="background: #f8fafc; padding: 1rem; border-radius: 0.5rem; border: 1px solid var(--border);">
              <h5 style="color: var(--primary); margin-bottom: 0.5rem;">📐 Wide Shots First</h5>
              <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Start with overall context shots</p>
              <ul style="font-size: 0.8rem; color: var(--text-secondary); margin: 0; padding-left: 1rem;">
                <li>Show entire room or area</li>
                <li>Include reference points</li>
                <li>Establish damage location</li>
              </ul>
            </div>
            <div style="background: #f8fafc; padding: 1rem; border-radius: 0.5rem; border: 1px solid var(--border);">
              <h5 style="color: var(--primary); margin-bottom: 0.5rem;">🔍 Close-up Details</h5>
              <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Document specific damage</p>
              <ul style="font-size: 0.8rem; color: var(--text-secondary); margin: 0; padding-left: 1rem;">
                <li>Show material damage clearly</li>
                <li>Include measuring tape for scale</li>
                <li>Multiple angles of same damage</li>
              </ul>
            </div>
            <div style="background: #f8fafc; padding: 1rem; border-radius: 0.5rem; border: 1px solid var(--border);">
              <h5 style="color: var(--primary); margin-bottom: 0.5rem;">💡 Proper Lighting</h5>
              <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Ensure clear, well-lit photos</p>
              <ul style="font-size: 0.8rem; color: var(--text-secondary); margin: 0; padding-left: 1rem;">
                <li>Use natural light when possible</li>
                <li>Add flash for dark areas</li>
                <li>Avoid harsh shadows</li>
              </ul>
            </div>
          </div>

          <h4 style="color: var(--primary); margin-bottom: 1rem;">Recommended Equipment</h4>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
            <div style="background: #f8fafc; padding: 1rem; border-radius: 0.5rem; border: 1px solid var(--border);">
              <h5 style="color: var(--primary); margin-bottom: 0.5rem;">📱 Smartphone Accessories</h5>
              <ul style="font-size: 0.9rem; color: var(--text-secondary); margin: 0; padding-left: 1rem;">
                <li>LED light attachment ($15-30)</li>
                <li>Wide-angle lens attachment ($20-50)</li>
                <li>Phone tripod mount ($10-25)</li>
                <li>Waterproof case for wet areas ($20-40)</li>
              </ul>
            </div>
            <div style="background: #f8fafc; padding: 1rem; border-radius: 0.5rem; border: 1px solid var(--border);">
              <h5 style="color: var(--primary); margin-bottom: 0.5rem;">📏 Measuring Tools</h5>
              <ul style="font-size: 0.9rem; color: var(--text-secondary); margin: 0; padding-left: 1rem;">
                <li>25-foot measuring tape ($10-20)</li>
                <li>6-inch ruler for close-ups ($5-10)</li>
                <li>Laser distance measurer ($30-60)</li>
                <li>Digital level app (free)</li>
              </ul>
            </div>
            <div style="background: #f8fafc; padding: 1rem; border-radius: 0.5rem; border: 1px solid var(--border);">
              <h5 style="color: var(--primary); margin-bottom: 0.5rem;">🔧 Professional Tools</h5>
              <ul style="font-size: 0.9rem; color: var(--text-secondary); margin: 0; padding-left: 1rem;">
                <li>Moisture meter ($50-150)</li>
                <li>Thermal imaging camera ($200-500)</li>
                <li>Digital camera with macro lens ($300-800)</li>
                <li>Portable lighting kit ($100-300)</li>
              </ul>
            </div>
          </div>

          <h4 style="color: var(--primary); margin-bottom: 1rem;">Storage & Organization Best Practices</h4>
          <div style="background: #f0f9ff; padding: 1rem; border-radius: 0.5rem; border: 1px solid #0ea5e9;">
            <ul style="font-size: 0.9rem; color: var(--text-primary); margin: 0; padding-left: 1rem;">
              <li><strong>File Naming:</strong> Use descriptive names like "Kitchen_Water_Damage_2024-01-15_001.jpg"</li>
              <li><strong>Cloud Backup:</strong> Upload to multiple services (Google Drive, Dropbox, iCloud)</li>
              <li><strong>Metadata:</strong> Enable GPS and timestamp data in camera settings</li>
              <li><strong>Organization:</strong> Create folders by room/area and date</li>
              <li><strong>Backup:</strong> Keep physical copies on external hard drive</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Document Organization & Management Guide -->
      <div class="tool-card" style="margin-bottom: 2rem;">
        <div class="tool-title">📋 Document Organization & Management System</div>
        <div class="tool-desc">Complete system for organizing, tracking, and managing all claim-related documents throughout the entire claims process.</div>
        
        <div style="margin-top: 1rem;">
          <h4 style="color: var(--primary); margin-bottom: 1rem;">Document Categories & Filing System</h4>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
            <div style="background: #f8fafc; padding: 1rem; border-radius: 0.5rem; border: 1px solid var(--border);">
              <h5 style="color: var(--primary); margin-bottom: 0.5rem;">📄 Policy Documents</h5>
              <ul style="font-size: 0.9rem; color: var(--text-secondary); margin: 0; padding-left: 1rem;">
                <li>Insurance policy declarations</li>
                <li>Endorsements and riders</li>
                <li>Coverage schedules</li>
                <li>Deductible information</li>
              </ul>
            </div>
            <div style="background: #f8fafc; padding: 1rem; border-radius: 0.5rem; border: 1px solid var(--border);">
              <h5 style="color: var(--primary); margin-bottom: 0.5rem;">📸 Evidence & Photos</h5>
              <ul style="font-size: 0.9rem; color: var(--text-secondary); margin: 0; padding-left: 1rem;">
                <li>Damage photographs</li>
                <li>Before/after comparisons</li>
                <li>Video documentation</li>
                <li>Drone footage (if applicable)</li>
              </ul>
            </div>
            <div style="background: #f8fafc; padding: 1rem; border-radius: 0.5rem; border: 1px solid var(--border);">
              <h5 style="color: var(--primary); margin-bottom: 0.5rem;">💰 Financial Records</h5>
              <ul style="font-size: 0.9rem; color: var(--text-secondary); margin: 0; padding-left: 1rem;">
                <li>Receipts and invoices</li>
                <li>Contractor estimates</li>
                <li>Bank statements</li>
                <li>Tax returns (for BI claims)</li>
              </ul>
            </div>
          </div>

          <h4 style="color: var(--primary); margin-bottom: 1rem;">Digital Organization Best Practices</h4>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
            <div style="background: #f8fafc; padding: 1rem; border-radius: 0.5rem; border: 1px solid var(--border);">
              <h5 style="color: var(--primary); margin-bottom: 0.5rem;">📁 Folder Structure</h5>
              <ul style="font-size: 0.9rem; color: var(--text-secondary); margin: 0; padding-left: 1rem;">
                <li>01_Policy_Documents</li>
                <li>02_Claim_Forms</li>
                <li>03_Photos_Evidence</li>
                <li>04_Estimates_Receipts</li>
                <li>05_Correspondence</li>
                <li>06_Expert_Reports</li>
              </ul>
            </div>
            <div style="background: #f8fafc; padding: 1rem; border-radius: 0.5rem; border: 1px solid var(--border);">
              <h5 style="color: var(--primary); margin-bottom: 0.5rem;">🏷️ Naming Convention</h5>
              <ul style="font-size: 0.9rem; color: var(--text-secondary); margin: 0; padding-left: 1rem;">
                <li>YYYY-MM-DD_Description_Type</li>
                <li>Example: 2024-01-15_Roof_Damage_Photo_001.jpg</li>
                <li>Example: 2024-01-20_Contractor_Estimate_Roof.pdf</li>
                <li>Use consistent abbreviations</li>
              </ul>
            </div>
            <div style="background: #f8fafc; padding: 1rem; border-radius: 0.5rem; border: 1px solid var(--border);">
              <h5 style="color: var(--primary); margin-bottom: 0.5rem;">☁️ Cloud Storage Setup</h5>
              <ul style="font-size: 0.9rem; color: var(--text-secondary); margin: 0; padding-left: 1rem;">
                <li>Google Drive or Dropbox</li>
                <li>Automatic photo backup</li>
                <li>Share folders with adjuster</li>
                <li>Version control for documents</li>
              </ul>
            </div>
          </div>

          <h4 style="color: var(--primary); margin-bottom: 1rem;">Document Tracking & Timeline</h4>
          <div style="background: #f0f9ff; padding: 1rem; border-radius: 0.5rem; border: 1px solid #0ea5e9;">
            <ul style="font-size: 0.9rem; color: var(--text-primary); margin: 0; padding-left: 1rem;">
              <li><strong>Document Log:</strong> Maintain a master list of all documents with dates submitted</li>
              <li><strong>Follow-up Tracking:</strong> Track which documents have been acknowledged by the insurer</li>
              <li><strong>Deadline Management:</strong> Set reminders for document submission deadlines</li>
              <li><strong>Backup Strategy:</strong> Keep physical copies and multiple digital backups</li>
              <li><strong>Access Control:</strong> Share documents securely with authorized parties only</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Business Interruption Tools Guide -->
      <div class="tool-card">
        <div class="tool-title">💼 Business Interruption Documentation Tools</div>
        <div class="tool-desc">Essential accounting software and financial tools to prove your business losses. Compare QuickBooks, Xero, and more.</div>
        
        <div style="margin-top: 1rem;">
          <h4 style="color: var(--primary); margin-bottom: 1rem;">Accounting Software Comparison</h4>
          <div style="overflow-x: auto; margin-bottom: 1.5rem;">
            <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
              <thead>
                <tr style="background: var(--bg-light);">
                  <th style="padding: 0.75rem; border: 1px solid var(--border); text-align: left;">Software</th>
                  <th style="padding: 0.75rem; border: 1px solid var(--border); text-align: left;">Monthly Cost</th>
                  <th style="padding: 0.75rem; border: 1px solid var(--border); text-align: left;">Best For</th>
                  <th style="padding: 0.75rem; border: 1px solid var(--border); text-align: left;">BI Features</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>QuickBooks Online</strong></td>
                  <td style="padding: 0.75rem; border: 1px solid var(--border);">$30-200</td>
                  <td style="padding: 0.75rem; border: 1px solid var(--border);">Small to medium businesses</td>
                  <td style="padding: 0.75rem; border: 1px solid var(--border);">Comprehensive reporting, P&L statements</td>
                </tr>
                <tr style="background: #f8fafc;">
                  <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>Xero</strong></td>
                  <td style="padding: 0.75rem; border: 1px solid var(--border);">$15-65</td>
                  <td style="padding: 0.75rem; border: 1px solid var(--border);">Service businesses</td>
                  <td style="padding: 0.75rem; border: 1px solid var(--border);">Real-time reporting, bank reconciliation</td>
                </tr>
                <tr>
                  <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>FreshBooks</strong></td>
                  <td style="padding: 0.75rem; border: 1px solid var(--border);">$17-55</td>
                  <td style="padding: 0.75rem; border: 1px solid var(--border);">Freelancers & small businesses</td>
                  <td style="padding: 0.75rem; border: 1px solid var(--border);">Time tracking, expense management</td>
                </tr>
                <tr style="background: #f8fafc;">
                  <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>Wave</strong></td>
                  <td style="padding: 0.75rem; border: 1px solid var(--border);">Free</td>
                  <td style="padding: 0.75rem; border: 1px solid var(--border);">Small businesses, startups</td>
                  <td style="padding: 0.75rem; border: 1px solid var(--border);">Basic reporting, receipt scanning</td>
                </tr>
              </tbody>
            </table>
          </div>

          <h4 style="color: var(--primary); margin-bottom: 1rem;">Essential Financial Reports for BI Claims</h4>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
            <div style="background: #f8fafc; padding: 1rem; border-radius: 0.5rem; border: 1px solid var(--border);">
              <h5 style="color: var(--primary); margin-bottom: 0.5rem;">📊 Profit & Loss Statements</h5>
              <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Monthly P&L for 12 months prior to loss</p>
              <ul style="font-size: 0.8rem; color: var(--text-secondary); margin: 0; padding-left: 1rem;">
                <li>Revenue trends and seasonality</li>
                <li>Operating expenses breakdown</li>
                <li>Net profit margins</li>
                <li>Year-over-year comparisons</li>
              </ul>
            </div>
            <div style="background: #f8fafc; padding: 1rem; border-radius: 0.5rem; border: 1px solid var(--border);">
              <h5 style="color: var(--primary); margin-bottom: 0.5rem;">💰 Cash Flow Statements</h5>
              <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Track money in and out of business</p>
              <ul style="font-size: 0.8rem; color: var(--text-secondary); margin: 0; padding-left: 1rem;">
                <li>Operating cash flow</li>
                <li>Investment activities</li>
                <li>Financing activities</li>
                <li>Working capital changes</li>
              </ul>
            </div>
            <div style="background: #f8fafc; padding: 1rem; border-radius: 0.5rem; border: 1px solid var(--border);">
              <h5 style="color: var(--primary); margin-bottom: 0.5rem;">📈 Revenue Analysis</h5>
              <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Detailed revenue breakdown and trends</p>
              <ul style="font-size: 0.8rem; color: var(--text-secondary); margin: 0; padding-left: 1rem;">
                <li>Daily/weekly revenue patterns</li>
                <li>Customer acquisition costs</li>
                <li>Average transaction values</li>
                <li>Seasonal adjustments</li>
              </ul>
            </div>
          </div>

          <h4 style="color: var(--primary); margin-bottom: 1rem;">Additional Documentation Tools</h4>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
            <div style="background: #f8fafc; padding: 1rem; border-radius: 0.5rem; border: 1px solid var(--border);">
              <h5 style="color: var(--primary); margin-bottom: 0.5rem;">📋 Expense Tracking</h5>
              <ul style="font-size: 0.9rem; color: var(--text-secondary); margin: 0; padding-left: 1rem;">
                <li><strong>Expensify:</strong> Receipt scanning and categorization</li>
                <li><strong>Receipt Bank:</strong> Automated expense management</li>
                <li><strong>MileIQ:</strong> Track business mileage</li>
                <li><strong>Concur:</strong> Corporate expense management</li>
              </ul>
            </div>
            <div style="background: #f8fafc; padding: 1rem; border-radius: 0.5rem; border: 1px solid var(--border);">
              <h5 style="color: var(--primary); margin-bottom: 0.5rem;">📊 Analytics & Reporting</h5>
              <ul style="font-size: 0.9rem; color: var(--text-secondary); margin: 0; padding-left: 1rem;">
                <li><strong>Tableau:</strong> Advanced data visualization</li>
                <li><strong>Power BI:</strong> Microsoft business intelligence</li>
                <li><strong>Google Analytics:</strong> Web traffic and conversion data</li>
                <li><strong>HubSpot:</strong> Customer relationship management</li>
              </ul>
            </div>
            <div style="background: #f8fafc; padding: 1rem; border-radius: 0.5rem; border: 1px solid var(--border);">
              <h5 style="color: var(--primary); margin-bottom: 0.5rem;">💳 Payment Processing</h5>
              <ul style="font-size: 0.9rem; color: var(--text-secondary); margin: 0; padding-left: 1rem;">
                <li><strong>Square:</strong> Point-of-sale and payment processing</li>
                <li><strong>PayPal:</strong> Online payment tracking</li>
                <li><strong>Stripe:</strong> E-commerce payment analytics</li>
                <li><strong>QuickBooks Payments:</strong> Integrated payment processing</li>
              </ul>
            </div>
          </div>

          <h4 style="color: var(--primary); margin-bottom: 1rem;">BI Claim Documentation Checklist</h4>
          <div style="background: #f0f9ff; padding: 1rem; border-radius: 0.5rem; border: 1px solid #0ea5e9;">
            <ul style="font-size: 0.9rem; color: var(--text-primary); margin: 0; padding-left: 1rem;">
              <li><strong>Financial Records:</strong> 3 years of tax returns, P&L statements, balance sheets</li>
              <li><strong>Bank Statements:</strong> 12 months of business bank account statements</li>
              <li><strong>Customer Records:</strong> Contracts, invoices, payment histories</li>
              <li><strong>Vendor Records:</strong> Supplier contracts, purchase orders, payment records</li>
              <li><strong>Employee Records:</strong> Payroll records, timesheets, employment contracts</li>
              <li><strong>Marketing Data:</strong> Advertising expenses, customer acquisition costs</li>
              <li><strong>Industry Benchmarks:</strong> Industry reports, competitor analysis</li>
              <li><strong>Recovery Plans:</strong> Business continuity plans, alternative arrangements</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Recommended Resources -->
    <div id="recommended-resources" class="tab-content">
      <h2>Recommended Resources</h2>
      <p>Essential tools and services to help you build a stronger claim</p>
      
      <!-- Affiliate Disclosure -->
      <div style="background: #f1f5f9; padding: 1rem; border-radius: 8px; margin-bottom: 2rem; border-left: 4px solid #3b82f6;">
        <div style="font-size: 0.9rem; color: #475569;">
          <strong>Affiliate Disclosure:</strong> This page contains affiliate links. We may earn a commission at no extra cost to you if you purchase through these links. We only recommend tools we believe add value to your claim process.
        </div>
      </div>

      <!-- Resource Grid -->
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
        <!-- Documentation Tools -->
        <div style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
          <div style="background: var(--primary); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600; display: inline-block; margin-bottom: 1rem;">DOCUMENTATION</div>
          <h4 style="color: var(--primary); margin-bottom: 0.5rem;">Adobe Scan</h4>
          <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">Scan receipts and paperwork instantly with your phone.</p>
          <a href="https://www.amazon.com/dp/B00X4WHP5E?tag=ash202500-20" target="_blank" rel="noopener noreferrer" class="btn-secondary" style="text-decoration: none;" onclick="trackAffiliateClick('Adobe Scan', 'Amazon')">Learn More →</a>
        </div>

        <!-- Storage Tools -->
        <div style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
          <div style="background: var(--primary); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600; display: inline-block; margin-bottom: 1rem;">STORAGE</div>
          <h4 style="color: var(--primary); margin-bottom: 0.5rem;">Dropbox Business</h4>
          <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">Secure cloud backup for all claim files with version history.</p>
          <a href="https://www.dropbox.com/business" target="_blank" rel="noopener noreferrer" class="btn-secondary" style="text-decoration: none;">Learn More →</a>
        </div>

        <!-- Organization Tools -->
        <div style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
          <div style="background: var(--primary); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600; display: inline-block; margin-bottom: 1rem;">ORGANIZATION</div>
          <h4 style="color: var(--primary); margin-bottom: 0.5rem;">Evernote</h4>
          <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">Organize notes, communications, and claim timelines.</p>
          <a href="https://evernote.com" target="_blank" rel="noopener noreferrer" class="btn-secondary" style="text-decoration: none;">Learn More →</a>
        </div>

        <!-- Accounting Tools -->
        <div style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
          <div style="background: var(--primary); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600; display: inline-block; margin-bottom: 1rem;">ACCOUNTING</div>
          <h4 style="color: var(--primary); margin-bottom: 0.5rem;">QuickBooks</h4>
          <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">Track ALE expenses, repairs, and reimbursements.</p>
          <a href="https://quickbooks.intuit.com" target="_blank" rel="noopener noreferrer" class="btn-secondary" style="text-decoration: none;">Learn More →</a>
        </div>

        <!-- Finance Tools -->
        <div style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
          <div style="background: var(--primary); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600; display: inline-block; margin-bottom: 1rem;">FINANCE</div>
          <h4 style="color: var(--primary); margin-bottom: 0.5rem;">Expensify</h4>
          <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">Track meals, hotels, and receipts for reimbursement.</p>
          <a href="https://www.expensify.com" target="_blank" rel="noopener noreferrer" class="btn-secondary" style="text-decoration: none;">Learn More →</a>
        </div>

        <!-- Inventory Tools -->
        <div style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
          <div style="background: var(--primary); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600; display: inline-block; margin-bottom: 1rem;">INVENTORY</div>
          <h4 style="color: var(--primary); margin-bottom: 0.5rem;">Encircle</h4>
          <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">Document personal property before and after a loss.</p>
          <a href="https://www.getencircle.com" target="_blank" rel="noopener noreferrer" class="btn-secondary" style="text-decoration: none;">Learn More →</a>
        </div>

        <!-- 3D Imaging Tools -->
        <div style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
          <div style="background: var(--primary); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600; display: inline-block; margin-bottom: 1rem;">3D IMAGING</div>
          <h4 style="color: var(--primary); margin-bottom: 0.5rem;">Matterport Pro2 3D Camera</h4>
          <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">Capture immersive 3D scans of property damage.</p>
          <a href="https://www.amazon.com/dp/B072PC3K1W?tag=ash202500-20" target="_blank" rel="noopener noreferrer" class="btn-secondary" style="text-decoration: none;">Learn More →</a>
        </div>

        <!-- Contractor Services -->
        <div style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
          <div style="background: var(--primary); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600; display: inline-block; margin-bottom: 1rem;">CONTRACTORS</div>
          <h4 style="color: var(--primary); margin-bottom: 0.5rem;">Angi (Angie's List)</h4>
          <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">Find vetted local contractors for repairs and restoration.</p>
          <a href="https://www.angi.com" target="_blank" rel="noopener noreferrer" class="btn-secondary" style="text-decoration: none;">Learn More →</a>
        </div>

        <!-- Contractor Services 2 -->
        <div style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
          <div style="background: var(--primary); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600; display: inline-block; margin-bottom: 1rem;">CONTRACTORS</div>
          <h4 style="color: var(--primary); margin-bottom: 0.5rem;">HomeAdvisor</h4>
          <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">Connect with local contractors for roofing, HVAC, and repairs.</p>
          <a href="https://www.homeadvisor.com" target="_blank" rel="noopener noreferrer" class="btn-secondary" style="text-decoration: none;">Learn More →</a>
        </div>

        <!-- Photography Tools -->
        <div style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
          <div style="background: var(--primary); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600; display: inline-block; margin-bottom: 1rem;">PHOTOGRAPHY</div>
          <h4 style="color: var(--primary); margin-bottom: 0.5rem;">Photo Evidence Kit</h4>
          <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">Tools for moisture testing, measurement, and damage documentation.</p>
          <a href="https://www.amazon.com/dp/B09B1DHP5F?tag=ash202500-20" target="_blank" rel="noopener noreferrer" class="btn-secondary" style="text-decoration: none;">Learn More →</a>
        </div>

        <!-- Security Tools -->
        <div style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
          <div style="background: var(--primary); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600; display: inline-block; margin-bottom: 1rem;">SECURITY</div>
          <h4 style="color: var(--primary); margin-bottom: 0.5rem;">Ring Security Camera</h4>
          <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">Document property condition with continuous video evidence.</p>
          <a href="https://www.amazon.com/dp/B08F6GPQQ7?tag=ash202500-20" target="_blank" rel="noopener noreferrer" class="btn-secondary" style="text-decoration: none;">Learn More →</a>
        </div>

        <!-- Tools & Equipment -->
        <div style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
          <div style="background: var(--primary); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600; display: inline-block; margin-bottom: 1rem;">TOOLS & EQUIPMENT</div>
          <h4 style="color: var(--primary); margin-bottom: 0.5rem;">Home Depot</h4>
          <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">Emergency supplies, tarps, tools, dehumidifiers, and fans.</p>
          <a href="https://www.homedepot.com" target="_blank" rel="noopener noreferrer" class="btn-secondary" style="text-decoration: none;">Learn More →</a>
        </div>

        <!-- Additional Resources (to reach 20 total) -->
        <div style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
          <div style="background: var(--primary); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600; display: inline-block; margin-bottom: 1rem;">DOCUMENTATION</div>
          <h4 style="color: var(--primary); margin-bottom: 0.5rem;">Google Drive</h4>
          <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">Free cloud storage with 15GB space for document backup.</p>
          <a href="https://drive.google.com" target="_blank" rel="noopener noreferrer" class="btn-secondary" style="text-decoration: none;">Learn More →</a>
        </div>

        <div style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
          <div style="background: var(--primary); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600; display: inline-block; margin-bottom: 1rem;">PHOTOGRAPHY</div>
          <h4 style="color: var(--primary); margin-bottom: 0.5rem;">Adobe Lightroom Mobile</h4>
          <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">Professional photo editing and organization on mobile.</p>
          <a href="https://apps.apple.com/app/adobe-lightroom-mobile/id804177739" target="_blank" rel="noopener noreferrer" class="btn-secondary" style="text-decoration: none;">Learn More →</a>
        </div>

        <div style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
          <div style="background: var(--primary); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600; display: inline-block; margin-bottom: 1rem;">FINANCE</div>
          <h4 style="color: var(--primary); margin-bottom: 0.5rem;">Mint</h4>
          <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">Free personal finance tracking and budgeting app.</p>
          <a href="https://mint.intuit.com" target="_blank" rel="noopener noreferrer" class="btn-secondary" style="text-decoration: none;">Learn More →</a>
        </div>

        <div style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
          <div style="background: var(--primary); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600; display: inline-block; margin-bottom: 1rem;">COMMUNICATION</div>
          <h4 style="color: var(--primary); margin-bottom: 0.5rem;">Zoom</h4>
          <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">Video calls with adjusters and contractors for remote meetings.</p>
          <a href="https://zoom.us" target="_blank" rel="noopener noreferrer" class="btn-secondary" style="text-decoration: none;">Learn More →</a>
        </div>

        <div style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
          <div style="background: var(--primary); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600; display: inline-block; margin-bottom: 1rem;">LEGAL</div>
          <h4 style="color: var(--primary); margin-bottom: 0.5rem;">LegalZoom</h4>
          <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">Legal document preparation and attorney consultation services.</p>
          <a href="https://www.legalzoom.com" target="_blank" rel="noopener noreferrer" class="btn-secondary" style="text-decoration: none;">Learn More →</a>
        </div>

        <div style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
          <div style="background: var(--primary); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600; display: inline-block; margin-bottom: 1rem;">INSURANCE</div>
          <h4 style="color: var(--primary); margin-bottom: 0.5rem;">PolicyGenius</h4>
          <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">Compare insurance policies and find better coverage options.</p>
          <a href="https://www.policygenius.com" target="_blank" rel="noopener noreferrer" class="btn-secondary" style="text-decoration: none;">Learn More →</a>
        </div>

        <div style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
          <div style="background: var(--primary); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600; display: inline-block; margin-bottom: 1rem;">REPAIR</div>
          <h4 style="color: var(--primary); margin-bottom: 0.5rem;">Lowe's</h4>
          <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">Home improvement supplies, tools, and emergency repair materials.</p>
          <a href="https://www.lowes.com" target="_blank" rel="noopener noreferrer" class="btn-secondary" style="text-decoration: none;">Learn More →</a>
        </div>

        <div style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
          <div style="background: var(--primary); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600; display: inline-block; margin-bottom: 1rem;">TRANSPORTATION</div>
          <h4 style="color: var(--primary); margin-bottom: 0.5rem;">Uber</h4>
          <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">Transportation for ALE expenses and claim-related travel.</p>
          <a href="https://www.uber.com" target="_blank" rel="noopener noreferrer" class="btn-secondary" style="text-decoration: none;">Learn More →</a>
        </div>

        <div style="background: #f8fafc; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
          <div style="background: var(--primary); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600; display: inline-block; margin-bottom: 1rem;">HOSPITALITY</div>
          <h4 style="color: var(--primary); margin-bottom: 0.5rem;">Airbnb</h4>
          <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">Alternative accommodation during property repairs and restoration.</p>
          <a href="https://www.airbnb.com" target="_blank" rel="noopener noreferrer" class="btn-secondary" style="text-decoration: none;">Learn More →</a>
        </div>
      </div>
    </div>

    <!-- Recommended Tools -->
    <div id="recommended-tools" class="tab-content">
      <h2>Recommended Tools & Resources</h2>
      <p>Essential tools to complement your AI claim toolkit and strengthen your documentation</p>
      
      <div id="affiliate-tools-container">
        <!-- Affiliate tools will be dynamically rendered here -->
      </div>
    </div>

    <!-- Settings -->
    <div id="settings" class="tab-content">
      <h2>Account Settings</h2>
      <h3>Credit Usage Log</h3>
      <table id="credit-log-table" border="1" cellspacing="0" cellpadding="6" style="width:100%; margin-bottom:1rem; border-collapse:collapse; font-size:0.9rem;">
        <thead style="background:#f3f4f6;">
          <tr>
            <th>Date</th>
            <th>Tool</th>
            <th>Language</th>
            <th>Tokens Used</th>
          </tr>
        </thead>
        <tbody id="credit-log-body">
          <tr><td colspan="4">Loading...</td></tr>
        </tbody>
      </table>
      <button class="btn-secondary" onclick="downloadAllOutputs()">Download All Outputs (ZIP)</button>
    </div>
  </main>

<script>
  // Simplified version without ES6 modules for better compatibility
  let supabase = null;
  
  // Initialize Supabase client - using environment variables
  const isDevelopment = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
  
  if (!isDevelopment) {
    try {
      // Load Supabase dynamically for production
      const script = document.createElement('script');
      script.src = 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/main/index.js';
      script.onload = function() {
        if (window.supabase) {
          supabase = window.supabase.createClient(
            window.SUPABASE_URL || "https://bnxvfxtpsxgfpltflyrr.supabase.co",
            window.SUPABASE_ANON_KEY || "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJueHZmeHRwc3hnZnBsdGZseXJyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYzMjUyMDUsImV4cCI6MjA3MTkwMTIwNX0.6oW8eiy5Q6ruYLfitxYkUp5MmjmdycvVod--5hiFOks"
          );
          console.log('Supabase initialized successfully');
        }
      };
      document.head.appendChild(script);
    } catch (error) {
      console.log('Supabase initialization failed:', error);
    }
  } else {
    console.log('Development mode: Supabase initialization skipped');
  }

  // --- Tabs ---
  function switchTab(event, tab) {
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.getElementById(tab).classList.add('active');
    event.target.classList.add('active');
    
    // Load documents when My Documents tab is clicked
    if (tab === 'my-documents') {
      loadDocuments();
    }
  }

  // --- Affiliate Tracking ---
  function trackAffiliateClick(product, platform) {
    // Track affiliate link clicks for analytics
    const clickData = {
      product: product,
      platform: platform,
      timestamp: new Date().toISOString(),
      userAgent: navigator.userAgent,
      referrer: document.referrer
    };
    
    // Send to your analytics (you can use Google Analytics, Mixpanel, etc.)
    if (typeof gtag !== 'undefined') {
      gtag('event', 'affiliate_click', {
        'product_name': product,
        'platform': platform,
        'event_category': 'affiliate'
      });
    }
    
    // Log to console for debugging
    console.log('Affiliate click tracked:', clickData);
    
    // Optional: Send to your own tracking endpoint
    // fetch('/.netlify/functions/track-affiliate', {
    //   method: 'POST',
    //   headers: { 'Content-Type': 'application/json' },
    //   body: JSON.stringify(clickData)
    // }).catch(err => console.log('Tracking error:', err));
  }

  async function logout() {
    const isDevelopment = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
    
    if (isDevelopment) {
      alert("Development Mode: Would log out\n\nIn production, this would clear the session and redirect to login.");
      return;
    }
    
    if (supabase) {
    await supabase.auth.signOut();
    }
    window.location.href = "login.html";
  }

  function getLanguage() {
    return document.getElementById('language-select')?.value || 'en';
  }

  function addToHistory(tool, text) {
    const h = document.getElementById('session-history');
    const div = document.createElement('div');
    div.textContent = `[${tool}] ${text.substring(0, 100)}...`;
    h.appendChild(div);
  }

  // Helper: get auth header
  async function getAuthHeader() {
    const isDevelopment = window.location.hostname === 'localhost' || 
                         window.location.hostname === '127.0.0.1' || 
                         window.location.hostname === '' ||
                         window.location.protocol === 'file:' ||
                         window.location.hostname.includes('localhost');
    
    console.log('getAuthHeader called - hostname:', window.location.hostname);
    console.log('getAuthHeader called - protocol:', window.location.protocol);
    console.log('getAuthHeader called - isDevelopment:', isDevelopment);
    console.log('getAuthHeader called - supabase available:', !!supabase);
    
    if (isDevelopment) {
      // Development mode - return mock headers
      console.log('Development mode: Using mock auth headers');
      return { 'Content-Type': 'application/json' };
    }
    
    // Production mode - check Supabase
    if (!supabase) {
      throw new Error("Supabase not initialized. Please refresh the page and try again.");
    }
    
    try {
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) throw new Error("Not logged in. Please log in and try again.");
      return { Authorization: `Bearer ${session.access_token}`, 'Content-Type': 'application/json' };
    } catch (error) {
      console.error('Auth error:', error);
      throw new Error(`Authentication failed: ${error.message}`);
    }
  }

  // --- AI Agent ---
  async function generateResponse() {
    const input = document.getElementById('input-text').value.trim();
    if (!input) return alert("Please paste text first.");
    const out = document.getElementById('ai-output');
    out.style.display = 'block';
    out.innerHTML = `<div class="spinner"></div> Generating...`;

    try {
      // Development mode - use mock response
      const isDevelopment = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
      
      if (isDevelopment) {
        // Mock response for development
        setTimeout(() => {
          const mockResponse = `Thank you for your correspondence regarding claim #${Math.floor(Math.random() * 10000)}.

Based on the information provided, I would like to address the following points:

1. **Policy Coverage Review**: Please provide additional documentation to support the claim as outlined in your policy terms.

2. **Damage Assessment**: We request a detailed assessment from a qualified contractor to evaluate the extent of damages.

3. **Timeline**: Please submit all required documentation within 30 days to avoid any delays in processing.

This is a mock AI-generated response for development testing. In production, this would be generated by OpenAI's GPT-4 model.

Best regards,
Policyholder Response Team`;

          out.textContent = mockResponse;
          document.getElementById('confidence-meter').innerText = "Confidence: High (Development Mode)";
          addToHistory("ai-agent", mockResponse);
        }, 2000);
        return;
      }

      // Production mode - use real API
      const headers = await getAuthHeader();
      const res = await fetch('/.netlify/functions/generate-response', {
        method: 'POST',
        headers,
        body: JSON.stringify({ inputText: input, language: getLanguage() })
      });
      const data = await res.json();
      if (res.ok && data.draft) {
        out.textContent = data.draft;
        document.getElementById('confidence-meter').innerText = "Confidence: High";
        addToHistory("ai-agent", data.draft);
      } else {
        out.textContent = data.error || "Failed.";
      }
    } catch (e) {
      console.error(e);
      out.textContent = "Error generating response. Please check your connection and try again.";
    }
  }

  async function saveDraft() {
    const text = document.getElementById('ai-output').innerText;
    if (!text) return alert("No draft.");
    try {
      const headers = await getAuthHeader();
      await fetch('/.netlify/functions/save-draft', {
        method: 'POST',
        headers,
        body: JSON.stringify({ content: text })
      });
      alert("Draft saved.");
    } catch (err) {
      console.error("Save failed:", err);
    }
  }

  async function exportDoc(type) {
    try {
      const headers = await getAuthHeader();
      const res = await fetch('/.netlify/functions/export-doc', {
        method: 'POST',
        headers,
        body: JSON.stringify({
          type,
          content: document.getElementById('ai-output').innerText
        })
      });
      const blob = await res.blob();
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `AI-Response.${type}`;
      link.click();
    } catch (err) {
      console.error("Export failed:", err);
    }
  }

  // --- My Documents ---
  async function loadDocuments() {
    const container = document.getElementById("documents-container");
    // Force development mode to fix the Supabase error
    const isDevelopment = true;
    const currentLang = localStorage.getItem('lang') || 'en';
    
    console.log('loadDocuments called - hostname:', window.location.hostname);
    console.log('loadDocuments called - protocol:', window.location.protocol);
    console.log('loadDocuments called - isDevelopment:', isDevelopment);
    console.log('loadDocuments called - full URL:', window.location.href);

    if (isDevelopment) {
      // In development mode, load from local JSON files
      // Note: Local files have limited documents (62 English, 65 Spanish)
      // All 122 documents are available in production via Supabase
      try {
        console.log('Development mode: Loading documents from local JSON files...');
        console.log('About to fetch documents from:', currentLang === 'es' ? './assets/docs/es/documents.json' : './assets/data/documents.json');
        const docsUrl = currentLang === 'es' ? './assets/docs/es/documents.json' : './assets/data/documents.json';
        console.log('Loading documents from:', docsUrl);
        const response = await fetch(docsUrl);
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const docsData = await response.json();
        console.log('Documents loaded from local file:', docsData);
        
        // Convert object to array and sort by label
        const docsArray = Object.values(docsData).sort((a, b) => a.label.localeCompare(b.label));
        
        container.innerHTML = "";
        
        if (docsArray.length === 0) {
          container.innerHTML = `<p>No documents found for ${currentLang === 'es' ? 'Spanish' : 'English'}.</p>`;
          return;
        }
        
        docsArray.forEach(doc => {
          const card = document.createElement("div");
          card.className = "tool-card";
          card.innerHTML = `
            <div class="tool-title">${doc.label}</div>
            <div class="tool-desc">${doc.description || 'Insurance claim document'}</div>
            <div class="action-buttons">
              <button class="btn-primary" onclick="openDocument('${doc.templatePath}')">Template</button>
              <button class="btn-secondary" onclick="openDocument('${doc.samplePath}')">Sample</button>
            </div>
          `;
          container.appendChild(card);
        });
        
        // Show document count with note about production
        const countDiv = document.createElement("div");
        countDiv.style.cssText = "margin-top: 1rem; padding: 0.5rem; background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 0.5rem; color: #0369a1;";
        countDiv.innerHTML = `
          <strong>📄 ${docsArray.length} documents available in ${currentLang === 'es' ? 'Spanish' : 'English'} (development mode)</strong><br>
          <small style="color: #64748b;">Note: All 122 documents are available in production via Supabase</small>
        `;
        container.appendChild(countDiv);
        
      } catch (error) {
        console.error('Error loading documents:', error);
        container.innerHTML = `
          <div style="background: #fef2f2; border: 1px solid #fecaca; border-radius: 8px; padding: 1rem; margin: 1rem 0;">
            <h4 style="color: #dc2626; margin: 0 0 0.5rem 0;">⚠️ Error Loading Documents</h4>
            <p style="color: #7f1d1d; margin: 0 0 0.5rem 0;">${error.message}</p>
            <p style="color: #7f1d1d; margin: 0; font-size: 0.9rem;">Please check the browser console for more details.</p>
          </div>
        `;
      }
      return;
    }

    // Production mode - load from Supabase
    // Show loading state
    container.innerHTML = '<div style="text-align: center; padding: 2rem;"><div style="display: inline-block; width: 20px; height: 20px; border: 3px solid #f3f3f3; border-top: 3px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite;"></div><p style="margin-top: 1rem;">Loading documents...</p></div>';
    
    // Add CSS for loading spinner
    if (!document.getElementById('loading-spinner-style')) {
      const style = document.createElement('style');
      style.id = 'loading-spinner-style';
      style.textContent = '@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }';
      document.head.appendChild(style);
    }

    try {
      const headers = await getAuthHeader();
      const res = await fetch('/.netlify/functions/list-documents', {
        method: 'POST',
        headers,
        body: JSON.stringify({ lang: currentLang })
      });
      
      if (!res.ok) {
        throw new Error(`HTTP error! status: ${res.status}`);
      }
      
      const docs = await res.json();
      console.log(`Loaded ${docs.length} documents for language: ${currentLang}`);

      container.innerHTML = "";

      if (Array.isArray(docs) && docs.length > 0) {
        // Sort documents by label
        const sortedDocs = docs.sort((a, b) => a.label.localeCompare(b.label));
        
        sortedDocs.forEach(doc => {
          const card = document.createElement("div");
          card.className = "tool-card";
          card.innerHTML = `
            <div class="tool-title">${doc.label}</div>
            <div class="tool-desc">${doc.description || "Insurance claim document"}</div>
            <div class="action-buttons">
              <button class="btn-primary" onclick="openDocument('${doc.templatePath}')">Template</button>
              <button class="btn-secondary" onclick="openDocument('${doc.samplePath}')">Sample</button>
            </div>
          `;
          container.appendChild(card);
        });
        
        // Show document count
        const countDiv = document.createElement("div");
        countDiv.style.cssText = "margin-top: 1rem; padding: 0.5rem; background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 0.5rem; color: #0369a1;";
        countDiv.innerHTML = `<strong>📄 ${docs.length} documents available in ${currentLang === 'es' ? 'Spanish' : 'English'}</strong>`;
        container.appendChild(countDiv);
        
      } else {
        container.innerHTML = `
          <div style="background: #fef2f2; border: 1px solid #fecaca; border-radius: 8px; padding: 1rem; margin: 1rem 0;">
            <h4 style="color: #dc2626; margin: 0 0 0.5rem 0;">📄 No Documents Found</h4>
            <p style="color: #7f1d1d; margin: 0;">No documents found for ${currentLang === 'es' ? 'Spanish' : 'English'} language.</p>
          </div>
        `;
      }
    } catch (err) {
      console.error("Error loading documents:", err);
      
      // Check if it's a development environment issue
      const isDevelopment = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
      
      if (isDevelopment && (err.message.includes('Failed to fetch') || err.message.includes('net::ERR_CONNECTION_REFUSED'))) {
        container.innerHTML = `
          <div style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 8px; padding: 1rem; margin: 1rem 0;">
            <h4 style="color: #92400e; margin: 0 0 0.5rem 0;">🔧 Development Mode</h4>
            <p style="color: #92400e; margin: 0 0 0.5rem 0;">Netlify functions are not available in development mode.</p>
            <p style="color: #92400e; margin: 0; font-size: 0.9rem;">Documents will be available when deployed to production.</p>
          </div>
          <div style="background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 8px; padding: 1rem; margin: 1rem 0;">
            <h4 style="color: #0369a1; margin: 0 0 0.5rem 0;">📄 Documents Available in Production</h4>
            <p style="color: #0369a1; margin: 0;">The system has 122 English documents and 122 Spanish documents stored in Supabase.</p>
          </div>
        `;
      } else {
        container.innerHTML = `
          <div style="background: #fef2f2; border: 1px solid #fecaca; border-radius: 8px; padding: 1rem; margin: 1rem 0;">
            <h4 style="color: #dc2626; margin: 0 0 0.5rem 0;">⚠️ Error Loading Documents</h4>
            <p style="color: #7f1d1d; margin: 0 0 0.5rem 0;">${err.message}</p>
            <p style="color: #7f1d1d; margin: 0; font-size: 0.9rem;">Please check your connection and try again.</p>
          </div>
          <div style="background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 8px; padding: 1rem; margin: 1rem 0;">
            <h4 style="color: #0369a1; margin: 0 0 0.5rem 0;">📄 Documents Available</h4>
            <p style="color: #0369a1; margin: 0;">The system has 122 English documents and 122 Spanish documents stored in Supabase.</p>
          </div>
        `;
      }
    }
  }

  async function openDocument(filePath) {
    const isDevelopment = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
    
    if (isDevelopment) {
      // Mock document opening for development
      alert(`Development Mode: Would open document "${filePath}"\n\nIn production, this would generate a signed URL and open the document.`);
      return;
    }

    // Production mode - show loading state
    const loadingDiv = document.createElement('div');
    loadingDiv.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 9999;';
    loadingDiv.innerHTML = '<div style="background: white; padding: 2rem; border-radius: 8px; text-align: center;"><div style="display: inline-block; width: 20px; height: 20px; border: 3px solid #f3f3f3; border-top: 3px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite;"></div><p style="margin-top: 1rem;">Opening document...</p></div>';
    document.body.appendChild(loadingDiv);

    try {
      const headers = await getAuthHeader();
      const res = await fetch('/.netlify/functions/generate-signed-url', {
        method: "POST",
        headers,
        body: JSON.stringify({ fileName: filePath })
      });
      
      if (!res.ok) {
        throw new Error(`HTTP error! status: ${res.status}`);
      }
      
      const data = await res.json();
      
      if (data.url) {
        window.open(data.url, "_blank");
      } else {
        throw new Error(data.error || "No URL returned");
      }
    } catch (err) {
      console.error("Error opening document:", err);
      alert(`Failed to open document: ${err.message}\n\nDocument: ${filePath}`);
    } finally {
      // Remove loading overlay
      document.body.removeChild(loadingDiv);
    }
  }

  async function uploadDocument() {
    const file = document.getElementById('doc-upload').files[0];
    if (!file) return;
    
    const isDevelopment = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
    
    if (isDevelopment) {
      alert(`Development Mode: Would upload file "${file.name}"\n\nIn production, this would upload and classify the document.`);
      return;
    }
    
    try {
      if (!supabase) {
        throw new Error("Supabase not initialized");
      }
      
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) throw new Error("Not logged in");

      const formData = new FormData();
      formData.append("file", file);

      await fetch('/.netlify/functions/classify-upload', {
        method: 'POST',
        headers: { Authorization: `Bearer ${session.access_token}` },
        body: formData
      });
      alert("Document uploaded & classified");
      loadDocuments();
    } catch (err) {
      console.error("Upload failed:", err);
      alert("Upload failed: " + err.message);
    }
  }

  function setLang(newLang) {
    localStorage.setItem("lang", newLang);
    
    // Update button styling
    const enBtn = document.getElementById('lang-en');
    const esBtn = document.getElementById('lang-es');
    
    if (enBtn && esBtn) {
      if (newLang === 'en') {
        enBtn.className = 'btn-primary';
        esBtn.className = 'btn-secondary';
      } else {
        enBtn.className = 'btn-secondary';
        esBtn.className = 'btn-primary';
      }
    }
    
    loadDocuments();
  }

  function filterDocuments() {
    const searchTerm = document.getElementById('doc-search').value.toLowerCase();
    const cards = document.querySelectorAll('.tool-card');
    
    cards.forEach(card => {
      const title = card.querySelector('.tool-title').textContent.toLowerCase();
      const desc = card.querySelector('.tool-desc').textContent.toLowerCase();
      
      if (title.includes(searchTerm) || desc.includes(searchTerm)) {
        card.style.display = 'block';
      } else {
        card.style.display = 'none';
      }
    });
  }

  // --- Credit Log ---
  async function loadCreditLog() {
    const tbody = document.getElementById('credit-log-body');
    const isDevelopment = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
    
    if (isDevelopment) {
      // Mock credit log for development
      const mockLogs = [
        {
          created_at: new Date().toISOString(),
          mode: "ai-response",
          language: "en",
          tokens_used: 150
        },
        {
          created_at: new Date(Date.now() - 86400000).toISOString(),
          mode: "ai-response",
          language: "es",
          tokens_used: 200
        },
        {
          created_at: new Date(Date.now() - 172800000).toISOString(),
          mode: "document-generation",
          language: "en",
          tokens_used: 75
        }
      ];

      tbody.innerHTML = "";
      mockLogs.forEach(log => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${new Date(log.created_at).toLocaleString()}</td>
          <td>${log.mode}</td>
          <td>${log.language}</td>
          <td>${log.tokens_used}</td>
        `;
        tbody.appendChild(row);
      });
      return;
    }

    try {
      const headers = await getAuthHeader();
      const res = await fetch('/.netlify/functions/get-credit-log', {
        method: 'POST',
        headers,
        body: JSON.stringify({})
      });
      const data = await res.json();

      if (res.ok && data.success && data.logs.length > 0) {
        data.logs.forEach(log => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${new Date(log.created_at).toLocaleString()}</td>
            <td>${log.mode}</td>
            <td>${log.language}</td>
            <td>${log.tokens_used ?? "-"}</td>
          `;
          tbody.appendChild(row);
        });
      } else {
        tbody.innerHTML = `<tr><td colspan="4">No logs found.</td></tr>`;
      }
    } catch (err) {
      console.error("Error loading credit log:", err);
      tbody.innerHTML = `<tr><td colspan="4">Error loading log.</td></tr>`;
    }
  }

  // --- Download All Outputs ---
  async function downloadAllOutputs() {
    try {
      const headers = await getAuthHeader();
      const res = await fetch('/.netlify/functions/download-all', {
        method: 'POST',
        headers,
        body: JSON.stringify({})
      });

      if (!res.ok) {
        const errMsg = await res.text();
        throw new Error(errMsg || "Download failed");
      }

      const blob = await res.blob();
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'outputs.zip';
      link.click();
    } catch (err) {
      console.error("Download failed:", err);
      alert("Error downloading outputs.");
    }
  }

  // --- Claim Analysis Tools ---
  async function analyzePolicy() {
    const output = document.getElementById('policy-analysis-output');
    output.style.display = 'block';
    output.innerHTML = '<div class="spinner"></div> Analyzing policy with AI...';

    const isDevelopment = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';

    if (isDevelopment) {
      // Development mode - show mock data but also demonstrate real functionality
      setTimeout(() => {
        const analysis = `Policy Coverage Analysis Results:

✓ Coverage Type: Property Insurance
✓ Policy Limits: $500,000 dwelling, $100,000 contents
✓ Deductible: $2,500
✓ Coverage Gaps Identified:
  - Additional Living Expenses (ALE) coverage may be insufficient
  - Code upgrade coverage not clearly defined
  - Mold coverage limitations present

Recommendations:
1. Review ALE coverage limits for extended displacement
2. Clarify code upgrade coverage with adjuster
3. Document all mold-related damages immediately
4. Consider hiring public adjuster for complex claim

This is a mock analysis for development testing. In production, this would use AI to analyze your actual policy documents.`;
        output.textContent = analysis;
      }, 2000);
    } else {
      // Production mode - use real AI analysis
      try {
        const headers = await getAuthHeader();
        
        // Get policy data from user input or uploaded documents
        const policyData = document.getElementById('policy-input')?.value || 
          "Please upload your policy documents or paste policy information for AI analysis.";
        
        const response = await fetch('/.netlify/functions/analyze-claim', {
          method: 'POST',
          headers,
          body: JSON.stringify({
            analysisType: 'policy_review',
            inputData: policyData
          })
        });

        const result = await response.json();
        
        if (response.ok && result.success) {
          output.textContent = result.analysis;
        } else {
          output.textContent = `Error: ${result.error || 'Analysis failed'}`;
        }
      } catch (error) {
        console.error('Policy analysis error:', error);
        output.textContent = 'Error: Failed to analyze policy. Please try again.';
      }
    }
  }

  async function assessDamage() {
    const output = document.getElementById('damage-assessment-output');
    output.style.display = 'block';
    output.innerHTML = '<div class="spinner"></div> Calculating damage assessment with AI...';

    const isDevelopment = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';

    if (isDevelopment) {
      setTimeout(() => {
        const assessment = `Damage Assessment Summary:

Property Damage Breakdown:
- Roof Damage: $15,000 (replacement required)
- Interior Water Damage: $8,500 (drywall, flooring)
- HVAC System: $3,200 (water damage)
- Personal Property: $12,000 (furniture, electronics)

Total Estimated Damage: $38,700
Less Depreciation (10%): $3,870
Net Claim Value: $34,830

Documentation Required:
✓ Photos of all damaged areas
✓ Contractor estimates (minimum 2)
✓ Proof of ownership for personal property
✓ Receipts for emergency repairs

This is a mock assessment for development testing. In production, this would use AI to analyze your damage photos and estimates.`;
        output.textContent = assessment;
      }, 2000);
    } else {
      try {
        const headers = await getAuthHeader();
        
        const damageData = document.getElementById('damage-input')?.value || 
          "Please provide damage information, photos, or estimates for AI analysis.";
        
        const response = await fetch('/.netlify/functions/analyze-claim', {
          method: 'POST',
          headers,
          body: JSON.stringify({
            analysisType: 'damage_assessment',
            inputData: damageData
          })
        });

        const result = await response.json();
        
        if (response.ok && result.success) {
          output.textContent = result.analysis;
        } else {
          output.textContent = `Error: ${result.error || 'Assessment failed'}`;
        }
      } catch (error) {
        console.error('Damage assessment error:', error);
        output.textContent = 'Error: Failed to assess damage. Please try again.';
      }
    }
  }

  async function reviewEstimate() {
    const output = document.getElementById('estimate-review-output');
    output.style.display = 'block';
    output.innerHTML = '<div class="spinner"></div> Reviewing estimates with AI...';

    const isDevelopment = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';

    if (isDevelopment) {
      setTimeout(() => {
        const review = `Estimate Comparison Analysis:

Contractor Estimate: $38,700
Insurer Estimate: $28,500
Discrepancy: $10,200 (26% difference)

Key Discrepancies Identified:
1. Roof Replacement: Contractor $15,000 vs Insurer $12,000
   - Missing: Underlayment, flashing, permits
2. Interior Repairs: Contractor $8,500 vs Insurer $6,200
   - Missing: Paint, trim, baseboards
3. HVAC: Contractor $3,200 vs Insurer $2,100
   - Missing: Ductwork cleaning, filter replacement

Recommended Actions:
1. Request detailed line-item breakdown from insurer
2. Submit contractor estimates with supporting documentation
3. Schedule re-inspection with both parties present
4. Consider independent appraisal if dispute continues

This is a mock review for development testing. In production, this would use AI to compare your actual estimates.`;
        output.textContent = review;
      }, 2000);
    } else {
      try {
        const headers = await getAuthHeader();
        
        const estimateData = document.getElementById('estimate-input')?.value || 
          "Please provide contractor and insurer estimates for AI comparison.";
        
        const response = await fetch('/.netlify/functions/analyze-claim', {
          method: 'POST',
          headers,
          body: JSON.stringify({
            analysisType: 'estimate_review',
            inputData: estimateData
          })
        });

        const result = await response.json();
        
        if (response.ok && result.success) {
          output.textContent = result.analysis;
        } else {
          output.textContent = `Error: ${result.error || 'Estimate review failed'}`;
        }
      } catch (error) {
        console.error('Estimate review error:', error);
        output.textContent = 'Error: Failed to review estimates. Please try again.';
      }
    }
  }

  async function calculateBI() {
    const output = document.getElementById('bi-calculator-output');
    output.style.display = 'block';
    output.innerHTML = '<div class="spinner"></div> Calculating business interruption with AI...';

    const isDevelopment = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';

    if (isDevelopment) {
      setTimeout(() => {
        const biCalc = `Business Interruption Loss Calculation:

Lost Revenue Analysis:
- Pre-loss monthly revenue: $25,000
- Projected downtime: 3 months
- Total lost revenue: $75,000

Extra Expenses:
- Temporary location rent: $3,000/month × 3 = $9,000
- Equipment rental: $1,500/month × 3 = $4,500
- Additional utilities: $500/month × 3 = $1,500
- Marketing to retain customers: $2,000

Total Extra Expenses: $17,000

Total BI Claim: $92,000

Documentation Required:
✓ Profit & Loss statements (12 months prior)
✓ Tax returns (2 years)
✓ Bank statements
✓ Customer contracts
✓ Vendor invoices

This is a mock calculation for development testing. In production, this would use AI to analyze your business financials.`;
        output.textContent = biCalc;
      }, 2000);
    } else {
      try {
        const headers = await getAuthHeader();
        
        const biData = document.getElementById('bi-input')?.value || 
          "Please provide business financial information for BI calculation.";
        
        const response = await fetch('/.netlify/functions/analyze-claim', {
          method: 'POST',
          headers,
          body: JSON.stringify({
            analysisType: 'business_interruption',
            inputData: biData
          })
        });

        const result = await response.json();
        
        if (response.ok && result.success) {
          output.textContent = result.analysis;
        } else {
          output.textContent = `Error: ${result.error || 'BI calculation failed'}`;
        }
      } catch (error) {
        console.error('BI calculation error:', error);
        output.textContent = 'Error: Failed to calculate BI losses. Please try again.';
      }
    }
  }

  async function requestExpertOpinion() {
    const output = document.getElementById('expert-opinion-output');
    output.style.display = 'block';
    output.innerHTML = '<div class="spinner"></div> Generating expert opinion request with AI...';

    const isDevelopment = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';

    if (isDevelopment) {
      setTimeout(() => {
        const expertRequest = `Expert Opinion Request Letter:

[Date]

[Expert Name]
[Expert Company]
[Address]

Re: Property Damage Assessment - Claim #[CLAIM_NUMBER]

Dear [Expert Name],

We are requesting your professional opinion regarding property damage sustained at [Property Address] on [Date of Loss].

Scope of Work Requested:
1. Structural damage assessment
2. Cause and origin analysis
3. Repair methodology and cost estimation
4. Timeline for completion
5. Code compliance requirements

Documents Provided:
- Insurance adjuster's estimate
- Contractor estimates
- Photographic documentation
- Engineering reports (if available)

Please provide your written opinion within 14 days of inspection.

Sincerely,
[Your Name]

This is a mock request for development testing. In production, this would use AI to generate customized expert opinion requests.`;
        output.textContent = expertRequest;
      }, 2000);
    } else {
      try {
        const headers = await getAuthHeader();
        
        const expertData = document.getElementById('expert-input')?.value || 
          "Please provide claim details for expert opinion request generation.";
        
        const response = await fetch('/.netlify/functions/analyze-claim', {
          method: 'POST',
          headers,
          body: JSON.stringify({
            analysisType: 'expert_opinion',
            inputData: expertData
          })
        });

        const result = await response.json();
        
        if (response.ok && result.success) {
          output.textContent = result.analysis;
        } else {
          output.textContent = `Error: ${result.error || 'Expert opinion generation failed'}`;
        }
      } catch (error) {
        console.error('Expert opinion error:', error);
        output.textContent = 'Error: Failed to generate expert opinion request. Please try again.';
      }
    }
  }

  async function analyzeSettlement() {
    const output = document.getElementById('settlement-analysis-output');
    output.style.display = 'block';
    output.innerHTML = '<div class="spinner"></div> Analyzing settlement offer with AI...';

    const isDevelopment = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';

    if (isDevelopment) {
      setTimeout(() => {
        const settlementAnalysis = `Settlement Analysis & Negotiation Strategy:

Current Settlement Offer: $28,500
Your Claim Value: $38,700
Shortfall: $10,200 (26% underpayment)

Negotiation Strategy:
1. Document all discrepancies with supporting evidence
2. Request detailed explanation for each line item reduction
3. Submit independent contractor estimates
4. Highlight code upgrade requirements
5. Emphasize policy language supporting full replacement cost

Key Arguments:
- Policy provides replacement cost coverage
- Contractor estimates are from licensed professionals
- Code upgrades are required by local ordinances
- Depreciation should not apply to structural elements

Next Steps:
1. Send formal demand letter within 30 days
2. Request appraisal if negotiations fail
3. Consider public adjuster if claim exceeds $50,000
4. Document all communications

This is a mock analysis for development testing. In production, this would use AI to analyze your actual settlement offer.`;
        output.textContent = settlementAnalysis;
      }, 2000);
    } else {
      try {
        const headers = await getAuthHeader();
        
        const settlementData = document.getElementById('settlement-input')?.value || 
          "Please provide settlement offer details for AI analysis.";
        
        const response = await fetch('/.netlify/functions/analyze-claim', {
          method: 'POST',
          headers,
          body: JSON.stringify({
            analysisType: 'settlement_analysis',
            inputData: settlementData
          })
        });

        const result = await response.json();
        
        if (response.ok && result.success) {
          output.textContent = result.analysis;
        } else {
          output.textContent = `Error: ${result.error || 'Settlement analysis failed'}`;
        }
      } catch (error) {
        console.error('Settlement analysis error:', error);
        output.textContent = 'Error: Failed to analyze settlement. Please try again.';
      }
    }
  }

  // Download functions for analysis tools
  function downloadPolicyChecklist() {
    alert("Development Mode: Would download Policy Review Checklist\n\nIn production, this would generate and download a comprehensive policy review checklist.");
  }

  function downloadDamageForm() {
    alert("Development Mode: Would download Damage Assessment Form\n\nIn production, this would generate and download a detailed damage assessment form.");
  }

  function downloadComparison() {
    alert("Development Mode: Would download Estimate Comparison Report\n\nIn production, this would generate and download a detailed comparison report.");
  }

  function downloadBICalc() {
    alert("Development Mode: Would download Business Interruption Calculator\n\nIn production, this would generate and download a BI calculation worksheet.");
  }

  function downloadExpertForm() {
    alert("Development Mode: Would download Expert Opinion Request Form\n\nIn production, this would generate and download a professional expert opinion request form.");
  }

  function downloadNegotiation() {
    alert("Development Mode: Would download Negotiation Strategy Document\n\nIn production, this would generate and download a comprehensive negotiation strategy document.");
  }

  // --- Auth Guard + Init ---
  document.addEventListener('DOMContentLoaded', async () => {
    // Development mode bypass - remove in production
    const isDevelopment = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
    
    if (!isDevelopment) {
    const { data: { user } } = await supabase.auth.getUser();
    if (!user) {
      alert("You must log in first.");
      window.location.href = "login.html";
      return;
      }
    } else {
      console.log("Development mode: Authentication bypassed");
    }

    // Initialize accordion functionality
    document.querySelectorAll('.accordion-header').forEach(btn => {
      btn.addEventListener('click', () => {
        btn.parentElement.classList.toggle('active');
      });
    });

    // Load initial data
    try {
      await loadDocuments();
      await loadCreditLog();
    } catch (error) {
      console.log("Some functions may not be available in development mode:", error);
    }
  });
</script>

<!-- Affiliate Tools Script -->
<script src="../assets/js/affiliate-tools.js"></script>
</body>
</html>
