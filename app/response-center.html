<!-- Claim Analysis Tools -->
<div id="analysis-tools" class="tab-content">
  <h2>Claim Analysis Tools</h2>
  <p>Use these AI-powered tools to analyze insurer communications, reserves, settlement positions, and more.</p>
  
  <div class="tool-grid">
    <!-- Reserve Inquiry -->
    <div class="tool-card">
      <div class="tool-title">Reserve Inquiry Letter</div>
      <div class="tool-desc">Generate a professional request for insurer reserve information.</div>
      <button class="btn-primary" onclick="runTool('reserve-inquiry')">Generate</button>
      <div id="reserve-inquiry-output" class="tool-output"></div>
      <div id="reserve-inquiry-actions" class="action-buttons" style="display:none; margin-top:0.5rem;">
        <button class="btn-primary" onclick="copyToolOutput('reserve-inquiry')">Copy</button>
        <button class="btn-primary" onclick="downloadToolOutput('reserve-inquiry')">Download</button>
      </div>
    </div>

    <!-- Coverage Analyzer -->
    <div class="tool-card">
      <div class="tool-title">Coverage Letter Analyzer</div>
      <div class="tool-desc">Paste an insurer coverage letter and get a plain-English analysis with rebuttal points.</div>
      <button class="btn-primary" onclick="runTool('coverage-analyzer')">Generate</button>
      <div id="coverage-analyzer-output" class="tool-output"></div>
      <div id="coverage-analyzer-actions" class="action-buttons" style="display:none; margin-top:0.5rem;">
        <button class="btn-primary" onclick="copyToolOutput('coverage-analyzer')">Copy</button>
        <button class="btn-primary" onclick="downloadToolOutput('coverage-analyzer')">Download</button>
      </div>
    </div>

    <!-- Supplement Request -->
    <div class="tool-card">
      <div class="tool-title">Supplement Request Draft</div>
      <div class="tool-desc">Generate a draft letter requesting additional scope items without dollar values.</div>
      <button class="btn-primary" onclick="runTool('supplement-request')">Generate</button>
      <div id="supplement-request-output" class="tool-output"></div>
      <div id="supplement-request-actions" class="action-buttons" style="display:none; margin-top:0.5rem;">
        <button class="btn-primary" onclick="copyToolOutput('supplement-request')">Copy</button>
        <button class="btn-primary" onclick="downloadToolOutput('supplement-request')">Download</button>
      </div>
    </div>

    <!-- Proof of Loss Checklist -->
    <div class="tool-card">
      <div class="tool-title">Proof of Loss Checklist</div>
      <div class="tool-desc">Get a checklist of required elements for a valid Proof of Loss.</div>
      <button class="btn-primary" onclick="runTool('pol-checklist')">Generate</button>
      <div id="pol-checklist-output" class="tool-output"></div>
      <div id="pol-checklist-actions" class="action-buttons" style="display:none; margin-top:0.5rem;">
        <button class="btn-primary" onclick="copyToolOutput('pol-checklist')">Copy</button>
        <button class="btn-primary" onclick="downloadToolOutput('pol-checklist')">Download</button>
      </div>
    </div>

    <!-- Depreciation Release -->
    <div class="tool-card">
      <div class="tool-title">Depreciation Release Request</div>
      <div class="tool-desc">Draft a request to release recoverable depreciation once repairs are complete.</div>
      <button class="btn-primary" onclick="runTool('depreciation-release')">Generate</button>
      <div id="depreciation-release-output" class="tool-output"></div>
      <div id="depreciation-release-actions" class="action-buttons" style="display:none; margin-top:0.5rem;">
        <button class="btn-primary" onclick="copyToolOutput('depreciation-release')">Copy</button>
        <button class="btn-primary" onclick="downloadToolOutput('depreciation-release')">Download</button>
      </div>
    </div>

    <!-- ALE Extension -->
    <div class="tool-card">
      <div class="tool-title">ALE Extension Letter</div>
      <div class="tool-desc">Request an extension for Additional Living Expenses or temporary housing.</div>
      <button class="btn-primary" onclick="runTool('ale-extension')">Generate</button>
      <div id="ale-extension-output" class="tool-output"></div>
      <div id="ale-extension-actions" class="action-buttons" style="display:none; margin-top:0.5rem;">
        <button class="btn-primary" onclick="copyToolOutput('ale-extension')">Copy</button>
        <button class="btn-primary" onclick="downloadToolOutput('ale-extension')">Download</button>
      </div>
    </div>

    <!-- Settlement Analyzer -->
    <div class="tool-card">
      <div class="tool-title">Settlement Position Analyzer</div>
      <div class="tool-desc">Paste an insurer settlement offer and receive a plain-English analysis.</div>
      <button class="btn-primary" onclick="runTool('settlement-analyzer')">Generate</button>
      <div id="settlement-analyzer-output" class="tool-output"></div>
      <div id="settlement-analyzer-actions" class="action-buttons" style="display:none; margin-top:0.5rem;">
        <button class="btn-primary" onclick="copyToolOutput('settlement-analyzer')">Copy</button>
        <button class="btn-primary" onclick="downloadToolOutput('settlement-analyzer')">Download</button>
      </div>
    </div>

    <!-- Bad Faith Checker -->
    <div class="tool-card">
      <div class="tool-title">Bad Faith Red Flag Checker</div>
      <div class="tool-desc">Enter insurer actions/timeline to check for possible bad faith indicators.</div>
      <button class="btn-primary" onclick="runTool('badfaith-checker')">Generate</button>
      <div id="badfaith-checker-output" class="tool-output"></div>
      <div id="badfaith-checker-actions" class="action-buttons" style="display:none; margin-top:0.5rem;">
        <button class="btn-primary" onclick="copyToolOutput('badfaith-checker')">Copy</button>
        <button class="btn-primary" onclick="downloadToolOutput('badfaith-checker')">Download</button>
      </div>
    </div>

    <!-- Escalation Drafts -->
    <div class="tool-card">
      <div class="tool-title">Escalation Drafts</div>
      <div class="tool-desc">Generate draft complaints or escalation letters to supervisors, DOI, or mediation.</div>
      <button class="btn-primary" onclick="runTool('escalation-drafts')">Generate</button>
      <div id="escalation-drafts-output" class="tool-output"></div>
      <div id="escalation-drafts-actions" class="action-buttons" style="display:none; margin-top:0.5rem;">
        <button class="btn-primary" onclick="copyToolOutput('escalation-drafts')">Copy</button>
        <button class="btn-primary" onclick="downloadToolOutput('escalation-drafts')">Download</button>
      </div>
    </div>

    <!-- Timeline Builder -->
    <div class="tool-card">
      <div class="tool-title">Claim Timeline Builder</div>
      <div class="tool-desc">Input claim events and generate a structured timeline to highlight delays and gaps.</div>
      <button class="btn-primary" onclick="runTool('timeline-builder')">Generate</button>
      <div id="timeline-builder-output" class="tool-output"></div>
      <div id="timeline-builder-actions" class="action-buttons" style="display:none; margin-top:0.5rem;">
        <button class="btn-primary" onclick="copyToolOutput('timeline-builder')">Copy</button>
        <button class="btn-primary" onclick="downloadToolOutput('timeline-builder')">Download</button>
      </div>
    </div>
  </div>
</div>

<script>
async function runTool(tool) {
  const outputBox = document.getElementById(`${tool}-output`);
  const actionBox = document.getElementById(`${tool}-actions`);

  outputBox.style.display = 'block';
  outputBox.innerHTML = `<div class="spinner"></div> Generating...`;
  actionBox.style.display = 'none';

  try {
    const res = await fetch('/.netlify/functions/generate-response', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        email: localStorage.getItem('userEmail'),
        mode: tool,
        inputText: `Please generate output for tool: ${tool}`
      })
    });
    const data = await res.json();

    if (res.ok && data.draft) {
      outputBox.textContent = data.draft;
      actionBox.style.display = 'flex';
    } else {
      outputBox.textContent = data.error || "Failed to generate output.";
    }
  } catch (err) {
    console.error(err);
    outputBox.textContent = "Error generating output.";
  }
}

function copyToolOutput(tool) {
  const text = document.getElementById(`${tool}-output`).innerText.trim();
  if (!text) {
    alert("No content to copy.");
    return;
  }
  navigator.clipboard.writeText(text)
    .then(() => alert("Copied to clipboard!"))
    .catch(err => {
      console.error("Copy failed:", err);
      alert("Failed to copy.");
    });
}

function downloadToolOutput(tool) {
  const text = document.getElementById(`${tool}-output`).innerText.trim();
  if (!text) {
    alert("No content to download.");
    return;
  }
  const blob = new Blob([text], { type: 'text/plain' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = `${tool}-output.txt`;
  link.click();
}
</script>
