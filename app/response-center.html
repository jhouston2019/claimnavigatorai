<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Claim Resource & AI Response Center - ClaimNavigatorAI</title>
  <meta name="description" content="AI-powered claim resource and response center with document library, AI response generation, claim analysis tools, and playbook.">
  
  <style>
    :root {
      --primary: #1e40af;
      --accent: #3b82f6;
      --border: #e5e7eb;
      --text-secondary: #6b7280;
      --bg-light: #f9fafb;
    }
    
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
      margin: 0; 
      padding: 0; 
      background: #f8fafc; 
    }
    
    /* Header */
    header { 
      background: #0f172a; 
      padding: 1rem; 
      color: #fff; 
      position: sticky; 
      top: 0; 
      z-index: 100;
    }
    
    nav { 
      display: flex;
      justify-content: space-between; 
      align-items: center;
    }
    
    .logo { 
      margin-right: 2rem; 
      font-weight: bold;
      font-size: 1.2rem;
    }
    
    .nav-links { 
      display: flex;
      gap: 1rem;
    }
    
    .nav-links a { 
      color: #fff; 
      text-decoration: none; 
      padding: 0.5rem 1rem;
      border-radius: 0.375rem;
      transition: background-color 0.2s;
    }
    
    .nav-links a:hover { 
      background: rgba(255,255,255,0.1);
    }
    
    /* Main container */
    .main-container {
      display: flex;
      min-height: calc(100vh - 80px);
    }
    
    /* Sidebar */
    .sidebar {
      width: 250px;
      background: white;
      border-right: 1px solid var(--border);
      padding: 1rem;
      overflow-y: auto;
    }
    
    .sidebar h3 {
      color: var(--primary);
      margin-bottom: 1rem;
      font-size: 1.1rem;
    }
    
    .sidebar-section {
      margin-bottom: 0.5rem;
    }
    
    .sidebar-button {
      width: 100%;
      background: none;
      border: none;
      padding: 0.75rem 1rem;
      text-align: left;
      cursor: pointer;
      border-radius: 0.5rem;
      transition: all 0.2s;
      color: var(--text-secondary);
      font-size: 0.9rem;
    }
    
    .sidebar-button:hover {
      background: var(--bg-light);
      color: var(--primary);
    }
    
    .sidebar-button.active {
      background: var(--primary);
      color: white;
    }
    
    .subsection-button {
      width: 100%;
      background: none;
      border: none;
      padding: 0.5rem 1rem;
      text-align: left;
      cursor: pointer;
      border-radius: 0.375rem;
      transition: all 0.2s;
      color: var(--text-secondary);
      font-size: 0.8rem;
      margin-left: 1rem;
    }
    
    .subsection-button:hover {
      background: var(--bg-light);
      color: var(--primary);
    }
    
    .subsection-button.active {
      background: var(--primary);
      color: white;
    }
    
    /* Main content */
    .main-content {
      flex: 1;
      padding: 2rem;
      overflow-y: auto;
    }
    
    /* Categories at top */
    .categories-section {
      margin-bottom: 2rem;
    }
    
    .category-group {
      margin-bottom: 2rem;
      background: white;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1.5rem;
    }
    
    .category-title {
      font-size: 5.5rem;
      font-weight: 600;
      color: black;
      margin: 0 0 1rem 0;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid var(--border);
    }
    
    .tools-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 0.75rem;
    }
    
    .tool-item {
      background: #1e3a8a;
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 0.75rem 1rem;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 1.2rem;
      font-weight: 700;
      color: white;
      text-align: center;
    }
    
    .tool-item:hover {
      background: var(--primary);
      color: white;
      transform: translateY(-1px);
    }
    
    .tool-item.active {
      background: var(--primary);
      color: white;
    }
    
    .content-header {
      margin-bottom: 2rem;
    }
    
    .content-header h1 {
      color: var(--primary);
      margin: 0 0 0.5rem 0;
      font-size: 2rem;
    }
    
    .content-header p {
      color: var(--text-secondary);
      margin: 0;
    }
    
    /* Category and Tool Views */
    .category-view {
      max-width: 1200px;
      margin: 0 auto;
    }

    .category-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 2rem;
      padding: 1.5rem;
      background: white;
      border-radius: 12px;
      border: 1px solid var(--border);
    }

    .category-icon {
      font-size: 3rem;
      line-height: 1;
    }

    .category-info {
      flex: 1;
    }

    .category-title {
      font-size: 2rem;
      font-weight: 700;
      color: black;
      margin: 0 0 0.5rem 0;
    }

    .category-description {
      color: var(--text-secondary);
      margin: 0;
      font-size: 1.1rem;
    }

    .tools-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-top: 1rem;
    }

    .tool-card {
      background: white;
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 1.5rem;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
    }

    .tool-card:hover {
      border-color: var(--primary);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .tool-icon {
      font-size: 2.5rem;
      margin-bottom: 1rem;
    }

    .tool-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--primary);
      margin: 0 0 0.5rem 0;
    }

    .tool-description {
      color: var(--text-secondary);
      margin: 0;
      font-size: 0.9rem;
      line-height: 1.4;
    }
    
    /* Mobile responsive */
    @media (max-width: 768px) {
      .main-container {
        flex-direction: column;
      }
      
      .sidebar {
        width: 100%;
        height: auto;
        border-right: none;
        border-bottom: 1px solid var(--border);
      }
      
      .main-content {
        padding: 1rem;
      }
      
      .tools-list {
        grid-template-columns: 1fr;
        gap: 0.5rem;
      }
      
      .tool-item {
        padding: 0.5rem 0.75rem;
        font-size: 0.85rem;
      }
      
      .category-group {
        padding: 1rem;
        margin-bottom: 1rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <nav>
      <div class="logo">üè† ClaimNavigatorAI</div>
      <div class="nav-links">
        <a href="../index.html">Home</a>
        <a href="response-center.html">Response Center</a>
        <a href="../product.html">Product</a>
        <a href="../terms.html">Terms</a>
        <a href="../privacy.html">Privacy</a>
      </div>
    </nav>
  </header>

  <div class="main-container">
    <div class="sidebar">
      <h3>Response Center</h3>
      
      <div class="sidebar-section">
        <button class="sidebar-button active" data-section="dashboard">
          Dashboard
        </button>
      </div>
      
      <div class="sidebar-section">
        <button class="sidebar-button" data-section="advanced-tools">
          Advanced Tools
        </button>
      </div>
      
      <div class="sidebar-section">
        <button class="sidebar-button" data-section="ai-agent">
          AI Response & Analysis Agent
        </button>
      </div>
      
      <div class="sidebar-section">
        <button class="sidebar-button" data-section="ai-policy-analyzer">
          AI Policy Analyzer
        </button>
      </div>
      
      <div class="sidebar-section">
        <button class="sidebar-button" data-section="claim-analysis">
          Claim Analysis Tools
        </button>
      </div>
      
      <div class="sidebar-section">
        <button class="sidebar-button" data-section="claim-document-library">
          Claim Document Library
        </button>
      </div>
      
      <div class="sidebar-section">
        <button class="sidebar-button" data-section="claim-documentation-guides">
          Claim Documentation Guides
        </button>
      </div>
      
      <div class="sidebar-section">
        <button class="sidebar-button" data-section="claim-playbook">
          Claim Playbook
        </button>
      </div>
      
      <div class="sidebar-section">
        <button class="sidebar-button" data-section="claim-timeline">
          Claim Timeline & Sequence Guide
        </button>
      </div>
      
      <div class="sidebar-section">
        <button class="sidebar-button" data-section="document-generator">
          Document Generator
        </button>
      </div>
      
      <div class="sidebar-section">
        <button class="sidebar-button" data-section="evidence-organizer">
          Evidence Organizer
        </button>
      </div>
      
      <div class="sidebar-section">
        <button class="sidebar-button" data-section="how-to-use">
          How to Use this Site
        </button>
      </div>
      
      <div class="sidebar-section">
        <button class="sidebar-button" data-section="insurance-tactics">
          Insurance Company Tactics
        </button>
      </div>
      
      <div class="sidebar-section">
        <button class="sidebar-button" data-section="maximize-claim">
          Maximize Your Claim
        </button>
      </div>
      
      <div class="sidebar-section">
        <button class="sidebar-button" data-section="my-claims">
          My Claim - Tracking Journal
        </button>
      </div>
      
      <div class="sidebar-section">
        <button class="sidebar-button" data-section="negotiation-scripts">
          Negotiation Scripts & Escalation
        </button>
      </div>
      
      <div class="sidebar-section">
        <button class="sidebar-button" data-section="recommended-resources">
          Recommended Resources
        </button>
      </div>
      
      <div class="sidebar-section">
        <button class="sidebar-button" data-section="settings">
          Settings
        </button>
      </div>
      
      <div class="sidebar-section">
        <button class="sidebar-button" data-section="situational-advisory">
          Situational Advisory
        </button>
      </div>
      
      <div class="sidebar-section">
        <button class="sidebar-button" data-section="state-rights">
          State-Specific Rights & Deadlines
        </button>
      </div>
    </div>
    
    <div class="main-content">
      <div class="content-header" style="text-align: center;">
        <h1>Your AI-Powered Claim Resource Center</h1>
        <p>Your comprehensive claim management toolkit</p>
      </div>
      
      <div class="categories-section">
        <div class="category-group">
          <h2 class="category-title">How to Use this Site</h2>
          <div class="tools-list">
            <div class="tool-item" data-tool="how-to-use">How to Use this Site</div>
          </div>
        </div>
        
        <div class="category-group">
          <h2 class="category-title">Strategy & Guidance</h2>
          <div class="tools-list">
            <div class="tool-item" data-tool="claim-playbook">Claim Playbook</div>
            <div class="tool-item" data-tool="claim-timeline">Claim Timeline & Sequence Guide</div>
            <div class="tool-item" data-tool="insurance-tactics">Insurance Company Tactics</div>
            <div class="tool-item" data-tool="maximize-claim">Maximize Your Claim</div>
            <div class="tool-item" data-tool="state-rights">State-Specific Rights & Deadlines</div>
          </div>
        </div>
        
        <div class="category-group">
          <h2 class="category-title">Core Claim Tools</h2>
          <div class="tools-list">
            <div class="tool-item" data-tool="ai-agent">AI Response & Analysis Agent</div>
            <div class="tool-item" data-tool="ai-policy-analyzer">AI Policy Analyzer</div>
            <div class="tool-item" data-tool="claim-analysis">Claim Analysis Tools</div>
            <div class="tool-item" data-tool="situational-advisory">Situational Advisory</div>
            <div class="tool-item" data-tool="document-generator">Document Generator</div>
            <div class="tool-item" data-tool="evidence-organizer">Evidence Organizer</div>
            <div class="tool-item" data-tool="claim-document-library">Claim Document Library</div>
            <div class="tool-item" data-tool="claim-documentation-guides">Claim Documentation Guides</div>
            <div class="tool-item" data-tool="negotiation-scripts">Negotiation Scripts & Escalation</div>
            <div class="tool-item" data-tool="my-claims">My Claim - Tracking Journal</div>
            <div class="tool-item" data-tool="advanced-tools">Advanced Tools</div>
          </div>
        </div>
        
        <div class="category-group">
          <h2 class="category-title">Resources</h2>
          <div class="tools-list">
            <div class="tool-item" data-tool="recommended-resources">Recommended Resources</div>
            <div class="tool-item" data-tool="settings">Settings</div>
          </div>
        </div>
      </div>
      
      <div id="content-area">
        <!-- Content will be loaded here -->
      </div>
    </div>
  </div>

  <script>
    // Simple navigation functionality
    document.addEventListener('DOMContentLoaded', function() {
      console.log('‚úÖ Clean Response Center loaded successfully');
      
      // Handle sidebar navigation
      const sidebarButtons = document.querySelectorAll('.sidebar-button, .subsection-button');
      sidebarButtons.forEach(button => {
        button.addEventListener('click', function() {
          // Remove active class from all buttons
          sidebarButtons.forEach(btn => btn.classList.remove('active'));
          // Add active class to clicked button
          this.classList.add('active');
          
          const section = this.dataset.section;
          const subsection = this.dataset.subsection;
          
          if (section === 'dashboard') {
            showDashboard();
          } else if (subsection) {
            showTool(subsection);
          } else {
            showCategory(section);
          }
        });
      });
      
      // Handle tool items in main content
      const toolItems = document.querySelectorAll('.tool-item');
      toolItems.forEach(item => {
        item.addEventListener('click', function() {
          const tool = this.dataset.tool;
          showTool(tool);
          
          // Update sidebar active state
          const sidebarButton = document.querySelector(`[data-subsection="${tool}"]`);
          if (sidebarButton) {
            sidebarButtons.forEach(btn => btn.classList.remove('active'));
            sidebarButton.classList.add('active');
          }
        });
      });
      
      function showDashboard() {
        document.getElementById('content-area').innerHTML = '';
      }
      
      // AI Response & Analysis Agent Functions
      async function generateResponse() {
        const input = document.getElementById('input-text').value;
        const output = document.getElementById('ai-output');
        const confidence = document.getElementById('confidence-meter');
        
        if (!input.trim()) {
          alert('Please enter some text to analyze.');
          return;
        }
        
        output.style.display = 'block';
        output.innerHTML = '<div class="spinner"></div> Generating AI response...';
        
        try {
          // Call the real AI generation function
          const response = await fetch('/.netlify/functions/generate-response', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              input: input,
              type: 'claim_response'
            })
          });
          
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          
          const data = await response.json();
          
          if (data.success) {
            output.innerHTML = data.response;
            confidence.innerHTML = `Confidence Level: ${data.confidence || '85%'} - AI generated response`;
            
            // Add to session history
            addToSessionHistory(input, data.response);
          } else {
            throw new Error(data.error || 'Failed to generate response');
          }
        } catch (error) {
          console.error('Error generating AI response:', error);
          output.innerHTML = `
            <div style="color: #dc2626; padding: 1rem; background: #fee2e2; border-radius: 0.5rem;">
              <strong>Error:</strong> ${error.message}<br>
              <small>Falling back to template response...</small>
            </div>
            <div style="margin-top: 1rem;">
              Based on your correspondence, here's a professional response template:<br><br>
              Dear Insurance Representative,<br><br>
              I am writing in response to your letter dated [DATE]. After careful review of your correspondence, I would like to address the following points:<br><br>
              1. [Point 1 from your letter]<br>
              2. [Point 2 from your letter]<br>
              3. [Point 3 from your letter]<br><br>
              I believe there may be some misunderstanding regarding [SPECIFIC ISSUE]. According to my policy documentation, [RELEVANT POLICY LANGUAGE].<br><br>
              I would appreciate the opportunity to discuss this matter further and provide additional documentation as needed.<br><br>
              Thank you for your time and consideration.<br><br>
              Sincerely,<br>
              [YOUR NAME]
            </div>
          `;
          confidence.innerHTML = 'Confidence Level: 70% - Template response (AI service unavailable)';
        }
      }
      
      async function exportDoc(format) {
        const output = document.getElementById('ai-output');
        if (!output.innerHTML || output.innerHTML.includes('spinner')) {
          alert('Please generate a response first.');
          return;
        }
        
        const content = output.innerHTML;
        
        try {
          // Use the real document generation function
          const response = await fetch('/.netlify/functions/generate-document', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              content: content,
              format: format,
              type: 'claim_response',
              filename: `claim_response_${new Date().toISOString().split('T')[0]}`
            })
          });
          
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          
          const data = await response.json();
          
          if (data.success && data.downloadUrl) {
            // Download the generated document
            const a = document.createElement('a');
            a.href = data.downloadUrl;
            a.download = data.filename || `claim_response.${format}`;
            a.click();
          } else {
            throw new Error(data.error || 'Failed to generate document');
          }
        } catch (error) {
          console.error('Error generating document:', error);
          // Fallback to simple text download
          const blob = new Blob([content], { type: 'text/plain' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `claim_response.${format}`;
          a.click();
          URL.revokeObjectURL(url);
          alert('Document generated locally (AI service unavailable)');
        }
      }
      
      async function saveDraft() {
        const output = document.getElementById('ai-output');
        if (!output.innerHTML || output.innerHTML.includes('spinner')) {
          alert('Please generate a response first.');
          return;
        }
        
        const content = output.innerHTML;
        
        try {
          // Save to user's documents using the save-draft function
          const response = await fetch('/.netlify/functions/save-draft', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              content: content,
              type: 'claim_response',
              title: `AI Response - ${new Date().toLocaleDateString()}`,
              metadata: {
                generated: new Date().toISOString(),
                source: 'ai_response_agent'
              }
            })
          });
          
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          
          const data = await response.json();
          
          if (data.success) {
            alert('Draft saved to My Documents successfully!');
            // Optionally refresh the documents list if it's visible
            if (typeof loadDocuments === 'function') {
              loadDocuments();
            }
          } else {
            throw new Error(data.error || 'Failed to save draft');
          }
        } catch (error) {
          console.error('Error saving draft:', error);
          alert('Failed to save draft. Please try again or copy the content manually.');
        }
      }
      
      function addToSessionHistory(input, response) {
        const history = document.getElementById('session-history');
        const entry = document.createElement('div');
        entry.style.cssText = 'border: 1px solid var(--border); padding: 1rem; margin: 0.5rem 0; border-radius: 6px; background: var(--bg-light);';
        entry.innerHTML = `
          <strong>Input:</strong> ${input.substring(0, 100)}...<br>
          <strong>Response:</strong> ${response.substring(0, 200)}...
        `;
        history.appendChild(entry);
      }
      
      // Document Library Functions
      function setLang(lang) {
        document.getElementById('lang-en').className = lang === 'en' ? 'btn-primary' : 'btn-secondary';
        document.getElementById('lang-es').className = lang === 'es' ? 'btn-primary' : 'btn-secondary';
        loadDocuments(lang);
      }
      
      async function loadDocuments(lang = 'en') {
        const container = document.getElementById('documents-container');
        container.innerHTML = '<div class="spinner"></div> Loading documents...';
        
        try {
          // Load real documents from the backend
          const response = await fetch('/.netlify/functions/list-documents', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              language: lang,
              type: 'claim_documents'
            })
          });
          
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          
          const data = await response.json();
          
          if (data.success && data.documents) {
            container.innerHTML = data.documents.map(doc => `
              <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; border: 1px solid var(--border); border-radius: 6px; margin: 0.5rem 0;">
                <div>
                  <strong>${doc.name}</strong><br>
                  <small style="color: var(--text-secondary);">${doc.type} ‚Ä¢ ${doc.date}</small>
                </div>
                <div>
                  <button class="btn-primary" onclick="downloadDocument('${doc.id}', '${doc.name}')">Download</button>
                  ${doc.hasTemplate ? '<button class="btn-secondary" onclick="downloadTemplate(\'' + doc.id + '\')">Template</button>' : ''}
                </div>
              </div>
            `).join('');
          } else {
            throw new Error(data.error || 'Failed to load documents');
          }
        } catch (error) {
          console.error('Error loading documents:', error);
          // Fallback to mock data
          const documents = lang === 'en' ? [
            { name: 'Claim Denial Response Template', type: 'PDF', date: '2024-01-15' },
            { name: 'Policy Review Checklist', type: 'DOCX', date: '2024-01-14' },
            { name: 'Damage Assessment Form', type: 'PDF', date: '2024-01-13' }
          ] : [
            { name: 'Plantilla de Respuesta a Denegaci√≥n', type: 'PDF', date: '2024-01-15' },
            { name: 'Lista de Verificaci√≥n de P√≥liza', type: 'DOCX', date: '2024-01-14' },
            { name: 'Formulario de Evaluaci√≥n de Da√±os', type: 'PDF', date: '2024-01-13' }
          ];
          
          container.innerHTML = documents.map(doc => `
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; border: 1px solid var(--border); border-radius: 6px; margin: 0.5rem 0;">
              <div>
                <strong>${doc.name}</strong><br>
                <small style="color: var(--text-secondary);">${doc.type} ‚Ä¢ ${doc.date}</small>
              </div>
              <button class="btn-primary" onclick="downloadDocument('${doc.name}')">Download</button>
            </div>
          `).join('');
        }
      }
      
      function filterDocuments() {
        const search = document.getElementById('doc-search').value.toLowerCase();
        const docs = document.querySelectorAll('#documents-container > div');
        docs.forEach(doc => {
          const text = doc.textContent.toLowerCase();
          doc.style.display = text.includes(search) ? 'flex' : 'none';
        });
      }
      
      function uploadDocument() {
        const file = document.getElementById('doc-upload').files[0];
        if (file) {
          alert(`File "${file.name}" uploaded successfully!`);
          loadDocuments();
        }
      }
      
      async function downloadDocument(id, name) {
        try {
          // Use the real document download function
          const response = await fetch('/.netlify/functions/download', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              documentId: id,
              type: 'claim_document'
            })
          });
          
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          
          const data = await response.json();
          
          if (data.success && data.downloadUrl) {
            // Download the document
            const a = document.createElement('a');
            a.href = data.downloadUrl;
            a.download = name || data.filename;
            a.click();
          } else {
            throw new Error(data.error || 'Failed to download document');
          }
        } catch (error) {
          console.error('Error downloading document:', error);
          alert(`Failed to download ${name}. Please try again.`);
        }
      }
      
      async function downloadTemplate(id) {
        try {
          // Use the template download function
          const response = await fetch('/.netlify/functions/get-template', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              templateId: id,
              type: 'claim_template'
            })
          });
          
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          
          const data = await response.json();
          
          if (data.success && data.downloadUrl) {
            // Download the template
            const a = document.createElement('a');
            a.href = data.downloadUrl;
            a.download = data.filename || `template_${id}`;
            a.click();
          } else {
            throw new Error(data.error || 'Failed to download template');
          }
        } catch (error) {
          console.error('Error downloading template:', error);
          alert('Failed to download template. Please try again.');
        }
      }
      
      // Claim Analysis Functions
      async function analyzePolicy() {
        const input = document.getElementById('policy-input').value;
        const output = document.getElementById('policy-analysis-output');
        
        if (!input.trim()) {
          alert('Please enter policy information to analyze.');
          return;
        }
        
        output.style.display = 'block';
        output.innerHTML = '<div class="spinner"></div> Analyzing policy...';
        
        try {
          // Use the real policy analysis function
          const response = await fetch('/.netlify/functions/policyAnalyzer', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              policyText: input,
              analysisType: 'coverage_review'
            })
          });
          
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          
          const data = await response.json();
          
          if (data.success) {
            output.innerHTML = data.analysis;
          } else {
            throw new Error(data.error || 'Failed to analyze policy');
          }
        } catch (error) {
          console.error('Error analyzing policy:', error);
          output.innerHTML = `
            <div style="color: #dc2626; padding: 1rem; background: #fee2e2; border-radius: 0.5rem; margin-bottom: 1rem;">
              <strong>Error:</strong> ${error.message}<br>
              <small>Falling back to template analysis...</small>
            </div>
            <div>
              Policy Analysis Results:<br><br>
              ‚úÖ Coverage Type: Property Insurance<br>
              ‚úÖ Deductible: $1,000<br>
              ‚úÖ Coverage Limit: $500,000<br>
              ‚ö†Ô∏è  Potential Gap: Flood damage not covered<br>
              ‚ö†Ô∏è  Potential Gap: Earthquake damage not covered<br><br>
              Recommendations:<br>
              1. Consider additional flood insurance<br>
              2. Review earthquake coverage options<br>
              3. Document all pre-existing conditions<br>
              4. Keep detailed records of improvements
            </div>
          `;
        }
      }
      
      function downloadPolicyChecklist() {
        alert('Policy Review Checklist downloaded!');
      }
      
      async function assessDamage() {
        const input = document.getElementById('damage-input').value;
        const output = document.getElementById('damage-assessment-output');
        
        if (!input.trim()) {
          alert('Please describe the damage to assess.');
          return;
        }
        
        output.style.display = 'block';
        output.innerHTML = '<div class="spinner"></div> Assessing damage...';
        
        try {
          // Use the real damage assessment function
          const response = await fetch('/.netlify/functions/analyze-claim', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              damageDescription: input,
              analysisType: 'damage_assessment'
            })
          });
          
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          
          const data = await response.json();
          
          if (data.success) {
            output.innerHTML = data.assessment;
          } else {
            throw new Error(data.error || 'Failed to assess damage');
          }
        } catch (error) {
          console.error('Error assessing damage:', error);
          output.innerHTML = `
            <div style="color: #dc2626; padding: 1rem; background: #fee2e2; border-radius: 0.5rem; margin-bottom: 1rem;">
              <strong>Error:</strong> ${error.message}<br>
              <small>Falling back to template assessment...</small>
            </div>
            <div>
              Damage Assessment Report:<br><br>
              Property Type: Residential<br>
              Damage Category: Water Damage<br>
              Estimated Repair Cost: $15,000 - $25,000<br>
              Urgency Level: High<br><br>
              Recommended Actions:<br>
              1. Contact water damage restoration company<br>
              2. Document all affected areas<br>
              3. Keep receipts for emergency repairs<br>
              4. Schedule professional inspection<br><br>
              Next Steps:<br>
              - File claim within 24 hours<br>
              - Gather supporting documentation<br>
              - Prepare for adjuster visit
            </div>
          `;
        }
      }
      
      function generateDamageReport() {
        alert('Damage Assessment Report generated and downloaded!');
      }
      
      // Evidence Organizer Functions
      function handleDragOver(e) {
        e.preventDefault();
        e.currentTarget.style.borderColor = 'var(--primary)';
        e.currentTarget.style.background = '#e0f2fe';
      }
      
      function handleDragLeave(e) {
        e.currentTarget.style.borderColor = 'var(--border)';
        e.currentTarget.style.background = 'var(--bg-light)';
      }
      
      function handleDrop(e) {
        e.preventDefault();
        e.currentTarget.style.borderColor = 'var(--border)';
        e.currentTarget.style.background = 'var(--bg-light)';
        
        const files = e.dataTransfer.files;
        handleFiles(files);
      }
      
      function handleFileSelect(e) {
        const files = e.target.files;
        handleFiles(files);
      }
      
      async function handleFiles(files) {
        const evidenceList = document.getElementById('evidence-list');
        
        for (const file of files) {
          // Show uploading status
          const item = document.createElement('div');
          item.style.cssText = 'display: flex; justify-content: space-between; align-items: center; padding: 1rem; border: 1px solid var(--border); border-radius: 6px; margin: 0.5rem 0; background: white;';
          item.innerHTML = `
            <div>
              <strong>${file.name}</strong><br>
              <small style="color: var(--text-secondary);">${file.type} ‚Ä¢ ${(file.size / 1024).toFixed(1)} KB</small>
            </div>
            <div>
              <span style="background: #f59e0b; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem;">Uploading...</span>
            </div>
          `;
          evidenceList.appendChild(item);
          
          try {
            // Upload file to evidence system
            const formData = new FormData();
            formData.append('file', file);
            formData.append('type', 'evidence');
            formData.append('category', 'claim_evidence');
            
            const response = await fetch('/.netlify/functions/upload-documents-to-supabase', {
              method: 'POST',
              body: formData
            });
            
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const data = await response.json();
            
            if (data.success) {
              // Update status to categorized
              item.innerHTML = `
                <div>
                  <strong>${file.name}</strong><br>
                  <small style="color: var(--text-secondary);">${file.type} ‚Ä¢ ${(file.size / 1024).toFixed(1)} KB</small>
                </div>
                <div>
                  <span style="background: var(--primary); color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem;">Categorized</span>
                </div>
              `;
            } else {
              throw new Error(data.error || 'Upload failed');
            }
          } catch (error) {
            console.error('Error uploading file:', error);
            // Update status to error
            item.innerHTML = `
              <div>
                <strong>${file.name}</strong><br>
                <small style="color: var(--text-secondary);">${file.type} ‚Ä¢ ${(file.size / 1024).toFixed(1)} KB</small>
              </div>
              <div>
                <span style="background: #dc2626; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem;">Error</span>
              </div>
            `;
          }
        }
        
        alert(`${files.length} file(s) processed!`);
      }
      
      // Helper function to get current user ID
      function getCurrentUserId() {
        // Try to get from localStorage or session
        const userId = localStorage.getItem('userId') || sessionStorage.getItem('userId');
        if (userId) return userId;
        
        // Generate a temporary user ID for demo purposes
        const tempId = 'temp_' + Date.now();
        localStorage.setItem('userId', tempId);
        return tempId;
      }
      
      // Claim Playbook Functions
      function togglePhase(phaseId) {
        const body = document.getElementById(phaseId + '-body');
        const toggle = document.getElementById(phaseId + '-toggle');
        
        if (body.style.display === 'none' || body.style.display === '') {
          body.style.display = 'block';
          toggle.innerHTML = '‚ñ≤';
        } else {
          body.style.display = 'none';
          toggle.innerHTML = '‚ñº';
        }
      }
      
      // Claim Timeline Functions
      function toggleTimelinePhase(phaseId) {
        const body = document.getElementById(phaseId + '-body');
        const toggle = document.getElementById(phaseId + '-toggle');
        
        if (body.style.display === 'none' || body.style.display === '') {
          body.style.display = 'block';
          toggle.innerHTML = '‚ñ≤';
        } else {
          body.style.display = 'none';
          toggle.innerHTML = '‚ñº';
        }
      }
      
      function showCategory(category) {
        const categoryNames = {
          'core-tools': 'Core Claim Tools',
          'strategy-guidance': 'Strategy & Guidance',
          'appeals-legal': 'Appeals & Legal Rights',
          'resources-support': 'Resources & Support'
        };
        
        document.getElementById('content-area').innerHTML = `
          <div style="text-align: center; padding: 3rem; background: white; border-radius: 8px; border: 1px solid var(--border);">
            <h2 style="color: var(--primary); margin-bottom: 1rem;">${categoryNames[category]}</h2>
            <p style="color: var(--text-secondary);">Select a specific tool from the ${categoryNames[category]} category above or use the sidebar.</p>
          </div>
        `;
      }
      
      function showTool(tool) {
        const toolContent = getToolContent(tool);
        document.getElementById('content-area').innerHTML = toolContent;
      }
      
      function getToolContent(tool) {
        // This will be implemented with actual content
        const toolNames = {
          'advanced-tools': 'Advanced Tools',
          'ai-agent': 'AI Response & Analysis Agent',
          'ai-policy-analyzer': 'AI Policy Analyzer',
          'claim-analysis': 'Claim Analysis Tools',
          'document-generator': 'Document Generator',
          'evidence-organizer': 'Evidence Organizer',
          'claim-document-library': 'Claim Document Library',
          'claim-documentation-guides': 'Claim Documentation Guides',
          'claim-playbook': 'Claim Playbook',
          'claim-timeline': 'Claim Timeline & Sequence Guide',
          'situational-advisory': 'Situational Advisory',
          'insurance-tactics': 'Insurance Company Tactics',
          'maximize-claim': 'Maximize Your Claim',
          'negotiation-scripts': 'Negotiation Scripts & Escalation',
          'appeal-builder': 'Appeal Builder',
          'state-rights': 'State-Specific Rights & Deadlines',
          'how-to-use': 'How to Use This Site',
          'recommended-resources': 'Recommended Resources',
          'my-claims': 'My Claim - Tracking Journal',
          'settings': 'Settings'
        };
        
        const toolContent = {
          'ai-agent': `
            <div style="padding: 2rem; background: white; border-radius: 8px; border: 1px solid var(--border);">
              <h2 style="color: var(--primary); margin-bottom: 1.5rem;">ü§ñ AI Response & Analysis Agent</h2>
              <p style="margin-bottom: 1.5rem; color: var(--text-secondary);">Generate professional responses to insurance correspondence using AI</p>
              
              <textarea id="input-text" style="width:100%; min-height:120px; margin-bottom:1rem; padding: 0.75rem; border: 1px solid var(--border); border-radius: 6px;" placeholder="Paste insurer correspondence..."></textarea>
              
              <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 1rem;">
                <button class="btn-primary" onclick="generateResponse()">Generate Response</button>
                <button class="btn-primary" onclick="exportDoc('docx')">Export DOCX</button>
                <button class="btn-primary" onclick="exportDoc('pdf')">Export PDF</button>
                <button class="btn-primary" onclick="saveDraft()">Save to My Documents</button>
                <select id="language-select" style="padding:0.5rem; border-radius:0.5rem; border: 1px solid var(--border);">
                  <option value="en">English</option>
                  <option value="es">Espa√±ol</option>
                </select>
              </div>
              
              <div id="ai-output" style="display:none; background:#fff; border:1px solid var(--border); border-radius:0.5rem; padding:0.75rem; white-space:pre-wrap; margin-top:0.5rem; min-height:80px;"></div>
              <div id="confidence-meter" style="margin-top:0.5rem; font-size:0.9rem; color:var(--text-secondary);"></div>
              
              <h3 style="margin-top: 2rem;">Session History</h3>
              <div id="session-history"></div>
            </div>
          `,
          'ai-policy-analyzer': `
            <div style="padding: 2rem; background: white; border-radius: 8px; border: 1px solid var(--border);">
              <h2 style="color: var(--primary); margin-bottom: 1.5rem;">üìã AI Policy Analyzer</h2>
              <p style="margin-bottom: 1.5rem; color: var(--text-secondary);">Upload your insurance policy documents for AI-powered analysis of coverages, important dates, and key information</p>
              
              <div style="background: linear-gradient(135deg, #f0f9ff, #e0f2fe); padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem; border-left: 5px solid var(--primary);">
                <h3 style="margin: 0 0 1rem 0; color: var(--primary);">What This Tool Does</h3>
                <ul style="margin: 0; padding-left: 1.5rem;">
                  <li>Analyzes your policy documents to identify all coverages and limits</li>
                  <li>Extracts important dates (policy period, renewal dates, claim deadlines)</li>
                  <li>Identifies exclusions and limitations that may affect your claim</li>
                  <li>Provides a comprehensive summary of your policy benefits</li>
                </ul>
              </div>
              
              <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 1.5rem;">
                <div style="background: var(--bg-light); padding: 1.5rem; border: 1px solid var(--border); border-radius: 12px;">
                  <h3 style="color: var(--primary); margin-bottom: 1rem;">üìÑ Policy Upload</h3>
                  <div style="border: 2px dashed var(--border); border-radius: 8px; padding: 2rem; text-align: center; background: white; margin-bottom: 1rem;">
                    <div style="font-size: 2rem; margin-bottom: 1rem;">üìÅ</div>
                    <p style="margin: 0 0 1rem 0; font-weight: 600;">Upload Your Policy Documents</p>
                    <p style="margin: 0 0 1rem 0; color: var(--text-secondary); font-size: 0.9rem;">Supports: PDF, DOC, DOCX files</p>
                    <input type="file" id="policy-upload" multiple accept=".pdf,.doc,.docx" style="display: none;" onchange="handlePolicyUpload(event)">
                    <button class="btn-primary" onclick="document.getElementById('policy-upload').click()">Choose Files</button>
                  </div>
                  
                  <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Or paste policy text:</label>
                    <textarea id="policy-text-input" placeholder="Paste your policy information here..." style="width: 100%; min-height: 120px; padding: 0.75rem; border: 1px solid var(--border); border-radius: 6px; font-family: inherit;"></textarea>
                  </div>
                  
                  <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                    <button class="btn-primary" onclick="analyzePolicyWithAI()">Analyze Policy</button>
                    <button class="btn-secondary" onclick="downloadPolicySummary()">Download Summary</button>
                    <button class="btn-secondary" onclick="savePolicyAnalysis()">Save Analysis</button>
                  </div>
                </div>
                
                <div style="background: var(--bg-light); padding: 1.5rem; border: 1px solid var(--border); border-radius: 12px;">
                  <h3 style="color: var(--primary); margin-bottom: 1rem;">üìä Analysis Results</h3>
                  <div id="policy-analysis-results" style="background: white; border: 1px solid var(--border); border-radius: 8px; padding: 1rem; min-height: 200px; max-height: 400px; overflow-y: auto;">
                    <p style="color: var(--text-secondary); text-align: center; margin: 2rem 0;">Upload your policy documents to begin analysis</p>
                  </div>
                  
                  <div style="margin-top: 1rem;">
                    <h4 style="margin: 0 0 0.5rem 0; color: var(--primary);">Key Information Extracted:</h4>
                    <div id="policy-key-info" style="background: white; border: 1px solid var(--border); border-radius: 6px; padding: 0.75rem; font-size: 0.9rem;">
                      <p style="margin: 0; color: var(--text-secondary);">Analysis results will appear here</p>
                    </div>
                  </div>
                </div>
              </div>
              
              <div style="background: linear-gradient(135deg, #fef3c7, #fde68a); padding: 1.5rem; border-radius: 12px; margin-top: 2rem; border-left: 5px solid #f59e0b;">
                <h3 style="margin: 0 0 1rem 0; color: #92400e;">üí° Pro Tips</h3>
                <ul style="margin: 0; padding-left: 1.5rem;">
                  <li><strong>Upload Complete Documents:</strong> Include all policy pages, endorsements, and amendments</li>
                  <li><strong>Check for Updates:</strong> Ensure you have the most recent policy version</li>
                  <li><strong>Review Exclusions:</strong> Pay special attention to what's NOT covered</li>
                  <li><strong>Save Your Analysis:</strong> Keep a copy of the analysis for your records</li>
                </ul>
              </div>
            </div>
          `,
          'claim-document-library': `
            <div style="padding: 2rem; background: white; border-radius: 8px; border: 1px solid var(--border);">
              <h2 style="color: var(--primary); margin-bottom: 1.5rem;">üìÅ Claim Document Library</h2>
              <p style="margin-bottom: 1.5rem; color: var(--text-secondary);">Access and manage your claim documents</p>
              
              <div style="margin-bottom:1rem;">
                <button id="lang-en" onclick="setLang('en')" class="btn-primary">English</button>
                <button id="lang-es" onclick="setLang('es')" class="btn-secondary">Espa√±ol</button>
              </div>
              
              <input type="text" id="doc-search" placeholder="Search documents..." oninput="filterDocuments()" style="width:100%; margin-bottom:1rem; padding:0.5rem; border: 1px solid var(--border); border-radius: 6px;">
              <input type="file" id="doc-upload" onchange="uploadDocument()" style="margin-bottom:1rem;">
              <div id="documents-container"></div>
            </div>
          `,
          'claim-analysis': `
            <div style="padding: 2rem; background: white; border-radius: 8px; border: 1px solid var(--border);">
              <h2 style="color: var(--primary); margin-bottom: 1.5rem;">üîç Claim Analysis Tools</h2>
              <p style="margin-bottom: 1.5rem; color: var(--text-secondary);">Professional tools to analyze your claim, review coverage, and assess damages</p>
              
              <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 1rem;">
                <div style="background: var(--bg-light); padding: 1rem; border: 1px solid var(--border); border-radius: 0.5rem;">
                  <div style="font-weight: bold; margin-bottom: 0.5rem;">Policy Review & Coverage Analysis</div>
                  <div style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Upload your policy documents for AI-powered coverage analysis</div>
                  <textarea id="policy-input" placeholder="Paste your policy information here..." style="width: 100%; min-height: 80px; margin: 0.5rem 0; padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 0.5rem;"></textarea>
                  <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-top: 0.5rem;">
                    <button class="btn-primary" onclick="analyzePolicy()">Analyze Policy</button>
                    <button class="btn-secondary" onclick="downloadPolicyChecklist()">Download Checklist</button>
                  </div>
                  <div id="policy-analysis-output" style="display:none; background:#fff; border:1px solid var(--border); border-radius:0.5rem; padding:0.75rem; white-space:pre-wrap; margin-top:0.5rem; min-height:80px;"></div>
                </div>
                
                <div style="background: var(--bg-light); padding: 1rem; border: 1px solid var(--border); border-radius: 0.5rem;">
                  <div style="font-weight: bold; margin-bottom: 0.5rem;">Damage Assessment Tool</div>
                  <div style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Calculate and document property damage</div>
                  <textarea id="damage-input" placeholder="Describe the damage to your property..." style="width: 100%; min-height: 80px; margin: 0.5rem 0; padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 0.5rem;"></textarea>
                  <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-top: 0.5rem;">
                    <button class="btn-primary" onclick="assessDamage()">Assess Damage</button>
                    <button class="btn-secondary" onclick="generateDamageReport()">Generate Report</button>
                  </div>
                  <div id="damage-assessment-output" style="display:none; background:#fff; border:1px solid var(--border); border-radius:0.5rem; padding:0.75rem; white-space:pre-wrap; margin-top:0.5rem; min-height:80px;"></div>
                </div>
              </div>
            </div>
          `,
          'claim-playbook': `
            <div style="padding: 2rem; background: white; border-radius: 8px; border: 1px solid var(--border);">
              <h2 style="color: var(--primary); margin-bottom: 1.5rem;">üìñ Claim Playbook</h2>
              <p style="margin-bottom: 1.5rem; color: var(--text-secondary);">Step-by-step guidance for your insurance claim process</p>
              
              <div style="background: linear-gradient(135deg, #f0f9ff, #e0f2fe); padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem; border-left: 5px solid var(--primary);">
                <h3 style="margin: 0 0 1rem 0; color: var(--primary);">Claim Process Overview</h3>
                <p style="margin: 0;">Follow these phases to maximize your claim success and ensure you receive fair compensation.</p>
              </div>
              
              <div style="max-width: 1200px; margin: 0 auto;">
                <div style="background: #fff; border: 2px solid var(--border); border-radius: 12px; margin-bottom: 2rem; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                  <div style="background: linear-gradient(135deg, var(--primary), var(--accent)); color: white; padding: 1.5rem; cursor: pointer; display: flex; align-items: center; gap: 1rem;" onclick="togglePhase('phase1')">
                    <div style="background: rgba(255,255,255,0.2); border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem;">1</div>
                    <div style="font-size: 1.3rem; font-weight: 600; flex: 1;">Initial Claim Filing</div>
                    <div style="font-size: 1.5rem; transition: transform 0.3s;" id="phase1-toggle">‚ñº</div>
                  </div>
                  <div id="phase1-body" style="display: none; padding: 2rem; background: #fafbfc;">
                    <h4>Immediate Actions (First 24-48 Hours)</h4>
                    <ul>
                      <li>Document everything with photos and videos</li>
                      <li>Contact your insurance company immediately</li>
                      <li>Secure your property to prevent further damage</li>
                      <li>Keep detailed records of all communications</li>
                    </ul>
                    <h4>Required Documentation</h4>
                    <ul>
                      <li>Policy number and coverage details</li>
                      <li>Photos/videos of damage</li>
                      <li>Police report (if applicable)</li>
                      <li>Witness contact information</li>
                    </ul>
                  </div>
                </div>
                
                <div style="background: #fff; border: 2px solid var(--border); border-radius: 12px; margin-bottom: 2rem; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                  <div style="background: linear-gradient(135deg, var(--primary), var(--accent)); color: white; padding: 1.5rem; cursor: pointer; display: flex; align-items: center; gap: 1rem;" onclick="togglePhase('phase2')">
                    <div style="background: rgba(255,255,255,0.2); border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem;">2</div>
                    <div style="font-size: 1.3rem; font-weight: 600; flex: 1;">Evidence Collection & Documentation</div>
                    <div style="font-size: 1.5rem; transition: transform 0.3s;" id="phase2-toggle">‚ñº</div>
                  </div>
                  <div id="phase2-body" style="display: none; padding: 2rem; background: #fafbfc;">
                    <h4>Evidence Collection Checklist</h4>
                    <ul>
                      <li>Comprehensive photo documentation</li>
                      <li>Video walkthrough of damage</li>
                      <li>Receipts for temporary repairs</li>
                      <li>Expert assessments and estimates</li>
                    </ul>
                    <h4>Documentation Best Practices</h4>
                    <ul>
                      <li>Date and timestamp all evidence</li>
                      <li>Include multiple angles and perspectives</li>
                      <li>Maintain a detailed damage log</li>
                      <li>Keep all receipts and invoices</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          `,
          'evidence-organizer': `
            <div style="padding: 2rem; background: white; border-radius: 8px; border: 1px solid var(--border);">
              <h2 style="color: var(--primary); margin-bottom: 1.5rem;">üì∏ Evidence Organizer</h2>
              <p style="margin-bottom: 1.5rem; color: var(--text-secondary);">Upload, organize, and categorize your claim evidence</p>
              
              <div style="border: 3px dashed var(--border); border-radius: 12px; padding: 3rem; text-align: center; background: var(--bg-light); transition: all 0.3s ease; cursor: pointer;" id="upload-area" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                <div style="font-size: 3rem; margin-bottom: 1rem;">üìÅ</div>
                <h3>Drop files here or click to upload</h3>
                <p style="color: var(--text-secondary);">Supports: Images, PDFs, Videos, Documents</p>
                <input type="file" id="evidence-upload" multiple accept="image/*,video/*,.pdf,.doc,.docx" style="display: none;" onchange="handleFileSelect(event)">
              </div>
              
              <div style="background: linear-gradient(135deg, #f0f9ff, #e0f2fe); border: 1px solid var(--border); border-radius: 12px; padding: 1.5rem; margin: 2rem 0;">
                <h4 style="margin: 0 0 1rem 0;">AI-Powered Categorization</h4>
                <p style="margin: 0;">Your uploaded evidence will be automatically categorized and organized for easy access.</p>
              </div>
              
              <div id="evidence-categories" style="margin: 2rem 0;">
                <h3>Organized Evidence</h3>
                <div id="evidence-list"></div>
              </div>
            </div>
          `,
          'claim-timeline': `
            <div style="padding: 2rem; background: white; border-radius: 8px; border: 1px solid var(--border);">
              <h2 style="color: var(--primary); margin-bottom: 1.5rem;">‚è∞ Claim Timeline & Sequence Guide</h2>
              <p style="margin-bottom: 1.5rem; color: var(--text-secondary);">Complete step-by-step timeline for your insurance claim process</p>
              
              <div style="background: linear-gradient(135deg, #f0f9ff, #e0f2fe); padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem; border-left: 5px solid var(--primary);">
                <h3 style="margin: 0 0 1rem 0; color: var(--primary);">Claim Process Timeline</h3>
                <p style="margin: 0;">Follow this comprehensive timeline to ensure you meet all deadlines and maximize your claim success.</p>
              </div>
              
              <div style="max-width: 1200px; margin: 0 auto;">
                <!-- Phase 1: Immediate Response (0-48 hours) -->
                <div style="background: #fff; border: 2px solid var(--border); border-radius: 12px; margin-bottom: 2rem; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                  <div style="background: linear-gradient(135deg, #dc2626, #ef4444); color: white; padding: 1.5rem; cursor: pointer; display: flex; align-items: center; gap: 1rem;" onclick="toggleTimelinePhase('timeline1')">
                    <div style="background: rgba(255,255,255,0.2); border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem;">1</div>
                    <div style="font-size: 1.3rem; font-weight: 600; flex: 1;">Immediate Response (0-48 Hours)</div>
                    <div style="font-size: 1.5rem; transition: transform 0.3s;" id="timeline1-toggle">‚ñº</div>
                  </div>
                  <div id="timeline1-body" style="display: none; padding: 2rem; background: #fafbfc;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                      <div style="background: white; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
                        <h4 style="color: #dc2626; margin: 0 0 1rem 0;">üö® First 2 Hours</h4>
                        <ul style="margin: 0; padding-left: 1.5rem;">
                          <li>Ensure safety - evacuate if necessary</li>
                          <li>Call 911 for emergencies</li>
                          <li>Contact police if required</li>
                          <li>Take immediate safety measures</li>
                        </ul>
                      </div>
                      <div style="background: white; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
                        <h4 style="color: #dc2626; margin: 0 0 1rem 0;">üìû First 24 Hours</h4>
                        <ul style="margin: 0; padding-left: 1.5rem;">
                          <li>Contact insurance company</li>
                          <li>Report the claim immediately</li>
                          <li>Get claim number and adjuster info</li>
                          <li>Document everything with photos</li>
                        </ul>
                      </div>
                      <div style="background: white; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
                        <h4 style="color: #dc2626; margin: 0 0 1rem 0;">üìã Within 48 Hours</h4>
                        <ul style="margin: 0; padding-left: 1.5rem;">
                          <li>Secure property from further damage</li>
                          <li>Keep detailed records</li>
                          <li>Gather witness information</li>
                          <li>Start evidence collection</li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Phase 2: Documentation Phase (1-2 weeks) -->
                <div style="background: #fff; border: 2px solid var(--border); border-radius: 12px; margin-bottom: 2rem; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                  <div style="background: linear-gradient(135deg, #ea580c, #f97316); color: white; padding: 1.5rem; cursor: pointer; display: flex; align-items: center; gap: 1rem;" onclick="toggleTimelinePhase('timeline2')">
                    <div style="background: rgba(255,255,255,0.2); border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem;">2</div>
                    <div style="font-size: 1.3rem; font-weight: 600; flex: 1;">Documentation Phase (1-2 Weeks)</div>
                    <div style="font-size: 1.5rem; transition: transform 0.3s;" id="timeline2-toggle">‚ñº</div>
                  </div>
                  <div id="timeline2-body" style="display: none; padding: 2rem; background: #fafbfc;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                      <div style="background: white; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
                        <h4 style="color: #ea580c; margin: 0 0 1rem 0;">üì∏ Evidence Collection</h4>
                        <ul style="margin: 0; padding-left: 1.5rem;">
                          <li>Comprehensive photo documentation</li>
                          <li>Video walkthrough of damage</li>
                          <li>Before and after comparisons</li>
                          <li>Close-up detail shots</li>
                        </ul>
                      </div>
                      <div style="background: white; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
                        <h4 style="color: #ea580c; margin: 0 0 1rem 0;">üìÑ Documentation</h4>
                        <ul style="margin: 0; padding-left: 1.5rem;">
                          <li>Police reports (if applicable)</li>
                          <li>Medical records (if injuries)</li>
                          <li>Receipts for temporary repairs</li>
                          <li>Expert assessments</li>
                        </ul>
                      </div>
                      <div style="background: white; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
                        <h4 style="color: #ea580c; margin: 0 0 1rem 0;">üìû Communication</h4>
                        <ul style="margin: 0; padding-left: 1.5rem;">
                          <li>Record all phone calls</li>
                          <li>Keep email correspondence</li>
                          <li>Document adjuster visits</li>
                          <li>Maintain claim log</li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Phase 3: Assessment Phase (2-4 weeks) -->
                <div style="background: #fff; border: 2px solid var(--border); border-radius: 12px; margin-bottom: 2rem; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                  <div style="background: linear-gradient(135deg, #d97706, #f59e0b); color: white; padding: 1.5rem; cursor: pointer; display: flex; align-items: center; gap: 1rem;" onclick="toggleTimelinePhase('timeline3')">
                    <div style="background: rgba(255,255,255,0.2); border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem;">3</div>
                    <div style="font-size: 1.3rem; font-weight: 600; flex: 1;">Assessment Phase (2-4 Weeks)</div>
                    <div style="font-size: 1.5rem; transition: transform 0.3s;" id="timeline3-toggle">‚ñº</div>
                  </div>
                  <div id="timeline3-body" style="display: none; padding: 2rem; background: #fafbfc;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                      <div style="background: white; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
                        <h4 style="color: #d97706; margin: 0 0 1rem 0;">üîç Adjuster Visit</h4>
                        <ul style="margin: 0; padding-left: 1.5rem;">
                          <li>Prepare for adjuster inspection</li>
                          <li>Have documentation ready</li>
                          <li>Accompany adjuster during visit</li>
                          <li>Take notes during inspection</li>
                        </ul>
                      </div>
                      <div style="background: white; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
                        <h4 style="color: #d97706; margin: 0 0 1rem 0;">üìä Damage Assessment</h4>
                        <ul style="margin: 0; padding-left: 1.5rem;">
                          <li>Get independent estimates</li>
                          <li>Compare with adjuster's estimate</li>
                          <li>Document discrepancies</li>
                          <li>Prepare counter-arguments</li>
                        </ul>
                      </div>
                      <div style="background: white; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
                        <h4 style="color: #d97706; margin: 0 0 1rem 0;">üìã Policy Review</h4>
                        <ul style="margin: 0; padding-left: 1.5rem;">
                          <li>Review policy coverage details</li>
                          <li>Identify coverage gaps</li>
                          <li>Understand exclusions</li>
                          <li>Prepare coverage arguments</li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Phase 4: Negotiation Phase (1-3 months) -->
                <div style="background: #fff; border: 2px solid var(--border); border-radius: 12px; margin-bottom: 2rem; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                  <div style="background: linear-gradient(135deg, #059669, #10b981); color: white; padding: 1.5rem; cursor: pointer; display: flex; align-items: center; gap: 1rem;" onclick="toggleTimelinePhase('timeline4')">
                    <div style="background: rgba(255,255,255,0.2); border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem;">4</div>
                    <div style="font-size: 1.3rem; font-weight: 600; flex: 1;">Negotiation Phase (1-3 Months)</div>
                    <div style="font-size: 1.5rem; transition: transform 0.3s;" id="timeline4-toggle">‚ñº</div>
                  </div>
                  <div id="timeline4-body" style="display: none; padding: 2rem; background: #fafbfc;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                      <div style="background: white; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
                        <h4 style="color: #059669; margin: 0 0 1rem 0;">üí∞ Initial Settlement</h4>
                        <ul style="margin: 0; padding-left: 1.5rem;">
                          <li>Review initial settlement offer</li>
                          <li>Compare with your estimates</li>
                          <li>Identify lowball tactics</li>
                          <li>Prepare counter-offer</li>
                        </ul>
                      </div>
                      <div style="background: white; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
                        <h4 style="color: #059669; margin: 0 0 1rem 0;">üìù Negotiation Strategy</h4>
                        <ul style="margin: 0; padding-left: 1.5rem;">
                          <li>Use professional language</li>
                          <li>Reference policy language</li>
                          <li>Provide supporting evidence</li>
                          <li>Maintain professional tone</li>
                        </ul>
                      </div>
                      <div style="background: white; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
                        <h4 style="color: #059669; margin: 0 0 1rem 0;">‚öñÔ∏è Legal Options</h4>
                        <ul style="margin: 0; padding-left: 1.5rem;">
                          <li>Consider public adjuster</li>
                          <li>Consult with attorney</li>
                          <li>File complaint with DOI</li>
                          <li>Prepare for mediation</li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Phase 5: Resolution Phase (3-6 months) -->
                <div style="background: #fff; border: 2px solid var(--border); border-radius: 12px; margin-bottom: 2rem; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                  <div style="background: linear-gradient(135deg, #7c3aed, #8b5cf6); color: white; padding: 1.5rem; cursor: pointer; display: flex; align-items: center; gap: 1rem;" onclick="toggleTimelinePhase('timeline5')">
                    <div style="background: rgba(255,255,255,0.2); border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem;">5</div>
                    <div style="font-size: 1.3rem; font-weight: 600; flex: 1;">Resolution Phase (3-6 Months)</div>
                    <div style="font-size: 1.5rem; transition: transform 0.3s;" id="timeline5-toggle">‚ñº</div>
                  </div>
                  <div id="timeline5-body" style="display: none; padding: 2rem; background: #fafbfc;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                      <div style="background: white; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
                        <h4 style="color: #7c3aed; margin: 0 0 1rem 0;">‚úÖ Settlement Agreement</h4>
                        <ul style="margin: 0; padding-left: 1.5rem;">
                          <li>Review final settlement terms</li>
                          <li>Ensure all damages covered</li>
                          <li>Verify payment timeline</li>
                          <li>Get everything in writing</li>
                        </ul>
                      </div>
                      <div style="background: white; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
                        <h4 style="color: #7c3aed; margin: 0 0 1rem 0;">üìã Final Documentation</h4>
                        <ul style="margin: 0; padding-left: 1.5rem;">
                          <li>Sign settlement agreement</li>
                          <li>Release additional claims</li>
                          <li>Close claim file</li>
                          <li>Keep all records</li>
                        </ul>
                      </div>
                      <div style="background: white; padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border);">
                        <h4 style="color: #7c3aed; margin: 0 0 1rem 0;">üîÑ Post-Settlement</h4>
                        <ul style="margin: 0; padding-left: 1.5rem;">
                          <li>Monitor payment receipt</li>
                          <li>Complete repairs</li>
                          <li>Update insurance coverage</li>
                          <li>Learn from experience</li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div style="background: linear-gradient(135deg, #f0f9ff, #e0f2fe); padding: 1.5rem; border-radius: 12px; margin-top: 2rem; border-left: 5px solid var(--primary);">
                <h3 style="margin: 0 0 1rem 0; color: var(--primary);">üí° Pro Tips</h3>
                <ul style="margin: 0; padding-left: 1.5rem;">
                  <li><strong>Stay Organized:</strong> Keep all documents in a dedicated folder</li>
                  <li><strong>Be Persistent:</strong> Follow up regularly but professionally</li>
                  <li><strong>Document Everything:</strong> Record all communications and interactions</li>
                  <li><strong>Know Your Rights:</strong> Understand your state's insurance laws</li>
                  <li><strong>Get Help When Needed:</strong> Don't hesitate to consult professionals</li>
                </ul>
              </div>
            </div>
          `,
          'how-to-use': `
            <div style="padding: 2rem; background: white; border-radius: 8px; border: 1px solid var(--border);">
              <h1 style="color: var(--primary); margin-bottom: 1.5rem; font-size: 2rem;">How to Use This Site (Fast Start)</h1>
              <p style="margin-bottom: 1.5rem; color: var(--text-secondary); font-size: 1.1rem;"><strong>1) Create your case.</strong> Go to <strong>My Claims ‚Üí New Claim</strong>, select your claim type, state, and insurer, then upload any policy docs, letters, photos, and receipts.<br/>
              <strong>2) Pick your path.</strong> Choose the workflow that matches your situation: <strong>New Filing</strong>, <strong>Denied</strong>, <strong>Low Offer</strong>, or <strong>No Response</strong>.<br/>
              <strong>3) Follow the steps.</strong> Each section below has a short checklist. Complete tasks in order‚Äîyour <strong>Timeline</strong> and <strong>Deadlines</strong> will update automatically.<br/>
              <strong>4) Generate documents.</strong> Use <strong>Document Generator</strong> to produce letters/forms, then send by the recommended channel (portal, email, certified mail).<br/>
              <strong>5) Track &amp; escalate.</strong> Log insurer calls/emails under <strong>My Claims</strong>. If stalled or denied, use <strong>Negotiation Scripts &amp; Escalation</strong> and <strong>State-Specific Rights &amp; Deadlines</strong>.</p>
              
              <hr style="border: none; border-top: 2px solid var(--border); margin: 2rem 0;"/>

              <h2 style="color: var(--primary); margin: 2rem 0 1rem 0; font-size: 1.5rem;">üü† Strategy &amp; Guidance</h2>
              
              <h3 style="color: #4b5563; margin: 1.5rem 0 0.75rem 0; font-size: 1.25rem;">Claim Playbook</h3>
              <p style="margin-bottom: 1rem;"><strong>Goal:</strong> A clear, customized plan from today to payout.</p>
              <ol style="margin: 1rem 0; padding-left: 2rem;">
                <li>Open Claim Playbook ‚Üí choose claim type + current status.</li>
                <li>Link your <strong>My Claims</strong> case to auto-pull policy limits, dates, and uploads.</li>
                <li>Complete <strong>Do This Now</strong> tasks.</li>
                <li>Stage <strong>This Week/This Month</strong> steps (evidence, estimates, letters).</li>
                <li><strong>Add to Timeline</strong> to create due dates + reminders.</li>
                <li>Update as insurer responds.</li>
              </ol>
              <p style="color: #6b7280; font-style: italic; margin-bottom: 1rem;"><em>Output: Personalized checklist + timeline entries.</em></p>
              
              <h3 style="color: #4b5563; margin: 1.5rem 0 0.75rem 0; font-size: 1.25rem;">Claim Timeline &amp; Sequence Guide</h3>
              <p style="margin-bottom: 1rem;"><strong>Goal:</strong> Never miss a deadline; sequence actions correctly.</p>
              <ol style="margin: 1rem 0; padding-left: 2rem;">
                <li>Open Timeline ‚Üí confirm state + loss date.</li>
                <li>Import tasks from <strong>Playbook</strong> and <strong>Document Due Dates</strong>.</li>
                <li>Log insurer events (RFIs, inspections, offers, denials).</li>
                <li>Review computed deadlines (proof-of-loss, appeal windows, DOI timing).</li>
                <li>Optional: Calendar sync.</li>
                <li>Act on alerts (click red items to jump to the next action/letter).</li>
              </ol>
              <p style="color: #6b7280; font-style: italic; margin-bottom: 1rem;"><em>Output: Live calendar with legal/contractual deadlines.</em></p>
              
              <div style="background: var(--bg-light); padding: 1rem; border: 1px solid var(--border); border-radius: 0.5rem; margin-bottom: 2rem;">
                <h3 style="color: var(--primary); margin-bottom: 1rem;">3. Use the AI Agent</h3>
                <p>Go to the <strong>AI Response & Analysis Agent</strong> tab.</p>
                <ul style="margin: 1rem 0; padding-left: 1.5rem;">
                  <li>Enter your claim details and facts.</li>
                  <li>The AI will produce a draft letter or response, tailored to your situation.</li>
                </ul>
              </div>
              
              <div style="background: var(--bg-light); padding: 1rem; border: 1px solid var(--border); border-radius: 0.5rem;">
                <h3 style="color: var(--primary); margin-bottom: 1rem;">4. Download Your Files</h3>
                <ul style="margin: 1rem 0; padding-left: 1.5rem;">
                  <li>All generated documents are delivered as secure PDFs.</li>
                  <li>Save them to your device or cloud storage.</li>
                  <li>Print and mail as needed.</li>
                </ul>
              </div>
            </div>
          `
        };
        
        return toolContent[tool] || `
          <div style="text-align: center; padding: 3rem; background: white; border-radius: 8px; border: 1px solid var(--border);">
            <h2 style="color: var(--primary); margin-bottom: 1rem;">${toolNames[tool]}</h2>
            <p style="color: var(--text-secondary);">Coming Soon - This tool is under development</p>
          </div>
        `;
      }
      
      // Show dashboard by default
      showDashboard();
    });
    
    // AI Response functions
    async function generateAIResponse() {
      const input = document.getElementById('ai-input').value;
      if (!input.trim()) {
        alert('Please enter some text first.');
        return;
      }

      const output = document.getElementById('ai-output');
      const content = document.getElementById('ai-response-content');

      content.innerHTML = '<div class="spinner"></div> Generating AI response...';

      try {
        // Use the real AI generation function
        const response = await fetch('/.netlify/functions/generate-response', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            input: input,
            type: 'claim_response'
          })
        });
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        
        if (data.success) {
          content.innerHTML = `
            <div style="background: #f0f9ff; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">                                                           
              <strong>AI Generated Response:</strong><br>
              ${data.response}
            </div>
          `;
        } else {
          throw new Error(data.error || 'Failed to generate response');
        }
      } catch (error) {
        console.error('Error generating AI response:', error);
        content.innerHTML = `
          <div style="background: #fee2e2; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem; color: #dc2626;">                                                           
            <strong>Error:</strong> ${error.message}<br>
            <small>Falling back to template response...</small>
          </div>
          <div style="background: #f0f9ff; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">                                                           
            <strong>AI Generated Response:</strong><br>
            Based on your input, here's a professional response to the insurance company...                                                                       
          </div>
        `;
      }

      output.style.display = 'block';
    }

    async function downloadResponse() {
      const content = document.getElementById('ai-response-content');
      if (!content || !content.innerHTML.includes('AI Generated Response')) {
        alert('Please generate a response first.');
        return;
      }
      
      try {
        // Use the real document generation function
        const response = await fetch('/.netlify/functions/generate-document', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            content: content.innerHTML,
            format: 'pdf',
            type: 'ai_response',
            filename: `ai_response_${new Date().toISOString().split('T')[0]}`
          })
        });
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        
        if (data.success && data.downloadUrl) {
          // Download the generated document
          const a = document.createElement('a');
          a.href = data.downloadUrl;
          a.download = data.filename || 'ai_response.pdf';
          a.click();
        } else {
          throw new Error(data.error || 'Failed to generate document');
        }
      } catch (error) {
        console.error('Error downloading response:', error);
        alert('Failed to download response. Please try again.');
      }
    }

    function copyResponse() {
      const content = document.getElementById('ai-response-content');
      if (!content || !content.innerHTML.includes('AI Generated Response')) {
        alert('Please generate a response first.');
        return;
      }
      
      // Copy to clipboard
      navigator.clipboard.writeText(content.innerText).then(() => {
        alert('Response copied to clipboard!');
      }).catch(err => {
        console.error('Failed to copy: ', err);
        alert('Failed to copy to clipboard. Please select and copy manually.');
      });
    }

    function buyMoreCredits() {
      // Redirect to credit purchase page
      window.location.href = '/checkout?type=credits';
    }

      function searchDocuments() {
        const searchTerm = prompt('Enter search term:');
        if (searchTerm) {
          // Use the real document search function
          fetch('/.netlify/functions/list-documents', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              search: searchTerm,
              type: 'claim_documents'
            })
          })
          .then(response => response.json())
          .then(data => {
            if (data.success && data.documents) {
              alert(`Found ${data.documents.length} documents matching "${searchTerm}"`);
              // You could display the results in a modal or update the document list
            } else {
              alert('No documents found matching your search.');
            }
          })
          .catch(error => {
            console.error('Error searching documents:', error);
            alert('Search failed. Please try again.');
          });
        }
      }
      
      // AI Policy Analyzer Functions
      function handlePolicyUpload(event) {
        const files = event.target.files;
        if (files.length > 0) {
          const fileNames = Array.from(files).map(f => f.name).join(', ');
          alert(`Selected ${files.length} file(s): ${fileNames}`);
          // In a real implementation, you would upload these files to the backend
        }
      }
      
      async function analyzePolicyWithAI() {
        const textInput = document.getElementById('policy-text-input');
        const resultsDiv = document.getElementById('policy-analysis-results');
        const keyInfoDiv = document.getElementById('policy-key-info');
        
        if (!textInput || !textInput.value.trim()) {
          alert('Please upload policy documents or paste policy text first.');
          return;
        }
        
        resultsDiv.innerHTML = '<div class="spinner"></div> Analyzing policy with AI...';
        keyInfoDiv.innerHTML = '<p style="margin: 0; color: var(--text-secondary);">Analyzing...</p>';
        
        try {
          // Use the real AI policy analysis function
          const response = await fetch('/.netlify/functions/analyze-policy', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              policyText: textInput.value,
              analysisType: 'comprehensive_policy_review'
            })
          });
          
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          
          const data = await response.json();
          
          if (data.success) {
            resultsDiv.innerHTML = data.analysis;
            keyInfoDiv.innerHTML = data.keyInfo || '<p style="margin: 0; color: var(--text-secondary);">Key information extracted</p>';
          } else {
            throw new Error(data.error || 'Failed to analyze policy');
          }
        } catch (error) {
          console.error('Error analyzing policy:', error);
          // Fallback to template analysis
          resultsDiv.innerHTML = `
            <div style="color: #dc2626; padding: 1rem; background: #fee2e2; border-radius: 0.5rem; margin-bottom: 1rem;">
              <strong>Error:</strong> ${error.message}<br>
              <small>Falling back to template analysis...</small>
            </div>
            <div style="background: #f0f9ff; padding: 1rem; border-radius: 0.5rem;">
              <h4 style="margin: 0 0 1rem 0; color: var(--primary);">Policy Analysis Results</h4>
              <div style="margin-bottom: 1rem;">
                <strong>Coverage Summary:</strong><br>
                ‚Ä¢ Property Coverage: $500,000 dwelling, $50,000 personal property<br>
                ‚Ä¢ Liability Coverage: $300,000 per occurrence<br>
                ‚Ä¢ Deductible: $1,000 per claim<br>
                ‚Ä¢ Additional Living Expenses: Up to $100,000
              </div>
              <div style="margin-bottom: 1rem;">
                <strong>Important Dates:</strong><br>
                ‚Ä¢ Policy Period: January 1, 2024 - January 1, 2025<br>
                ‚Ä¢ Renewal Date: January 1, 2025<br>
                ‚Ä¢ Claim Filing Deadline: Within 1 year of loss<br>
                ‚Ä¢ Proof of Loss Deadline: 60 days from request
              </div>
              <div style="margin-bottom: 1rem;">
                <strong>Key Exclusions:</strong><br>
                ‚Ä¢ Flood damage (requires separate policy)<br>
                ‚Ä¢ Earthquake damage (requires separate policy)<br>
                ‚Ä¢ Wear and tear, gradual deterioration<br>
                ‚Ä¢ Intentional damage
              </div>
              <div>
                <strong>Important Conditions:</strong><br>
                ‚Ä¢ Must report claim within 24 hours<br>
                ‚Ä¢ Must protect property from further damage<br>
                ‚Ä¢ Must cooperate with investigation<br>
                ‚Ä¢ Must provide proof of loss when requested
              </div>
            </div>
          `;
          
          keyInfoDiv.innerHTML = `
            <div style="background: #f0f9ff; padding: 0.75rem; border-radius: 6px; border-left: 3px solid var(--primary);">
              <strong>Policy Number:</strong> [Extracted from document]<br>
              <strong>Insured:</strong> [Policyholder name]<br>
              <strong>Property Address:</strong> [Property location]<br>
              <strong>Agent:</strong> [Insurance agent contact]<br>
              <strong>Emergency Contact:</strong> [24/7 claims hotline]
            </div>
          `;
        }
      }
      
      function downloadPolicySummary() {
        const resultsDiv = document.getElementById('policy-analysis-results');
        if (!resultsDiv || resultsDiv.innerHTML.includes('Upload your policy')) {
          alert('Please analyze a policy first.');
          return;
        }
        
        try {
          // Use the real document generation function
          fetch('/.netlify/functions/generate-document', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              content: resultsDiv.innerHTML,
              format: 'pdf',
              type: 'policy_analysis',
              filename: `policy_analysis_${new Date().toISOString().split('T')[0]}`
            })
          })
          .then(response => response.json())
          .then(data => {
            if (data.success && data.downloadUrl) {
              const a = document.createElement('a');
              a.href = data.downloadUrl;
              a.download = data.filename || 'policy_analysis.pdf';
              a.click();
            } else {
              throw new Error(data.error || 'Failed to generate document');
            }
          })
          .catch(error => {
            console.error('Error generating policy summary:', error);
            alert('Failed to generate policy summary. Please try again.');
          });
        } catch (error) {
          console.error('Error downloading policy summary:', error);
          alert('Failed to download policy summary. Please try again.');
        }
      }
      
      function savePolicyAnalysis() {
        const resultsDiv = document.getElementById('policy-analysis-results');
        if (!resultsDiv || resultsDiv.innerHTML.includes('Upload your policy')) {
          alert('Please analyze a policy first.');
          return;
        }
        
        try {
          // Save to user's documents using the save-draft function
          fetch('/.netlify/functions/save-draft', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              content: resultsDiv.innerHTML,
              type: 'policy_analysis',
              title: `Policy Analysis - ${new Date().toLocaleDateString()}`,
              metadata: {
                generated: new Date().toISOString(),
                source: 'ai_policy_analyzer'
              }
            })
          })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              alert('Policy analysis saved to My Documents successfully!');
            } else {
              throw new Error(data.error || 'Failed to save analysis');
            }
          })
          .catch(error => {
            console.error('Error saving policy analysis:', error);
            alert('Failed to save policy analysis. Please try again.');
          });
        } catch (error) {
          console.error('Error saving policy analysis:', error);
          alert('Failed to save policy analysis. Please try again.');
        }
      }
  </script>
</body>
</html>