<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Response Center - ClaimNavigatorAI</title>
  <meta name="description" content="AI-powered claim response center with document library, AI response generation, and estimate tools.">
  <style>
    /* Keep your existing CSS styles */
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
      background: #fff;
      margin: 0;
    }
    header {
      background: #0f172a;
      color: white;
      padding: 1rem 0;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .logo {
      font-size: 1.5rem;
      font-weight: bold;
    }
    .nav-links {
      display: flex;
      gap: 1.5rem;
    }
    .nav-links a {
      color: rgba(255, 255, 255, 0.9);
      text-decoration: none;
      font-weight: 500;
    }
    .nav-links a:hover {
      color: #fff;
    }
    .main-content {
      padding: 2rem 0;
    }
    .page-header {
      text-align: center;
      margin-bottom: 2rem;
    }
    .tabs {
      display: flex;
      border-bottom: 2px solid #eee;
      margin-bottom: 2rem;
    }
    .tab {
      padding: 1rem 2rem;
      cursor: pointer;
      border: none;
      background: none;
      font-weight: 500;
      color: #6b7280;
      border-bottom: 3px solid transparent;
    }
    .tab.active {
      color: #1e40af;
      border-bottom-color: #1e40af;
      background: #f9fafb;
    }
    .tab-content {
      display: none;
      padding: 2rem;
      background: #fff;
      border-radius: 0 0 0.5rem 0.5rem;
    }
    .tab-content.active {
      display: block;
    }
    .document-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
    }
    .document-card {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 0.75rem;
      padding: 1.5rem;
    }
    .document-title {
      font-weight: 600;
      margin-bottom: 0.5rem;
    }
    .document-description {
      font-size: 0.9rem;
      margin-bottom: 1rem;
      color: #6b7280;
    }
    .btn-secondary {
      background: #f3f4f6;
      color: #1e40af;
      padding: 0.5rem 1rem;
      border: 1px solid #1e40af;
      border-radius: 0.5rem;
      text-decoration: none;
      cursor: pointer;
    }
    .btn-secondary:hover {
      background: #1e40af;
      color: #fff;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="container">
      <nav>
        <div class="logo">ClaimNavigatorAI</div>
        <div class="nav-links">
          <a href="../index.html">Home</a>
          <a href="../product.html">Product</a>
          <a href="response-center.html">Response Center</a>
          <a href="settings.html">Settings</a>
          <a href="login.html" onclick="logout()">Logout</a>
        </div>
      </nav>
    </div>
  </header>

  <!-- Main -->
  <main class="main-content">
    <div class="container">
      <div class="page-header">
        <h1>Response Center</h1>
        <p>AI-powered tools to strengthen your claim and generate professional responses</p>
      </div>

      <!-- Tabs -->
      <div class="tabs">
        <button class="tab active" onclick="switchTab('my-documents')">My Documents</button>
        <button class="tab" onclick="switchTab('estimate-tools')">Estimate Tools</button>
        <button class="tab" onclick="switchTab('settings')">Settings</button>
      </div>

      <!-- My Documents -->
      <div id="my-documents" class="tab-content active">
        <h2>Document Library</h2>
        <p style="color:#6b7280; margin-bottom:1rem;">Download professional claim documents and templates.</p>
        <div id="documents-loading" class="loading">Loading documents...</div>
        <div id="documents-error" style="display:none; color:red;">Error loading documents</div>
        <div id="documents-container" style="display:none;"></div>
      </div>
    </div>
  </main>

  <!-- Scripts -->
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

    const supabase = createClient(
      "SUPABASE_URL",       // replace with your Supabase project URL
      "SUPABASE_ANON_KEY"   // replace with your anon key
    );

    let currentUserEmail = null;

    async function initUser() {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) {
        alert("You must log in first.");
        window.location.href = "login.html";
        return;
      }
      currentUserEmail = user.email;
      console.log("Logged in as:", currentUserEmail);
    }

    async function logout() {
      await supabase.auth.signOut();
      window.location.href = "login.html";
    }
    window.logout = logout;

    function switchTab(tabId) {
      document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
      event.target.classList.add('active');
    }

    async function downloadDocument(fileName) {
      if (!currentUserEmail) {
        alert("No user logged in.");
        return;
      }
      try {
        const res = await fetch("/.netlify/functions/generate-signed-url", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ fileName, userEmail: currentUserEmail })
        });
        if (res.status === 200) {
          const { url } = await res.json();
          window.location.href = url;
        } else {
          const msg = await res.text();
          alert(msg);
        }
      } catch (err) {
        console.error(err);
        alert("Error downloading file.");
      }
    }

    async function loadDocuments() {
      const loading = document.getElementById('documents-loading');
      const error = document.getElementById('documents-error');
      const container = document.getElementById('documents-container');

      loading.style.display = 'block';
      error.style.display = 'none';
      container.style.display = 'none';

      try {
        const response = await fetch('../assets/data/documents.json');
        if (!response.ok) throw new Error('Failed to fetch documents');
        const documents = await response.json();
        renderDocuments(documents);
        loading.style.display = 'none';
        container.style.display = 'block';
      } catch (err) {
        console.error(err);
        loading.style.display = 'none';
        error.style.display = 'block';
      }
    }

    function renderDocuments(documents) {
      const container = document.getElementById('documents-container');
      let html = '<div class="document-grid">';
      Object.values(documents).forEach(doc => {
        html += `
          <div class="document-card">
            <div class="document-title">${doc.label}</div>
            <div class="document-description">${doc.description}</div>
            <div class="document-actions">
              <button onclick="downloadDocument('${doc.templatePath}')" class="btn-secondary">Download Template</button>
              ${doc.samplePath ? `<button onclick="downloadDocument('${doc.samplePath}')" class="btn-secondary">Download Sample</button>` : ''}
            </div>
          </div>`;
      });
      html += '</div>';
      container.innerHTML = html;
    }

    document.addEventListener("DOMContentLoaded", async () => {
      await initUser();
      await loadDocuments();
    });
  </script>
</body>
</html>
