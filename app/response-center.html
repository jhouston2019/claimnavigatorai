<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Response Center - ClaimNavigatorAI</title>
  <meta name="description" content="AI-powered claim response center with document library, AI response generation, claim analysis tools, and playbook.">
  <style>
    :root {
      --primary: #1e40af;
      --accent: #3b82f6;
      --border: #e5e7eb;
      --text-secondary: #6b7280;
      --bg-light: #f9fafb;
    }
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#fff; }
    header { background:#0f172a; padding:1rem; color:#fff; position:sticky; top:0; }
    nav { display:flex; justify-content:space-between; align-items:center; }
    .nav-links { display:flex; gap:1rem; }
    .nav-links a { color:#fff; text-decoration:none; }
    .main-content { padding:2rem; }
    .tabs { display:flex; border-bottom:2px solid var(--border); margin-bottom:1.5rem; flex-wrap:wrap; }
    .tab { padding:1rem; cursor:pointer; }
    .tab.active { border-bottom:3px solid var(--primary); font-weight:bold; }
    .tab-content { display:none; }
    .tab-content.active { display:block; }
    .btn-primary { background:var(--primary); color:#fff; border:none; border-radius:0.5rem; padding:0.5rem 1rem; cursor:pointer; text-decoration:none; display:inline-block; }
    .btn-secondary { background:var(--accent); color:#fff; border:none; border-radius:0.5rem; padding:0.5rem 1rem; cursor:pointer; text-decoration:none; display:inline-block; }
    .accordion .accordion-item { border:1px solid var(--border); border-radius:0.5rem; margin-bottom:1rem; overflow:hidden; }
    .accordion-header { width:100%; text-align:left; background:var(--bg-light); padding:0.75rem; border:none; font-weight:bold; cursor:pointer; }
    .accordion-body { display:none; padding:1rem; background:#fff; border-top:1px solid var(--border); }
    .accordion-item.active .accordion-body { display:block; }
    .accordion-body ul { list-style:none; padding:0; }
    .accordion-body li { margin-bottom:0.5rem; }
    /* Progress tracker */
    #playbook-progress { margin:1rem 0; padding:1rem; background:#f3f4f6; border:1px solid var(--border); border-radius:0.5rem; }
    #playbook-progress-bar { height:10px; width:0%; background:var(--primary); transition:width 0.3s ease; }
  </style>
</head>
<body>
  <header>
    <nav>
      <div class="logo">ClaimNavigatorAI</div>
      <div class="nav-links">
        <a href="../index.html">Home</a>
        <a href="../product.html">Product</a>
        <a href="response-center.html">Response Center</a>
        <a href="settings.html">Settings</a>
        <a href="#" onclick="logout()">Logout</a>
      </div>
    </nav>
  </header>

  <main class="main-content">
    <h1>Response Center</h1>
    <p>AI-powered tools to strengthen your claim and generate professional responses</p>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab active" onclick="switchTab('ai-agent')">AI Response & Analysis Agent</button>
      <button class="tab" onclick="switchTab('my-documents')">My Documents</button>
      <button class="tab" onclick="switchTab('analysis-tools')">Claim Analysis Tools</button>
      <button class="tab" onclick="switchTab('claim-playbook')">Claim Playbook</button>
      <button class="tab" onclick="switchTab('settings')">Settings</button>
    </div>

    <!-- Claim Playbook -->
    <div id="claim-playbook" class="tab-content">
      <h2>Claim Playbook</h2>
      <p>Step-by-step roadmap for managing your insurance claim. Expand each phase for checklists, decision points, and the right documents.</p>

      <!-- ✅ Progress Tracker -->
      <div id="playbook-progress">
        <div style="display:flex; justify-content:space-between; margin-bottom:0.5rem;">
          <span id="progress-label">Progress: 0%</span>
          <span id="progress-count">0 / 0 tasks</span>
        </div>
        <div style="width:100%; height:10px; background:#e5e7eb; border-radius:5px; overflow:hidden;">
          <div id="playbook-progress-bar"></div>
        </div>
      </div>

      <div class="accordion">
        <!-- Phase 1 -->
        <div class="accordion-item">
          <button class="accordion-header">Phase 1 – Immediate Response (0–24 Hours)</button>
          <div class="accordion-body" id="phase-1">
            <ul>
              <li><input type="checkbox" data-phase="phase-1" data-task-index="0" onchange="handleTaskChange(this)"> Ensure safety: evacuate if needed, check for injuries.</li>
              <li><input type="checkbox" data-phase="phase-1" data-task-index="1" onchange="handleTaskChange(this)"> Call 911 for fire, flood, or medical emergencies.</li>
              <li><input type="checkbox" data-phase="phase-1" data-task-index="2" onchange="handleTaskChange(this)"> Shut off utilities (gas, electric, water).</li>
              <li><input type="checkbox" data-phase="phase-1" data-task-index="3" onchange="handleTaskChange(this)"> Document damage before moving anything.</li>
              <li><input type="checkbox" data-phase="phase-1" data-task-index="4" onchange="handleTaskChange(this)"> Secure property: board up, tarp, lock doors.</li>
            </ul>
            <div class="action-buttons">
              <a href="/assets/docs/core/fnol-form.docx" class="btn-primary">Download DOCX</a>
              <a href="/assets/docs/core/fnol-form.pdf" class="btn-secondary">Download PDF</a>
            </div>
          </div>
        </div>

        <!-- (Phases 2–9 remain exactly the same as your code above) -->
        <!-- ... -->
      </div>
    </div>
  </main>

  <script>
    // --- Tabs ---
    function switchTab(tab) {
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.getElementById(tab).classList.add('active');
      event.target.classList.add('active');
    }

    function logout() {
      localStorage.removeItem('userEmail');
      window.location.href = '../index.html';
    }

    // --- Playbook Progress ---
    async function savePlaybookProgress(phase, tasks) {
      try {
        await fetch("/.netlify/functions/save-playbook-progress", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            email: localStorage.getItem("userEmail"),
            phase,
            tasks
          })
        });
      } catch (err) {
        console.error("Failed to save playbook progress:", err);
      }
    }

    async function loadPlaybookProgress() {
      try {
        const res = await fetch("/.netlify/functions/get-playbook-progress", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email: localStorage.getItem("userEmail") })
        });

        const data = await res.json();
        if (res.ok && data.success) {
          data.progress.forEach(({ phase, tasks }) => {
            Object.entries(tasks).forEach(([i, checked]) => {
              const checkbox = document.querySelector(`#${phase} input[data-task-index="${i}"]`);
              if (checkbox) checkbox.checked = checked;
            });
          });
        }
        updateProgressTracker();
      } catch (err) {
        console.error("Failed to load playbook progress:", err);
      }
    }

    function handleTaskChange(checkbox) {
      const phase = checkbox.dataset.phase;
      const allTasks = {};
      document.querySelectorAll(`#${phase} input[type="checkbox"]`).forEach(cb => {
        allTasks[cb.dataset.taskIndex] = cb.checked;
      });
      savePlaybookProgress(phase, allTasks);
      updateProgressTracker();
    }

    function updateProgressTracker() {
      const all = document.querySelectorAll('#claim-playbook input[type="checkbox"]');
      const checked = [...all].filter(cb => cb.checked).length;
      const percent = all.length ? Math.round((checked / all.length) * 100) : 0;
      document.getElementById('progress-label').textContent = `Progress: ${percent}%`;
      document.getElementById('progress-count').textContent = `${checked} / ${all.length} tasks`;
      document.getElementById('playbook-progress-bar').style.width = `${percent}%`;
    }

    // --- Accordion ---
    document.addEventListener('DOMContentLoaded', () => {
      loadPlaybookProgress();
      updateProgressTracker();
      document.querySelectorAll('.accordion-header').forEach(btn => {
        btn.addEventListener('click', () => {
          const item = btn.parentElement;
          item.classList.toggle('active');
        });
      });
    });
  </script>
</body>
</html>
