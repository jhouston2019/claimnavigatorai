<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Response Center - ClaimNavigatorAI</title>
  <meta name="description" content="AI-powered claim response center with document library, AI response generation, and estimate tools.">

  <style>
    /* keep all your original CSS exactly as-is */
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="container">
      <nav>
        <div class="logo">ClaimNavigatorAI</div>
        <div class="nav-links">
          <a href="../index.html">Home</a>
          <a href="../product.html">Product</a>
          <a href="response-center.html">Response Center</a>
          <a href="settings.html">Settings</a>
          <a href="#" onclick="logout()">Logout</a>
        </div>
      </nav>
    </div>
  </header>

  <!-- Main -->
  <main class="main-content">
    <div class="container">
      <div class="page-header">
        <h1>Response Center</h1>
        <p>AI-powered tools to strengthen your claim and generate professional responses</p>
      </div>

      <!-- Tabs -->
      <div class="tabs">
        <button class="tab active" onclick="switchTab('new-response')">New Response</button>
        <button class="tab" onclick="switchTab('my-documents')">My Documents</button>
        <button class="tab" onclick="switchTab('estimate-tools')">Estimate Tools</button>
        <button class="tab" onclick="switchTab('settings')">Settings</button>
      </div>

      <!-- New Response -->
      <div id="new-response" class="tab-content active">
        <h2>New Response</h2>
        <p>Upload your insurer correspondence to generate AI-powered drafts.</p>
      </div>

      <!-- My Documents -->
      <div id="my-documents" class="tab-content">
        <h2>Document Library</h2>
        <div id="credits-banner">
          <span>AI Responses Available:</span>
          <span id="credits-count">Loading...</span>
        </div>
        <div id="documents-container" style="display:none;"></div>
      </div>

      <!-- Estimate Tools -->
      <div id="estimate-tools" class="tab-content">
        <h2>Estimate Tools</h2>
        <p>Use AI-powered tools to calculate rough order of magnitude and reserve inquiries.</p>
      </div>

      <!-- Settings -->
      <div id="settings" class="tab-content">
        <h2>Settings</h2>
        <p>Manage your account, update preferences, and view usage history.</p>
      </div>
    </div>
  </main>

  <script>
    let userCredits = 0;

    function switchTab(tabName) {
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.getElementById(tabName).classList.add('active');
      event.target.classList.add('active');
    }

    function logout() {
      if (confirm("Are you sure you want to logout?")) {
        localStorage.removeItem('userEmail');
        window.location.href = '../index.html';
      }
    }

    async function loadEntitlement() {
      try {
        const response = await fetch('/.netlify/functions/verify-entitlement', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email: localStorage.getItem('userEmail') })
        });

        const data = await response.json();

        if (response.ok && data.credits !== undefined) {
          userCredits = data.credits;
          document.getElementById('credits-count').textContent = userCredits;
        } else {
          userCredits = 0;
          document.getElementById('credits-count').textContent = '0';
        }
      } catch (err) {
        console.error('Entitlement fetch error:', err);
        userCredits = 0;
        document.getElementById('credits-count').textContent = '0';
      }
    }

    async function downloadDocument(filePath) {
      try {
        const response = await fetch('/.netlify/functions/generate-signed-url', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ fileName: filePath, email: localStorage.getItem('userEmail') })
        });

        const data = await response.json();

        if (data.url) {
          window.location.href = data.url;
        } else {
          alert('Download failed. Please try again.');
        }
      } catch (err) {
        console.error('Download error:', err);
        alert('Error downloading file.');
      }
    }

    function renderDocuments(documents) {
      const container = document.getElementById('documents-container');
      let html = '<div class="document-grid">';
      Object.values(documents).forEach(doc => {
        html += `
          <div class="document-card">
            <div class="document-title">${doc.label}</div>
            <div class="document-description">${doc.description}</div>
            <div class="document-actions">
              <button class="btn-secondary" onclick="downloadDocument('${doc.templatePath}')">Download Template</button>
              ${doc.samplePath ? `<button class="btn-secondary" onclick="downloadDocument('${doc.samplePath}')">Download Sample</button>` : ''}
            </div>
          </div>`;
      });
      html += '</div>';
      container.innerHTML = html;
      container.style.display = 'block';
    }

    async function loadDocuments() {
      try {
        const response = await fetch('../assets/data/documents.json');
        if (!response.ok) throw new Error('Failed to fetch documents');
        const documents = await response.json();
        renderDocuments(documents);
      } catch (err) {
        console.error('Error loading documents:', err);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      loadEntitlement();
      loadDocuments();
    });
  </script>
</body>
</html>
