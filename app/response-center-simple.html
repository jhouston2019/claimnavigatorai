<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Claim Resource & AI Response Center - ClaimNavigatorAI</title>
  
  <!-- Supabase Auth -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: #f8fafc;
      line-height: 1.6;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }
    
    .header {
      background: #1e40af;
      color: white;
      padding: 2rem;
      border-radius: 0.75rem;
      margin-bottom: 2rem;
      text-align: center;
    }
    
    .header h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }
    
    .header p {
      font-size: 1.2rem;
      opacity: 0.9;
    }
    
    .tabs {
      display: flex;
      background: white;
      border-radius: 0.75rem;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      margin-bottom: 2rem;
      overflow: hidden;
    }
    
    .tab {
      flex: 1;
      padding: 1rem 2rem;
      background: #f9fafb;
      border: none;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: all 0.3s;
    }
    
    .tab.active {
      background: #1e40af;
      color: white;
    }
    
    .tab:hover:not(.active) {
      background: #e5e7eb;
    }
    
    .content {
      background: white;
      border-radius: 0.75rem;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      padding: 2rem;
      min-height: 500px;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: #374151;
    }
    
    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #d1d5db;
      border-radius: 0.5rem;
      font-size: 1rem;
    }
    
    .form-group textarea {
      min-height: 200px;
      resize: vertical;
    }
    
    button {
      background: #1e40af;
      color: white;
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 0.5rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s;
    }
    
    button:hover {
      background: #3b82f6;
    }
    
    button:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }
    
    .response-preview {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 0.5rem;
      padding: 1rem;
      margin: 1rem 0;
      white-space: pre-wrap;
    }
    
    .download-links {
      margin: 1rem 0;
      padding: 1rem;
      background: #f0f9ff;
      border-radius: 0.5rem;
      border: 1px solid #0ea5e9;
    }
    
    .download-links a {
      color: #1e40af;
      text-decoration: none;
      font-weight: 600;
      margin-right: 1rem;
    }
    
    .download-links a:hover {
      text-decoration: underline;
    }
    
    .credit-counter {
      background: #fef3c7;
      border: 1px solid #f59e0b;
      border-radius: 0.5rem;
      padding: 1rem;
      margin: 1rem 0;
      text-align: center;
    }
    
    .error {
      background: #fee;
      color: #dc2626;
      padding: 1rem;
      border-radius: 0.5rem;
      border: 1px solid #dc2626;
      margin: 1rem 0;
    }
    
    .success {
      background: #d1fae5;
      color: #065f46;
      padding: 1rem;
      border-radius: 0.5rem;
      border: 1px solid #10b981;
      margin: 1rem 0;
    }
    
    .loading {
      display: none;
      text-align: center;
      padding: 2rem;
    }
    
    .loading.active {
      display: block;
    }
    
    .document-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1rem;
      margin: 1rem 0;
    }
    
    .document-card {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 0.5rem;
      padding: 1rem;
    }
    
    .document-card h3 {
      color: #1e40af;
      margin-bottom: 0.5rem;
    }
    
    .document-card p {
      color: #6b7280;
      font-size: 0.9rem;
    }
    
    .logout-btn {
      background: #dc2626;
      float: right;
    }
    
    .logout-btn:hover {
      background: #b91c1c;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üéØ Claim Resource & AI Response Center</h1>
      <p>Your comprehensive toolkit for navigating insurance claims</p>
    </div>
    
    <div class="tabs">
      <button class="tab active" onclick="switchTab('ai-response')">ü§ñ AI Response Generator</button>
      <button class="tab" onclick="switchTab('documents')">üìÑ Document Library</button>
      <button class="tab" onclick="switchTab('tools')">üõ†Ô∏è Claim Tools</button>
      <button class="tab" onclick="switchTab('account')">üë§ Account</button>
    </div>
    
    <div class="content">
      <!-- AI Response Generator Tab -->
      <div id="ai-response" class="tab-content active">
        <h2>AI Response Generator</h2>
        <div class="credit-counter">
          <strong>Responses Available:</strong> <span id="response-count">Loading...</span> credits
        </div>
        
        <div class="form-group">
          <label for="claimText">Paste the insurer's letter here:</label>
          <textarea id="claimText" placeholder="Paste the complete insurer letter here. Our AI will analyze it and generate a professional response..."></textarea>
        </div>
        
        <div class="form-group">
          <label>Language:</label>
          <select id="language">
            <option value="en">English</option>
            <option value="es">Espa√±ol</option>
          </select>
        </div>
        
        <button id="generateBtn" onclick="generateResponse()">Generate AI Response</button>
        
        <div id="loading" class="loading">
          <p>‚è≥ Analyzing letter and generating response... This may take 10-30 seconds.</p>
        </div>
        
        <div id="error" class="error" style="display:none;"></div>
        <div id="success" class="success" style="display:none;"></div>
        
        <div id="response-preview" class="response-preview" style="display:none;"></div>
        
        <div id="downloads" class="download-links" style="display:none;">
          <h3>Your Response is Ready!</h3>
          <p>
            <strong>Download as:</strong>
            <a href="#" id="pdf-link" target="_blank">üìÑ PDF Document</a> | 
            <a href="#" id="docx-link" target="_blank">üìù Word Document</a>
          </p>
        </div>
      </div>
      
      <!-- Document Library Tab -->
      <div id="documents" class="tab-content">
        <h2>Document Library</h2>
        <p>Access our comprehensive library of claim-related documents and templates.</p>
        
        <div class="document-grid">
          <div class="document-card">
            <h3>üìã Claim Documentation Checklist</h3>
            <p>Complete checklist for documenting your claim properly</p>
            <button onclick="downloadDocument('checklist')">Download</button>
          </div>
          
          <div class="document-card">
            <h3>üìù Sample Demand Letter</h3>
            <p>Professional template for demand letters</p>
            <button onclick="downloadDocument('demand-letter')">Download</button>
          </div>
          
          <div class="document-card">
            <h3>üìä Evidence Organization Guide</h3>
            <p>How to organize and present your evidence effectively</p>
            <button onclick="downloadDocument('evidence-guide')">Download</button>
          </div>
          
          <div class="document-card">
            <h3>‚öñÔ∏è Legal Rights Summary</h3>
            <p>Your rights as an insurance policyholder</p>
            <button onclick="downloadDocument('rights-summary')">Download</button>
          </div>
          
          <div class="document-card">
            <h3>üí∞ Settlement Negotiation Tips</h3>
            <p>Strategies for negotiating better settlements</p>
            <button onclick="downloadDocument('negotiation-tips')">Download</button>
          </div>
        </div>
      </div>
      
      <!-- Claim Tools Tab -->
      <div id="tools" class="tab-content">
        <h2>Claim Analysis Tools</h2>
        <p>Professional tools to analyze and strengthen your claim.</p>
        
        <div class="form-group">
          <label for="claimDetails">Describe your claim situation:</label>
          <textarea id="claimDetails" placeholder="Describe your claim situation, what happened, what the insurer has said, etc."></textarea>
        </div>
        
        <button onclick="analyzeClaim()">Analyze My Claim</button>
        
        <div id="analysis-result" style="display:none;">
          <h3>Claim Analysis Results</h3>
          <div id="analysis-content"></div>
        </div>
      </div>
      
      <!-- Account Tab -->
      <div id="account" class="tab-content">
        <h2>Account Information</h2>
        <div class="credit-counter">
          <strong>Your Credits:</strong> <span id="account-credits">Loading...</span>
        </div>
        
        <div style="margin: 2rem 0;">
          <h3>Need More Responses?</h3>
          <p>Purchase additional AI responses at $29 each:</p>
          <button onclick="purchaseMore()">Buy More Responses</button>
        </div>
        
        <div style="margin: 2rem 0;">
          <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    let supabase = null;
    let currentUser = null;
    let userCredits = 20;
    
    // Initialize Supabase
    async function initSupabase() {
      try {
        const response = await fetch('/.netlify/functions/get-supabase-config');
        const config = await response.json();
        supabase = window.supabase.createClient(config.supabaseUrl, config.supabaseAnonKey);
        console.log('‚úÖ Supabase initialized');
        
        // Check if user is already logged in
        const { data: { session } } = await supabase.auth.getSession();
        if (session) {
          currentUser = session.user;
          await loadUserCredits();
        }
      } catch (error) {
        console.error('‚ùå Failed to initialize Supabase:', error);
        // Set default credits for development
        document.getElementById('response-count').textContent = '20';
        document.getElementById('account-credits').textContent = '20';
      }
    }
    
    // Load user credits
    async function loadUserCredits() {
      if (!currentUser) {
        document.getElementById('response-count').textContent = '20';
        document.getElementById('account-credits').textContent = '20';
        return;
      }
      
      try {
        const { data: { session } } = await supabase.auth.getSession();
        if (!session) {
          document.getElementById('response-count').textContent = '20';
          document.getElementById('account-credits').textContent = '20';
          return;
        }
        
        const response = await fetch('/.netlify/functions/get-user-credits', {
          headers: {
            'Authorization': `Bearer ${session.access_token}`
          }
        });
        
        if (response.ok) {
          const data = await response.json();
          userCredits = data.credits || 20;
          document.getElementById('response-count').textContent = userCredits;
          document.getElementById('account-credits').textContent = userCredits;
        } else {
          document.getElementById('response-count').textContent = '20';
          document.getElementById('account-credits').textContent = '20';
        }
      } catch (error) {
        console.error('Failed to load credits:', error);
        document.getElementById('response-count').textContent = '20';
        document.getElementById('account-credits').textContent = '20';
      }
    }
    
    // Switch tabs
    function switchTab(tabName) {
      // Hide all tab contents
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      
      // Remove active class from all tabs
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Show selected tab content
      document.getElementById(tabName).classList.add('active');
      
      // Add active class to clicked tab
      event.target.classList.add('active');
    }
    
    // Generate AI response
    async function generateResponse() {
      const text = document.getElementById('claimText').value.trim();
      const language = document.getElementById('language').value;
      const button = document.getElementById('generateBtn');
      const loading = document.getElementById('loading');
      const errorDiv = document.getElementById('error');
      const successDiv = document.getElementById('success');
      const preview = document.getElementById('response-preview');
      const downloads = document.getElementById('downloads');
      
      // Validation
      if (!text || text.length < 50) {
        showError('Please paste the complete insurer letter (minimum 50 characters).');
        return;
      }
      
      if (userCredits <= 0) {
        showError('No credits remaining. Please purchase additional responses.');
        return;
      }
      
      // Reset UI
      hideMessages();
      button.disabled = true;
      loading.classList.add('active');
      
      try {
        const { data: { session } } = await supabase.auth.getSession();
        if (!session) {
          throw new Error('No valid session');
        }
        
        const response = await fetch('/.netlify/functions/generate', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${session.access_token}`
          },
          body: JSON.stringify({ text, language })
        });
        
        const data = await response.json();
        
        if (!response.ok) {
          throw new Error(data.error || 'Generation failed');
        }
        
        // Update credits display
        userCredits = data.creditsRemaining;
        document.getElementById('response-count').textContent = userCredits;
        document.getElementById('account-credits').textContent = userCredits;
        
        // Show response preview
        preview.textContent = data.text.substring(0, 500) + '...';
        preview.style.display = 'block';
        
        // Update download links
        document.getElementById('pdf-link').href = data.pdf;
        document.getElementById('docx-link').href = data.docx;
        
        // Show success message and downloads
        showSuccess('Response generated successfully!');
        downloads.style.display = 'block';
        
        // Clear the textarea
        document.getElementById('claimText').value = '';
        
      } catch (error) {
        console.error('Generation error:', error);
        showError(error.message || 'Failed to generate response. Please try again.');
      } finally {
        button.disabled = false;
        loading.classList.remove('active');
      }
    }
    
    // Analyze claim
    function analyzeClaim() {
      const details = document.getElementById('claimDetails').value.trim();
      
      if (!details) {
        showError('Please describe your claim situation.');
        return;
      }
      
      // Mock analysis for now
      const analysis = `
        Based on your claim description, here are some key recommendations:
        
        1. **Documentation**: Ensure you have all receipts, photos, and witness statements
        2. **Timeline**: Document the exact sequence of events
        3. **Evidence**: Gather any relevant police reports or expert opinions
        4. **Policy Review**: Check your policy for specific coverage details
        5. **Legal Rights**: Understand your state's insurance laws
        
        Consider consulting with a public adjuster or attorney if the claim is complex.
      `;
      
      document.getElementById('analysis-content').innerHTML = analysis.replace(/\n/g, '<br>');
      document.getElementById('analysis-result').style.display = 'block';
    }
    
    // Download document
    function downloadDocument(type) {
      // Mock document downloads
      const documents = {
        'checklist': '/docs/claim-documentation-checklist.pdf',
        'demand-letter': '/docs/sample-demand-letter.pdf',
        'evidence-guide': '/docs/evidence-organization-guide.pdf',
        'rights-summary': '/docs/legal-rights-summary.pdf',
        'negotiation-tips': '/docs/settlement-negotiation-tips.pdf'
      };
      
      const url = documents[type];
      if (url) {
        window.open(url, '_blank');
      } else {
        showError('Document not available yet.');
      }
    }
    
    // Purchase more responses
    function purchaseMore() {
      window.location.href = '/#pricing';
    }
    
    // Logout
    async function logout() {
      if (currentUser) {
        await supabase.auth.signOut();
      }
      window.location.href = '/';
    }
    
    // Utility functions
    function showError(message) {
      const errorDiv = document.getElementById('error');
      errorDiv.textContent = message;
      errorDiv.style.display = 'block';
    }
    
    function showSuccess(message) {
      const successDiv = document.getElementById('success');
      successDiv.textContent = message;
      successDiv.style.display = 'block';
    }
    
    function hideMessages() {
      document.getElementById('error').style.display = 'none';
      document.getElementById('success').style.display = 'none';
    }
    
    // Initialize on page load
    initSupabase();
  </script>
</body>
</html>
