<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Response Center Function Audit - ClaimNavigatorAI</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
            background: #f8fafc;
        }
        .function-test {
            background: white;
            padding: 1.5rem;
            margin: 1rem 0;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
        }
        .test-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            margin: 0.5rem;
        }
        .test-button:hover {
            background: #2563eb;
        }
        .result {
            background: #f9fafb;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            border-left: 4px solid #3b82f6;
        }
        .error {
            border-left-color: #dc2626;
            background: #fef2f2;
        }
        .success {
            border-left-color: #059669;
            background: #f0fdf4;
        }
        .warning {
            border-left-color: #f59e0b;
            background: #fffbeb;
        }
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }
        .status-card {
            background: white;
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
        }
        .status-working { border-left: 4px solid #059669; }
        .status-error { border-left: 4px solid #dc2626; }
        .status-warning { border-left: 4px solid #f59e0b; }
        .status-unknown { border-left: 4px solid #6b7280; }
    </style>
</head>
<body>
    <h1>üîç Response Center Function Audit</h1>
    <p>Testing all functions used in the response center to identify issues.</p>

    <div class="function-test">
        <h2>üìä Function Status Overview</h2>
        <div id="overview" class="result">
            <strong>Running comprehensive function tests...</strong>
        </div>
    </div>

    <div class="status-grid" id="function-grid">
        <!-- Function status cards will be populated here -->
    </div>

    <div class="function-test">
        <h2>üß™ Individual Function Tests</h2>
        <button class="test-button" onclick="testAllFunctions()">Test All Functions</button>
        <button class="test-button" onclick="testCriticalFunctions()">Test Critical Functions Only</button>
    </div>

    <script>
        const functions = [
            { name: 'generate-response-simple', endpoint: '/.netlify/functions/generate-response-simple', critical: true, method: 'POST' },
            { name: 'generate-response', endpoint: '/.netlify/functions/generate-response', critical: false, method: 'POST' },
            { name: 'list-documents-simple', endpoint: '/.netlify/functions/list-documents-simple', critical: true, method: 'POST' },
            { name: 'list-documents', endpoint: '/.netlify/functions/list-documents', critical: false, method: 'POST' },
            { name: 'generate-document', endpoint: '/.netlify/functions/generate-document', critical: true, method: 'POST' },
            { name: 'save-draft', endpoint: '/.netlify/functions/save-draft', critical: false, method: 'POST' },
            { name: 'download', endpoint: '/.netlify/functions/download', critical: true, method: 'POST' },
            { name: 'get-template', endpoint: '/.netlify/functions/get-template', critical: false, method: 'POST' },
            { name: 'policyAnalyzer', endpoint: '/.netlify/functions/policyAnalyzer', critical: true, method: 'POST' },
            { name: 'analyze-claim', endpoint: '/.netlify/functions/analyze-claim', critical: true, method: 'POST' },
            { name: 'upload-documents-to-supabase', endpoint: '/.netlify/functions/upload-documents-to-supabase', critical: false, method: 'POST' },
            { name: 'health-check', endpoint: '/.netlify/functions/health-check', critical: false, method: 'GET' }
        ];

        let testResults = {};

        async function testFunction(func) {
            try {
                const testData = {
                    input: 'Test input for function testing',
                    type: 'test',
                    language: 'en'
                };

                const response = await fetch(func.endpoint, {
                    method: func.method,
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: func.method === 'POST' ? JSON.stringify(testData) : undefined
                });

                const data = await response.json();
                
                return {
                    status: response.ok ? 'working' : 'error',
                    statusCode: response.status,
                    error: data.error || null,
                    success: data.success || false
                };
            } catch (error) {
                return {
                    status: 'error',
                    error: error.message,
                    success: false
                };
            }
        }

        async function testAllFunctions() {
            const overview = document.getElementById('overview');
            overview.innerHTML = '<div class="spinner">Testing all functions...</div>';
            
            const grid = document.getElementById('function-grid');
            grid.innerHTML = '';

            for (const func of functions) {
                const result = await testFunction(func);
                testResults[func.name] = result;
                
                const statusClass = result.status === 'working' ? 'status-working' : 
                                  result.status === 'error' ? 'status-error' : 'status-unknown';
                
                const criticalBadge = func.critical ? '<span style="background: #dc2626; color: white; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem;">CRITICAL</span>' : '';
                
                grid.innerHTML += `
                    <div class="status-card ${statusClass}">
                        <h3>${func.name} ${criticalBadge}</h3>
                        <p><strong>Status:</strong> ${result.status}</p>
                        <p><strong>Code:</strong> ${result.statusCode || 'N/A'}</p>
                        ${result.error ? `<p><strong>Error:</strong> ${result.error}</p>` : ''}
                        <p><strong>Success:</strong> ${result.success ? 'Yes' : 'No'}</p>
                    </div>
                `;
            }

            // Update overview
            const working = Object.values(testResults).filter(r => r.status === 'working').length;
            const total = functions.length;
            const critical = functions.filter(f => f.critical).length;
            const criticalWorking = functions.filter(f => f.critical).map(f => testResults[f.name]).filter(r => r.status === 'working').length;

            overview.className = 'result ' + (working === total ? 'success' : working > 0 ? 'warning' : 'error');
            overview.innerHTML = `
                <strong>Function Test Results:</strong><br>
                <strong>Working:</strong> ${working}/${total} functions<br>
                <strong>Critical Functions Working:</strong> ${criticalWorking}/${critical}<br>
                <strong>Overall Status:</strong> ${working === total ? '‚úÖ All Working' : working > 0 ? '‚ö†Ô∏è Partial' : '‚ùå None Working'}
            `;
        }

        async function testCriticalFunctions() {
            const criticalFunctions = functions.filter(f => f.critical);
            const overview = document.getElementById('overview');
            overview.innerHTML = '<div class="spinner">Testing critical functions only...</div>';
            
            const grid = document.getElementById('function-grid');
            grid.innerHTML = '';

            for (const func of criticalFunctions) {
                const result = await testFunction(func);
                testResults[func.name] = result;
                
                const statusClass = result.status === 'working' ? 'status-working' : 'status-error';
                
                grid.innerHTML += `
                    <div class="status-card ${statusClass}">
                        <h3>${func.name} <span style="background: #dc2626; color: white; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem;">CRITICAL</span></h3>
                        <p><strong>Status:</strong> ${result.status}</p>
                        <p><strong>Code:</strong> ${result.statusCode || 'N/A'}</p>
                        ${result.error ? `<p><strong>Error:</strong> ${result.error}</p>` : ''}
                        <p><strong>Success:</strong> ${result.success ? 'Yes' : 'No'}</p>
                    </div>
                `;
            }

            const working = criticalFunctions.map(f => testResults[f.name]).filter(r => r.status === 'working').length;
            const total = criticalFunctions.length;

            overview.className = 'result ' + (working === total ? 'success' : 'error');
            overview.innerHTML = `
                <strong>Critical Function Test Results:</strong><br>
                <strong>Working:</strong> ${working}/${total} critical functions<br>
                <strong>Status:</strong> ${working === total ? '‚úÖ All Critical Functions Working' : '‚ùå Some Critical Functions Failing'}
            `;
        }

        // Auto-run tests on page load
        document.addEventListener('DOMContentLoaded', function() {
            testCriticalFunctions();
        });
    </script>
</body>
</html>
