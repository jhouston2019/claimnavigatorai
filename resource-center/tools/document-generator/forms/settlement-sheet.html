<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settlement Sheet - Document Generator</title>
    <meta name="description" content="Generate a professional settlement sheet for your insurance claim">
    <link rel="stylesheet" href="/app/assets/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', sans-serif;
            background-color: #f9fafb;
            color: #111827;
            line-height: 1.6;
        }

        .header {
            background: #1e40af;
            color: white;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 600;
            font-size: 1.25rem;
        }

        .nav a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            transition: background-color 0.2s;
        }

        .nav a:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .breadcrumb {
            background: white;
            padding: 0.75rem 2rem;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.875rem;
            color: #6b7280;
        }

        .breadcrumb a {
            color: #1e40af;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .main-container {
            max-width: 100%;
            margin: 0 auto;
            padding: 2rem;
        }

        .page-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .page-header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1e40af;
            margin-bottom: 1rem;
        }

        .page-header .subtitle {
            font-size: 1.125rem;
            color: #6b7280;
            max-width: 600px;
            margin: 0 auto 1rem;
        }

        .explainer {
            background: #f0fdf4;
            border: 1px solid #22c55e;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 2rem;
            color: #166534;
            font-size: 0.875rem;
        }

        .form-container {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: #374151;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 1rem;
            color: #111827;
            transition: border-color 0.2s;
            background: white;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #1e40af;
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: #9ca3af;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            margin-left: 0.5rem;
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #374151;
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 0.5rem;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.75rem;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
            min-width: 150px;
            justify-content: center;
        }

        .btn-primary {
            background: #1e40af;
            color: white;
        }

        .btn-primary:hover {
            background: #1e3a8a;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .btn-success {
            background: #059669;
            color: white;
        }

        .btn-success:hover {
            background: #047857;
        }

        .btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .result-container {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 2rem;
            margin-top: 2rem;
            display: none;
        }

        .result-container.show {
            display: block;
        }

        .result-content {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            line-height: 1.5;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            display: inline-block;
            width: 2rem;
            height: 2rem;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #1e40af;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
        }

        @media (max-width: 768px) {
            .main-container {
                padding: 1rem;
            }

            .page-header h1 {
                font-size: 2rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .header .container {
                padding: 0 1rem;
            }

            .breadcrumb {
                padding: 0.75rem 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Header -->
    <header class="header">
        <div class="container">
            <div class="brand">
                <div>üìã</div>
                <div>Settlement Sheet Generator</div>
            </div>
            <nav class="nav">
                <a href="../index.html">‚Üê Document Generator</a>
            </nav>
        </div>
    </header>

    <!-- Breadcrumb -->
    <div class="breadcrumb">
        <a href="/app/response-center.html">‚Üê Resource Center</a> / <a href="../index.html">Document Generator</a> / Settlement Sheet
    </div>

    <main class="main-container">
        <div class="page-header">
            <h1>üìã Settlement Sheet</h1>
            <p class="subtitle">Compare insurance offers against actual damages and policy coverage</p>
        </div>

        <div class="explainer">
            <strong>What is a Settlement Sheet?</strong> A settlement sheet provides a detailed analysis comparing insurance settlement offers against actual damages and policy coverage. This document helps identify discrepancies, justify higher settlements, and support negotiations with your insurance company. It should include itemized comparisons, policy analysis, and recommendations.
        </div>

        <div class="form-container">
            <form id="settlementSheetForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="claimantName">Your Full Name</label>
                        <input type="text" id="claimantName" name="claimantName" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="claimantAddress">Your Address</label>
                        <textarea id="claimantAddress" name="claimantAddress" rows="3" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="insurerName">Insurance Company</label>
                        <input type="text" id="insurerName" name="insurerName" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="policyNumber">Policy Number</label>
                        <input type="text" id="policyNumber" name="policyNumber" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="claimNumber">Claim Number</label>
                        <input type="text" id="claimNumber" name="claimNumber" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="dateOfLoss">Date of Loss</label>
                        <input type="date" id="dateOfLoss" name="dateOfLoss" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="causeOfLoss">Cause of Loss</label>
                        <input type="text" id="causeOfLoss" name="causeOfLoss" placeholder="e.g., Fire, Water Damage, Storm" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="locationOfLoss">Location of Loss</label>
                        <input type="text" id="locationOfLoss" name="locationOfLoss" placeholder="Full address where the loss occurred" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="phoneNumber">Phone Number</label>
                        <input type="tel" id="phoneNumber" name="phoneNumber" placeholder="(555) 123-4567">
                    </div>
                    
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" name="email" placeholder="your.email@example.com">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="settlementOffer">Insurance Settlement Offer <span class="tooltip">?<span class="tooltiptext">What amount did the insurance company offer?</span></span></label>
                    <input type="number" id="settlementOffer" name="settlementOffer" step="0.01" placeholder="0.00" required>
                </div>
                
                <div class="form-group">
                    <label for="actualDamages">Actual Damages <span class="tooltip">?<span class="tooltiptext">What is the actual cost of damages?</span></span></label>
                    <input type="number" id="actualDamages" name="actualDamages" step="0.01" placeholder="0.00" required>
                </div>
                
                <div class="form-group">
                    <label for="policyCoverage">Policy Coverage Analysis <span class="tooltip">?<span class="tooltiptext">What does your policy cover?</span></span></label>
                    <textarea id="policyCoverage" name="policyCoverage" rows="4" placeholder="Policy coverage analysis:
- What is covered under your policy?
- What are the coverage limits?
- Any exclusions or limitations?
- Deductible information" required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="itemizedComparison">Itemized Comparison <span class="tooltip">?<span class="tooltiptext">Compare each item between offer and actual</span></span></label>
                    <textarea id="itemizedComparison" name="itemizedComparison" rows="6" placeholder="Itemized comparison:
- Item 1: Insurance offer vs Actual cost
- Item 2: Insurance offer vs Actual cost
- Item 3: Insurance offer vs Actual cost
- Continue for all items" required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="discrepancies">Discrepancies <span class="tooltip">?<span class="tooltiptext">What are the main discrepancies?</span></span></label>
                    <textarea id="discrepancies" name="discrepancies" rows="4" placeholder="Discrepancies:
- What are the main differences?
- Why do they exist?
- What evidence supports your position?
- Any other issues?" required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="recommendation">Recommendation <span class="tooltip">?<span class="tooltiptext">What do you recommend?</span></span></label>
                    <textarea id="recommendation" name="recommendation" rows="4" placeholder="Your recommendation:
- What should the settlement be?
- Why is this fair?
- What evidence supports this?
- Any other considerations?" required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="supportingEvidence">Supporting Evidence <span class="tooltip">?<span class="tooltiptext">What evidence supports your position?</span></span></label>
                    <textarea id="supportingEvidence" name="supportingEvidence" rows="4" placeholder="Supporting evidence:
- Expert opinions
- Documentation
- Photographs
- Other evidence"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="additionalInfo">Additional Information</label>
                    <textarea id="additionalInfo" name="additionalInfo" rows="4" placeholder="Any additional information about the settlement analysis..."></textarea>
                </div>
            </form>
        </div>

        <div class="action-buttons">
            <button type="button" class="btn btn-primary" id="draftBtn">
                ü§ñ Draft with AI
            </button>
            <button type="button" class="btn btn-secondary" id="exportPdfBtn" disabled>
                üìÑ Export PDF
            </button>
            <button type="button" class="btn btn-success" id="exportDocxBtn" disabled>
                üìù Export DOCX
            </button>
        </div>

        <!-- Loading State -->
        <div class="loading" id="loadingState">
            <div class="spinner"></div>
            <p>Generating your Settlement Sheet...</p>
        </div>

        <!-- Results -->
        <div class="result-container" id="resultContainer">
            <h3>Generated Settlement Sheet</h3>
            <div class="result-content" id="resultContent"></div>
        </div>
    </main>

    <script>
        class SettlementSheetGenerator {
            constructor() {
                this.generatedContent = null;
                this.init();
            }

            init() {
                this.setupEventListeners();
            }

            setupEventListeners() {
                const draftBtn = document.getElementById('draftBtn');
                const exportPdfBtn = document.getElementById('exportPdfBtn');
                const exportDocxBtn = document.getElementById('exportDocxBtn');

                draftBtn.addEventListener('click', () => this.draftWithAI());
                exportPdfBtn.addEventListener('click', () => this.exportPDF());
                exportDocxBtn.addEventListener('click', () => this.exportDOCX());
            }

            async draftWithAI() {
                const form = document.getElementById('settlementSheetForm');
                const formData = new FormData(form);
                const data = Object.fromEntries(formData);

                // Validate required fields
                if (!data.claimantName || !data.claimantAddress || !data.insurerName || !data.policyNumber || !data.claimNumber || !data.dateOfLoss || !data.causeOfLoss || !data.locationOfLoss || !data.settlementOffer || !data.actualDamages || !data.policyCoverage || !data.itemizedComparison || !data.discrepancies || !data.recommendation) {
                    alert('Please fill in all required fields.');
                    return;
                }

                const loadingState = document.getElementById('loadingState');
                const resultContainer = document.getElementById('resultContainer');
                const draftBtn = document.getElementById('draftBtn');
                const exportPdfBtn = document.getElementById('exportPdfBtn');
                const exportDocxBtn = document.getElementById('exportDocxBtn');

                // Show loading
                loadingState.classList.add('show');
                resultContainer.classList.remove('show');
                draftBtn.disabled = true;
                draftBtn.textContent = 'Generating...';

                try {
                    // Call the Netlify function for AI generation
                    const response = await fetch('/netlify/functions/generate-letter', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            documentType: 'settlement-sheet',
                            formData: data
                        })
                    });

                    if (response.ok) {
                        const result = await response.json();
                        this.generatedContent = result.content;
                        this.displayResults(result.content);
                        exportPdfBtn.disabled = false;
                        exportDocxBtn.disabled = false;
                    } else {
                        throw new Error('AI generation failed');
                    }
                    
                } catch (error) {
                    console.error('AI Generation Error:', error);
                    // Fallback to static template
                    this.generatedContent = this.generateFallbackDocument(data);
                    this.displayResults(this.generatedContent);
                    exportPdfBtn.disabled = false;
                    exportDocxBtn.disabled = false;
                } finally {
                    // Hide loading
                    loadingState.classList.remove('show');
                    draftBtn.disabled = false;
                    draftBtn.textContent = 'ü§ñ Draft with AI';
                }
            }

            generateFallbackDocument(data) {
                const today = new Date().toLocaleDateString();
                const difference = parseFloat(data.actualDamages) - parseFloat(data.settlementOffer);
                return `
SETTLEMENT SHEET

Date: ${today}

Policy Number: ${data.policyNumber}
Claim Number: ${data.claimNumber}
Date of Loss: ${data.dateOfLoss}
Cause of Loss: ${data.causeOfLoss}
Location: ${data.locationOfLoss}

CLAIMANT INFORMATION:
${data.claimantName}
${data.claimantAddress}
${data.phoneNumber ? 'Phone: ' + data.phoneNumber : ''}
${data.email ? 'Email: ' + data.email : ''}

SETTLEMENT ANALYSIS:
- Insurance Settlement Offer: $${data.settlementOffer}
- Actual Damages: $${data.actualDamages}
- Difference: $${difference.toFixed(2)}

POLICY COVERAGE ANALYSIS:
${data.policyCoverage}

ITEMIZED COMPARISON:
${data.itemizedComparison}

DISCREPANCIES:
${data.discrepancies}

RECOMMENDATION:
${data.recommendation}

SUPPORTING EVIDENCE:
${data.supportingEvidence || 'None provided'}

ADDITIONAL INFORMATION:
${data.additionalInfo || 'None'}

This settlement sheet provides a comprehensive analysis of the insurance settlement offer compared to actual damages and policy coverage.

Signature: _________________________ Date: _________

${data.claimantName}

---
Policy Number: ${data.policyNumber}
Claim Number: ${data.claimNumber}
Date of Loss: ${data.dateOfLoss}
Settlement Offer: $${data.settlementOffer}
Actual Damages: $${data.actualDamages}
Difference: $${difference.toFixed(2)}
                `.trim();
            }

            displayResults(content) {
                const resultContainer = document.getElementById('resultContainer');
                const resultContent = document.getElementById('resultContent');
                
                resultContent.textContent = content;
                resultContainer.classList.add('show');
                
                // Scroll to results
                resultContainer.scrollIntoView({ behavior: 'smooth' });
            }

            async exportPDF() {
                if (!this.generatedContent) {
                    alert('Please generate a document first.');
                    return;
                }

                try {
                    const response = await fetch('/netlify/functions/export-pdf', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            content: this.generatedContent,
                            filename: 'settlement-sheet.pdf'
                        })
                    });

                    if (response.ok) {
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'settlement-sheet.pdf';
                        document.body.appendChild(a);
                        a.click();
                        window.URL.revokeObjectURL(url);
                        document.body.removeChild(a);
                    } else {
                        throw new Error('PDF export failed');
                    }
                } catch (error) {
                    console.error('PDF Export Error:', error);
                    alert('Failed to export PDF. Please try again.');
                }
            }

            async exportDOCX() {
                if (!this.generatedContent) {
                    alert('Please generate a document first.');
                    return;
                }

                try {
                    const response = await fetch('/netlify/functions/export-docx', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            content: this.generatedContent,
                            filename: 'settlement-sheet.docx'
                        })
                    });

                    if (response.ok) {
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'settlement-sheet.docx';
                        document.body.appendChild(a);
                        a.click();
                        window.URL.revokeObjectURL(url);
                        document.body.removeChild(a);
                    } else {
                        throw new Error('DOCX export failed');
                    }
                } catch (error) {
                    console.error('DOCX Export Error:', error);
                    alert('Failed to export DOCX. Please try again.');
                }
            }
        }

        // Initialize the generator when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            new SettlementSheetGenerator();
        });
    </script>
</body>
</html>
